import{j as e,r as i,B as t,C as N,bn as ae,A as H}from"./index-DwHm_xfn.js";import{A as k,a as ie,M as le,T as Y,F as ee,I as se,S as te,L as oe}from"./TextField-CFS6yht_.js";import{c as R,T as n,P as z}from"./Typography-3O39rTWb.js";import{C as D,a as A}from"./CardContent-T6ZqzC_F.js";import{C as U}from"./CheckCircle-CgEdPYFv.js";import{B as L}from"./Business-B5w9ux49.js";import{T as ce,R as re}from"./TrendingUp-B33mDqde.js";import{L as Q}from"./LinearProgress-Bt9_20sU.js";import{C as S}from"./listItemTextClasses-D3JvyVNP.js";import{W as de}from"./Warning-BQbennwL.js";import{B as I}from"./Button-DwLQaF7Z.js";import{e as xe,T as he,a as me,b as V,c as y,d as ue}from"./TableRow-CpFPOIXi.js";import{M as je,D as pe}from"./MoreVert-DzGVHVhb.js";import{M as E}from"./MenuItem-DeVymi7x.js";import{d as X,e as W,D as fe,a as ge,b as ye,F as K,c as ve,L as Z,f as be}from"./ListItemText-CIqAQvaJ.js";import{E as _e}from"./Edit-CRKKVfF2.js";import{D as Ce}from"./Delete-BtN1vZx7.js";import{S as B,a as we}from"./Save-CDtLDdtC.js";import{S as Se}from"./Settings-p14i-YRg.js";import{S as Ee}from"./Security-DhOBYZoa.js";import{D as De}from"./Divider-CBmqyGsn.js";import{T as Ae,a as q}from"./Tabs-7ynZqZzg.js";const Te=R([e.jsx("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),e.jsx("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")]),Ie=R(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"})),ne=R(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"})),Ue=R(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),ke=({userRole:x})=>{const[s,c]=i.useState(null),[v,g]=i.useState(!0),[p,f]=i.useState(null);i.useEffect(()=>{w()},[]);const w=async()=>{try{g(!0);const j=await fetch("/admin/api/analytics/overview",{credentials:"include"});if(!j.ok)throw new Error("Failed to fetch analytics");const l=await j.json();if(l.success)c(l.analytics);else throw new Error(l.error||"Failed to load analytics")}catch(j){console.error("Error fetching analytics:",j),f(j instanceof Error?j.message:"Failed to load analytics")}finally{g(!1)}};if(v)return e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(N,{})});if(p)return e.jsx(k,{severity:"error",sx:{mb:3},children:p});if(!s)return null;const h=s.total_users>0?Math.round(s.active_users/s.total_users*100):0,b=s.total_departments>0?Math.round(s.active_departments/s.total_departments*100):0;return e.jsxs(t,{children:[e.jsxs(t,{sx:{mb:3},children:[e.jsx(n,{variant:"h5",gutterBottom:!0,children:"System Overview"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:x==="super_admin"?"System-wide analytics":"Department analytics"})]}),e.jsxs(t,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"repeat(4, 1fr)"},gap:3,mb:4},children:[e.jsx(D,{children:e.jsx(A,{children:e.jsxs(t,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(t,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Total Users"}),e.jsx(n,{variant:"h4",children:s.total_users})]}),e.jsx(ne,{sx:{fontSize:40,color:"primary.main",opacity:.7}})]})})}),e.jsx(D,{children:e.jsx(A,{children:e.jsxs(t,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(t,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Active Users"}),e.jsx(n,{variant:"h4",color:"success.main",children:s.active_users}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[h,"% active"]})]}),e.jsx(U,{sx:{fontSize:40,color:"success.main",opacity:.7}})]})})}),e.jsx(D,{children:e.jsx(A,{children:e.jsxs(t,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(t,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:x==="super_admin"?"Total Departments":"Your Department"}),e.jsx(n,{variant:"h4",children:s.total_departments}),s.active_departments<s.total_departments&&e.jsxs(n,{variant:"body2",color:"warning.main",children:[s.total_departments-s.active_departments," inactive"]})]}),e.jsx(L,{sx:{fontSize:40,color:"info.main",opacity:.7}})]})})}),e.jsx(D,{children:e.jsx(A,{children:e.jsxs(t,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(t,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"New This Month"}),e.jsx(n,{variant:"h4",color:"secondary.main",children:s.recent_users_this_month}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"new users"})]}),e.jsx(ce,{sx:{fontSize:40,color:"secondary.main",opacity:.7}})]})})})]}),e.jsxs(t,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:3},children:[e.jsx(D,{children:e.jsxs(A,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"User Activity"}),e.jsxs(t,{sx:{mb:2},children:[e.jsxs(t,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Active Users"}),e.jsxs(n,{variant:"body2",fontWeight:"bold",children:[s.active_users," / ",s.total_users]})]}),e.jsx(Q,{variant:"determinate",value:h,sx:{height:8,borderRadius:4},color:h>80?"success":h>60?"warning":"error"}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[h,"% of users are active"]})]}),e.jsxs(t,{display:"flex",gap:1,flexWrap:"wrap",children:[e.jsx(S,{size:"small",label:`${s.active_users} Active`,color:"success",variant:"outlined"}),s.total_users-s.active_users>0&&e.jsx(S,{size:"small",label:`${s.total_users-s.active_users} Inactive`,color:"default",variant:"outlined"}),s.recent_users_this_month>0&&e.jsx(S,{size:"small",label:`${s.recent_users_this_month} New This Month`,color:"primary",variant:"outlined"})]})]})}),e.jsx(D,{children:e.jsxs(A,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Department Status"}),e.jsxs(t,{sx:{mb:2},children:[e.jsxs(t,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Active Departments"}),e.jsxs(n,{variant:"body2",fontWeight:"bold",children:[s.active_departments," / ",s.total_departments]})]}),e.jsx(Q,{variant:"determinate",value:b,sx:{height:8,borderRadius:4},color:b>80?"success":b>60?"warning":"error"}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[b,"% of departments are active"]})]}),e.jsxs(t,{display:"flex",gap:1,flexWrap:"wrap",children:[e.jsx(S,{size:"small",label:`${s.active_departments} Active`,color:"success",variant:"outlined"}),s.total_departments-s.active_departments>0&&e.jsx(S,{size:"small",label:`${s.total_departments-s.active_departments} Inactive`,color:"warning",variant:"outlined"}),x==="super_admin"&&e.jsx(S,{size:"small",label:"System Admin",color:"primary",variant:"filled"})]})]})})]}),e.jsx(D,{sx:{mt:3},children:e.jsxs(A,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"System Health"}),e.jsxs(t,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(3, 1fr)"},gap:2},children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(U,{color:"success"}),e.jsx(n,{variant:"body2",children:"User Management: Operational"})]}),e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(U,{color:"success"}),e.jsx(n,{variant:"body2",children:"Department Management: Operational"})]}),e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[s.recent_users_this_month>0?e.jsx(U,{color:"success"}):e.jsx(de,{color:"warning"}),e.jsxs(n,{variant:"body2",children:["User Registration: ",s.recent_users_this_month>0?"Active":"Low Activity"]})]})]})]})})]})},Me=({open:x,user:s,onClose:c,onSave:v,userRole:g})=>{const[p,f]=i.useState({name:"",email:"",role:"",is_active:!0});i.useEffect(()=>{s&&f({name:s.name||"",email:s.email||"",role:s.role||"user",is_active:s.is_active??!0})},[s]);const w=()=>{s&&v(s.id,p)},h=j=>l=>{f(_=>({..._,[j]:l.target.value}))},b=j=>l=>{f(_=>({..._,[j]:l.target.checked}))};return e.jsxs(fe,{open:x,onClose:c,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(ge,{children:["Edit User: ",s==null?void 0:s.email]}),e.jsx(ye,{children:e.jsxs(t,{sx:{pt:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(Y,{label:"Name",fullWidth:!0,value:p.name,onChange:h("name")}),e.jsx(Y,{label:"Email",fullWidth:!0,value:p.email,onChange:h("email"),type:"email"}),e.jsxs(ee,{fullWidth:!0,children:[e.jsx(se,{children:"Role"}),e.jsxs(te,{value:p.role,onChange:h("role"),label:"Role",children:[e.jsx(E,{value:"user",children:"User"}),e.jsx(E,{value:"admin",children:"Admin"}),e.jsx(E,{value:"manager",children:"Manager"}),g==="super_admin"&&e.jsx(E,{value:"super_admin",children:"Super Admin"})]})]}),e.jsx(K,{control:e.jsx(B,{checked:p.is_active,onChange:b("is_active")}),label:"Active User"})]})}),e.jsxs(ve,{children:[e.jsx(I,{onClick:c,children:"Cancel"}),e.jsx(I,{onClick:w,variant:"contained",children:"Save Changes"})]})]})},Fe=({userRole:x})=>{const[s,c]=i.useState([]),[v,g]=i.useState(!0),[p,f]=i.useState(null),[w,h]=i.useState({open:!1,user:null}),[b,j]=i.useState(null),[l,_]=i.useState(null);i.useEffect(()=>{M()},[]);const M=async()=>{try{g(!0);const a=await fetch("/admin/api/users",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch users");const u=await a.json();if(u.success)c(u.users);else throw new Error(u.error||"Failed to load users")}catch(a){console.error("Error fetching users:",a),f(a instanceof Error?a.message:"Failed to load users")}finally{g(!1)}},P=async(a,u)=>{try{const F=await(await fetch(`/admin/api/users/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(u)})).json();if(F.success)c($=>$.map(O=>O.id===a?{...O,...u}:O)),h({open:!1,user:null}),f(null);else throw new Error(F.error||"Failed to update user")}catch(T){console.error("Error updating user:",T),f(T instanceof Error?T.message:"Failed to update user")}},r=async a=>{if(window.confirm("Are you sure you want to delete this user? This action cannot be undone."))try{const T=await(await fetch(`/admin/api/users/${a}`,{method:"DELETE",credentials:"include"})).json();if(T.success)c(F=>F.filter($=>$.id!==a)),f(null);else throw new Error(T.error||"Failed to delete user")}catch(u){console.error("Error deleting user:",u),f(u instanceof Error?u.message:"Failed to delete user")}},d=(a,u)=>{j(a.currentTarget),_(u)},m=()=>{j(null),_(null)},C=a=>{switch(a){case"super_admin":return"error";case"admin":return"warning";case"manager":return"info";default:return"default"}},o=a=>a?new Date(a).toLocaleDateString():"Never";return v?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(N,{})}):e.jsxs(t,{children:[e.jsxs(t,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"h5",children:"User Management"}),e.jsxs(t,{sx:{display:"flex",gap:1},children:[e.jsx(I,{variant:"outlined",startIcon:e.jsx(re,{}),onClick:M,children:"Refresh"}),x==="super_admin"&&e.jsx(I,{variant:"contained",startIcon:e.jsx(Ue,{}),onClick:()=>{},children:"Add User"})]})]}),p&&e.jsx(k,{severity:"error",sx:{mb:3},children:p}),e.jsx(xe,{component:z,children:e.jsxs(he,{children:[e.jsx(me,{children:e.jsxs(V,{children:[e.jsx(y,{children:"User"}),e.jsx(y,{children:"Department"}),e.jsx(y,{children:"Role"}),e.jsx(y,{children:"Status"}),e.jsx(y,{children:"Created"}),e.jsx(y,{children:"Last Login"}),e.jsx(y,{children:"Actions"})]})}),e.jsxs(ue,{children:[s.map(a=>e.jsxs(V,{children:[e.jsx(y,{children:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:"bold",children:a.name}),e.jsx(n,{variant:"body2",color:"text.secondary",children:a.email})]})}),e.jsx(y,{children:e.jsx(n,{variant:"body2",children:a.department_name||"No Department"})}),e.jsx(y,{children:e.jsx(S,{label:a.role.replace("_"," ").toUpperCase(),color:C(a.role),size:"small"})}),e.jsx(y,{children:e.jsx(S,{label:a.is_active?"Active":"Inactive",color:a.is_active?"success":"default",size:"small",icon:a.is_active?e.jsx(U,{}):e.jsx(Ie,{})})}),e.jsx(y,{children:e.jsx(n,{variant:"body2",children:o(a.created_at)})}),e.jsx(y,{children:e.jsx(n,{variant:"body2",children:o(a.last_login)})}),e.jsx(y,{children:e.jsx(ie,{onClick:u=>d(u,a),children:e.jsx(je,{})})})]},a.id)),s.length===0&&e.jsx(V,{children:e.jsx(y,{colSpan:7,align:"center",children:e.jsx(n,{variant:"body2",color:"text.secondary",sx:{py:4},children:"No users found"})})})]})]})}),e.jsxs(le,{anchorEl:b,open:!!b,onClose:m,children:[e.jsxs(E,{onClick:()=>{l&&h({open:!0,user:l}),m()},children:[e.jsx(X,{children:e.jsx(_e,{fontSize:"small"})}),e.jsx(W,{children:"Edit User"})]}),e.jsxs(E,{onClick:()=>{l&&r(l.id),m()},children:[e.jsx(X,{children:e.jsx(Ce,{fontSize:"small"})}),e.jsx(W,{children:"Delete User"})]})]}),e.jsx(Me,{open:w.open,user:w.user,onClose:()=>h({open:!1,user:null}),onSave:P,userRole:x})]})},Be=({userRole:x})=>{const[s,c]=i.useState([]),[v,g]=i.useState(!0),[p,f]=i.useState(!1),[w,h]=i.useState(null),[b,j]=i.useState(null);i.useEffect(()=>{l()},[]);const l=async()=>{try{g(!0);const r=await fetch("/admin/api/departments",{credentials:"include"});if(!r.ok)throw new Error("Failed to fetch departments");const d=await r.json();if(d.success)c(d.departments);else throw new Error(d.error||"Failed to load departments")}catch(r){console.error("Error fetching departments:",r),h(r instanceof Error?r.message:"Failed to load departments")}finally{g(!1)}},_=async(r,d)=>{try{f(!0);const C=await(await fetch(`/admin/api/departments/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)})).json();if(C.success)c(o=>o.map(a=>a.id===r?{...a,...d}:a)),j("Department updated successfully"),h(null),setTimeout(()=>{j(null)},3e3);else throw new Error(C.error||"Failed to update department")}catch(m){console.error("Error updating department:",m),h(m instanceof Error?m.message:"Failed to update department")}finally{f(!1)}},M=r=>{switch(r){case"fire":return"error";case"ems":return"info";case"combined":return"warning";default:return"default"}},P=r=>new Date(r).toLocaleDateString();return v?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(N,{})}):e.jsxs(t,{children:[e.jsxs(t,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(n,{variant:"h5",children:"Department Settings"}),e.jsx(I,{variant:"outlined",startIcon:e.jsx(re,{}),onClick:l,children:"Refresh"})]}),w&&e.jsx(k,{severity:"error",sx:{mb:3},children:w}),b&&e.jsx(k,{severity:"success",sx:{mb:3},children:b}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3},children:[s.map(r=>e.jsx(D,{children:e.jsxs(A,{children:[e.jsxs(t,{sx:{mb:3},children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:2,sx:{mb:2},children:[e.jsx(L,{color:"primary"}),e.jsx(n,{variant:"h6",children:r.name}),e.jsx(S,{label:r.department_type.toUpperCase(),color:M(r.department_type),size:"small"}),e.jsx(S,{label:r.is_active?"Active":"Inactive",color:r.is_active?"success":"default",size:"small"})]}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Department Code: ",r.code," • Created: ",P(r.created_at)," • ",r.user_count," Users"]})]}),e.jsxs(t,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:3},children:[e.jsxs(t,{children:[e.jsxs(n,{variant:"subtitle1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Se,{fontSize:"small"}),"Basic Settings"]}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(Y,{label:"Department Name",fullWidth:!0,value:r.name,onChange:d=>{const m=d.target.value;c(C=>C.map(o=>o.id===r.id?{...o,name:m}:o))},size:"small"}),e.jsxs(ee,{fullWidth:!0,size:"small",children:[e.jsx(se,{children:"Department Type"}),e.jsxs(te,{value:r.department_type,onChange:d=>{const m=d.target.value;c(C=>C.map(o=>o.id===r.id?{...o,department_type:m}:o))},label:"Department Type",children:[e.jsx(E,{value:"fire",children:"Fire"}),e.jsx(E,{value:"ems",children:"EMS"}),e.jsx(E,{value:"combined",children:"Combined Fire/EMS"})]})]}),x==="super_admin"&&e.jsx(K,{control:e.jsx(B,{checked:r.is_active,onChange:d=>{const m=d.target.checked;c(C=>C.map(o=>o.id===r.id?{...o,is_active:m}:o))}}),label:"Department Active"})]})]}),e.jsxs(t,{children:[e.jsxs(n,{variant:"subtitle1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ee,{fontSize:"small"}),"Advanced Settings"]}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(K,{control:e.jsx(B,{checked:r.api_enabled,onChange:d=>{const m=d.target.checked;c(C=>C.map(o=>o.id===r.id?{...o,api_enabled:m}:o))}}),label:"API Access Enabled"}),e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Available Features"}),e.jsx(z,{variant:"outlined",sx:{p:2},children:e.jsxs(oe,{dense:!0,children:[Object.entries(r.features_enabled||{}).map(([d,m])=>e.jsxs(Z,{divider:!0,children:[e.jsx(W,{primary:d.replace("_"," ").toUpperCase(),secondary:m?"Enabled":"Disabled"}),e.jsx(be,{children:e.jsx(B,{edge:"end",checked:m,onChange:C=>{const o={...r.features_enabled,[d]:C.target.checked};c(a=>a.map(u=>u.id===r.id?{...u,features_enabled:o}:u))}})})]},d)),Object.keys(r.features_enabled||{}).length===0&&e.jsx(Z,{children:e.jsx(W,{primary:"No features configured",secondary:"Contact administrator to enable features"})})]})})]})]})]}),e.jsx(De,{sx:{my:3}}),e.jsx(t,{display:"flex",justifyContent:"flex-end",children:e.jsx(I,{variant:"contained",startIcon:e.jsx(we,{}),onClick:()=>_(r.id,{name:r.name,department_type:r.department_type,is_active:r.is_active,api_enabled:r.api_enabled,features_enabled:r.features_enabled}),disabled:p,children:p?"Saving...":"Save Changes"})})]})},r.id)),s.length===0&&e.jsxs(z,{sx:{p:4,textAlign:"center"},children:[e.jsx(L,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Departments Found"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:x==="super_admin"?"Create a new department to get started.":"Contact your administrator to set up departments."})]})]})]})};function J(x){const{children:s,value:c,index:v,...g}=x;return e.jsx("div",{role:"tabpanel",hidden:c!==v,id:`admin-tabpanel-${v}`,"aria-labelledby":`admin-tab-${v}`,...g,children:c===v&&e.jsx(t,{sx:{pt:3},children:s})})}function G(x){return{id:`admin-tab-${x}`,"aria-controls":`admin-tabpanel-${x}`}}const ns=()=>{const x=ae(),[s,c]=i.useState(0),[v,g]=i.useState(!0),[p,f]=i.useState(null),[w,h]=i.useState(null);i.useEffect(()=>{b()},[]);const b=async()=>{try{g(!0);const l=await fetch("/auth/api/me",{credentials:"include"});if(!l.ok)throw new Error("Authentication required");const _=await l.json();if(!_.is_admin&&!_.is_super_admin)throw new Error("Admin access required");h(_.is_super_admin?"super_admin":"admin")}catch(l){console.error("Admin access check failed:",l),f(l instanceof Error?l.message:"Access denied"),setTimeout(()=>{x("/login")},2e3)}finally{g(!1)}},j=(l,_)=>{c(_)};return v?e.jsx(H,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(N,{size:60})})}):p?e.jsx(H,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsx(k,{severity:"error",children:p})}):e.jsxs(H,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(t,{sx:{mb:4},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Te,{sx:{fontSize:40,color:"primary.main"}}),e.jsxs(t,{sx:{flexGrow:1},children:[e.jsx(n,{variant:"h4",component:"h1",gutterBottom:!0,children:"Admin Console"}),e.jsx(n,{variant:"subtitle1",color:"text.secondary",children:"Manage departments, users, and system settings"})]}),e.jsx(I,{variant:"outlined",onClick:()=>x("/"),sx:{mr:2},children:"Back to Tools"})]})}),e.jsx(z,{sx:{mb:3},children:e.jsxs(Ae,{value:s,onChange:j,"aria-label":"admin navigation tabs",variant:"fullWidth",children:[e.jsx(q,{icon:e.jsx(pe,{}),label:"Overview",...G(0)}),e.jsx(q,{icon:e.jsx(ne,{}),label:"User Management",...G(1)}),e.jsx(q,{icon:e.jsx(L,{}),label:"Department Settings",...G(2)})]})}),e.jsx(J,{value:s,index:0,children:e.jsx(ke,{userRole:w})}),e.jsx(J,{value:s,index:1,children:e.jsx(Fe,{userRole:w})}),e.jsx(J,{value:s,index:2,children:e.jsx(Be,{userRole:w})})]})};export{ns as default};
