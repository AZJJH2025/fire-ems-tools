var jt=Object.defineProperty;var wt=(a,t,o)=>t in a?jt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;var ne=(a,t,o)=>wt(a,typeof t!="symbol"?t+"":t,o);import{r as x,k as st,ca as Xe,aq as St,ai as Tt,j as e,s as nt,m as Oe,o as ot,cb as Pt,B as Rt,cc as kt,p as rt,aB as we,cd as ge,h as It,i as At,n as it,e as lt,J as ae,ce as ze,cf as be,aC as $e,aT as Fe,t as F,cg as ke,aE as Me,b7 as We,v as m,K as te,au as le,at as ce,b1 as Ie,ch as Je,b2 as de,H as He,I as Ge,a9 as K,G as E,V as oe,bE as re,b9 as ct,as as De,R as ve,q as _,ci as Le,cj as dt,ck as je,cl as ut,cm as Ue,cn as Ne,co as _e,cp as pt,be as Et,bf as me,cq as zt,P as xe,W as U,O as N,bO as Qe,a1 as ue,bw as et,cr as ht,cs as gt,ct as $t,ad as Ft,cu as Se,aM as fe,a$ as ye,cv as Mt,cw as Dt,cx as Lt,cy as Nt,a7 as qe,b0 as Ae,D as Ce,cz as Be,cA as mt,cB as ft,cC as Bt,cD as Ot,cE as Ht,cF as yt,cG as xt,X as pe,c5 as Ve,cH as Gt,aS as Wt,cI as vt,aY as Ut,aZ as _t,a_ as qt,Q as Vt,cJ as Yt,c1 as Zt,b3 as Kt,cK as Xt}from"./index-CzXFL0VC.js";import{S as Jt,A as Qt,a as ea}from"./A11yProvider-CMmpglKo.js";import{F as ta}from"./FilterList-ET4bv2wj.js";import{l as Q}from"./leaflet-BDm3c01f.js";import{a as aa,b as sa,t as Te,P as na,C as oa,T as tt}from"./PureLeafletMap-C1CPrPoa.js";import{C as bt}from"./Cancel-BhZjS6yk.js";import{a as Pe}from"./jspdf.plugin.autotable-CtA5BUKo.js";import{G as ra}from"./Gavel-CtD449Zm.js";import{B as ia}from"./BusinessCenter-kSPfP3Pz.js";import{u as la,F as ca,a as da}from"./FullscreenExit-D4NvYb8T.js";import{M as ua,E as pa,D as ha}from"./Menu-Bp2bJCad.js";function ga(a){return x.Children.toArray(a).filter(t=>x.isValidElement(t))}const ma=(a,t)=>{const{ownerState:o}=a;return[t.root,o.dense&&t.dense,o.alignItems==="flex-start"&&t.alignItemsFlexStart,o.divider&&t.divider,!o.disableGutters&&t.gutters]},fa=a=>{const{alignItems:t,classes:o,dense:b,disabled:u,disableGutters:s,divider:v,selected:l}=a,p=ot({root:["root",b&&"dense",!s&&"gutters",v&&"divider",u&&"disabled",t==="flex-start"&&"alignItemsFlexStart",l&&"selected"]},Pt,o);return{...o,...p}},ya=nt(Rt,{shouldForwardProp:a=>kt(a)||a==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:ma})(rt(({theme:a})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:a.transitions.create("background-color",{duration:a.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(a.vars||a).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${ge.selected}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / ${a.vars.palette.action.selectedOpacity})`:we(a.palette.primary.main,a.palette.action.selectedOpacity),[`&.${ge.focusVisible}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.focusOpacity}))`:we(a.palette.primary.main,a.palette.action.selectedOpacity+a.palette.action.focusOpacity)}},[`&.${ge.selected}:hover`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.hoverOpacity}))`:we(a.palette.primary.main,a.palette.action.selectedOpacity+a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / ${a.vars.palette.action.selectedOpacity})`:we(a.palette.primary.main,a.palette.action.selectedOpacity)}},[`&.${ge.focusVisible}`]:{backgroundColor:(a.vars||a).palette.action.focus},[`&.${ge.disabled}`]:{opacity:(a.vars||a).palette.action.disabledOpacity},variants:[{props:({ownerState:t})=>t.divider,style:{borderBottom:`1px solid ${(a.vars||a).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:t})=>!t.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:t})=>t.dense,style:{paddingTop:4,paddingBottom:4}}]}))),at=x.forwardRef(function(t,o){const b=st({props:t,name:"MuiListItemButton"}),{alignItems:u="center",autoFocus:s=!1,component:v="div",children:l,dense:C=!1,disableGutters:p=!1,divider:D=!1,focusVisibleClassName:W,selected:c=!1,className:i,...j}=b,A=x.useContext(Xe),f=x.useMemo(()=>({dense:C||A.dense||!1,alignItems:u,disableGutters:p}),[u,A.dense,C,p]),d=x.useRef(null);St(()=>{s&&d.current&&d.current.focus()},[s]);const r={...b,alignItems:u,dense:f.dense,disableGutters:p,divider:D,selected:c},h=fa(r),g=Tt(d,o);return e.jsx(Xe.Provider,{value:f,children:e.jsx(ya,{ref:g,href:j.href||j.to,component:(j.href||j.to)&&v==="div"?"button":v,focusVisibleClassName:Oe(h.focusVisible,W),ownerState:r,className:Oe(h.root,i),...j,classes:h,children:l})})});function xa(a){return At("MuiToggleButtonGroup",a)}const Z=It("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),va=a=>{const{classes:t,orientation:o,fullWidth:b,disabled:u}=a,s={root:["root",o,b&&"fullWidth"],grouped:["grouped",`grouped${it(o)}`,u&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return ot(s,xa,t)},ba=nt("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(a,t)=>{const{ownerState:o}=a;return[{[`& .${Z.grouped}`]:t.grouped},{[`& .${Z.grouped}`]:t[`grouped${it(o.orientation)}`]},{[`& .${Z.firstButton}`]:t.firstButton},{[`& .${Z.lastButton}`]:t.lastButton},{[`& .${Z.middleButton}`]:t.middleButton},t.root,o.orientation==="vertical"&&t.vertical,o.fullWidth&&t.fullWidth]}})(rt(({theme:a})=>({display:"inline-flex",borderRadius:(a.vars||a).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${Z.grouped}`]:{[`&.${Z.selected} + .${Z.grouped}.${Z.selected}`]:{borderTop:0,marginTop:0}},[`& .${Z.firstButton},& .${Z.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${Z.lastButton},& .${Z.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${Z.lastButton}.${Te.disabled},& .${Z.middleButton}.${Te.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${Z.grouped}`]:{[`&.${Z.selected} + .${Z.grouped}.${Z.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${Z.firstButton},& .${Z.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${Z.lastButton},& .${Z.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${Z.lastButton}.${Te.disabled},& .${Z.middleButton}.${Te.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),Ca=x.forwardRef(function(t,o){const b=st({props:t,name:"MuiToggleButtonGroup"}),{children:u,className:s,color:v="standard",disabled:l=!1,exclusive:C=!1,fullWidth:p=!1,onChange:D,orientation:W="horizontal",size:c="medium",value:i,...j}=b,A={...b,disabled:l,fullWidth:p,orientation:W,size:c},f=va(A),d=x.useCallback((z,L)=>{if(!D)return;const H=i&&i.indexOf(L);let q;i&&H>=0?(q=i.slice(),q.splice(H,1)):q=i?i.concat(L):[L],D(z,q)},[D,i]),r=x.useCallback((z,L)=>{D&&D(z,i===L?null:L)},[D,i]),h=x.useMemo(()=>({className:f.grouped,onChange:C?r:d,value:i,size:c,fullWidth:p,color:v,disabled:l}),[f.grouped,C,r,d,i,c,p,v,l]),g=ga(u),y=g.length,T=z=>{const L=z===0,H=z===y-1;return L&&H?"":L?f.firstButton:H?f.lastButton:f.middleButton};return e.jsx(ba,{role:"group",className:Oe(f.root,s),ref:o,ownerState:A,...j,children:e.jsx(aa.Provider,{value:h,children:g.map((z,L)=>e.jsx(sa.Provider,{value:T(L),children:z},L))})})}),ja=lt(e.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"})),Ee=lt(e.jsx("path",{d:"M12 2c-5.33 4.55-8 8.48-8 11.8 0 4.98 3.8 8.2 8 8.2s8-3.22 8-8.2c0-3.32-2.67-7.25-8-11.8M7.83 14c.37 0 .67.26.74.62.41 2.22 2.28 2.98 3.64 2.87.43-.02.79.32.79.75 0 .4-.32.73-.72.75-2.13.13-4.62-1.09-5.19-4.12-.08-.45.28-.87.74-.87"})),wa=[{id:"rural",name:"Rural Fire Department",description:"Mixed tanks and hydrants for rural coverage",file:"/src/test-data/water-supply-rural-dept.csv",preview:"6 Tanks + 4 Hydrants (Salt Lake Rural Area)",tanks:6,hydrants:4},{id:"suburban",name:"Suburban Fire Department",description:"Primarily hydrant-based suburban coverage",file:"/src/test-data/water-supply-suburban-dept.csv",preview:"2 Tanks + 10 Hydrants (Denver Suburban)",tanks:2,hydrants:10},{id:"mixed",name:"Mixed Coverage Area",description:"Complex coverage with gaps and clusters",file:"/src/test-data/water-supply-mixed-coverage.csv",preview:"6 Tanks + 7 Hydrants (Charlotte Mixed)",tanks:6,hydrants:7}],Sa=({open:a,onClose:t})=>{const o=ae(),[b,u]=x.useState(!1),[s,v]=x.useState(null),[l,C]=x.useState(!1),p=x.useCallback(d=>{try{const r=d.trim();if(!r)return[];const h=r.split(/\r?\n/).filter(z=>z.trim());if(h.length<2)return[];const g=z=>{const L=[];let H="",q=!1;for(let V=0;V<z.length;V++){const P=z[V],S=z[V+1];P==='"'?q&&S==='"'?(H+='"',V++):q=!q:P===","&&!q?(L.push(H.trim()),H=""):H+=P}return L.push(H.trim()),L},y=g(h[0]).map(z=>z.replace(/^["']|["']$/g,"").trim());console.log("🔍 WATER SUPPLY CSV HEADERS FOUND:",y);const T=h.slice(1).map((z,L)=>{const H=g(z),q={};return y.forEach((V,P)=>{let S=H[P]||"";S=S.replace(/^["']|["']$/g,"").trim(),q[V]=S}),q}).filter(z=>Object.values(z).some(L=>L!==""));if(T.length>0){console.log("🔍 FIRST RECORD SAMPLE:",T[0]),console.log("🔍 TOTAL RECORDS PARSED:",T.length);const z=y.filter(L=>/^(x|y|lat|lng|lon|latitude|longitude)$/i.test(L)||L.toLowerCase().includes("coord"));console.log("🔍 COORDINATE-RELATED FIELDS FOUND:",z)}return T}catch(r){return console.error("🔥 CSV PARSING ERROR:",r),[]}},[]),D=x.useCallback((d,r,h,g)=>{const y=parseInt(d.Capacity_Gallons||d.Capacity||"25000");return{name:g,location:{latitude:r,longitude:h},capacity:isNaN(y)?25e3:y,type:"municipal",accessRating:d.Access_Rating||"good",operationalStatus:d.Operational_Status||"active",owner:d.Owner||"Fire Department",contactInfo:"",notes:d.Notes||"",created:new Date,modified:new Date}},[]),W=x.useCallback((d,r,h,g)=>{const y=parseInt(d.Flow_Rate_GPM||d.FlowRate||"1000"),T=parseInt(d.Static_Pressure_PSI||d.Pressure||"50");return{name:g,location:{latitude:r,longitude:h},flowRate:isNaN(y)?1e3:y,staticPressure:isNaN(T)?50:T,residualPressure:Math.max(T-30,20),type:"municipal",size:"4-inch",operationalStatus:d.Operational_Status||"active",owner:d.Owner||"Water Department",contactInfo:"",notes:d.Notes||"",created:new Date,modified:new Date}},[]),c=x.useCallback(async d=>{try{const r=p(d),h={tanks:0,hydrants:0,errors:[],warnings:[]};for(const g of r)try{h.tanks+h.hydrants<3&&console.log(`🔍 PROCESSING RECORD #${h.tanks+h.hydrants+1}:`,g);let y,T,z="",L="";const H=["Latitude","latitude","LAT","lat","Y","y","LATITUDE"],q=["Longitude","longitude","LNG","lng","LON","lon","X","x","LONGITUDE"];for(const w of H)if(g[w]&&g[w]!==""){const $=parseFloat(g[w]);if(!isNaN($)&&Math.abs($)<=90){y=$,z=w;break}}for(const w of q)if(g[w]&&g[w]!==""){const $=parseFloat(g[w]);if(!isNaN($)&&Math.abs($)<=180){T=$,L=w;break}}if(isNaN(y)||isNaN(T)){const w=Object.keys(g).filter($=>{const G=parseFloat(g[$]);return!isNaN(G)&&g[$]!==""});console.log("🔍 FALLBACK: Looking for coordinates in numeric fields:",w);for(const $ of w){const G=parseFloat(g[$]);Math.abs(G)<=90&&isNaN(y)?(y=G,z=`${$} (auto-detected)`):Math.abs(G)<=180&&isNaN(T)&&(T=G,L=`${$} (auto-detected)`)}}const V=g.Name||g.name||g.NAME||g.HYD_ID||g.ST_NAME||g.STATION||g.station||g.ID||g.id||`Item ${h.tanks+h.hydrants+1}`;if(console.log(`🔍 COORDINATE PARSING: lat=${y} (from ${z}), lng=${T} (from ${L})`),y===void 0||T===void 0||isNaN(y)||isNaN(T)){const w=Object.keys(g).filter($=>g[$]!=="");h.errors.push(`Invalid coordinates for ${V}: Could not find valid lat/lng. Available fields: ${w.join(", ")}. Tried lat from: ${H.join(", ")}. Tried lng from: ${q.join(", ")}.`);continue}const P=(g.Type||"").toLowerCase(),S=g.Capacity_Gallons||g.Capacity,R=g.Flow_Rate_GPM||g.FlowRate;if(P==="tank"||S&&!R){const w=D(g,y,T,V);o(ze(w)),h.tanks++}else if(P==="hydrant"||R){const w=W(g,y,T,V);o(be(w)),h.hydrants++}else{h.warnings.push(`Unclear type for ${V} - defaulting to hydrant`);const w=W(g,y,T,V);o(be(w)),h.hydrants++}}catch(y){h.errors.push(`Error processing ${g.Name}: ${y}`)}return h}catch(r){throw new Error(`CSV parsing failed: ${r}`)}},[p,D,W,o]),i=x.useCallback(async d=>{d.preventDefault(),C(!1),u(!0);try{const h=Array.from(d.dataTransfer.files).find(T=>T.name.endsWith(".csv"));if(!h)throw new Error("Please drop a CSV file");const g=await h.text(),y=await c(g);v(y)}catch(r){v({tanks:0,hydrants:0,errors:[`Import failed: ${r}`],warnings:[]})}finally{u(!1)}},[c]),j=x.useCallback(async d=>{var h;const r=(h=d.target.files)==null?void 0:h[0];if(r){u(!0);try{const g=await r.text(),y=await c(g);v(y)}catch(g){v({tanks:0,hydrants:0,errors:[`Import failed: ${g}`],warnings:[]})}finally{u(!1)}}},[c]),A=x.useCallback(async d=>{u(!0);try{let r=`Name,Type,Latitude,Longitude,Capacity_Gallons,Flow_Rate_GPM,Static_Pressure_PSI,Access_Rating,Operational_Status,Owner,Notes
`;const h={lat:39.8283,lng:-98.5795};for(let y=0;y<d.tanks;y++){const T=h.lat+(Math.random()-.5)*.1,z=h.lng+(Math.random()-.5)*.1,L=[25e3,5e4,75e3][Math.floor(Math.random()*3)];r+=`"${d.name} Tank ${y+1}",tank,${T},${z},${L},,,"good","active","${d.name}","Test tank"
`}for(let y=0;y<d.hydrants;y++){const T=h.lat+(Math.random()-.5)*.1,z=h.lng+(Math.random()-.5)*.1,L=[1e3,1200,1500][Math.floor(Math.random()*3)],H=[50,65,80][Math.floor(Math.random()*3)];r+=`"${d.name} Hydrant ${y+1}",hydrant,${T},${z},,${L},${H},"excellent","active","City Water","Test hydrant"
`}const g=await c(r);v(g)}catch(r){v({tanks:0,hydrants:0,errors:[`Test scenario load failed: ${r}`],warnings:[]})}finally{u(!1)}},[c]),f=()=>{v(null),t()};return e.jsxs($e,{open:a,onClose:f,maxWidth:"md",fullWidth:!0,children:[e.jsx(Fe,{children:e.jsxs(F,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ke,{}),"Water Supply Data Import"]})}),e.jsxs(Me,{children:[b&&e.jsxs(F,{mb:2,children:[e.jsx(We,{}),e.jsx(m,{variant:"body2",sx:{mt:1},children:"Processing water supply data..."})]}),s&&e.jsxs(te,{severity:s.errors.length>0?"error":"success",sx:{mb:2},children:[e.jsxs(m,{variant:"subtitle2",children:["Import Complete: ",s.tanks," tanks, ",s.hydrants," hydrants added"]}),s.errors.length>0&&e.jsx(le,{dense:!0,children:s.errors.map((d,r)=>e.jsxs(ce,{children:[e.jsx(Ie,{children:e.jsx(Je,{color:"error"})}),e.jsx(de,{primary:d})]},r))}),s.warnings.length>0&&e.jsx(le,{dense:!0,children:s.warnings.map((d,r)=>e.jsxs(ce,{children:[e.jsx(Ie,{children:e.jsx(Je,{color:"warning"})}),e.jsx(de,{primary:d})]},r))})]}),e.jsx(He,{sx:{mb:3},children:e.jsxs(Ge,{children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"Upload CSV File"}),e.jsxs(F,{onDrop:i,onDragOver:d=>{d.preventDefault(),C(!0)},onDragLeave:()=>C(!1),sx:{border:2,borderColor:l?"primary.main":"grey.300",borderStyle:"dashed",borderRadius:2,p:3,textAlign:"center",bgcolor:l?"primary.50":"grey.50",cursor:"pointer"},children:[e.jsx(ke,{sx:{fontSize:48,color:"grey.500",mb:1}}),e.jsx(m,{variant:"body1",gutterBottom:!0,children:"Drag and drop your CSV file here, or click to browse"}),e.jsx(m,{variant:"body2",color:"text.secondary",children:"Supports: Name, Type, Latitude, Longitude, Capacity, Flow Rate, Pressure"}),e.jsx("input",{type:"file",accept:".csv",onChange:j,style:{display:"none"},id:"csv-upload"}),e.jsx("label",{htmlFor:"csv-upload",children:e.jsx(K,{variant:"contained",component:"span",sx:{mt:2},children:"Browse Files"})})]})]})}),e.jsx(m,{variant:"h6",gutterBottom:!0,children:"Quick Test Scenarios"}),e.jsx(E,{container:!0,spacing:2,children:wa.map(d=>e.jsx(E,{size:{xs:12,md:4},children:e.jsxs(He,{children:[e.jsxs(Ge,{children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:d.name}),e.jsx(m,{variant:"body2",color:"text.secondary",paragraph:!0,children:d.description}),e.jsxs(F,{display:"flex",gap:1,mb:1,children:[e.jsx(oe,{icon:e.jsx(re,{}),label:`${d.tanks} Tanks`,size:"small",color:"primary"}),e.jsx(oe,{icon:e.jsx(Ee,{}),label:`${d.hydrants} Hydrants`,size:"small",color:"secondary"})]}),e.jsx(m,{variant:"caption",color:"text.secondary",children:d.preview})]}),e.jsx(ct,{children:e.jsx(K,{size:"small",onClick:()=>A(d),disabled:b,startIcon:e.jsx(ja,{}),children:"Load Test Data"})})]})},d.id))})]}),e.jsx(De,{children:e.jsx(K,{onClick:f,children:"Close"})})]})},Ta=({mode:a})=>{const t=ae(),[o,b]=ve.useState(!1),u=_(Le),s=_(dt),v=_(je),l=_(ut),C=_(Ue),p=_(Ne),D=_(_e),W=_(pt),c=(n,k)=>{t(zt(k))},i=()=>{if(u.length+v.length===0){alert("Please add at least one water supply (tank or hydrant) before running analysis.");return}t(Ot()),console.log("🔬 Starting coverage analysis for",u.length,"tanks and",v.length,"hydrants..."),setTimeout(()=>{const k=j(u,v,D);t(Ht(k)),console.log("✅ Analysis complete:",k)},2e3)},j=(n,k,B)=>{const O=[...n,...k].map(J=>A(J,B)),I=d(O),Y=r(O,n,k,B),X=g(Y,I);return{totalTanks:n.length,totalHydrants:k.length,totalSupplies:n.length+k.length,coveragePercentage:I.overallCoverage,averageResponseTime:I.averageResponseTime,totalCoverageArea:I.totalArea,gapAreas:Y,redundancyAreas:h(O),recommendations:X,coverageZones:O,generatedAt:new Date,analysisParameters:B}},A=(n,k)=>{const B="flowRate"in n;let O;if(B){const X=Math.min(n.flowRate/1e3,2),J=Math.min(n.staticPressure/50,1.5);O=800*X*J,k.terrainFactor&&(O*=.9),k.roadAccessOnly&&(O*=.8)}else{const X=Math.min(n.capacity/25e3,2),J=n.accessRating==="excellent"?1.2:n.accessRating==="good"?1:.8;O=1e3*X*J,k.terrainFactor&&(O*=.85),k.seasonalFactors&&(O*=.9)}const I=O*.3048;return{supplyId:n.id,supplyType:B?"hydrant":"tank",location:n.location,effectiveRadius:O,radiusMeters:I,coverageArea:Math.PI*Math.pow(I,2),responseTime:f(O,k),capacity:B?n.flowRate:n.capacity,reliability:n.operationalStatus==="active"?1:.5}},f=(n,k)=>{const B=n/25,O=120,I=k.roadAccessOnly?30:60;return B+O+I},d=(n,k)=>{const B=n.reduce((X,J)=>X+J.coverageArea,0),O=n.reduce((X,J)=>X+J.responseTime,0)/n.length,I=5e7,Y=Math.min(B/I*100,95);return{overallCoverage:Math.round(Y*10)/10,averageResponseTime:Math.round(O),totalArea:Math.round(B),supplyDensity:n.length/(I/1e6)}},r=(n,k,B,O)=>{const I=[],Y=O.maxEffectiveDistance*.3048;if(n.length>=2)for(let X=0;X<n.length;X++)for(let J=X+1;J<n.length;J++){const se=n[X],he=n[J],Ye=y(se.location,he.location)*1e3,Ze=se.radiusMeters+he.radiusMeters;if(Ye>Ze*1.5){const Ct={latitude:(se.location.latitude+he.location.latitude)/2,longitude:(se.location.longitude+he.location.longitude)/2},ie=Ye-Ze,Ke=ie>Y*2?"critical":ie>Y?"high":"medium";I.push({id:`gap-${X}-${J}`,location:Ct,area:Math.PI*Math.pow(ie/2,2),severity:Ke,distance:ie,affectedZones:[se.supplyId,he.supplyId],nearestSupply:{supplyId:se.supplyId,supplyType:se.supplyType,distance:ie/2,accessTime:f(ie/2/.3048,O)},riskAssessment:Ke==="critical"?"high":"medium"})}}return I},h=n=>{const k=[];for(let B=0;B<n.length;B++)for(let O=B+1;O<n.length;O++){const I=n[B],Y=n[O],X=y(I.location,Y.location)*1e3,J=I.radiusMeters+Y.radiusMeters;X<J*.8&&k.push({id:`redundancy-${B}-${O}`,area:Math.PI*Math.pow(Math.min(I.radiusMeters,Y.radiusMeters),2),tankCount:2,totalCapacity:(I.capacity||0)+(Y.capacity||0),efficiency:1-X/J,geometry:[]})}return k},g=(n,k,B,O)=>{const I=[];return n.filter(Y=>Y.severity==="critical").forEach((Y,X)=>{I.push({id:`rec-gap-${X}`,type:"new-tank",priority:"high",title:"Address Critical Coverage Gap",description:`Critical coverage gap of ${(Y.area/4047).toFixed(1)} acres identified requiring immediate attention.`,proposedLocation:Y.location,estimatedCost:Y.area>1e5?15e4:75e3,expectedBenefit:`Improve response time by ${Math.round(Y.nearestSupply.accessTime/60)} minutes for affected area`,implementation:Y.area>1e5?"Install 50,000 gallon tank with excellent road access":"Install 25,000 gallon tank or high-flow hydrant (1500+ GPM)"})}),k.overallCoverage<80&&I.push({id:"rec-coverage",type:"increase-capacity",priority:"medium",title:"Improve Overall Coverage",description:`Current coverage at ${k.overallCoverage}% is below recommended 80% minimum.`,estimatedCost:2e5,expectedBenefit:`Increase coverage to 85%+ with ${Math.ceil((80-k.overallCoverage)/10)} additional supplies`,implementation:"Strategic placement of 2-3 additional water supplies in underserved areas"}),k.averageResponseTime>600&&I.push({id:"rec-response-time",type:"upgrade-access",priority:"medium",title:"Reduce Average Response Time",description:`Average response time of ${Math.round(k.averageResponseTime/60)} minutes exceeds NFPA recommendations.`,estimatedCost:1e5,expectedBenefit:"Reduce average response time to under 8 minutes",implementation:"Optimize supply placement and improve access roads to existing supplies"}),I},y=(n,k)=>{const O=(k.latitude-n.latitude)*Math.PI/180,I=(k.longitude-n.longitude)*Math.PI/180,Y=Math.sin(O/2)*Math.sin(O/2)+Math.cos(n.latitude*Math.PI/180)*Math.cos(k.latitude*Math.PI/180)*Math.sin(I/2)*Math.sin(I/2);return 6371*(2*Math.atan2(Math.sqrt(Y),Math.sqrt(1-Y)))},T=n=>{p.selectedTanks.includes(n)?t(mt(n)):t(ft(n))},z=n=>{t(Bt(n))},L=()=>{const n={name:`Tank ${u.length+1}`,location:{latitude:39.8283+(Math.random()-.5)*.1,longitude:-98.5795+(Math.random()-.5)*.1},capacity:25e3,type:"municipal",accessRating:"good",operationalStatus:"active",owner:"Fire Department",contactInfo:"",notes:"Added via Add Tank button"};t(ze(n)),console.log("🎯 Tank added:",n)},H=()=>{const n={name:`Hydrant ${v.length+1}`,location:{latitude:39.8283+(Math.random()-.5)*.1,longitude:-98.5795+(Math.random()-.5)*.1},flowRate:1e3,staticPressure:65,residualPressure:20,type:"municipal",size:"4.5-inch",operationalStatus:"active",owner:"Water Department",notes:"Added via Add Hydrant button"};t(be(n)),console.log("🚰 Hydrant added:",n)},q=()=>{b(!0)},V=n=>{const k=n.target.value;t(Be({tankTypes:k==="all"?[]:[k]})),console.log("🔍 Tank type filter changed:",k)},P=n=>{const k=n.target.value;t(Be({operationalStatus:k==="all"?[]:[k]})),console.log("🔍 Status filter changed:",k)},S=(n,k)=>{const B=Array.isArray(k)?[k[0],k[1]]:[0,k];t(Be({capacityRange:B})),console.log("🔍 Capacity range changed:",B)},R=()=>e.jsxs(F,{sx:{p:2},children:[e.jsxs(F,{sx:{mb:2,display:"flex",gap:1},children:[e.jsx(K,{variant:"outlined",startIcon:e.jsx(re,{}),size:"small",onClick:L,children:"Add Tank"}),e.jsx(K,{variant:"outlined",startIcon:e.jsx(Ee,{}),size:"small",onClick:H,children:"Add Hydrant"}),e.jsx(K,{variant:"outlined",startIcon:e.jsx(ke,{}),size:"small",fullWidth:!0,onClick:q,children:"Import CSV"})]}),e.jsxs(xe,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(m,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(ta,{sx:{mr:1,verticalAlign:"middle"}}),"Filters"]}),e.jsxs(U,{select:!0,size:"small",label:"Tank Type",fullWidth:!0,margin:"dense",value:p.filterCriteria.tankTypes[0]||"all",onChange:V,children:[e.jsx(N,{value:"all",children:"All Types"}),e.jsx(N,{value:"municipal",children:"Municipal"}),e.jsx(N,{value:"private",children:"Private"}),e.jsx(N,{value:"emergency",children:"Emergency"})]}),e.jsxs(U,{select:!0,size:"small",label:"Status",fullWidth:!0,margin:"dense",value:p.filterCriteria.operationalStatus[0]||"all",onChange:P,children:[e.jsx(N,{value:"all",children:"All Status"}),e.jsx(N,{value:"active",children:"Active"}),e.jsx(N,{value:"inactive",children:"Inactive"}),e.jsx(N,{value:"maintenance",children:"Maintenance"})]}),e.jsx(m,{variant:"caption",display:"block",sx:{mt:1,mb:1},children:"Capacity Range (gallons)"}),e.jsx(Jt,{size:"small",value:p.filterCriteria.capacityRange,onChange:S,min:0,max:1e5,step:5e3,valueLabelDisplay:"auto",marks:[{value:0,label:"0"},{value:5e4,label:"50K"},{value:1e5,label:"100K"}]})]}),e.jsxs(m,{variant:"subtitle2",gutterBottom:!0,children:["Water Tanks (",s.length,")"]}),e.jsx(le,{dense:!0,children:s.map(n=>e.jsxs(ce,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:[e.jsxs(at,{selected:p.selectedTanks.includes(n.id),onClick:()=>T(n.id),children:[e.jsx(Ie,{children:e.jsx(re,{color:n.operationalStatus==="active"?"primary":"disabled"})}),e.jsx(de,{primary:n.name,secondary:e.jsxs(F,{children:[e.jsxs(m,{variant:"caption",display:"block",children:[n.capacity.toLocaleString()," gal • ",n.type]}),e.jsx(oe,{size:"small",label:n.accessRating,color:n.accessRating==="excellent"?"success":"default"})]})})]}),e.jsx(Qe,{children:e.jsx(ue,{size:"small",onClick:k=>{k.stopPropagation(),z(n.id)},children:e.jsx(et,{})})})]},n.id))}),e.jsxs(m,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:["Fire Hydrants (",l.length,")"]}),e.jsx(le,{dense:!0,children:l.map(n=>{var k;return e.jsxs(ce,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:[e.jsxs(at,{selected:(k=p.selectedHydrants)==null?void 0:k.includes(n.id),onClick:()=>{var B;(B=p.selectedHydrants)!=null&&B.includes(n.id)?t(ht(n.id)):t(gt(n.id))},children:[e.jsx(Ie,{children:e.jsx(Ee,{color:n.operationalStatus==="active"?"primary":"disabled"})}),e.jsx(de,{primary:n.name,secondary:e.jsxs(F,{children:[e.jsxs(m,{variant:"caption",display:"block",children:[n.flowRate," GPM • ",n.staticPressure,"/",n.residualPressure," PSI"]}),e.jsx(oe,{size:"small",label:n.type,color:n.type==="municipal"?"success":"default"})]})})]}),e.jsx(Qe,{children:e.jsx(ue,{size:"small",onClick:B=>{B.stopPropagation(),t($t(n.id))},children:e.jsx(et,{})})})]},n.id)})}),s.length===0&&l.length===0&&e.jsx(te,{severity:"info",sx:{mt:2},children:"No water supplies found. Add tanks/hydrants or adjust filters."})]}),w=()=>e.jsxs(F,{sx:{p:2},children:[e.jsxs(xe,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(m,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(Ft,{sx:{mr:1,verticalAlign:"middle"}}),"Analysis Parameters"]}),e.jsx(U,{size:"small",label:"Max Effective Distance (ft)",fullWidth:!0,margin:"dense",type:"number",value:D.maxEffectiveDistance,onChange:n=>t(Se({maxEffectiveDistance:parseInt(n.target.value)||1500}))}),e.jsx(U,{size:"small",label:"Min Flow Rate (GPM)",fullWidth:!0,margin:"dense",type:"number",value:D.minimumFlowRate,onChange:n=>t(Se({minimumFlowRate:parseInt(n.target.value)||250}))}),e.jsx(fe,{control:e.jsx(ye,{checked:D.terrainFactor,onChange:n=>t(Se({terrainFactor:n.target.checked}))}),label:"Consider Terrain"}),e.jsx(fe,{control:e.jsx(ye,{checked:D.seasonalFactors,onChange:n=>t(Se({seasonalFactors:n.target.checked}))}),label:"Seasonal Factors"})]}),e.jsx(K,{variant:"contained",startIcon:e.jsx(Mt,{}),fullWidth:!0,size:"large",onClick:i,disabled:u.length+v.length===0||W,sx:{mb:2},children:W?"Analyzing...":"Analyze Coverage"}),W&&e.jsx(We,{sx:{mb:2}}),e.jsxs(xe,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Display Options"}),e.jsx(fe,{control:e.jsx(ye,{checked:p.showCoverageZones,onChange:()=>t(Dt())}),label:"Coverage Zones"}),e.jsx(fe,{control:e.jsx(ye,{checked:p.showGapAreas,onChange:()=>t(Lt())}),label:"Gap Areas"}),e.jsx(fe,{control:e.jsx(ye,{checked:p.showRedundancyAreas,onChange:()=>t(Nt())}),label:"Redundancy Areas"})]}),C&&e.jsxs(xe,{variant:"outlined",sx:{p:2},children:[e.jsxs(m,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(qe,{sx:{mr:1,verticalAlign:"middle"}}),"Analysis Results"]}),e.jsxs(m,{variant:"body2",gutterBottom:!0,children:["Coverage: ",C.coveragePercentage.toFixed(1),"%"]}),e.jsxs(m,{variant:"body2",gutterBottom:!0,children:["Tanks: ",C.totalTanks||0," • Hydrants: ",C.totalHydrants||0]}),e.jsxs(m,{variant:"body2",gutterBottom:!0,children:["Critical Gaps: ",C.gapAreas.filter(n=>n.severity==="critical").length]}),e.jsx(K,{variant:"outlined",size:"small",startIcon:e.jsx(Ae,{}),fullWidth:!0,sx:{mt:1},children:"Export Report"})]})]}),$=()=>e.jsxs(F,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Coverage Gaps"}),C?e.jsx(le,{dense:!0,children:C.gapAreas.map(n=>e.jsx(ce,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:e.jsx(de,{primary:`Gap ${n.id}`,secondary:e.jsxs(F,{children:[e.jsxs(m,{variant:"caption",display:"block",children:["Severity: ",e.jsx(oe,{size:"small",label:n.severity,color:n.severity==="critical"?"error":n.severity==="high"?"warning":"default"})]}),e.jsxs(m,{variant:"caption",display:"block",children:["Area: ",(n.area/43560).toFixed(1)," acres"]})]})})},n.id))}):e.jsx(te,{severity:"info",children:"Run coverage analysis to identify gaps."})]}),G=()=>e.jsxs(F,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Recommendations"}),C?e.jsx(le,{dense:!0,children:C.recommendations.map(n=>e.jsx(ce,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:e.jsx(de,{primary:n.title,secondary:e.jsxs(F,{children:[e.jsx(m,{variant:"body2",gutterBottom:!0,children:n.description}),e.jsx(oe,{size:"small",label:n.priority,color:n.priority==="critical"?"error":n.priority==="high"?"warning":"default"}),n.estimatedCost&&e.jsxs(m,{variant:"caption",display:"block",sx:{mt:1},children:["Est. Cost: $",n.estimatedCost.toLocaleString()]})]})})},n.id))}):e.jsx(te,{severity:"info",children:"Run coverage analysis to see recommendations."})]}),M=()=>e.jsxs(F,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Data Import"}),e.jsx(te,{severity:"info",sx:{mb:2},children:"Import tank and hydrant locations from CSV files. The system automatically detects data type based on column headers."}),e.jsx(K,{variant:"contained",startIcon:e.jsx(ke,{}),fullWidth:!0,sx:{mb:3},onClick:q,children:"Import Water Supply Data (CSV)"}),e.jsx(m,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"🏢 Tank CSV Format:"}),e.jsxs(m,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block",fontFamily:"monospace",bgcolor:"grey.100",p:1,borderRadius:1},children:["name,latitude,longitude,capacity,type,owner",`
`,"Tank 1,40.7128,-74.0060,25000,municipal,Fire Dept",`
`,"Tank 2,40.7589,-73.9851,50000,private,Water Co"]}),e.jsx(m,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"🚰 Hydrant CSV Format:"}),e.jsxs(m,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block",fontFamily:"monospace",bgcolor:"grey.100",p:1,borderRadius:1},children:["name,latitude,longitude,flowRate,type,owner",`
`,"Hydrant 1,40.7128,-74.0060,1000,municipal,Water Dept",`
`,"Hydrant 2,40.7589,-73.9851,1500,industrial,Private"]}),e.jsxs(m,{variant:"body2",color:"text.secondary",sx:{mb:3},children:[e.jsx("strong",{children:"Supported columns:"}),e.jsx("br",{}),"• Required: name, latitude, longitude",e.jsx("br",{}),"• Tanks: capacity (gallons), type, access_rating",e.jsx("br",{}),"• Hydrants: flowRate (GPM), static_pressure, size",e.jsx("br",{}),"• Optional: owner, contact, notes, status"]}),e.jsx(Ce,{sx:{my:2}}),e.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Export Data"}),e.jsx(K,{variant:"outlined",startIcon:e.jsx(Ae,{}),fullWidth:!0,disabled:u.length+v.length===0,onClick:()=>{const n={tanks:u.map(I=>({name:I.name,latitude:I.location.latitude,longitude:I.location.longitude,capacity:I.capacity,type:I.type,owner:I.owner,access_rating:I.accessRating,status:I.operationalStatus,notes:I.notes})),hydrants:v.map(I=>({name:I.name,latitude:I.location.latitude,longitude:I.location.longitude,flowRate:I.flowRate,static_pressure:I.staticPressure,residual_pressure:I.residualPressure,type:I.type,size:I.size,owner:I.owner,status:I.operationalStatus,notes:I.notes})),exportedAt:new Date().toISOString(),summary:{totalTanks:u.length,totalHydrants:v.length,totalSupplies:u.length+v.length}},k=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),B=URL.createObjectURL(k),O=document.createElement("a");O.href=B,O.download=`water-supply-data-${new Date().toISOString().split("T")[0]}.json`,O.click(),URL.revokeObjectURL(B),console.log("💾 Data exported:",n)},children:"Export Supply Data (JSON)"})]});return e.jsxs(F,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(F,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[e.jsxs(m,{variant:"h6",component:"div",sx:{display:"flex",alignItems:"center"},children:[e.jsx(re,{sx:{mr:1}}),"Water Supply Coverage"]}),a&&e.jsxs(m,{variant:"caption",color:"text.secondary",children:["Mode: ",a]})]}),e.jsxs(Et,{value:p.sidebarTab,onChange:c,variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(me,{label:"Supplies",value:"tanks"}),e.jsx(me,{label:"Analysis",value:"analysis"}),e.jsx(me,{label:"Gaps",value:"gaps"}),e.jsx(me,{label:"Recommendations",value:"recommendations"}),e.jsx(me,{label:"Import",value:"import"})]}),e.jsxs(F,{sx:{flexGrow:1,overflow:"auto"},children:[p.sidebarTab==="tanks"&&R(),p.sidebarTab==="analysis"&&w(),p.sidebarTab==="gaps"&&$(),p.sidebarTab==="recommendations"&&G(),p.sidebarTab==="import"&&M()]}),e.jsx(Sa,{open:o,onClose:()=>b(!1)})]})},ee=a=>a.type==="tank"?a.tank.location:a.hydrant.location,Pa=({map:a,onTankEdit:t})=>{const o=ae(),b=_(dt),u=_(Ne),s=_(_e),v=x.useRef(null),l=x.useRef(null),C=x.useRef(new Map);x.useEffect(()=>{if(a)return v.current=Q.layerGroup().addTo(a),l.current=Q.layerGroup().addTo(a),()=>{v.current&&a.removeLayer(v.current),l.current&&a.removeLayer(l.current)}},[a]);const p=c=>{const i=()=>{switch(c.operationalStatus){case"active":return"#2196f3";case"inactive":return"#9e9e9e";case"maintenance":return"#ff9800";default:return"#2196f3"}},A=(()=>{const h=Math.min(Math.max(c.capacity/25e3,.7),2);return Math.round(24*h)})(),f=i(),d=`
      <svg width="${A}" height="${A}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" fill="${f}" stroke="#ffffff" stroke-width="2"/>
        <path d="M8 10h8v6a2 2 0 01-2 2h-4a2 2 0 01-2-2v-6z" fill="#ffffff"/>
        <path d="M7 8h10v2H7z" fill="#ffffff"/>
        <circle cx="12" cy="6" r="1" fill="#ffffff"/>
      </svg>
    `;return Q.divIcon({html:d,className:"tank-marker",iconSize:[A,A],iconAnchor:[A/2,A/2],popupAnchor:[0,-A/2]})},D=c=>{var A,f;const i=c.capacity.toLocaleString(),j=(A=c.location)!=null&&A.latitude&&((f=c.location)!=null&&f.longitude)?`Lat: ${c.location.latitude.toFixed(6)}, Lng: ${c.location.longitude.toFixed(6)}`:"Location: Unknown";return`
      <div style="min-width: 200px;">
        <h4 style="margin: 0 0 8px 0; color: #1976d2;">${c.name}</h4>
        <p style="margin: 4px 0;"><strong>Capacity:</strong> ${i} gallons</p>
        <p style="margin: 4px 0;"><strong>Type:</strong> ${c.type}</p>
        <p style="margin: 4px 0;"><strong>Access:</strong> ${c.accessRating}</p>
        <p style="margin: 4px 0;"><strong>Status:</strong> ${c.operationalStatus}</p>
        <p style="margin: 4px 0;"><strong>Owner:</strong> ${c.owner}</p>
        ${c.notes?`<p style="margin: 4px 0;"><strong>Notes:</strong> ${c.notes}</p>`:""}
        <div style="margin-top: 8px; font-size: 12px; color: #666;">
          ${j}
        </div>
      </div>
    `},W=c=>{if(!u.showCoverageZones)return null;if(!c.location||!c.location.latitude||!c.location.longitude)return console.warn("🏗️ Skipping coverage circle for tank with invalid location:",c),null;let i=400;c.capacity>=1e5?i=1500:c.capacity>=5e4?i=1200:c.capacity>=25e3?i=1e3:c.capacity>=1e4?i=800:i=600;const j=c.accessRating==="excellent"?1.2:c.accessRating==="good"?1:c.accessRating==="fair"?.8:.6;i=i*j,i=Math.min(i,s.maxEffectiveDistance);const A=i*.3048;return Q.circle([c.location.latitude,c.location.longitude],{radius:A,fillColor:"#2196f3",fillOpacity:.1,color:"#1976d2",weight:2,opacity:.6})};return x.useEffect(()=>{if(!(!a||!v.current||!l.current)){if(v.current.clearLayers(),l.current.clearLayers(),C.current.clear(),b.forEach(c=>{var f,d;if(!c.location||!c.location.latitude||!c.location.longitude){console.warn("🏗️ Skipping tank with invalid location:",c);return}const i=p(c),j=Q.marker([c.location.latitude,c.location.longitude],{icon:i,draggable:!0,riseOnHover:!0});j.bindPopup(D(c)),j.on("click",r=>{var h;(h=r.originalEvent)==null||h.stopPropagation(),u.selectedTanks.includes(c.id)?o(mt(c.id)):o(ft(c.id)),console.log("🎯 Tank selected:",c.name)}),j.on("dblclick",r=>{var h;(h=r.originalEvent)==null||h.stopPropagation(),t&&(t(c),console.log("✏️ Tank edit requested:",c.name))}),j.on("dragend",r=>{const h=r.target.getLatLng(),g={...c,location:{latitude:h.lat,longitude:h.lng},modified:new Date};o(yt(g)),console.log("🚛 Tank moved:",c.name,"to",h)}),u.selectedTanks.includes(c.id)&&j.setZIndexOffset(1e3),(f=v.current)==null||f.addLayer(j),C.current.set(c.id,j);const A=W(c);A&&((d=l.current)==null||d.addLayer(A))}),b.length>0){const i=new Q.FeatureGroup(Array.from(C.current.values())).getBounds();i.isValid()&&a.fitBounds(i,{padding:[20,20],maxZoom:16})}console.log("🗺️ Tank markers updated:",b.length,"tanks displayed")}},[b,u.selectedTanks,u.showCoverageZones,s.maxEffectiveDistance,o,a]),x.useEffect(()=>{!l.current||!a||(u.showCoverageZones?a.hasLayer(l.current)||a.addLayer(l.current):a.hasLayer(l.current)&&a.removeLayer(l.current))},[u.showCoverageZones,a]),null},Ra=({map:a,onHydrantEdit:t})=>{const o=ae(),b=_(ut),u=_(je),s=_(Ne),v=_(_e);console.log("🔍 HydrantMapLayer state debug:",{allHydrantsCount:u.length,filteredHydrantsCount:b.length,showHydrants:s.filterCriteria.showHydrants,filterCriteria:s.filterCriteria});const l=x.useRef(null),C=x.useRef(null),p=x.useRef(new Map);x.useEffect(()=>{if(a)return l.current=Q.layerGroup().addTo(a),C.current=Q.layerGroup().addTo(a),()=>{l.current&&a.removeLayer(l.current),C.current&&a.removeLayer(C.current)}},[a]);const D=i=>{const j=()=>{switch(i.operationalStatus){case"active":return"#2196f3";case"inactive":return"#9e9e9e";case"maintenance":return"#ff9800";default:return"#2196f3"}},A=()=>{const T=Math.min(Math.max(i.flowRate/1e3,.8),2);return Math.round(20*T)},f=()=>i.staticPressure>=50?"#1976d2":i.staticPressure>=30?"#4caf50":"#f44336",d=A(),r=j(),h=f(),g=`
      <svg width="${d}" height="${d}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="2" y="2" width="20" height="20" fill="${r}" stroke="${h}" stroke-width="3" rx="2"/>
        <path d="M8 8h8v2H8z" fill="#ffffff"/>
        <path d="M8 12h8v2H8z" fill="#ffffff"/>
        <path d="M8 16h8v2H8z" fill="#ffffff"/>
        <circle cx="12" cy="6" r="1.5" fill="#ffffff"/>
      </svg>
    `;return Q.divIcon({html:g,className:"hydrant-marker",iconSize:[d,d],iconAnchor:[d/2,d/2],popupAnchor:[0,-d/2]})},W=i=>{var d,r;const j=i.flowRate.toLocaleString(),A=`${i.staticPressure}/${i.residualPressure} PSI`,f=(d=i.location)!=null&&d.latitude&&((r=i.location)!=null&&r.longitude)?`Lat: ${i.location.latitude.toFixed(6)}, Lng: ${i.location.longitude.toFixed(6)}`:"Location: Unknown";return`
      <div style="min-width: 220px;">
        <h4 style="margin: 0 0 8px 0; color: #2196f3;">🚰 ${i.name}</h4>
        <p style="margin: 4px 0;"><strong>Flow Rate:</strong> ${j} GPM</p>
        <p style="margin: 4px 0;"><strong>Pressure:</strong> ${A}</p>
        <p style="margin: 4px 0;"><strong>Type:</strong> ${i.type}</p>
        <p style="margin: 4px 0;"><strong>Size:</strong> ${i.size}</p>
        <p style="margin: 4px 0;"><strong>Status:</strong> ${i.operationalStatus}</p>
        <p style="margin: 4px 0;"><strong>Owner:</strong> ${i.owner}</p>
        ${i.notes?`<p style="margin: 4px 0;"><strong>Notes:</strong> ${i.notes}</p>`:""}
        <div style="margin-top: 8px; font-size: 12px; color: #666;">
          ${f}
        </div>
        <div style="margin-top: 4px; font-size: 11px; color: #888;">
          💧 Unlimited Supply • High Pressure Coverage
        </div>
      </div>
    `},c=i=>{if(!s.showCoverageZones)return null;let j=800;i.staticPressure>=50?j=1200:i.staticPressure>=30?j=1e3:j=600;const A=Math.min(i.flowRate/1e3,1.5);j=j*A;const f=j*.3048;return Q.circle([i.location.latitude,i.location.longitude],{radius:f,fillColor:"#00bcd4",fillOpacity:.1,color:"#0097a7",weight:2,opacity:.6,dashArray:"5,10"})};return x.useEffect(()=>{if(!(!a||!l.current||!C.current)){if(l.current.clearLayers(),C.current.clearLayers(),p.current.clear(),console.log("🚰 Processing hydrants for map display:",b.length),console.log("🚰 Sample hydrant data:",b[0]),b.forEach((i,j)=>{var r,h,g;if(!i.location||!i.location.latitude||!i.location.longitude){console.warn("🚰 Skipping hydrant with invalid location:",i);return}console.log(`🚰 Processing hydrant ${j+1}:`,{name:i.name,lat:i.location.latitude,lng:i.location.longitude,hasValidCoords:!isNaN(i.location.latitude)&&!isNaN(i.location.longitude)});const A=D(i),f=Q.marker([i.location.latitude,i.location.longitude],{icon:A,draggable:!0,riseOnHover:!0});f.bindPopup(W(i)),f.on("click",y=>{var T;(T=y.originalEvent)==null||T.stopPropagation(),s.selectedHydrants.includes(i.id)?o(ht(i.id)):o(gt(i.id)),console.log("🎯 Hydrant selected:",i.name)}),f.on("dblclick",y=>{var T;(T=y.originalEvent)==null||T.stopPropagation(),t&&(t(i),console.log("✏️ Hydrant edit requested:",i.name))}),f.on("dragend",y=>{const T=y.target.getLatLng(),z={...i,location:{latitude:T.lat,longitude:T.lng},modified:new Date};o(xt(z)),console.log("🚛 Hydrant moved:",i.name,"to",T)}),s.selectedHydrants.includes(i.id)&&f.setZIndexOffset(1e3),console.log(`🚰 Adding hydrant ${j+1} to layer group:`,i.name),(r=l.current)==null||r.addLayer(f),p.current.set(i.id,f),console.log(`🚰 Layer group now has ${(h=l.current)==null?void 0:h.getLayers().length} layers`);const d=c(i);d&&((g=C.current)==null||g.addLayer(d))}),b.length>0){const j=new Q.FeatureGroup(Array.from(p.current.values())).getBounds();j.isValid()&&a.fitBounds(j,{padding:[20,20],maxZoom:16})}console.log("🗺️ Hydrant markers updated:",b.length,"hydrants displayed"),console.log("🗺️ Layer group attached to map:",a.hasLayer(l.current)),console.log("🗺️ Total layers in hydrant group:",l.current.getLayers().length),console.log("🗺️ Map zoom level:",a.getZoom()),console.log("🗺️ Map center:",a.getCenter())}},[b,s.selectedHydrants,s.showCoverageZones,v.maxEffectiveDistance,o,a]),x.useEffect(()=>{!C.current||!a||(s.showCoverageZones?a.hasLayer(C.current)||a.addLayer(C.current):a.hasLayer(C.current)&&a.removeLayer(C.current))},[s.showCoverageZones,a]),null},ka=({tank:a,open:t,onClose:o,isNewTank:b=!1})=>{var j,A,f,d;const u=ae(),[s,v]=x.useState({name:"",capacity:25e3,type:"municipal",accessRating:"good",operationalStatus:"active",owner:"Fire Department",contactInfo:"",notes:"",elevation:""}),[l,C]=x.useState({});x.useEffect(()=>{a&&v({name:a.name||"",capacity:a.capacity||25e3,type:a.type||"municipal",accessRating:a.accessRating||"good",operationalStatus:a.operationalStatus||"active",owner:a.owner||"Fire Department",contactInfo:a.contactInfo||"",notes:a.notes||"",elevation:a.elevation?a.elevation.toString():""}),C({})},[a]);const p=r=>h=>{const g=h.target.value;v(y=>({...y,[r]:g})),l[r]&&C(y=>({...y,[r]:""}))},D=()=>{const r={};return s.name.trim()||(r.name="Tank name is required"),s.capacity<=0&&(r.capacity="Capacity must be greater than 0"),s.capacity>1e6&&(r.capacity="Capacity seems unreasonably large (>1M gallons)"),s.owner.trim()||(r.owner="Owner information is required"),s.elevation&&isNaN(Number(s.elevation))&&(r.elevation="Elevation must be a number"),C(r),Object.keys(r).length===0},W=()=>{if(!(!a||!D())){if(b){const r={name:s.name.trim(),location:a.location,capacity:Number(s.capacity),type:s.type,accessRating:s.accessRating,operationalStatus:s.operationalStatus,owner:s.owner.trim(),contactInfo:s.contactInfo.trim(),notes:s.notes.trim(),elevation:s.elevation?Number(s.elevation):void 0};u(ze(r)),console.log("🆕 New tank created:",r.name,"capacity:",r.capacity)}else{const r={...a,name:s.name.trim(),capacity:Number(s.capacity),type:s.type,accessRating:s.accessRating,operationalStatus:s.operationalStatus,owner:s.owner.trim(),contactInfo:s.contactInfo.trim(),notes:s.notes.trim(),elevation:s.elevation?Number(s.elevation):void 0,modified:new Date};u(yt(r)),console.log("💾 Tank updated:",r.name,"capacity:",r.capacity)}o()}},c=()=>{o()};if(!a)return null;const i=[{value:5e3,label:"5,000 gallons (Small)"},{value:1e4,label:"10,000 gallons"},{value:25e3,label:"25,000 gallons (Standard)"},{value:5e4,label:"50,000 gallons"},{value:1e5,label:"100,000 gallons (Large)"},{value:25e4,label:"250,000 gallons (Very Large)"}];return e.jsxs($e,{open:t,onClose:c,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsxs(Fe,{sx:{pb:1},children:[e.jsxs(F,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(re,{color:"primary"}),e.jsx(m,{variant:"h6",children:b?"New Tank Properties":`Edit Tank: ${a.name}`})]}),e.jsxs(m,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Location: ",((A=(j=a.location)==null?void 0:j.latitude)==null?void 0:A.toFixed(6))||"Unknown",", ",((d=(f=a.location)==null?void 0:f.longitude)==null?void 0:d.toFixed(6))||"Unknown"]})]}),e.jsx(Me,{dividers:!0,children:e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{size:{xs:12},children:e.jsx(m,{variant:"subtitle1",gutterBottom:!0,color:"primary",children:"Basic Information"})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Tank Name",value:s.name,onChange:p("name"),error:!!l.name,helperText:l.name||'e.g., "Main Street Tank", "Station 5 Tank"',required:!0})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Owner",value:s.owner,onChange:p("owner"),error:!!l.owner,helperText:l.owner||"Who owns/maintains this tank",required:!0})}),e.jsxs(E,{size:{xs:12},children:[e.jsx(Ce,{sx:{my:1}}),e.jsx(m,{variant:"subtitle1",gutterBottom:!0,color:"primary",children:"Tank Specifications"})]}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Capacity",type:"number",value:s.capacity,onChange:p("capacity"),error:!!l.capacity,helperText:l.capacity||"Tank capacity in gallons",InputProps:{endAdornment:e.jsx(pe,{position:"end",children:"gallons"})},required:!0})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsxs(U,{select:!0,fullWidth:!0,label:"Tank Type",value:s.type,onChange:p("type"),helperText:"Primary use classification",children:[e.jsx(N,{value:"municipal",children:"Municipal"}),e.jsx(N,{value:"private",children:"Private"}),e.jsx(N,{value:"emergency",children:"Emergency"}),e.jsx(N,{value:"industrial",children:"Industrial"}),e.jsx(N,{value:"agricultural",children:"Agricultural"}),e.jsx(N,{value:"portable",children:"Portable"})]})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsxs(U,{select:!0,fullWidth:!0,label:"Access Rating",value:s.accessRating,onChange:p("accessRating"),helperText:"How easily can fire apparatus access this tank",children:[e.jsx(N,{value:"excellent",children:"Excellent - Easy access, good road conditions"}),e.jsx(N,{value:"good",children:"Good - Accessible but may require coordination"}),e.jsx(N,{value:"fair",children:"Fair - Limited access, rough terrain"}),e.jsx(N,{value:"poor",children:"Poor - Difficult access, special equipment needed"}),e.jsx(N,{value:"restricted",children:"Restricted - Permission required"})]})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsxs(U,{select:!0,fullWidth:!0,label:"Operational Status",value:s.operationalStatus,onChange:p("operationalStatus"),helperText:"Current operational state",children:[e.jsx(N,{value:"active",children:"Active - Ready for use"}),e.jsx(N,{value:"inactive",children:"Inactive - Not currently available"}),e.jsx(N,{value:"maintenance",children:"Maintenance - Temporarily out of service"}),e.jsx(N,{value:"seasonal",children:"Seasonal - Weather dependent"}),e.jsx(N,{value:"unknown",children:"Unknown - Status needs verification"})]})}),e.jsxs(E,{size:{xs:12},children:[e.jsx(m,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Quick Capacity Selection:"}),e.jsx(F,{display:"flex",flexWrap:"wrap",gap:1,children:i.map(r=>e.jsx(K,{size:"small",variant:s.capacity===r.value?"contained":"outlined",onClick:()=>v(h=>({...h,capacity:r.value})),sx:{fontSize:"0.75rem"},children:r.label},r.value))})]}),e.jsxs(E,{size:{xs:12},children:[e.jsx(Ce,{sx:{my:1}}),e.jsx(m,{variant:"subtitle1",gutterBottom:!0,color:"primary",children:"Additional Information"})]}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Contact Information",value:s.contactInfo,onChange:p("contactInfo"),helperText:"Phone number or contact for access",placeholder:"(555) 123-4567"})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Elevation (feet)",type:"number",value:s.elevation,onChange:p("elevation"),error:!!l.elevation,helperText:l.elevation||"Elevation above sea level (optional)",InputProps:{endAdornment:e.jsx(pe,{position:"end",children:"ft"})}})}),e.jsx(E,{size:{xs:12},children:e.jsx(U,{fullWidth:!0,multiline:!0,rows:3,label:"Notes",value:s.notes,onChange:p("notes"),helperText:"Additional notes about this tank (access instructions, restrictions, etc.)",placeholder:"e.g., 'Requires key from station office', 'Dry hydrant connection available'"})}),Object.keys(l).length>0&&e.jsx(E,{size:{xs:12},children:e.jsx(te,{severity:"error",children:"Please correct the errors above before saving."})})]})}),e.jsxs(De,{sx:{p:2},children:[e.jsx(K,{onClick:c,startIcon:e.jsx(bt,{}),color:"inherit",children:"Cancel"}),e.jsx(K,{onClick:W,variant:"contained",startIcon:e.jsx(Ve,{}),disabled:Object.keys(l).length>0,children:"Save Tank"})]})]})},Ia=({hydrant:a,open:t,onClose:o,isNewHydrant:b=!1})=>{var j,A,f,d;const u=ae(),[s,v]=x.useState({name:"",flowRate:1e3,staticPressure:50,residualPressure:20,type:"municipal",size:"4-inch",operationalStatus:"active",owner:"Water Department",contactInfo:"",notes:"",elevation:""}),[l,C]=x.useState({});x.useEffect(()=>{a&&v({name:a.name||"",flowRate:a.flowRate||1e3,staticPressure:a.staticPressure||50,residualPressure:a.residualPressure||20,type:a.type||"municipal",size:a.size||"4-inch",operationalStatus:a.operationalStatus||"active",owner:a.owner||"Water Department",contactInfo:a.contactInfo||"",notes:a.notes||"",elevation:a.elevation?a.elevation.toString():""}),C({})},[a]);const p=r=>h=>{const g=h.target.value;v(y=>({...y,[r]:g})),l[r]&&C(y=>({...y,[r]:""}))},D=()=>{const r={};return s.name.trim()||(r.name="Hydrant name is required"),s.flowRate<=0&&(r.flowRate="Flow rate must be greater than 0"),s.flowRate>5e3&&(r.flowRate="Flow rate seems unreasonably high (>5000 GPM)"),s.staticPressure<=0&&(r.staticPressure="Static pressure must be greater than 0"),s.residualPressure<=0&&(r.residualPressure="Residual pressure must be greater than 0"),s.residualPressure>=s.staticPressure&&(r.residualPressure="Residual pressure must be less than static pressure"),s.owner.trim()||(r.owner="Owner information is required"),s.elevation&&isNaN(Number(s.elevation))&&(r.elevation="Elevation must be a number"),C(r),Object.keys(r).length===0},W=()=>{if(!(!a||!D())){if(b){const r={name:s.name.trim(),location:a.location,flowRate:Number(s.flowRate),staticPressure:Number(s.staticPressure),residualPressure:Number(s.residualPressure),type:s.type,size:s.size,operationalStatus:s.operationalStatus,owner:s.owner.trim(),contactInfo:s.contactInfo.trim(),notes:s.notes.trim(),elevation:s.elevation?Number(s.elevation):void 0};u(be(r)),console.log("🆕 New hydrant created:",r.name,"flow rate:",r.flowRate,"GPM")}else{const r={...a,name:s.name.trim(),flowRate:Number(s.flowRate),staticPressure:Number(s.staticPressure),residualPressure:Number(s.residualPressure),type:s.type,size:s.size,operationalStatus:s.operationalStatus,owner:s.owner.trim(),contactInfo:s.contactInfo.trim(),notes:s.notes.trim(),elevation:s.elevation?Number(s.elevation):void 0,modified:new Date};u(xt(r)),console.log("💾 Hydrant updated:",r.name,"flow rate:",r.flowRate,"GPM")}o()}},c=()=>{o()};if(!a)return null;const i=[{value:500,label:"500 GPM (Low Flow)"},{value:1e3,label:"1,000 GPM (Standard)"},{value:1500,label:"1,500 GPM (High Flow)"},{value:2e3,label:"2,000 GPM (Very High)"},{value:2500,label:"2,500 GPM (Maximum)"}];return e.jsxs($e,{open:t,onClose:c,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsxs(Fe,{sx:{pb:1},children:[e.jsxs(F,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Ee,{color:"primary"}),e.jsx(m,{variant:"h6",children:b?"New Hydrant Properties":`Edit Hydrant: ${a.name}`})]}),e.jsxs(m,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Location: ",((A=(j=a.location)==null?void 0:j.latitude)==null?void 0:A.toFixed(6))||"Unknown",", ",((d=(f=a.location)==null?void 0:f.longitude)==null?void 0:d.toFixed(6))||"Unknown"]})]}),e.jsx(Me,{dividers:!0,children:e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{size:{xs:12},children:e.jsx(m,{variant:"subtitle1",gutterBottom:!0,color:"primary",children:"Basic Information"})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Hydrant Name",value:s.name,onChange:p("name"),error:!!l.name,helperText:l.name||'e.g., "Main St & 1st Ave", "Station 5 Front"',required:!0})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Owner",value:s.owner,onChange:p("owner"),error:!!l.owner,helperText:l.owner||"Who owns/maintains this hydrant",required:!0})}),e.jsxs(E,{size:{xs:12},children:[e.jsx(Ce,{sx:{my:1}}),e.jsx(m,{variant:"subtitle1",gutterBottom:!0,color:"primary",children:"Hydrant Specifications"})]}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Flow Rate",type:"number",value:s.flowRate,onChange:p("flowRate"),error:!!l.flowRate,helperText:l.flowRate||"Maximum flow rate in gallons per minute",InputProps:{endAdornment:e.jsx(pe,{position:"end",children:"GPM"})},required:!0})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Static Pressure",type:"number",value:s.staticPressure,onChange:p("staticPressure"),error:!!l.staticPressure,helperText:l.staticPressure||"Static pressure when not flowing",InputProps:{endAdornment:e.jsx(pe,{position:"end",children:"PSI"})},required:!0})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Residual Pressure",type:"number",value:s.residualPressure,onChange:p("residualPressure"),error:!!l.residualPressure,helperText:l.residualPressure||"Pressure at rated flow",InputProps:{endAdornment:e.jsx(pe,{position:"end",children:"PSI"})},required:!0})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsxs(U,{select:!0,fullWidth:!0,label:"Hydrant Type",value:s.type,onChange:p("type"),helperText:"Type of hydrant water source",children:[e.jsx(N,{value:"municipal",children:"Municipal - Connected to city water system"}),e.jsx(N,{value:"industrial",children:"Industrial - Private industrial system"}),e.jsx(N,{value:"cistern",children:"Cistern - Fed by underground cistern"}),e.jsx(N,{value:"dry",children:"Dry Hydrant - Suction source only"}),e.jsx(N,{value:"private",children:"Private - Private water system"})]})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsxs(U,{select:!0,fullWidth:!0,label:"Hydrant Size",value:s.size,onChange:p("size"),helperText:"Main steamer port size",children:[e.jsx(N,{value:"4-inch",children:"4-inch - Standard steamer port"}),e.jsx(N,{value:"5-inch",children:"5-inch - Large steamer port"}),e.jsx(N,{value:"6-inch",children:"6-inch - Extra large steamer port"}),e.jsx(N,{value:"dual",children:"Dual - Multiple steamer ports"}),e.jsx(N,{value:"unknown",children:"Unknown - Size not documented"})]})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsxs(U,{select:!0,fullWidth:!0,label:"Operational Status",value:s.operationalStatus,onChange:p("operationalStatus"),helperText:"Current operational state",children:[e.jsx(N,{value:"active",children:"Active - Ready for use"}),e.jsx(N,{value:"inactive",children:"Inactive - Not currently available"}),e.jsx(N,{value:"maintenance",children:"Maintenance - Temporarily out of service"}),e.jsx(N,{value:"seasonal",children:"Seasonal - Weather dependent"}),e.jsx(N,{value:"unknown",children:"Unknown - Status needs verification"})]})}),e.jsxs(E,{size:{xs:12},children:[e.jsx(m,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Quick Flow Rate Selection:"}),e.jsx(F,{display:"flex",flexWrap:"wrap",gap:1,children:i.map(r=>e.jsx(K,{size:"small",variant:s.flowRate===r.value?"contained":"outlined",onClick:()=>v(h=>({...h,flowRate:r.value})),sx:{fontSize:"0.75rem"},children:r.label},r.value))})]}),e.jsxs(E,{size:{xs:12},children:[e.jsx(Ce,{sx:{my:1}}),e.jsx(m,{variant:"subtitle1",gutterBottom:!0,color:"primary",children:"Additional Information"})]}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Contact Information",value:s.contactInfo,onChange:p("contactInfo"),helperText:"Phone number or contact for issues",placeholder:"(555) 123-4567"})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(U,{fullWidth:!0,label:"Elevation (feet)",type:"number",value:s.elevation,onChange:p("elevation"),error:!!l.elevation,helperText:l.elevation||"Elevation above sea level (optional)",InputProps:{endAdornment:e.jsx(pe,{position:"end",children:"ft"})}})}),e.jsx(E,{size:{xs:12},children:e.jsx(U,{fullWidth:!0,multiline:!0,rows:3,label:"Notes",value:s.notes,onChange:p("notes"),helperText:"Additional notes about this hydrant (access instructions, restrictions, etc.)",placeholder:"e.g., 'Located in parking lot', 'Requires special wrench', 'Low pressure area'"})}),Object.keys(l).length>0&&e.jsx(E,{size:{xs:12},children:e.jsx(te,{severity:"error",children:"Please correct the errors above before saving."})})]})}),e.jsxs(De,{sx:{p:2},children:[e.jsx(K,{onClick:c,startIcon:e.jsx(bt,{}),color:"inherit",children:"Cancel"}),e.jsx(K,{onClick:W,variant:"contained",startIcon:e.jsx(Ve,{}),disabled:Object.keys(l).length>0,children:"Save Hydrant"})]})]})},Aa=Q.icon({iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});Q.Marker.prototype.options.icon=Aa;const Ea=({sidebarOpen:a=!1,isMobile:t=!1})=>{const o=ae(),b=_(Le),u=_(je),s=_(Gt),v=_(Ne),l=x.useRef(null),C=x.useRef(null),[p,D]=x.useState(!1),[W,c]=x.useState({latitude:39.8283,longitude:-98.5795,zoom:4}),[i,j]=x.useState(!1),[A,f]=x.useState(!1),[d,r]=x.useState(null),[h,g]=x.useState(null),[y,T]=x.useState(null),[z,L]=x.useState("tank"),H=x.useCallback(R=>{if(l.current=R,D(!0),R.on("click",w=>{if(v.selectedTanks.length===0&&v.selectedHydrants.length===0){const $=z;if(T({lat:w.latlng.lat,lng:w.latlng.lng,type:$}),$==="tank"){const G={id:`temp-${Date.now()}`,name:`Tank ${b.length+1}`,location:{latitude:w.latlng.lat,longitude:w.latlng.lng},capacity:25e3,type:"municipal",accessRating:"good",operationalStatus:"active",owner:"Fire Department",contactInfo:"",notes:"",created:new Date,modified:new Date};r(G),j(!0),console.log("🎯 Opening tank editor for new tank at:",w.latlng)}else{const G={id:`temp-${Date.now()}`,name:`Hydrant ${u.length+1}`,location:{latitude:w.latlng.lat,longitude:w.latlng.lng},flowRate:1e3,staticPressure:50,residualPressure:20,type:"municipal",size:"4-inch",operationalStatus:"active",owner:"Water Department",contactInfo:"",notes:"",created:new Date,modified:new Date};g(G),f(!0),console.log("🎯 Opening hydrant editor for new hydrant at:",w.latlng)}}}),R.on("move",()=>{const w=R.getCenter(),$=R.getZoom();c({latitude:w.lat,longitude:w.lng,zoom:$})}),s.length>0){const w=s.filter($=>ee($)&&ee($).latitude&&ee($).longitude);if(w.length>0){const $=Q.latLngBounds(w.map(G=>[ee(G).latitude,ee(G).longitude]));R.fitBounds($,{padding:[20,20],maxZoom:16})}else R.setView([39.8283,-98.5795],4)}else R.setView([39.8283,-98.5795],4);console.log("🗺️ Water supply map initialized with",b.length,"tanks and",u.length,"hydrants")},[s,v.selectedTanks.length,v.selectedHydrants.length,z,o]);x.useEffect(()=>{if(!l.current||s.length===0)return;const R=l.current;setTimeout(()=>{R.invalidateSize();const w=s.filter(G=>ee(G)&&ee(G).latitude&&ee(G).longitude);if(w.length===0)return;const $=Q.latLngBounds(w.map(G=>[ee(G).latitude,ee(G).longitude]));$.isValid()&&R.fitBounds($,{padding:[50,50],maxZoom:16,animate:!0,duration:.5})},100)},[s.length]),x.useEffect(()=>{if(!l.current)return;const R=l.current,w=setTimeout(()=>{R.invalidateSize(),console.log("🗺️ Map size invalidated due to layout change")},200);return()=>clearTimeout(w)},[p]),x.useEffect(()=>{if(!l.current)return;const R=l.current;[100,300,500].forEach($=>{setTimeout(()=>{if(l.current){if(R.invalidateSize(),R.invalidateSize(!0),s.length>0){const G=s.filter(M=>ee(M)&&ee(M).latitude&&ee(M).longitude);if(G.length>0){const M=Q.latLngBounds(G.map(n=>[ee(n).latitude,ee(n).longitude]));M.isValid()&&R.fitBounds(M,{padding:[50,50],maxZoom:16})}}console.log(`🗺️ Map resized due to layout change (${$}ms delay) - sidebarOpen: ${a}, isMobile: ${t}`)}},$)})},[a,t,s.length]),x.useEffect(()=>{if(!C.current||!l.current)return;const R=new ResizeObserver(w=>{for(const $ of w)setTimeout(()=>{l.current&&(l.current.invalidateSize(!0),console.log("🗺️ Map resized due to container size change:",{width:$.contentRect.width,height:$.contentRect.height}))},50)});return R.observe(C.current),()=>{R.disconnect()}},[p]),x.useEffect(()=>{if(!l.current)return;const R=()=>{l.current&&setTimeout(()=>{var w;(w=l.current)==null||w.invalidateSize(!0),console.log("🗺️ Map resized due to window resize")},100)};return window.addEventListener("resize",R),()=>{window.removeEventListener("resize",R)}},[]);const q=()=>{j(!1),r(null),T(null)},V=()=>{f(!1),g(null),T(null)},P=R=>{r(R),j(!0),T(null)},S=R=>{g(R),f(!0),T(null)};return e.jsxs(F,{ref:C,sx:{height:"100%",width:"100%",position:"relative",overflow:"hidden",margin:0,padding:"8px",boxSizing:"border-box"},children:[e.jsx(na,{onMapReady:H}),p&&e.jsxs(e.Fragment,{children:[e.jsx(Pa,{map:l.current,onTankEdit:P}),e.jsx(Ra,{map:l.current,onHydrantEdit:S})]}),e.jsx(F,{sx:{position:"absolute",bottom:16,left:16,zIndex:1e3,bgcolor:"rgba(255, 255, 255, 0.9)",p:1,borderRadius:1,fontSize:"0.75rem"},children:e.jsx(oa,{mouseCoords:null})}),e.jsxs(F,{sx:{position:"absolute",top:16,right:16,zIndex:1e3,display:"flex",flexDirection:"column",gap:1,alignItems:"flex-end"},children:[e.jsxs(F,{sx:{bgcolor:"rgba(255, 255, 255, 0.95)",p:1,borderRadius:1,boxShadow:1},children:[e.jsx(m,{variant:"caption",sx:{fontSize:"0.75rem",fontWeight:"medium",mb:.5,display:"block"},children:"Click to Place:"}),e.jsxs(Ca,{size:"small",value:z,exclusive:!0,onChange:(R,w)=>{w!==null&&(L(w),console.log("🎯 Placement mode changed to:",w))},sx:{"& .MuiToggleButton-root":{fontSize:"0.75rem",px:1,py:.5,minWidth:"auto"}},children:[e.jsx(tt,{value:"tank",children:"🏢 Tank"}),e.jsx(tt,{value:"hydrant",children:"🚰 Hydrant"})]})]}),e.jsxs(F,{sx:{bgcolor:"rgba(33, 150, 243, 0.9)",color:"white",p:1,borderRadius:1,fontSize:"0.875rem",fontWeight:"medium"},children:[b.length," ",b.length===1?"Tank":"Tanks",u.length>0&&e.jsxs("span",{style:{marginLeft:"8px"},children:["• ",u.length," ",u.length===1?"Hydrant":"Hydrants"]})]})]}),s.length===0&&e.jsxs(F,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3,bgcolor:"rgba(255, 255, 255, 0.95)",p:3,borderRadius:2,textAlign:"center",maxWidth:350,boxShadow:2},children:[e.jsx(m,{variant:"h6",gutterBottom:!0,color:"primary",children:"Welcome to Water Supply Coverage Analysis"}),e.jsx(m,{variant:"body2",color:"text.secondary",children:'Use the placement mode selector in the top-left to choose between tanks and hydrants, then click anywhere on the map to place water supplies. You can also use the "Add Tank" and "Add Hydrant" buttons in the sidebar.'})]}),e.jsx(ka,{tank:d,open:i,onClose:q,isNewTank:!!y&&y.type==="tank"}),e.jsx(Ia,{hydrant:h,open:A,onClose:V,isNewHydrant:!!y&&y.type==="hydrant"})]})};class za{constructor(t,o){ne(this,"pdf");ne(this,"config");ne(this,"data");ne(this,"pageNumber",1);ne(this,"yPosition",20);ne(this,"colors",{primary:"#1976d2",secondary:"#0d47a1",success:"#2e7d32",warning:"#f57c00",error:"#d32f2f",tank:"#ff9800",hydrant:"#2196f3",text:"#333333",lightGray:"#f5f5f5",mediumGray:"#9e9e9e"});this.pdf=new Wt("portrait","mm","a4"),this.config=t,this.data=o,console.log("📋 PDF DEBUG: autoTable import:",typeof Pe),typeof Pe=="function"?(this.pdf.autoTable=Pe.bind(null,this.pdf),console.log("📋 PDF DEBUG: ✅ autoTable attached successfully")):console.error("📋 PDF DEBUG: ❌ autoTable is not a function:",Pe),t.customBranding&&(this.colors.primary=t.customBranding.primaryColor,this.colors.secondary=t.customBranding.secondaryColor)}async generateReport(){return console.log("🚀 GENERATING WATER SUPPLY COVERAGE REPORT"),console.log("📋 PDF DEBUG: jsPDF instance created:",!!this.pdf),console.log("📋 PDF DEBUG: autoTable plugin loaded:",!!this.pdf.autoTable),this.addTitlePage(),this.config.includeSections.summary&&(this.addNewPage(),this.addExecutiveSummary()),this.config.includeSections.tankInventory&&(this.addNewPage(),this.addTankInventorySection()),this.config.includeSections.hydrantInventory&&(this.addNewPage(),this.addHydrantInventorySection()),this.config.includeSections.coverageAnalysis&&(this.addNewPage(),this.addCoverageAnalysisSection()),this.config.includeSections.gapAssessment&&(this.addNewPage(),this.addGapAssessmentSection()),this.config.includeSections.compliance&&(this.addNewPage(),this.addComplianceSection()),this.config.includeSections.recommendations&&(this.addNewPage(),this.addRecommendationsSection()),this.addFootersToAllPages(),this.pdf.output("blob")}addTitlePage(){var o,b,u;if(this.yPosition=40,this.config.departmentLogo){const v=((o=this.config.customBranding)==null?void 0:o.logoPosition)==="center"?90:((b=this.config.customBranding)==null?void 0:b.logoPosition)==="right"?160:20;try{let l="PNG";(this.config.departmentLogo.includes("data:image/jpeg")||this.config.departmentLogo.includes("data:image/jpg"))&&(l="JPEG"),this.pdf.addImage(this.config.departmentLogo,l,v,this.yPosition,30,30),this.yPosition+=40}catch(l){console.error("Failed to add logo:",l),this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.mediumGray),this.pdf.text("[Department Logo - Failed to Load]",v,this.yPosition+15),this.yPosition+=25}}if(this.pdf.setFontSize(24),this.pdf.setTextColor(this.colors.primary),this.addCenteredText(this.config.title,this.yPosition),this.yPosition+=15,this.config.subtitle&&(this.pdf.setFontSize(16),this.pdf.setTextColor(this.colors.text),this.addCenteredText(this.config.subtitle,this.yPosition),this.yPosition+=10),this.pdf.setFontSize(18),this.pdf.setTextColor(this.colors.secondary),this.addCenteredText(this.config.departmentName,this.yPosition),this.yPosition+=20,this.config.reportPeriod){this.pdf.setFontSize(14),this.pdf.setTextColor(this.colors.text);const s=`Analysis Period: ${this.config.reportPeriod.startDate} to ${this.config.reportPeriod.endDate}`;this.addCenteredText(s,this.yPosition),this.yPosition+=20}this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.mediumGray);const t=`Generated on ${new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}`;this.addCenteredText(t,this.yPosition),this.yPosition+=30,(u=this.config.customText)!=null&&u.chiefMessage&&(this.yPosition+=20,this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.text),this.pdf.text("Message from Fire Chief:",20,this.yPosition),this.yPosition+=10,this.pdf.splitTextToSize(this.config.customText.chiefMessage,170).forEach(v=>{this.pdf.text(v,20,this.yPosition),this.yPosition+=6})),this.config.chiefName&&(this.yPosition=220,this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.text),this.pdf.text("Prepared by:",20,this.yPosition),this.yPosition+=8,this.pdf.setFontSize(14),this.pdf.text(this.config.chiefName,20,this.yPosition),this.config.chiefTitle&&(this.yPosition+=6,this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.mediumGray),this.pdf.text(this.config.chiefTitle,20,this.yPosition)))}addExecutiveSummary(){var b;this.addSectionHeader("Executive Summary"),this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.text),[((b=this.config.customText)==null?void 0:b.executiveSummary)||`This report provides a comprehensive analysis of water supply coverage for ${this.config.departmentName}.`,"","Water Supply Infrastructure:",`• Total Tanks: ${this.data.tanks.length}`,`• Total Hydrants: ${this.data.hydrants.length}`,`• Total Water Sources: ${this.data.tanks.length+this.data.hydrants.length}`,"","Capacity Analysis:",`• Total Tank Capacity: ${this.getTotalTankCapacity().toLocaleString()} gallons`,`• Average Tank Capacity: ${this.getAverageTankCapacity().toLocaleString()} gallons`,`• Total Hydrant Flow Rate: ${this.getTotalHydrantFlow().toLocaleString()} GPM`,"","Coverage Assessment:",this.getCoverageOverview()].forEach(u=>{this.yPosition>250&&this.addNewPage(),this.pdf.text(u,20,this.yPosition),this.yPosition+=6})}addTankInventorySection(){if(this.addSectionHeader("Tank Inventory"),this.data.tanks.length===0){this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.text),this.pdf.text("No tanks recorded in the system.",20,this.yPosition);return}try{const t=this.data.tanks.map(o=>[o.name,`${o.capacity.toLocaleString()} gal`,o.type,o.accessRating,o.operationalStatus,o.owner]);this.pdf.autoTable({head:[["Tank Name","Capacity","Type","Access","Status","Owner"]],body:t,startY:this.yPosition,theme:"grid",headStyles:{fillColor:[255,152,0],textColor:255},bodyStyles:{fontSize:9,cellPadding:2},columnStyles:{0:{cellWidth:30},1:{cellWidth:25},2:{cellWidth:25},3:{cellWidth:20},4:{cellWidth:20},5:{cellWidth:25}},margin:{left:20,right:20},didDrawPage:o=>{this.yPosition=o.cursor.y+10}})}catch(t){console.error("Could not create tank table:",t),this.addTextFallbackTable("Tanks",this.data.tanks)}}addHydrantInventorySection(){if(this.addSectionHeader("Hydrant Inventory"),this.data.hydrants.length===0){this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.text),this.pdf.text("No hydrants recorded in the system.",20,this.yPosition);return}try{const t=this.data.hydrants.map(o=>[o.name,`${o.flowRate} GPM`,`${o.staticPressure} PSI`,o.size,o.operationalStatus,o.owner]);this.pdf.autoTable({head:[["Hydrant Name","Flow Rate","Pressure","Size","Status","Owner"]],body:t,startY:this.yPosition,theme:"grid",headStyles:{fillColor:[33,150,243],textColor:255},bodyStyles:{fontSize:9,cellPadding:2},columnStyles:{0:{cellWidth:30},1:{cellWidth:25},2:{cellWidth:25},3:{cellWidth:20},4:{cellWidth:20},5:{cellWidth:25}},margin:{left:20,right:20},didDrawPage:o=>{this.yPosition=o.cursor.y+10}})}catch(t){console.error("Could not create hydrant table:",t),this.addTextFallbackTable("Hydrants",this.data.hydrants)}}addCoverageAnalysisSection(){this.addSectionHeader("Coverage Analysis"),this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.text),["Water Supply Coverage Assessment:","","Tank Coverage Analysis:",`• Number of Tanks: ${this.data.tanks.length}`,`• Average Coverage Radius: ${this.getAverageCoverageRadius()} feet`,`• Total Area Covered by Tanks: ${this.calculateTankCoverageArea()} square miles`,"","Hydrant Coverage Analysis:",`• Number of Hydrants: ${this.data.hydrants.length}`,`• Average Flow Rate: ${this.getAverageHydrantFlow()} GPM`,`• Hydrant Distribution: ${this.getHydrantDistribution()}`,"","Combined Coverage:",this.getCombinedCoverageAnalysis()].forEach(o=>{this.yPosition>250&&this.addNewPage(),this.pdf.text(o,20,this.yPosition),this.yPosition+=6})}addGapAssessmentSection(){this.addSectionHeader("Coverage Gap Assessment"),this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.text),["Coverage Gap Analysis:","","Identified Coverage Gaps:",this.getGapAnalysis(),"","Recommendations for Gap Coverage:",...this.getGapRecommendations()].forEach(o=>{this.yPosition>250&&this.addNewPage(),this.pdf.text(o,20,this.yPosition),this.yPosition+=6})}addComplianceSection(){this.addSectionHeader("Regulatory Compliance"),this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.text),["PA 17 Compliance Assessment:","","Tank Requirements:",`✓ Tank locations documented: ${this.data.tanks.length>0?"YES":"NO"}`,`✓ Capacity information available: ${this.hasCapacityInfo()?"YES":"NO"}`,`✓ Access ratings documented: ${this.hasAccessRatings()?"YES":"NO"}`,"","Hydrant Requirements:",`✓ Hydrant locations documented: ${this.data.hydrants.length>0?"YES":"NO"}`,`✓ Flow rate testing data: ${this.hasFlowRateData()?"YES":"NO"}`,`✓ Pressure testing data: ${this.hasPressureData()?"YES":"NO"}`,"","Overall Compliance Status:",this.getOverallComplianceStatus()].forEach(o=>{this.yPosition>250&&this.addNewPage(),this.pdf.text(o,20,this.yPosition),this.yPosition+=6})}addRecommendationsSection(){this.addSectionHeader("Recommendations & Action Items"),this.pdf.setFontSize(12),this.pdf.setTextColor(this.colors.text),this.generateRecommendations().forEach(o=>{this.yPosition>250&&this.addNewPage(),this.pdf.text(o,20,this.yPosition),this.yPosition+=6})}addNewPage(){this.pdf.addPage(),this.pageNumber++,this.yPosition=20}addSectionHeader(t){this.pdf.setFontSize(16),this.pdf.setTextColor(this.colors.primary),this.pdf.text(t,20,this.yPosition),this.yPosition+=12,this.pdf.setDrawColor(this.colors.primary),this.pdf.line(20,this.yPosition-2,190,this.yPosition-2),this.yPosition+=8}addCenteredText(t,o){const u=(210-this.pdf.getTextWidth(t))/2;this.pdf.text(t,u,o)}addFootersToAllPages(){const t=this.pdf.getNumberOfPages();for(let o=1;o<=t;o++)this.pdf.setPage(o),this.pdf.setDrawColor(this.colors.mediumGray),this.pdf.line(20,280,190,280),this.pdf.setFontSize(10),this.pdf.setTextColor(this.colors.mediumGray),this.pdf.text(`Page ${o} of ${t}`,170,285),this.pdf.text(this.config.departmentName,20,285)}addTextFallbackTable(t,o){this.pdf.setFontSize(10),this.pdf.setTextColor(this.colors.text),o.slice(0,10).forEach((b,u)=>{this.yPosition>250&&this.addNewPage(),this.pdf.text(`${u+1}. ${b.name}`,20,this.yPosition),this.yPosition+=5})}getTotalTankCapacity(){return this.data.tanks.reduce((t,o)=>t+o.capacity,0)}getAverageTankCapacity(){return this.data.tanks.length===0?0:this.getTotalTankCapacity()/this.data.tanks.length}getTotalHydrantFlow(){return this.data.hydrants.reduce((t,o)=>t+o.flowRate,0)}getAverageHydrantFlow(){return this.data.hydrants.length===0?0:this.getTotalHydrantFlow()/this.data.hydrants.length}getAverageCoverageRadius(){const t=this.getAverageTankCapacity();let o=1e3;return t>=1e5?o=1500:t>=5e4?o=1200:t>=25e3?o=1e3:o=800,o.toString()}calculateTankCoverageArea(){const t=parseFloat(this.getAverageCoverageRadius());return(Math.PI*Math.pow(t/5280,2)*this.data.tanks.length).toFixed(2)}getHydrantDistribution(){return this.data.hydrants.length===0?"No hydrants recorded":this.data.hydrants.length<5?"Limited distribution":this.data.hydrants.length<15?"Moderate distribution":"Good distribution"}getCoverageOverview(){const t=this.data.tanks.length+this.data.hydrants.length;return t===0?"⚠ No water sources recorded":t<5?"⚠ Limited water supply coverage - consider additional sources":t<15?"✓ Adequate water supply coverage with room for improvement":"✓ Excellent water supply coverage"}getCombinedCoverageAnalysis(){return`Combined tank and hydrant coverage provides ${this.data.tanks.length+this.data.hydrants.length} water sources across the service area.`}getGapAnalysis(){var t;if((t=this.data.analysis)!=null&&t.gaps){const o=this.data.analysis.gaps.filter(b=>b.severity==="high").length;return o>0?`${o} high-priority coverage gaps identified requiring immediate attention.`:`${this.data.analysis.gaps.length} coverage gaps identified with varying priority levels.`}return"Gap analysis requires coverage zone data to be available."}getGapRecommendations(){const t=[];return this.data.tanks.length===0&&t.push("• Consider installing mobile water tanks for rural coverage"),this.data.hydrants.length<10&&t.push("• Evaluate hydrant placement for optimal coverage"),this.getTotalTankCapacity()<1e5&&t.push("• Consider increasing tank capacity for extended operations"),t.length===0&&(t.push("• Maintain current water supply infrastructure"),t.push("• Conduct annual coverage assessments")),t}hasCapacityInfo(){return this.data.tanks.every(t=>t.capacity>0)}hasAccessRatings(){return this.data.tanks.every(t=>t.accessRating&&t.accessRating!=="")}hasFlowRateData(){return this.data.hydrants.every(t=>t.flowRate>0)}hasPressureData(){return this.data.hydrants.every(t=>t.staticPressure>0)}getOverallComplianceStatus(){const t=[this.data.tanks.length>0,this.data.hydrants.length>0,this.hasCapacityInfo(),this.hasFlowRateData()],b=t.filter(Boolean).length/t.length*100;return b>=90?"✓ Excellent compliance with regulatory requirements":b>=70?"⚠ Good compliance with minor improvements needed":"⚠ Compliance improvements required"}generateRecommendations(){const t=["Water Supply Infrastructure Recommendations:",""];return this.data.tanks.length===0?t.push("• Install at least one mobile water tank for rural operations"):this.data.tanks.length<3&&t.push("• Consider additional tank installations for redundancy"),this.data.hydrants.length===0?t.push("• Work with water authority to install hydrants in service area"):this.data.hydrants.length<10&&t.push("• Evaluate hydrant spacing for optimal coverage"),this.getAverageTankCapacity()<25e3&&t.push("• Consider larger capacity tanks for extended operations"),this.getAverageHydrantFlow()<1e3&&t.push("• Test hydrant flow rates to ensure adequate pressure"),t.push(""),t.push("General Recommendations:"),t.push("• Conduct annual water supply coverage assessments"),t.push("• Maintain detailed records of all water sources"),t.push("• Test hydrant flow rates annually"),t.push("• Review tank maintenance schedules quarterly"),t}}async function $a(a,t){return console.log("🚀 GENERATING WATER SUPPLY COVERAGE REPORT"),await new za(a,t).generateReport()}const Fa=[{id:"pa17_compliance",name:"PA 17 Compliance Report",description:"Official Pennsylvania Act 17 compliance documentation",targetAudience:"State Fire Marshal, Insurance Commissioners",estimatedPages:8,icon:e.jsx(ra,{color:"primary"}),sections:{summary:!0,tankInventory:!0,hydrantInventory:!0,coverageAnalysis:!0,gapAssessment:!1,recommendations:!0,compliance:!0}},{id:"coverage_assessment",name:"Water Supply Coverage Assessment",description:"Comprehensive analysis of water supply distribution and effectiveness",targetAudience:"Fire Chief, City Manager, Planning Commission",estimatedPages:12,icon:e.jsx(qe,{color:"secondary"}),sections:{summary:!0,tankInventory:!0,hydrantInventory:!0,coverageAnalysis:!0,gapAssessment:!0,recommendations:!0,compliance:!1}},{id:"planning_document",name:"Strategic Planning Document",description:"Long-term water supply infrastructure planning and budgeting",targetAudience:"City Council, Budget Committee, Grant Reviewers",estimatedPages:16,icon:e.jsx(ia,{color:"success"}),sections:{summary:!0,tankInventory:!0,hydrantInventory:!0,coverageAnalysis:!0,gapAssessment:!0,recommendations:!0,compliance:!1}},{id:"inventory_report",name:"Water Supply Inventory Report",description:"Detailed inventory of all water supply assets and capabilities",targetAudience:"Department Personnel, Maintenance Staff",estimatedPages:6,icon:e.jsx(re,{color:"warning"}),sections:{summary:!0,tankInventory:!0,hydrantInventory:!0,coverageAnalysis:!1,gapAssessment:!1,recommendations:!1,compliance:!1}}],Ma=({open:a,onClose:t})=>{const[o,b]=x.useState(0),[u,s]=x.useState(null),[v,l]=x.useState(!1),[C,p]=x.useState(null);ve.useEffect(()=>{console.log("🔥 WATER SUPPLY REPORT GENERATOR - Dialog state changed:",{open:a})},[a]);const[D,W]=x.useState({name:"Fire Department",chiefName:"",chiefTitle:"Fire Chief",logo:""}),[c,i]=x.useState({executiveSummary:"",reportPurpose:"",chiefMessage:""}),j=_(Le),A=_(je),f=_(vt),d=_(Ue),r=["Select Template","Department Info","Customize Report","Generate & Download"],h=()=>{b(S=>S+1)},g=()=>{b(S=>S-1)},y=S=>{s(S),h()},T=async()=>{if(u){l(!0);try{const S={reportType:u.id.includes("compliance")?"compliance":u.id.includes("planning")?"planning":"coverage",title:u.name,subtitle:u.description,departmentName:D.name,departmentLogo:D.logo||void 0,chiefName:D.chiefName||void 0,chiefTitle:D.chiefTitle||void 0,includeSections:u.sections,customText:c.executiveSummary||c.reportPurpose||c.chiefMessage?{executiveSummary:c.executiveSummary||void 0,reportPurpose:c.reportPurpose||void 0,chiefMessage:c.chiefMessage||void 0}:void 0},R={tanks:j.map(M=>({id:M.id,name:M.name,location:M.location,capacity:M.capacity,type:M.type,accessRating:M.accessRating,operationalStatus:M.operationalStatus,owner:M.owner,notes:M.notes})),hydrants:A.map(M=>({id:M.id,name:M.name,location:M.location,flowRate:M.flowRate,staticPressure:M.staticPressure,residualPressure:M.residualPressure,type:M.type,size:M.size,operationalStatus:M.operationalStatus,owner:M.owner,notes:M.notes})),coverageZones:f?f.map(M=>({id:M.supplyId,center:{latitude:0,longitude:0},radius:M.effectiveRange||1e3,supplyId:M.supplyId,supplyType:M.supplyType})):[],analysis:d?{totalCoverage:d.coveragePercentage,gaps:d.gapAreas.map(M=>({id:M.id,location:M.location,severity:M.severity})),redundancy:d.redundancyAreas.map(M=>({location:{latitude:0,longitude:0},supplyCount:M.tankCount}))}:void 0},w=await $a(S,R);p(w);const $=URL.createObjectURL(w),G=document.createElement("a");G.href=$,G.download=`${u.name.toLowerCase().replace(/\s+/g,"-")}-${new Date().toISOString().split("T")[0]}.pdf`,G.click(),URL.revokeObjectURL($),h()}catch(S){console.error("Failed to generate water supply report:",S),alert("Failed to generate report. Please try again.")}finally{l(!1)}}},z=()=>{b(0),s(null),p(null),l(!1),t()},L=()=>{switch(o){case 0:return H();case 1:return q();case 2:return V();case 3:return P();default:return null}},H=()=>e.jsxs(F,{children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"Choose Report Template"}),e.jsx(m,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Select the type of water supply report you need to generate. Each template is designed for specific audiences and compliance requirements."}),e.jsx(E,{container:!0,spacing:2,children:Fa.map(S=>e.jsx(E,{size:{xs:12,md:6},children:e.jsxs(He,{sx:{cursor:"pointer","&:hover":{elevation:4},border:(u==null?void 0:u.id)===S.id?2:0,borderColor:"primary.main"},onClick:()=>y(S),children:[e.jsxs(Ge,{children:[e.jsxs(F,{display:"flex",alignItems:"center",gap:2,mb:2,children:[S.icon,e.jsxs(F,{children:[e.jsx(m,{variant:"h6",component:"div",children:S.name}),e.jsx(oe,{label:`~${S.estimatedPages} pages`,size:"small",color:"primary",variant:"outlined"})]})]}),e.jsx(m,{variant:"body2",color:"text.secondary",paragraph:!0,children:S.description}),e.jsxs(m,{variant:"caption",color:"text.secondary",children:[e.jsx("strong",{children:"Target Audience:"})," ",S.targetAudience]})]}),e.jsx(ct,{children:e.jsx(K,{size:"small",onClick:()=>y(S),children:"Select Template"})})]})},S.id))})]}),q=()=>e.jsxs(F,{children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"Department Information"}),e.jsx(m,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Enter your department information to personalize the report. This information will appear on the title page and throughout the document."}),e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{size:{xs:12},children:e.jsx(U,{fullWidth:!0,label:"Department Name",value:D.name,onChange:S=>W(R=>({...R,name:S.target.value})),required:!0})}),e.jsx(E,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Fire Chief Name",value:D.chiefName,onChange:S=>W(R=>({...R,chiefName:S.target.value}))})}),e.jsx(E,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Chief Title",value:D.chiefTitle,onChange:S=>W(R=>({...R,chiefTitle:S.target.value}))})}),e.jsx(E,{size:{xs:12},children:e.jsx(U,{fullWidth:!0,label:"Department Logo (Base64)",value:D.logo,onChange:S=>W(R=>({...R,logo:S.target.value})),placeholder:"data:image/png;base64,...",helperText:"Optional: Paste base64 encoded image data for department logo",multiline:!0,rows:3})})]})]}),V=()=>e.jsxs(F,{children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"Customize Report Content"}),e.jsx(m,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Add custom text to personalize your report. All fields are optional."}),e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{size:{xs:12},children:e.jsx(U,{fullWidth:!0,label:"Executive Summary",value:c.executiveSummary,onChange:S=>i(R=>({...R,executiveSummary:S.target.value})),multiline:!0,rows:3,helperText:"Custom introduction for the executive summary section"})}),e.jsx(E,{size:{xs:12},children:e.jsx(U,{fullWidth:!0,label:"Report Purpose",value:c.reportPurpose,onChange:S=>i(R=>({...R,reportPurpose:S.target.value})),multiline:!0,rows:2,helperText:"Specific purpose or context for this report"})}),e.jsx(E,{size:{xs:12},children:e.jsx(U,{fullWidth:!0,label:"Chief's Message",value:c.chiefMessage,onChange:S=>i(R=>({...R,chiefMessage:S.target.value})),multiline:!0,rows:4,helperText:"Personal message from the Fire Chief for the title page"})})]}),e.jsx(F,{mt:3,children:e.jsx(te,{severity:"info",children:e.jsxs(m,{variant:"body2",children:[e.jsx("strong",{children:"Report Preview:"})," Your report will include ",j.length," tanks, ",A.length," hydrants, and estimated ",u==null?void 0:u.estimatedPages," pages of professional analysis."]})})})]}),P=()=>e.jsx(F,{textAlign:"center",children:v?e.jsxs(F,{children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"Generating Report..."}),e.jsx(We,{sx:{my:2}}),e.jsx(m,{variant:"body2",color:"text.secondary",children:"Creating professional water supply coverage report"})]}):e.jsxs(F,{children:[e.jsx(m,{variant:"h6",gutterBottom:!0,color:"success.main",children:"✅ Report Generated Successfully"}),e.jsx(m,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Your professional water supply coverage report has been generated and downloaded."}),e.jsxs(F,{display:"flex",justifyContent:"center",gap:2,mt:3,children:[e.jsx(K,{variant:"outlined",onClick:z,children:"Close"}),e.jsx(K,{variant:"contained",onClick:T,startIcon:e.jsx(Ae,{}),children:"Download Again"})]})]})});return e.jsxs($e,{open:a,onClose:z,maxWidth:"md",fullWidth:!0,children:[e.jsx(Fe,{children:e.jsxs(F,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(qe,{}),"Professional Water Supply Report Generator"]})}),e.jsxs(Me,{children:[e.jsx(F,{mb:3,children:e.jsx(Ut,{activeStep:o,alternativeLabel:!0,children:r.map(S=>e.jsx(_t,{children:e.jsx(qt,{children:S})},S))})}),L()]}),e.jsxs(De,{children:[e.jsx(K,{onClick:z,children:"Cancel"}),o>0&&o<3&&e.jsx(K,{onClick:g,children:"Back"}),o===1&&e.jsx(K,{variant:"contained",onClick:h,disabled:!D.name,children:"Next"}),o===2&&e.jsx(K,{variant:"contained",onClick:T,disabled:v,startIcon:e.jsx(Ae,{}),children:"Generate Report"})]})]})};console.log("🚨 HYDRANT DATA STRUCTURE FIXED - 2025-07-13T02:15:00Z - FORCING BUNDLE REFRESH");const Re=320,Ya=({initialTanks:a=[],initialAnalysisParams:t,onAnalysisComplete:o,onTankUpdate:b,mode:u="analysis"})=>{const s=ae(),v=Vt(),l=la(v.breakpoints.down("md")),C=_(Le),p=_(je),D=_(vt),W=_(Ue),c=_(pt),i=_(Yt),[j,A]=ve.useState(!l),[f,d]=ve.useState(!1);x.useEffect(()=>{document.title="FireEMS Water Supply Coverage Analysis"},[]),x.useEffect(()=>{a.length>0&&console.log("Loading initial tanks:",a),t&&console.log("Loading initial analysis parameters:",t)},[a,t]),x.useEffect(()=>{W&&o&&o(W)},[W,o]),x.useEffect(()=>{(()=>{try{const q=sessionStorage.getItem("fireEmsExportedData");if(q){const V=JSON.parse(q);console.log("🔥 WATER SUPPLY COVERAGE - Checking imported data:",V),V.toolId==="water-supply-coverage"&&V.data&&V.data.length>0&&(console.log("🔥 WATER SUPPLY COVERAGE - Processing imported data:",V.data.length,"records"),V.data.forEach((P,S)=>{var $,G;console.log(`🔥 Processing record ${S+1}:`,P);const R=P.latitude||P.lat,w=P.longitude||P.lng||P.lon;if(R&&w)if((($=P.type)==null?void 0:$.toLowerCase().includes("hydrant"))||((G=P.infrastructure_type)==null?void 0:G.toLowerCase().includes("hydrant"))||!P.capacity){console.log("🔍 Record data for hydrant:",{address:P.address,name:P.name,index:S,fallback:`Hydrant ${S+1}`,hasAddress:!!P.address,hasName:!!P.name});const n={name:P.address||P.name||`Hydrant ${(S||0)+1}`,location:{latitude:parseFloat(R),longitude:parseFloat(w)},flowRate:P.gpm||P.flow_rate||1e3,staticPressure:P.staticPressure||P.static_pressure||50,residualPressure:P.residualPressure||P.residual_pressure||20,type:P.hydrant_type||"municipal",size:P.size||"4-inch",operationalStatus:P.status||"active",owner:P.owner||"Municipal",contactInfo:P.contact||"",notes:P.notes||""};console.log("🔥 Adding hydrant:",n),console.log("🔍 Hydrant validation:",{hasName:!!n.name,nameValue:n.name,hasLocation:!!n.location,hasValidCoords:!isNaN(n.location.latitude)&&!isNaN(n.location.longitude),coords:`${n.location.latitude}, ${n.location.longitude}`}),s(be(n))}else{const n={name:P.address||P.name||`Tank ${S+1}`,location:{latitude:parseFloat(R),longitude:parseFloat(w)},capacity:parseInt(P.capacity)||parseInt(P.gallons)||1e4,type:P.tank_type||"municipal",accessRating:P.access_rating||"good",operationalStatus:P.status||"active",owner:P.owner||"Municipal",contactInfo:P.contact||"",notes:P.notes||""};console.log("🔥 Adding tank:",n),s(ze(n))}else console.warn(`🔥 Skipping record ${S+1} - missing latitude/longitude:`,P)}),sessionStorage.removeItem("fireEmsExportedData"),console.log("🔥 WATER SUPPLY COVERAGE - Data import complete, cleared sessionStorage"))}}catch(q){console.error("🔥 WATER SUPPLY COVERAGE - Error importing data:",q)}})()},[s]);const r=()=>{A(!j)},h=()=>{d(!f),f?document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()},g=()=>{const H={tanks:C,coverageZones:D,activeAnalysis:W,timestamp:new Date};localStorage.setItem("tankZoneCoverage_autosave",JSON.stringify(H)),console.log("Tank zone coverage data saved")},[y,T]=ve.useState(!1);x.useEffect(()=>{console.log("🔥🔥🔥 COMPONENT STATE UPDATE - Export button state:",{tanksCount:C.length,hydrantsCount:p.length,isDisabled:C.length===0&&p.length===0,showReportGenerator:y})},[C.length,p.length,y]);const z=()=>{console.log("🔥🔥🔥 EXPORT FUNCTION CALLED - ENTRY POINT"),console.log("🔥 EXPORT BUTTON CLICKED - Starting export process");const H=C.length>0||p.length>0;if(console.log("🔥 EXPORT DATA CHECK:",{tanksCount:C.length,hydrantsCount:p.length,hasData:H}),!H){console.log("🔥 NO DATA - Showing alert"),alert("No water supply data to export. Please add tanks or hydrants first.");return}console.log("🔥 OPENING REPORT GENERATOR - Setting state"),T(!0),console.log("📊 Opening professional water supply report generator:",{tanks:C.length,hydrants:p.length,hasAnalysis:!!W,showReportGenerator:!0})},L=()=>{s(Xt())};return e.jsx(Qt,{children:e.jsxs(F,{sx:{display:"flex",height:"100vh",overflow:"hidden",bgcolor:"background.default",position:f?"fixed":"relative",top:f?0:"auto",left:f?0:"auto",right:f?0:"auto",bottom:f?0:"auto",zIndex:f?1300:"auto"},role:"main","aria-label":"Tank Zone Coverage Analysis Tool",children:[!f&&e.jsx(ea,{position:"fixed",sx:{zIndex:v.zIndex.drawer+1,bgcolor:"primary.main"},children:e.jsxs(Zt,{children:[e.jsx(ue,{color:"inherit","aria-label":"toggle sidebar",onClick:r,edge:"start",sx:{mr:2},children:e.jsx(ua,{})}),e.jsx(re,{sx:{mr:1}}),e.jsxs(m,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:["Water Supply Coverage Analysis",u==="planning"&&" - Planning Mode",u==="presentation"&&" - Presentation Mode"]}),e.jsxs(F,{sx:{display:"flex",gap:1},children:[e.jsx(ue,{color:"inherit",onClick:g,title:"Save Analysis",children:e.jsx(Ve,{})}),e.jsx(ue,{color:"inherit",onClick:H=>{console.log("🔥🔥🔥 EXPORT BUTTON CLICKED - Raw event:",H),console.log("🔥🔥🔥 Button disabled state:",C.length===0&&p.length===0),console.log("🔥🔥🔥 Tank count:",C.length,"Hydrant count:",p.length),z()},title:"Generate Professional Report",disabled:C.length===0&&p.length===0,children:e.jsx(pa,{})}),e.jsx(ue,{color:"inherit",onClick:h,title:"Toggle Fullscreen",children:f?e.jsx(ca,{}):e.jsx(da,{})})]})]})}),e.jsx(ha,{variant:l?"temporary":"persistent",anchor:"left",open:j,onClose:r,sx:{width:Re,flexShrink:0,"& .MuiDrawer-paper":{width:Re,boxSizing:"border-box",marginTop:f?0:"56px",height:f?"100vh":"calc(100vh - 56px)",borderRight:`1px solid ${v.palette.divider}`}},ModalProps:{keepMounted:!0,disablePortal:!1,hideBackdrop:!l,disableAutoFocus:!0,disableEnforceFocus:!0,disableRestoreFocus:!0},PaperProps:{"aria-hidden":!1,role:"complementary","aria-label":"Tank Zone Coverage Tools"},children:e.jsx(Ta,{mode:u})}),e.jsxs(F,{component:"main",sx:{flexGrow:1,position:"relative",marginLeft:!l&&j?`${Re}px`:0,width:!l&&j?`calc(100% - ${Re}px)`:"100%",marginTop:f?0:"56px",height:f?"100vh":"calc(100vh - 56px)",transition:v.transitions.create(["margin","width"],{easing:v.transitions.easing.sharp,duration:v.transitions.duration.leavingScreen})},children:[e.jsx(xe,{elevation:0,sx:{height:"100%",width:"100%",borderRadius:0,overflow:"hidden",position:"relative",minHeight:"500px",display:"flex",flexDirection:"column","& .leaflet-container":{background:"transparent !important",outline:"none"},"& .leaflet-tile-pane":{opacity:"1 !important",visibility:"visible !important"},"& .leaflet-tile":{opacity:"1 !important",visibility:"visible !important",display:"block !important",imageRendering:"auto",transform:"translateZ(0)",backfaceVisibility:"hidden"},"& .leaflet-layer":{opacity:"1 !important",visibility:"visible !important"}},children:e.jsx(Ea,{sidebarOpen:j,isMobile:l})}),c&&e.jsx(F,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsx(m,{variant:"h6",children:"Analyzing Tank Coverage..."})})]}),e.jsx(Kt,{open:!!i,autoHideDuration:6e3,onClose:L,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(te,{onClose:L,severity:"error",sx:{width:"100%"},children:i})}),e.jsx(Ma,{open:y,onClose:()=>T(!1)})]})})};export{Ya as default};
