import{j as e,r as i,B as a,C as R,bn as ie,A as V}from"./index-Dk2LUKdZ.js";import{A as M,a as le,M as ce,T as K,F as se,I as te,S as re,L as oe}from"./TextField-DbpKfZR0.js";import{c as P,T as r,P as L}from"./Typography-BoP20g0f.js";import{G as o,C as E}from"./listItemTextClasses-G9efp_b0.js";import{C as A,a as T}from"./CardContent-hb7W-CEs.js";import{C as k}from"./CheckCircle-CYnlYPiR.js";import{B as W}from"./Business-BJlSb4-0.js";import{T as de,R as ne}from"./TrendingUp-BkmgUrIc.js";import{L as X}from"./LinearProgress-BjrCVlbI.js";import{W as xe}from"./Warning-DbX9ck6g.js";import{B as U}from"./Button-DglV_EoA.js";import{e as he,T as me,a as ue,b as q,c as g,d as je}from"./TableRow-CubB2eeZ.js";import{M as pe,D as fe}from"./MoreVert-Dn-Sv573.js";import{M as D}from"./MenuItem-DQ49tEM0.js";import{d as Z,e as N,D as ve,a as ye,b as ge,F as Q,c as be,L as ee,f as _e}from"./ListItemText-DIYWaDV4.js";import{E as we}from"./Edit-BnTz3vbR.js";import{D as Ce}from"./Delete-BGm2zGuV.js";import{S as z,a as Se}from"./Save-BUHADtmF.js";import{S as Ee}from"./Settings-BKV03eqx.js";import{S as De}from"./Security-C2d5U-Cv.js";import{D as Ae}from"./Divider-BwHVwWx_.js";import{T as Te,a as G}from"./Tabs-DLRoe0W6.js";const Ie=P([e.jsx("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),e.jsx("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")]),Ue=P(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"})),ae=P(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"})),ke=P(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),Me=({userRole:h})=>{const[s,d]=i.useState(null),[b,y]=i.useState(!0),[f,v]=i.useState(null);i.useEffect(()=>{S()},[]);const S=async()=>{try{y(!0);const p=await fetch("/admin/api/analytics/overview",{credentials:"include"});if(!p.ok)throw new Error("Failed to fetch analytics");const l=await p.json();if(l.success)d(l.analytics);else throw new Error(l.error||"Failed to load analytics")}catch(p){console.error("Error fetching analytics:",p),v(p instanceof Error?p.message:"Failed to load analytics")}finally{y(!1)}};if(b)return e.jsx(a,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(R,{})});if(f)return e.jsx(M,{severity:"error",sx:{mb:3},children:f});if(!s)return null;const m=s.total_users>0?Math.round(s.active_users/s.total_users*100):0,_=s.total_departments>0?Math.round(s.active_departments/s.total_departments*100):0;return e.jsxs(a,{children:[e.jsxs(a,{sx:{mb:3},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,children:"System Overview"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:h==="super_admin"?"System-wide analytics":"Department analytics"})]}),e.jsxs(o,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{children:e.jsx(T,{children:e.jsxs(a,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(a,{children:[e.jsx(r,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Total Users"}),e.jsx(r,{variant:"h4",children:s.total_users})]}),e.jsx(ae,{sx:{fontSize:40,color:"primary.main",opacity:.7}})]})})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{children:e.jsx(T,{children:e.jsxs(a,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(a,{children:[e.jsx(r,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Active Users"}),e.jsx(r,{variant:"h4",color:"success.main",children:s.active_users}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[m,"% active"]})]}),e.jsx(k,{sx:{fontSize:40,color:"success.main",opacity:.7}})]})})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{children:e.jsx(T,{children:e.jsxs(a,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(a,{children:[e.jsx(r,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:h==="super_admin"?"Total Departments":"Your Department"}),e.jsx(r,{variant:"h4",children:s.total_departments}),s.active_departments<s.total_departments&&e.jsxs(r,{variant:"body2",color:"warning.main",children:[s.total_departments-s.active_departments," inactive"]})]}),e.jsx(W,{sx:{fontSize:40,color:"info.main",opacity:.7}})]})})})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{children:e.jsx(T,{children:e.jsxs(a,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(a,{children:[e.jsx(r,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"New This Month"}),e.jsx(r,{variant:"h4",color:"secondary.main",children:s.recent_users_this_month}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"new users"})]}),e.jsx(de,{sx:{fontSize:40,color:"secondary.main",opacity:.7}})]})})})})]}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(A,{children:e.jsxs(T,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"User Activity"}),e.jsxs(a,{sx:{mb:2},children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Active Users"}),e.jsxs(r,{variant:"body2",fontWeight:"bold",children:[s.active_users," / ",s.total_users]})]}),e.jsx(X,{variant:"determinate",value:m,sx:{height:8,borderRadius:4},color:m>80?"success":m>60?"warning":"error"}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[m,"% of users are active"]})]}),e.jsxs(a,{display:"flex",gap:1,flexWrap:"wrap",children:[e.jsx(E,{size:"small",label:`${s.active_users} Active`,color:"success",variant:"outlined"}),s.total_users-s.active_users>0&&e.jsx(E,{size:"small",label:`${s.total_users-s.active_users} Inactive`,color:"default",variant:"outlined"}),s.recent_users_this_month>0&&e.jsx(E,{size:"small",label:`${s.recent_users_this_month} New This Month`,color:"primary",variant:"outlined"})]})]})})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(A,{children:e.jsxs(T,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Department Status"}),e.jsxs(a,{sx:{mb:2},children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Active Departments"}),e.jsxs(r,{variant:"body2",fontWeight:"bold",children:[s.active_departments," / ",s.total_departments]})]}),e.jsx(X,{variant:"determinate",value:_,sx:{height:8,borderRadius:4},color:_>80?"success":_>60?"warning":"error"}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[_,"% of departments are active"]})]}),e.jsxs(a,{display:"flex",gap:1,flexWrap:"wrap",children:[e.jsx(E,{size:"small",label:`${s.active_departments} Active`,color:"success",variant:"outlined"}),s.total_departments-s.active_departments>0&&e.jsx(E,{size:"small",label:`${s.total_departments-s.active_departments} Inactive`,color:"warning",variant:"outlined"}),h==="super_admin"&&e.jsx(E,{size:"small",label:"System Admin",color:"primary",variant:"filled"})]})]})})})]}),e.jsx(A,{sx:{mt:3},children:e.jsxs(T,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"System Health"}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsxs(a,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(k,{color:"success"}),e.jsx(r,{variant:"body2",children:"User Management: Operational"})]})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsxs(a,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(k,{color:"success"}),e.jsx(r,{variant:"body2",children:"Department Management: Operational"})]})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsxs(a,{display:"flex",alignItems:"center",gap:1,children:[s.recent_users_this_month>0?e.jsx(k,{color:"success"}):e.jsx(xe,{color:"warning"}),e.jsxs(r,{variant:"body2",children:["User Registration: ",s.recent_users_this_month>0?"Active":"Low Activity"]})]})})]})]})})]})},Fe=({open:h,user:s,onClose:d,onSave:b,userRole:y})=>{const[f,v]=i.useState({name:"",email:"",role:"",is_active:!0});i.useEffect(()=>{s&&v({name:s.name||"",email:s.email||"",role:s.role||"user",is_active:s.is_active??!0})},[s]);const S=()=>{s&&b(s.id,f)},m=p=>l=>{v(w=>({...w,[p]:l.target.value}))},_=p=>l=>{v(w=>({...w,[p]:l.target.checked}))};return e.jsxs(ve,{open:h,onClose:d,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(ye,{children:["Edit User: ",s==null?void 0:s.email]}),e.jsx(ge,{children:e.jsxs(a,{sx:{pt:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(K,{label:"Name",fullWidth:!0,value:f.name,onChange:m("name")}),e.jsx(K,{label:"Email",fullWidth:!0,value:f.email,onChange:m("email"),type:"email"}),e.jsxs(se,{fullWidth:!0,children:[e.jsx(te,{children:"Role"}),e.jsxs(re,{value:f.role,onChange:m("role"),label:"Role",children:[e.jsx(D,{value:"user",children:"User"}),e.jsx(D,{value:"admin",children:"Admin"}),e.jsx(D,{value:"manager",children:"Manager"}),y==="super_admin"&&e.jsx(D,{value:"super_admin",children:"Super Admin"})]})]}),e.jsx(Q,{control:e.jsx(z,{checked:f.is_active,onChange:_("is_active")}),label:"Active User"})]})}),e.jsxs(be,{children:[e.jsx(U,{onClick:d,children:"Cancel"}),e.jsx(U,{onClick:S,variant:"contained",children:"Save Changes"})]})]})},Be=({userRole:h})=>{const[s,d]=i.useState([]),[b,y]=i.useState(!0),[f,v]=i.useState(null),[S,m]=i.useState({open:!1,user:null}),[_,p]=i.useState(null),[l,w]=i.useState(null);i.useEffect(()=>{F()},[]);const F=async()=>{try{y(!0);const n=await fetch("/admin/api/users",{credentials:"include"});if(!n.ok)throw new Error("Failed to fetch users");const j=await n.json();if(j.success)d(j.users);else throw new Error(j.error||"Failed to load users")}catch(n){console.error("Error fetching users:",n),v(n instanceof Error?n.message:"Failed to load users")}finally{y(!1)}},$=async(n,j)=>{try{const B=await(await fetch(`/admin/api/users/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(j)})).json();if(B.success)d(O=>O.map(H=>H.id===n?{...H,...j}:H)),m({open:!1,user:null}),v(null);else throw new Error(B.error||"Failed to update user")}catch(I){console.error("Error updating user:",I),v(I instanceof Error?I.message:"Failed to update user")}},t=async n=>{if(window.confirm("Are you sure you want to delete this user? This action cannot be undone."))try{const I=await(await fetch(`/admin/api/users/${n}`,{method:"DELETE",credentials:"include"})).json();if(I.success)d(B=>B.filter(O=>O.id!==n)),v(null);else throw new Error(I.error||"Failed to delete user")}catch(j){console.error("Error deleting user:",j),v(j instanceof Error?j.message:"Failed to delete user")}},x=(n,j)=>{p(n.currentTarget),w(j)},u=()=>{p(null),w(null)},C=n=>{switch(n){case"super_admin":return"error";case"admin":return"warning";case"manager":return"info";default:return"default"}},c=n=>n?new Date(n).toLocaleDateString():"Never";return b?e.jsx(a,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(R,{})}):e.jsxs(a,{children:[e.jsxs(a,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"h5",children:"User Management"}),e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(U,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:F,children:"Refresh"}),h==="super_admin"&&e.jsx(U,{variant:"contained",startIcon:e.jsx(ke,{}),onClick:()=>{},children:"Add User"})]})]}),f&&e.jsx(M,{severity:"error",sx:{mb:3},children:f}),e.jsx(he,{component:L,children:e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(q,{children:[e.jsx(g,{children:"User"}),e.jsx(g,{children:"Department"}),e.jsx(g,{children:"Role"}),e.jsx(g,{children:"Status"}),e.jsx(g,{children:"Created"}),e.jsx(g,{children:"Last Login"}),e.jsx(g,{children:"Actions"})]})}),e.jsxs(je,{children:[s.map(n=>e.jsxs(q,{children:[e.jsx(g,{children:e.jsxs(a,{children:[e.jsx(r,{variant:"body2",fontWeight:"bold",children:n.name}),e.jsx(r,{variant:"body2",color:"text.secondary",children:n.email})]})}),e.jsx(g,{children:e.jsx(r,{variant:"body2",children:n.department_name||"No Department"})}),e.jsx(g,{children:e.jsx(E,{label:n.role.replace("_"," ").toUpperCase(),color:C(n.role),size:"small"})}),e.jsx(g,{children:e.jsx(E,{label:n.is_active?"Active":"Inactive",color:n.is_active?"success":"default",size:"small",icon:n.is_active?e.jsx(k,{}):e.jsx(Ue,{})})}),e.jsx(g,{children:e.jsx(r,{variant:"body2",children:c(n.created_at)})}),e.jsx(g,{children:e.jsx(r,{variant:"body2",children:c(n.last_login)})}),e.jsx(g,{children:e.jsx(le,{onClick:j=>x(j,n),children:e.jsx(pe,{})})})]},n.id)),s.length===0&&e.jsx(q,{children:e.jsx(g,{colSpan:7,align:"center",children:e.jsx(r,{variant:"body2",color:"text.secondary",sx:{py:4},children:"No users found"})})})]})]})}),e.jsxs(ce,{anchorEl:_,open:!!_,onClose:u,children:[e.jsxs(D,{onClick:()=>{l&&m({open:!0,user:l}),u()},children:[e.jsx(Z,{children:e.jsx(we,{fontSize:"small"})}),e.jsx(N,{children:"Edit User"})]}),e.jsxs(D,{onClick:()=>{l&&t(l.id),u()},children:[e.jsx(Z,{children:e.jsx(Ce,{fontSize:"small"})}),e.jsx(N,{children:"Delete User"})]})]}),e.jsx(Fe,{open:S.open,user:S.user,onClose:()=>m({open:!1,user:null}),onSave:$,userRole:h})]})},ze=({userRole:h})=>{const[s,d]=i.useState([]),[b,y]=i.useState(!0),[f,v]=i.useState(!1),[S,m]=i.useState(null),[_,p]=i.useState(null);i.useEffect(()=>{l()},[]);const l=async()=>{try{y(!0);const t=await fetch("/admin/api/departments",{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch departments");const x=await t.json();if(x.success)d(x.departments);else throw new Error(x.error||"Failed to load departments")}catch(t){console.error("Error fetching departments:",t),m(t instanceof Error?t.message:"Failed to load departments")}finally{y(!1)}},w=async(t,x)=>{try{v(!0);const C=await(await fetch(`/admin/api/departments/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(x)})).json();if(C.success)d(c=>c.map(n=>n.id===t?{...n,...x}:n)),p("Department updated successfully"),m(null),setTimeout(()=>{p(null)},3e3);else throw new Error(C.error||"Failed to update department")}catch(u){console.error("Error updating department:",u),m(u instanceof Error?u.message:"Failed to update department")}finally{v(!1)}},F=t=>{switch(t){case"fire":return"error";case"ems":return"info";case"combined":return"warning";default:return"default"}},$=t=>new Date(t).toLocaleDateString();return b?e.jsx(a,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(R,{})}):e.jsxs(a,{children:[e.jsxs(a,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"h5",children:"Department Settings"}),e.jsx(U,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:l,children:"Refresh"})]}),S&&e.jsx(M,{severity:"error",sx:{mb:3},children:S}),_&&e.jsx(M,{severity:"success",sx:{mb:3},children:_}),e.jsxs(o,{container:!0,spacing:3,children:[s.map(t=>e.jsx(o,{item:!0,xs:12,children:e.jsx(A,{children:e.jsxs(T,{children:[e.jsxs(a,{sx:{mb:3},children:[e.jsxs(a,{display:"flex",alignItems:"center",gap:2,sx:{mb:2},children:[e.jsx(W,{color:"primary"}),e.jsx(r,{variant:"h6",children:t.name}),e.jsx(E,{label:t.department_type.toUpperCase(),color:F(t.department_type),size:"small"}),e.jsx(E,{label:t.is_active?"Active":"Inactive",color:t.is_active?"success":"default",size:"small"})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Department Code: ",t.code," • Created: ",$(t.created_at)," • ",t.user_count," Users"]})]}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsxs(r,{variant:"subtitle1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ee,{fontSize:"small"}),"Basic Settings"]}),e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(K,{label:"Department Name",fullWidth:!0,value:t.name,onChange:x=>{const u=x.target.value;d(C=>C.map(c=>c.id===t.id?{...c,name:u}:c))},size:"small"}),e.jsxs(se,{fullWidth:!0,size:"small",children:[e.jsx(te,{children:"Department Type"}),e.jsxs(re,{value:t.department_type,onChange:x=>{const u=x.target.value;d(C=>C.map(c=>c.id===t.id?{...c,department_type:u}:c))},label:"Department Type",children:[e.jsx(D,{value:"fire",children:"Fire"}),e.jsx(D,{value:"ems",children:"EMS"}),e.jsx(D,{value:"combined",children:"Combined Fire/EMS"})]})]}),h==="super_admin"&&e.jsx(Q,{control:e.jsx(z,{checked:t.is_active,onChange:x=>{const u=x.target.checked;d(C=>C.map(c=>c.id===t.id?{...c,is_active:u}:c))}}),label:"Department Active"})]})]}),e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsxs(r,{variant:"subtitle1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{fontSize:"small"}),"Advanced Settings"]}),e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(Q,{control:e.jsx(z,{checked:t.api_enabled,onChange:x=>{const u=x.target.checked;d(C=>C.map(c=>c.id===t.id?{...c,api_enabled:u}:c))}}),label:"API Access Enabled"}),e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Available Features"}),e.jsx(L,{variant:"outlined",sx:{p:2},children:e.jsxs(oe,{dense:!0,children:[Object.entries(t.features_enabled||{}).map(([x,u])=>e.jsxs(ee,{divider:!0,children:[e.jsx(N,{primary:x.replace("_"," ").toUpperCase(),secondary:u?"Enabled":"Disabled"}),e.jsx(_e,{children:e.jsx(z,{edge:"end",checked:u,onChange:C=>{const c={...t.features_enabled,[x]:C.target.checked};d(n=>n.map(j=>j.id===t.id?{...j,features_enabled:c}:j))}})})]},x)),Object.keys(t.features_enabled||{}).length===0&&e.jsx(ee,{children:e.jsx(N,{primary:"No features configured",secondary:"Contact administrator to enable features"})})]})})]})]})]}),e.jsx(Ae,{sx:{my:3}}),e.jsx(a,{display:"flex",justifyContent:"flex-end",children:e.jsx(U,{variant:"contained",startIcon:e.jsx(Se,{}),onClick:()=>w(t.id,{name:t.name,department_type:t.department_type,is_active:t.is_active,api_enabled:t.api_enabled,features_enabled:t.features_enabled}),disabled:f,children:f?"Saving...":"Save Changes"})})]})})},t.id)),s.length===0&&e.jsx(o,{item:!0,xs:12,children:e.jsxs(L,{sx:{p:4,textAlign:"center"},children:[e.jsx(W,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(r,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Departments Found"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:h==="super_admin"?"Create a new department to get started.":"Contact your administrator to set up departments."})]})})]})]})};function J(h){const{children:s,value:d,index:b,...y}=h;return e.jsx("div",{role:"tabpanel",hidden:d!==b,id:`admin-tabpanel-${b}`,"aria-labelledby":`admin-tab-${b}`,...y,children:d===b&&e.jsx(a,{sx:{pt:3},children:s})})}function Y(h){return{id:`admin-tab-${h}`,"aria-controls":`admin-tabpanel-${h}`}}const as=()=>{const h=ie(),[s,d]=i.useState(0),[b,y]=i.useState(!0),[f,v]=i.useState(null),[S,m]=i.useState(null);i.useEffect(()=>{_()},[]);const _=async()=>{try{y(!0);const l=await fetch("/auth/api/me",{credentials:"include"});if(!l.ok)throw new Error("Authentication required");const w=await l.json();if(!w.is_admin&&!w.is_super_admin)throw new Error("Admin access required");m(w.is_super_admin?"super_admin":"admin")}catch(l){console.error("Admin access check failed:",l),v(l instanceof Error?l.message:"Access denied"),setTimeout(()=>{h("/login")},2e3)}finally{y(!1)}},p=(l,w)=>{d(w)};return b?e.jsx(V,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsx(a,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(R,{size:60})})}):f?e.jsx(V,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsx(M,{severity:"error",children:f})}):e.jsxs(V,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(a,{sx:{mb:4},children:e.jsxs(o,{container:!0,alignItems:"center",spacing:2,children:[e.jsx(o,{item:!0,children:e.jsx(Ie,{sx:{fontSize:40,color:"primary.main"}})}),e.jsxs(o,{item:!0,xs:!0,children:[e.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,children:"Admin Console"}),e.jsx(r,{variant:"subtitle1",color:"text.secondary",children:"Manage departments, users, and system settings"})]}),e.jsx(o,{item:!0,children:e.jsx(U,{variant:"outlined",onClick:()=>h("/"),sx:{mr:2},children:"Back to Tools"})})]})}),e.jsx(L,{sx:{mb:3},children:e.jsxs(Te,{value:s,onChange:p,"aria-label":"admin navigation tabs",variant:"fullWidth",children:[e.jsx(G,{icon:e.jsx(fe,{}),label:"Overview",...Y(0)}),e.jsx(G,{icon:e.jsx(ae,{}),label:"User Management",...Y(1)}),e.jsx(G,{icon:e.jsx(W,{}),label:"Department Settings",...Y(2)})]})}),e.jsx(J,{value:s,index:0,children:e.jsx(Me,{userRole:S})}),e.jsx(J,{value:s,index:1,children:e.jsx(Be,{userRole:S})}),e.jsx(J,{value:s,index:2,children:e.jsx(ze,{userRole:S})})]})};export{as as default};
