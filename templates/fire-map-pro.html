<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FireMapPro | FireEMS.ai</title>
    
    <!-- External CSS Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-search@3.0.2/dist/leaflet-search.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-measure@3.1.0/dist/leaflet-measure.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='fire-map-pro.css') }}">
    
    <!-- Required scripts before content loads -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-search@3.0.2/dist/leaflet-search.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-measure@3.1.0/dist/leaflet-measure.js"></script>
    
    <!-- Export libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Heatmap plugin for Hotspot Analysis -->
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>
    <div class="navbar">
        <div class="logo">
            <a href="/">
                <i class="fas fa-fire"></i> FireEMS.ai
            </a>
        </div>
        <div class="nav-links">
            <a href="/">Home</a>
            <a href="/fire-ems-dashboard">Response Time Analyzer</a>
            <a href="/isochrone-map">Isochrone Map</a>
            <a href="/call-density-heatmap">Call Density</a>
            <a href="/station-overview">Station Overview</a>
            <a href="/incident-logger">Incident Logger</a>
            <a href="/coverage-gap-finder">Coverage Gap Finder</a>
            <a href="/fire-map-pro" class="active">FireMapPro</a>
            <a href="/data-formatter">Data Formatter</a>
            <a href="/user-guide">User Guide</a>
        </div>
    </div>

    <header class="tool-header">
        <div class="container">
            <h1><i class="fas fa-map-marked-alt"></i> FireMapPro</h1>
            <p>Advanced interactive map creator for fire department and EMS planning</p>
        </div>
    </header>

    <main class="container">
        <div class="firemappro-container">
            <div class="sidebar">
                <div class="tool-section">
                    <h3>Base Maps</h3>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="street-layer" name="base-layer" value="street" checked>
                            <label for="street-layer">Street Map</label>
                        </div>
                        <div>
                            <input type="radio" id="satellite-layer" name="base-layer" value="satellite">
                            <label for="satellite-layer">Satellite Imagery</label>
                        </div>
                        <div>
                            <input type="radio" id="terrain-layer" name="base-layer" value="terrain">
                            <label for="terrain-layer">Terrain Map</label>
                        </div>
                    </div>
                </div>

                <div class="tool-section">
                    <h3>Map Tools</h3>
                    <div class="tool-buttons">
                        <button id="draw-tool" class="tool-btn">
                            <i class="fas fa-draw-polygon"></i> Draw Tools
                        </button>
                        <button id="measure-tool" class="tool-btn">
                            <i class="fas fa-ruler"></i> Measure
                        </button>
                        <button id="clear-tool" class="tool-btn">
                            <i class="fas fa-trash-alt"></i> Clear All
                        </button>
                    </div>
                </div>

                <div class="tool-section">
                    <h3>Layers</h3>
                    <div class="layer-controls">
                        <div class="layer-item">
                            <input type="checkbox" id="stations-layer" checked>
                            <label for="stations-layer">Fire Stations</label>
                        </div>
                        <div class="layer-item">
                            <input type="checkbox" id="incidents-layer">
                            <label for="incidents-layer">Recent Incidents</label>
                        </div>
                        <div class="layer-item">
                            <input type="checkbox" id="response-zones-layer">
                            <label for="response-zones-layer">Response Zones</label>
                        </div>
                        <div class="layer-item">
                            <input type="checkbox" id="hydrants-layer">
                            <label for="hydrants-layer">Hydrants</label>
                        </div>
                        <div class="layer-item">
                            <input type="checkbox" id="hospitals-layer">
                            <label for="hospitals-layer">Hospitals</label>
                        </div>
                    </div>
                </div>

                <div class="tool-section">
                    <h3>Import Data</h3>
                    <div class="import-controls">
                        <div class="import-item">
                            <label for="csv-import" class="import-btn">
                                <i class="fas fa-file-csv"></i> Import CSV
                                <input type="file" id="csv-import" accept=".csv" style="display: none;">
                            </label>
                        </div>
                        <div class="import-item">
                            <label for="kml-import" class="import-btn">
                                <i class="fas fa-file-import"></i> Import KML/GPX
                                <input type="file" id="kml-import" accept=".kml,.gpx" style="display: none;">
                            </label>
                        </div>
                        <div class="import-item">
                            <label for="geojson-import" class="import-btn">
                                <i class="fas fa-file-code"></i> Import GeoJSON
                                <input type="file" id="geojson-import" accept=".geojson,.json" style="display: none;">
                            </label>
                        </div>
                    </div>
                </div>

                <div class="tool-section">
                    <h3>Analysis Tools</h3>
                    <div class="analysis-buttons">
                        <button id="hotspot-analysis" class="tool-btn">
                            <i class="fas fa-fire"></i> Hotspot Analysis
                        </button>
                        <button id="distance-analysis" class="tool-btn">
                            <i class="fas fa-road"></i> Distance Analysis
                        </button>
                        <button id="buffer-tool" class="tool-btn">
                            <i class="fas fa-expand-alt"></i> Create Buffer
                        </button>
                    </div>
                </div>

                <div class="tool-section">
                    <h3>Map Symbols</h3>
                    <div class="icon-category">
                        <h4>Emergency Services</h4>
                        <div class="icon-grid">
                            <div class="draggable-icon" data-icon="fa-fire-extinguisher" draggable="true">
                                <i class="fas fa-fire-extinguisher"></i>
                                <span>Extinguisher</span>
                            </div>
                            <div class="draggable-icon" data-icon="fa-ambulance" draggable="true">
                                <i class="fas fa-ambulance"></i>
                                <span>Ambulance</span>
                            </div>
                            <div class="draggable-icon" data-icon="fa-truck" draggable="true">
                                <i class="fas fa-truck"></i>
                                <span>Fire Engine</span>
                            </div>
                            <div class="draggable-icon" data-icon="fa-hospital" draggable="true">
                                <i class="fas fa-hospital"></i>
                                <span>Hospital</span>
                            </div>
                        </div>
                    </div>
                    <div class="icon-category">
                        <h4>Hazards</h4>
                        <div class="icon-grid">
                            <div class="draggable-icon" data-icon="fa-skull-crossbones" draggable="true">
                                <i class="fas fa-skull-crossbones"></i>
                                <span>Hazard</span>
                            </div>
                            <div class="draggable-icon" data-icon="fa-radiation" draggable="true">
                                <i class="fas fa-radiation"></i>
                                <span>Radiation</span>
                            </div>
                            <div class="draggable-icon" data-icon="fa-biohazard" draggable="true">
                                <i class="fas fa-biohazard"></i>
                                <span>Biohazard</span>
                            </div>
                            <div class="draggable-icon" data-icon="fa-bolt" draggable="true">
                                <i class="fas fa-bolt"></i>
                                <span>Electrical</span>
                            </div>
                        </div>
                    </div>
                    <div class="icon-options">
                        <div class="color-selector">
                            <label for="icon-color">Icon Color:</label>
                            <select id="icon-color">
                                <option value="#d32f2f">Red</option>
                                <option value="#1976d2">Blue</option>
                                <option value="#4caf50">Green</option>
                                <option value="#ff9800">Orange</option>
                                <option value="#9c27b0">Purple</option>
                                <option value="#607d8b">Gray</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="tool-section">
                    <h3>Export Map</h3>
                    <div class="export-buttons">
                        <button id="export-png" class="tool-btn">
                            <i class="fas fa-image"></i> Export PNG
                        </button>
                        <button id="export-pdf" class="tool-btn premium-btn">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                        <button id="export-data" class="tool-btn">
                            <i class="fas fa-file-export"></i> Export Data
                        </button>
                    </div>
                </div>
            </div>

            <div class="map-container">
                <div id="map"></div>
                <div class="map-controls">
                    <div class="map-control-item">
                        <button id="fullscreen-btn" class="map-btn">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                    <div class="map-control-item">
                        <button id="home-btn" class="map-btn">
                            <i class="fas fa-home"></i>
                        </button>
                    </div>
                </div>
                <div class="coords-display">
                    <span id="mouse-position">Coordinates: ---, ---</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Templates -->
    <div id="buffer-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Buffer</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="buffer-distance">Buffer Distance (miles):</label>
                    <input type="number" id="buffer-distance" min="0.1" max="50" step="0.1" value="1.0">
                </div>
                <div class="form-group">
                    <label for="buffer-layers">Apply to Layer:</label>
                    <select id="buffer-layers">
                        <option value="all">All Layers</option>
                        <option value="stations">Fire Stations</option>
                        <option value="hydrants">Hydrants</option>
                        <option value="hospitals">Hospitals</option>
                        <option value="selection">Current Selection</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button id="buffer-cancel" class="modal-btn">Cancel</button>
                <button id="buffer-apply" class="modal-btn primary-btn">Apply Buffer</button>
            </div>
        </div>
    </div>

    <div id="export-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Options</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="export-title">Map Title:</label>
                    <input type="text" id="export-title" placeholder="My Fire Department Map">
                </div>
                <div class="form-group">
                    <label for="export-format">Export Format:</label>
                    <select id="export-format">
                        <option value="png">PNG Image</option>
                        <option value="pdf">PDF Document</option>
                        <option value="geojson">GeoJSON</option>
                        <option value="kml">KML</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="export-dpi">Resolution (DPI):</label>
                    <select id="export-dpi">
                        <option value="96">Standard (96 DPI)</option>
                        <option value="150">Medium (150 DPI)</option>
                        <option value="300">High (300 DPI)</option>
                    </select>
                </div>
                <div class="form-group checkbox">
                    <input type="checkbox" id="export-legend" checked>
                    <label for="export-legend">Include Legend</label>
                </div>
                <div class="form-group checkbox">
                    <input type="checkbox" id="export-scale" checked>
                    <label for="export-scale">Include Scale Bar</label>
                </div>
                <div class="form-group checkbox">
                    <input type="checkbox" id="export-north" checked>
                    <label for="export-north">Include North Arrow</label>
                </div>
            </div>
            <div class="modal-footer">
                <button id="export-cancel" class="modal-btn">Cancel</button>
                <button id="export-confirm" class="modal-btn primary-btn">Export Map</button>
            </div>
        </div>
    </div>

    <div id="hotspot-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Hotspot Analysis</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="hotspot-layer">Analyze Layer:</label>
                    <select id="hotspot-layer">
                        <option value="incidents">Incident Points</option>
                        <option value="custom">Custom Data</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="hotspot-radius">Analysis Radius (miles):</label>
                    <input type="number" id="hotspot-radius" min="0.1" max="10" step="0.1" value="1.0">
                </div>
                <div class="form-group">
                    <label for="hotspot-intensity">Color Intensity:</label>
                    <select id="hotspot-intensity">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button id="hotspot-cancel" class="modal-btn">Cancel</button>
                <button id="hotspot-apply" class="modal-btn primary-btn">Generate Heatmap</button>
            </div>
        </div>
    </div>

    <!-- CSV Column Mapping Modal -->
    <div id="csv-mapping-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Map CSV Columns</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Please identify which columns contain location data:</p>
                <div class="form-group">
                    <label for="csv-lat-column">Latitude Column:</label>
                    <select id="csv-lat-column">
                        <!-- Will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="csv-lng-column">Longitude Column:</label>
                    <select id="csv-lng-column">
                        <!-- Will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="csv-name-column">Name/Title Column (optional):</label>
                    <select id="csv-name-column">
                        <option value="">-- None --</option>
                        <!-- Will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="csv-category-column">Category Column (optional):</label>
                    <select id="csv-category-column">
                        <option value="">-- None --</option>
                        <!-- Will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="csv-icon-style">Icon Style:</label>
                    <select id="csv-icon-style">
                        <option value="circle">Circle Markers</option>
                        <option value="marker">Default Markers</option>
                        <option value="custom">Custom Icons</option>
                    </select>
                </div>
                <div class="form-group checkbox">
                    <input type="checkbox" id="csv-first-row-header" checked>
                    <label for="csv-first-row-header">First Row Contains Headers</label>
                </div>
            </div>
            <div class="modal-footer">
                <button id="csv-cancel" class="modal-btn">Cancel</button>
                <button id="csv-import-confirm" class="modal-btn primary-btn">Import Data</button>
            </div>
        </div>
    </div>

    <!-- Print Preview Modal -->
    <div id="print-preview-modal">
        <div class="print-preview-content">
            <div class="print-preview-header">
                <h2>Print Preview</h2>
                <button class="print-preview-close">&times;</button>
            </div>
            <div class="print-preview-body">
                <div class="print-preview-canvas-container">
                    <canvas id="preview-canvas" class="print-preview-canvas"></canvas>
                    <div id="preview-overlay" class="print-preview-overlay"></div>
                </div>
            </div>
            <div class="print-preview-info">
                Previewing export at <span id="preview-dpi">96</span> DPI. 
                Estimated file size: <span id="preview-size">0 KB</span>
            </div>
            <div class="print-preview-footer">
                <button class="cancel-btn">Cancel</button>
                <button class="export-btn premium-btn">Export PDF</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 FireEMS.ai - Advanced Analytics for Fire & EMS Agencies</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='fire-map-pro.js') }}"></script>
</body>
</html>