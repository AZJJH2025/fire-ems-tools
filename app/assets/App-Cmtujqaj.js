var Ur=Object.defineProperty;var Hr=(t,r,s)=>r in t?Ur(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var Jt=(t,r,s)=>Hr(t,typeof r!="symbol"?r+"":r,s);import{r as E,g as ke,a as Me,u as Le,j as e,s as fe,c as we,b as Ae,m as Ne,d as ve,e as Nt,f as xr,h as he,i as Wr,_ as yr,k as ft,l as Je,B as y,t as Kt,n as Yr,C as Ye,o as Pe,p as qr,q as Gr,v as br,w as He,R as st,x as Ge,y as Jr,G as Kr,z as Xr,A as Zr,D as Qr}from"./index-BnvCZnOk.js";import{U as Xt,T as We,D as ut,C as es,A as ts,S as rs,a as Zt,E as vr,b as jr,c as ss,L as ns,d as $t}from"./dataTransformer-BI757shJ.js";import{T as x,u as Qt,c as oe,a as os,b as as,d as gt,S as is,e as ls,f as cs,g as ds,h as us,G as pe,F as qe,I as Ke,i as Xe,M as ie,P as me,A as ue,B as Q,D as be,j as nt,k as ot,l as at,m as tt,C as ps,n as ce,o as it,p as Fe,q as Ce,r as _e,s as pt,t as Tt,v as Ie,w as hs,x as Ht,y as Sr,z as Cr,E as wt,H as Tr,J as wr,K as Fr,L as Er,N as Ze,O as Ee,Q as Ve,R as De,U as fs,V as er,W as zt,X as Dr,Y as tr,Z as ms}from"./jspdf.es.min-Cmxmhrok.js";import{F as Rr,T as yt,a as bt,b as Be,c as Te,d as vt,S as jt,C as rt,L as gs,e as Vt,f as Ft,g as Et,h as Bt,i as xs,j as ys,D as St,P as $r,A as bs,B as vs,k as js}from"./TableChart-ChJQvS5_.js";const Ir=t=>{const r=E.useRef({});return E.useEffect(()=>{r.current=t}),r.current};function Ss(t){return ke("MuiAlertTitle",t)}Me("MuiAlertTitle",["root"]);const Cs=t=>{const{classes:r}=t;return Ae({root:["root"]},Ss,r)},Ts=fe(x,{name:"MuiAlertTitle",slot:"Root",overridesResolver:(t,r)=>r.root})(Ne(({theme:t})=>({fontWeight:t.typography.fontWeightMedium,marginTop:-2}))),ws=E.forwardRef(function(r,s){const n=Le({props:r,name:"MuiAlertTitle"}),{className:l,...i}=n,c=n,m=Cs(c);return e.jsx(Ts,{gutterBottom:!0,component:"div",ownerState:c,ref:s,className:we(m.root,l),...i})});function Fs(t){const{badgeContent:r,invisible:s=!1,max:n=99,showZero:l=!1}=t,i=Ir({badgeContent:r,max:n});let c=s;s===!1&&r===0&&!l&&(c=!0);const{badgeContent:m,max:p=n}=c?i:t,d=m&&Number(m)>p?`${p}+`:m;return{badgeContent:m,invisible:c,max:p,displayValue:d}}function Es(t){return ke("MuiBadge",t)}const ze=Me("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),It=10,kt=4,Ds=t=>{const{color:r,anchorOrigin:s,invisible:n,overlap:l,variant:i,classes:c={}}=t,m={root:["root"],badge:["badge",i,n&&"invisible",`anchorOrigin${ve(s.vertical)}${ve(s.horizontal)}`,`anchorOrigin${ve(s.vertical)}${ve(s.horizontal)}${ve(l)}`,`overlap${ve(l)}`,r!=="default"&&`color${ve(r)}`]};return Ae(m,Es,c)},Rs=fe("span",{name:"MuiBadge",slot:"Root",overridesResolver:(t,r)=>r.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),$s=fe("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.badge,r[s.variant],r[`anchorOrigin${ve(s.anchorOrigin.vertical)}${ve(s.anchorOrigin.horizontal)}${ve(s.overlap)}`],s.color!=="default"&&r[`color${ve(s.color)}`],s.invisible&&r.invisible]}})(Ne(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:It*2,lineHeight:1,padding:"0 6px",height:It*2,borderRadius:It,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen}),variants:[...Object.entries(t.palette).filter(Nt(["contrastText"])).map(([r])=>({props:{color:r},style:{backgroundColor:(t.vars||t).palette[r].main,color:(t.vars||t).palette[r].contrastText}})),{props:{variant:"dot"},style:{borderRadius:kt,height:kt*2,minWidth:kt*2,padding:0}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ze.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ze.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ze.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ze.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ze.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ze.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ze.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ze.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})}}]})));function rr(t){return{vertical:(t==null?void 0:t.vertical)??"top",horizontal:(t==null?void 0:t.horizontal)??"right"}}const Is=E.forwardRef(function(r,s){const n=Le({props:r,name:"MuiBadge"}),{anchorOrigin:l,className:i,classes:c,component:m,components:p={},componentsProps:d={},children:u,overlap:g="rectangular",color:v="default",invisible:C=!1,max:D=99,badgeContent:T,slots:z,slotProps:w,showZero:V=!1,variant:M="standard",...F}=n,{badgeContent:U,invisible:Y,max:H,displayValue:o}=Fs({max:D,invisible:C,badgeContent:T,showZero:V}),a=Ir({anchorOrigin:rr(l),color:v,overlap:g,variant:M,badgeContent:T}),h=Y||U==null&&M!=="dot",{color:R=v,overlap:N=g,anchorOrigin:W,variant:G=M}=h?a:n,se=rr(W),_=G!=="dot"?o:void 0,S={...n,badgeContent:U,invisible:h,max:H,displayValue:_,showZero:V,anchorOrigin:se,color:R,overlap:N,variant:G},q=Ds(S),f=(z==null?void 0:z.root)??p.Root??Rs,k=(z==null?void 0:z.badge)??p.Badge??$s,$=(w==null?void 0:w.root)??d.root,B=(w==null?void 0:w.badge)??d.badge,I=Qt({elementType:f,externalSlotProps:$,externalForwardedProps:F,additionalProps:{ref:s,as:m},ownerState:S,className:we($==null?void 0:$.className,q.root,i)}),j=Qt({elementType:k,externalSlotProps:B,ownerState:S,className:we(q.badge,B==null?void 0:B.className)});return e.jsxs(f,{...I,children:[u,e.jsx(k,{...j,children:_})]})});function ks(t){return ke("MuiCardActions",t)}Me("MuiCardActions",["root","spacing"]);const Ms=t=>{const{classes:r,disableSpacing:s}=t;return Ae({root:["root",!s&&"spacing"]},ks,r)},As=fe("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,!s.disableSpacing&&r.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),Os=E.forwardRef(function(r,s){const n=Le({props:r,name:"MuiCardActions"}),{disableSpacing:l=!1,className:i,...c}=n,m={...n,disableSpacing:l},p=Ms(m);return e.jsx(As,{className:we(p.root,i),ownerState:m,ref:s,...c})}),_s=oe(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),Ps=oe(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),Ls=fe("span",{shouldForwardProp:xr})({position:"relative",display:"flex"}),Ns=fe(_s)({transform:"scale(1)"}),zs=fe(Ps)(Ne(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function kr(t){const{checked:r=!1,classes:s={},fontSize:n}=t,l={...t,checked:r};return e.jsxs(Ls,{className:s.root,ownerState:l,children:[e.jsx(Ns,{fontSize:n,className:s.background,ownerState:l}),e.jsx(zs,{fontSize:n,className:s.dot,ownerState:l})]})}const Mr=E.createContext(void 0);function Vs(){return E.useContext(Mr)}function Bs(t){return ke("MuiRadio",t)}const sr=Me("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Us=t=>{const{classes:r,color:s,size:n}=t,l={root:["root",`color${ve(s)}`,n!=="medium"&&`size${ve(n)}`]};return{...r,...Ae(l,Bs,r)}},Hs=fe(is,{shouldForwardProp:t=>xr(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,s.size!=="medium"&&r[`size${ve(s.size)}`],r[`color${ve(s.color)}`]]}})(Ne(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${sr.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:he(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(Nt()).map(([r])=>({props:{color:r,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:he(t.palette[r].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(Nt()).map(([r])=>({props:{color:r,disabled:!1},style:{[`&.${sr.checked}`]:{color:(t.vars||t).palette[r].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function Ws(t,r){return typeof r=="object"&&r!==null?t===r:String(t)===String(r)}const Ys=e.jsx(kr,{checked:!0}),qs=e.jsx(kr,{}),mt=E.forwardRef(function(r,s){const n=Le({props:r,name:"MuiRadio"}),{checked:l,checkedIcon:i=Ys,color:c="primary",icon:m=qs,name:p,onChange:d,size:u="medium",className:g,disabled:v,disableRipple:C=!1,slots:D={},slotProps:T={},inputProps:z,...w}=n,V=os();let M=v;V&&typeof M>"u"&&(M=V.disabled),M??(M=!1);const F={...n,disabled:M,disableRipple:C,color:c,size:u},U=Us(F),Y=Vs();let H=l;const o=as(d,Y&&Y.onChange);let a=p;Y&&(typeof H>"u"&&(H=Ws(Y.value,n.value)),typeof a>"u"&&(a=Y.name));const h=T.input??z,[R,N]=gt("root",{ref:s,elementType:Hs,className:we(U.root,g),shouldForwardComponentProp:!0,externalForwardedProps:{slots:D,slotProps:T,...w},getSlotProps:W=>({...W,onChange:(G,...se)=>{var _;(_=W.onChange)==null||_.call(W,G,...se),o(G,...se)}}),ownerState:F,additionalProps:{type:"radio",icon:E.cloneElement(m,{fontSize:m.props.fontSize??u}),checkedIcon:E.cloneElement(i,{fontSize:i.props.fontSize??u}),disabled:M,name:a,checked:H,slots:D,slotProps:{input:typeof h=="function"?h(F):h}}});return e.jsx(R,{...N,classes:U})});function Gs(t){return ke("MuiRadioGroup",t)}Me("MuiRadioGroup",["root","row","error"]);const Js=t=>{const{classes:r,row:s,error:n}=t;return Ae({root:["root",s&&"row",n&&"error"]},Gs,r)},Ks=E.forwardRef(function(r,s){const{actions:n,children:l,className:i,defaultValue:c,name:m,onChange:p,value:d,...u}=r,g=E.useRef(null),v=Js(r),[C,D]=ls({controlled:d,default:c,name:"RadioGroup"});E.useImperativeHandle(n,()=>({focus:()=>{let V=g.current.querySelector("input:not(:disabled):checked");V||(V=g.current.querySelector("input:not(:disabled)")),V&&V.focus()}}),[]);const T=cs(s,g),z=ds(m),w=E.useMemo(()=>({name:z,onChange(V){D(V.target.value),p&&p(V,V.target.value)},value:C}),[z,p,D,C]);return e.jsx(Mr.Provider,{value:w,children:e.jsx(Rr,{role:"radiogroup",ref:T,className:we(v.root,i),...u,children:l})})}),Dt=E.createContext({}),Wt=E.createContext({});function Xs(t){return ke("MuiStep",t)}Me("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const Zs=t=>{const{classes:r,orientation:s,alternativeLabel:n,completed:l}=t;return Ae({root:["root",s,n&&"alternativeLabel",l&&"completed"]},Xs,r)},Qs=fe("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.completed&&r.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),en=E.forwardRef(function(r,s){const n=Le({props:r,name:"MuiStep"}),{active:l,children:i,className:c,component:m="div",completed:p,disabled:d,expanded:u=!1,index:g,last:v,...C}=n,{activeStep:D,connector:T,alternativeLabel:z,orientation:w,nonLinear:V}=E.useContext(Dt);let[M=!1,F=!1,U=!1]=[l,p,d];D===g?M=l!==void 0?l:!0:!V&&D>g?F=p!==void 0?p:!0:!V&&D<g&&(U=d!==void 0?d:!0);const Y=E.useMemo(()=>({index:g,last:v,expanded:u,icon:g+1,active:M,completed:F,disabled:U}),[g,v,u,M,F,U]),H={...n,active:M,orientation:w,alternativeLabel:z,completed:F,disabled:U,expanded:u,component:m},o=Zs(H),a=e.jsxs(Qs,{as:m,className:we(o.root,c),ref:s,ownerState:H,...C,children:[T&&z&&g!==0?T:null,i]});return e.jsx(Wt.Provider,{value:Y,children:T&&!z&&g!==0?e.jsxs(E.Fragment,{children:[T,a]}):a})}),tn=oe(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"})),rn=oe(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}));function sn(t){return ke("MuiStepIcon",t)}const Mt=Me("MuiStepIcon",["root","active","completed","error","text"]);var nr;const nn=t=>{const{classes:r,active:s,completed:n,error:l}=t;return Ae({root:["root",s&&"active",n&&"completed",l&&"error"],text:["text"]},sn,r)},At=fe(us,{name:"MuiStepIcon",slot:"Root",overridesResolver:(t,r)=>r.root})(Ne(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${Mt.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${Mt.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${Mt.error}`]:{color:(t.vars||t).palette.error.main}}))),on=fe("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(t,r)=>r.text})(Ne(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),an=E.forwardRef(function(r,s){const n=Le({props:r,name:"MuiStepIcon"}),{active:l=!1,className:i,completed:c=!1,error:m=!1,icon:p,...d}=n,u={...n,active:l,completed:c,error:m},g=nn(u);if(typeof p=="number"||typeof p=="string"){const v=we(i,g.root);return m?e.jsx(At,{as:rn,className:v,ref:s,ownerState:u,...d}):c?e.jsx(At,{as:tn,className:v,ref:s,ownerState:u,...d}):e.jsxs(At,{className:v,ref:s,ownerState:u,...d,children:[nr||(nr=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(on,{className:g.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:u,children:p})]})}return p});function ln(t){return ke("MuiStepLabel",t)}const Ue=Me("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),cn=t=>{const{classes:r,orientation:s,active:n,completed:l,error:i,disabled:c,alternativeLabel:m}=t;return Ae({root:["root",s,i&&"error",c&&"disabled",m&&"alternativeLabel"],label:["label",n&&"active",l&&"completed",i&&"error",c&&"disabled",m&&"alternativeLabel"],iconContainer:["iconContainer",n&&"active",l&&"completed",i&&"error",c&&"disabled",m&&"alternativeLabel"],labelContainer:["labelContainer",m&&"alternativeLabel"]},ln,r)},dn=fe("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation]]}})({display:"flex",alignItems:"center",[`&.${Ue.alternativeLabel}`]:{flexDirection:"column"},[`&.${Ue.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),un=fe("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(t,r)=>r.label})(Ne(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${Ue.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Ue.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Ue.alternativeLabel}`]:{marginTop:16},[`&.${Ue.error}`]:{color:(t.vars||t).palette.error.main}}))),pn=fe("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(t,r)=>r.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${Ue.alternativeLabel}`]:{paddingRight:0}}),hn=fe("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(t,r)=>r.labelContainer})(Ne(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${Ue.alternativeLabel}`]:{textAlign:"center"}}))),Ar=E.forwardRef(function(r,s){const n=Le({props:r,name:"MuiStepLabel"}),{children:l,className:i,componentsProps:c={},error:m=!1,icon:p,optional:d,slots:u={},slotProps:g={},StepIconComponent:v,StepIconProps:C,...D}=n,{alternativeLabel:T,orientation:z}=E.useContext(Dt),{active:w,disabled:V,completed:M,icon:F}=E.useContext(Wt),U=p||F;let Y=v;U&&!Y&&(Y=an);const H={...n,active:w,alternativeLabel:T,completed:M,disabled:V,error:m,orientation:z},o=cn(H),a={slots:u,slotProps:{stepIcon:C,...c,...g}},[h,R]=gt("root",{elementType:dn,externalForwardedProps:{...a,...D},ownerState:H,ref:s,className:we(o.root,i)}),[N,W]=gt("label",{elementType:un,externalForwardedProps:a,ownerState:H}),[G,se]=gt("stepIcon",{elementType:Y,externalForwardedProps:a,ownerState:H});return e.jsxs(h,{...R,children:[U||G?e.jsx(pn,{className:o.iconContainer,ownerState:H,children:e.jsx(G,{completed:M,active:w,error:m,icon:U,...se})}):null,e.jsxs(hn,{className:o.labelContainer,ownerState:H,children:[l?e.jsx(N,{...W,className:we(o.label,W==null?void 0:W.className),children:l}):null,d]})]})});Ar.muiName="StepLabel";function fn(t){return ke("MuiStepConnector",t)}Me("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const mn=t=>{const{classes:r,orientation:s,alternativeLabel:n,active:l,completed:i,disabled:c}=t,m={root:["root",s,n&&"alternativeLabel",l&&"active",i&&"completed",c&&"disabled"],line:["line",`line${ve(s)}`]};return Ae(m,fn,r)},gn=fe("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.completed&&r.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),xn=fe("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.line,r[`line${ve(s.orientation)}`]]}})(Ne(({theme:t})=>{const r=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:r,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),yn=E.forwardRef(function(r,s){const n=Le({props:r,name:"MuiStepConnector"}),{className:l,...i}=n,{alternativeLabel:c,orientation:m="horizontal"}=E.useContext(Dt),{active:p,disabled:d,completed:u}=E.useContext(Wt),g={...n,alternativeLabel:c,orientation:m,active:p,completed:u,disabled:d},v=mn(g);return e.jsx(gn,{className:we(v.root,l),ref:s,ownerState:g,...i,children:e.jsx(xn,{className:v.line,ownerState:g})})});function bn(t){return ke("MuiStepper",t)}Me("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const vn=t=>{const{orientation:r,nonLinear:s,alternativeLabel:n,classes:l}=t;return Ae({root:["root",r,s&&"nonLinear",n&&"alternativeLabel"]},bn,l)},jn=fe("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.nonLinear&&r.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),Sn=e.jsx(yn,{}),Cn=E.forwardRef(function(r,s){const n=Le({props:r,name:"MuiStepper"}),{activeStep:l=0,alternativeLabel:i=!1,children:c,className:m,component:p="div",connector:d=Sn,nonLinear:u=!1,orientation:g="horizontal",...v}=n,C={...n,nonLinear:u,alternativeLabel:i,orientation:g,component:p},D=vn(C),T=E.Children.toArray(c).filter(Boolean),z=T.map((V,M)=>E.cloneElement(V,{index:M,last:M+1===T.length,...V.props})),w=E.useMemo(()=>({activeStep:l,alternativeLabel:i,connector:d,nonLinear:u,orientation:g}),[l,i,d,u,g]);return e.jsx(Dt.Provider,{value:w,children:e.jsx(jn,{as:p,ownerState:C,className:we(D.root,m),ref:s,...v,children:z})})}),Yt=oe(e.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}));var xt={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/var Tn=xt.exports,or;function wn(){return or||(or=1,function(t,r){((s,n)=>{t.exports=n()})(Tn,function s(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},l,i=!n.document&&!!n.postMessage,c=n.IS_PAPA_WORKER||!1,m={},p=0,d={};function u(o){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(a){var h=U(a);h.chunkSize=parseInt(h.chunkSize),a.step||a.chunk||(h.chunkSize=null),this._handle=new T(h),(this._handle.streamer=this)._config=h}).call(this,o),this.parseChunk=function(a,h){var R=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<R){let W=this._config.newline;W||(N=this._config.quoteChar||'"',W=this._handle.guessLineEndings(a,N)),a=[...a.split(W).slice(R)].join(W)}this.isFirstChunk&&H(this._config.beforeFirstChunk)&&(N=this._config.beforeFirstChunk(a))!==void 0&&(a=N),this.isFirstChunk=!1,this._halted=!1;var R=this._partialLine+a,N=(this._partialLine="",this._handle.parse(R,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(a=N.meta.cursor,R=(this._finished||(this._partialLine=R.substring(a-this._baseIndex),this._baseIndex=a),N&&N.data&&(this._rowCount+=N.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),c)n.postMessage({results:N,workerId:d.WORKER_ID,finished:R});else if(H(this._config.chunk)&&!h){if(this._config.chunk(N,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=N=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(N.data),this._completeResults.errors=this._completeResults.errors.concat(N.errors),this._completeResults.meta=N.meta),this._completed||!R||!H(this._config.complete)||N&&N.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),R||N&&N.meta.paused||this._nextChunk(),N}this._halted=!0},this._sendError=function(a){H(this._config.error)?this._config.error(a):c&&this._config.error&&n.postMessage({workerId:d.WORKER_ID,error:a,finished:!1})}}function g(o){var a;(o=o||{}).chunkSize||(o.chunkSize=d.RemoteChunkSize),u.call(this,o),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(h){this._input=h,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(a=new XMLHttpRequest,this._config.withCredentials&&(a.withCredentials=this._config.withCredentials),i||(a.onload=Y(this._chunkLoaded,this),a.onerror=Y(this._chunkError,this)),a.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var h,R=this._config.downloadRequestHeaders;for(h in R)a.setRequestHeader(h,R[h])}var N;this._config.chunkSize&&(N=this._start+this._config.chunkSize-1,a.setRequestHeader("Range","bytes="+this._start+"-"+N));try{a.send(this._config.downloadRequestBody)}catch(W){this._chunkError(W.message)}i&&a.status===0&&this._chunkError()}},this._chunkLoaded=function(){a.readyState===4&&(a.status<200||400<=a.status?this._chunkError():(this._start+=this._config.chunkSize||a.responseText.length,this._finished=!this._config.chunkSize||this._start>=(h=>(h=h.getResponseHeader("Content-Range"))!==null?parseInt(h.substring(h.lastIndexOf("/")+1)):-1)(a),this.parseChunk(a.responseText)))},this._chunkError=function(h){h=a.statusText||h,this._sendError(new Error(h))}}function v(o){(o=o||{}).chunkSize||(o.chunkSize=d.LocalChunkSize),u.call(this,o);var a,h,R=typeof FileReader<"u";this.stream=function(N){this._input=N,h=N.slice||N.webkitSlice||N.mozSlice,R?((a=new FileReader).onload=Y(this._chunkLoaded,this),a.onerror=Y(this._chunkError,this)):a=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var N=this._input,W=(this._config.chunkSize&&(W=Math.min(this._start+this._config.chunkSize,this._input.size),N=h.call(N,this._start,W)),a.readAsText(N,this._config.encoding));R||this._chunkLoaded({target:{result:W}})},this._chunkLoaded=function(N){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(N.target.result)},this._chunkError=function(){this._sendError(a.error)}}function C(o){var a;u.call(this,o=o||{}),this.stream=function(h){return a=h,this._nextChunk()},this._nextChunk=function(){var h,R;if(!this._finished)return h=this._config.chunkSize,a=h?(R=a.substring(0,h),a.substring(h)):(R=a,""),this._finished=!a,this.parseChunk(R)}}function D(o){u.call(this,o=o||{});var a=[],h=!0,R=!1;this.pause=function(){u.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){u.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(N){this._input=N,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){R&&a.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),a.length?this.parseChunk(a.shift()):h=!0},this._streamData=Y(function(N){try{a.push(typeof N=="string"?N:N.toString(this._config.encoding)),h&&(h=!1,this._checkIsFinished(),this.parseChunk(a.shift()))}catch(W){this._streamError(W)}},this),this._streamError=Y(function(N){this._streamCleanUp(),this._sendError(N)},this),this._streamEnd=Y(function(){this._streamCleanUp(),R=!0,this._streamData("")},this),this._streamCleanUp=Y(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function T(o){var a,h,R,N,W=Math.pow(2,53),G=-W,se=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,_=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,S=this,q=0,f=0,k=!1,$=!1,B=[],I={data:[],errors:[],meta:{}};function j(O){return o.skipEmptyLines==="greedy"?O.join("").trim()==="":O.length===1&&O[0].length===0}function A(){if(I&&R&&(J("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+d.DefaultDelimiter+"'"),R=!1),o.skipEmptyLines&&(I.data=I.data.filter(function(P){return!j(P)})),K()){let P=function(X,ee){H(o.transformHeader)&&(X=o.transformHeader(X,ee)),B.push(X)};if(I)if(Array.isArray(I.data[0])){for(var O=0;K()&&O<I.data.length;O++)I.data[O].forEach(P);I.data.splice(0,1)}else I.data.forEach(P)}function L(P,X){for(var ee=o.header?{}:[],ne=0;ne<P.length;ne++){var te=ne,re=P[ne],re=((ge,Z)=>(le=>(o.dynamicTypingFunction&&o.dynamicTyping[le]===void 0&&(o.dynamicTyping[le]=o.dynamicTypingFunction(le)),(o.dynamicTyping[le]||o.dynamicTyping)===!0))(ge)?Z==="true"||Z==="TRUE"||Z!=="false"&&Z!=="FALSE"&&((le=>{if(se.test(le)&&(le=parseFloat(le),G<le&&le<W))return 1})(Z)?parseFloat(Z):_.test(Z)?new Date(Z):Z===""?null:Z):Z)(te=o.header?ne>=B.length?"__parsed_extra":B[ne]:te,re=o.transform?o.transform(re,te):re);te==="__parsed_extra"?(ee[te]=ee[te]||[],ee[te].push(re)):ee[te]=re}return o.header&&(ne>B.length?J("FieldMismatch","TooManyFields","Too many fields: expected "+B.length+" fields but parsed "+ne,f+X):ne<B.length&&J("FieldMismatch","TooFewFields","Too few fields: expected "+B.length+" fields but parsed "+ne,f+X)),ee}var b;I&&(o.header||o.dynamicTyping||o.transform)&&(b=1,!I.data.length||Array.isArray(I.data[0])?(I.data=I.data.map(L),b=I.data.length):I.data=L(I.data,0),o.header&&I.meta&&(I.meta.fields=B),f+=b)}function K(){return o.header&&B.length===0}function J(O,L,b,P){O={type:O,code:L,message:b},P!==void 0&&(O.row=P),I.errors.push(O)}H(o.step)&&(N=o.step,o.step=function(O){I=O,K()?A():(A(),I.data.length!==0&&(q+=O.data.length,o.preview&&q>o.preview?h.abort():(I.data=I.data[0],N(I,S))))}),this.parse=function(O,L,b){var P=o.quoteChar||'"',P=(o.newline||(o.newline=this.guessLineEndings(O,P)),R=!1,o.delimiter?H(o.delimiter)&&(o.delimiter=o.delimiter(O),I.meta.delimiter=o.delimiter):((P=((X,ee,ne,te,re)=>{var ge,Z,le,ae;re=re||[",","	","|",";",d.RECORD_SEP,d.UNIT_SEP];for(var de=0;de<re.length;de++){for(var xe,lt=re[de],je=0,Re=0,ye=0,Se=(le=void 0,new w({comments:te,delimiter:lt,newline:ee,preview:10}).parse(X)),Oe=0;Oe<Se.data.length;Oe++)ne&&j(Se.data[Oe])?ye++:(xe=Se.data[Oe].length,Re+=xe,le===void 0?le=xe:0<xe&&(je+=Math.abs(xe-le),le=xe));0<Se.data.length&&(Re/=Se.data.length-ye),(Z===void 0||je<=Z)&&(ae===void 0||ae<Re)&&1.99<Re&&(Z=je,ge=lt,ae=Re)}return{successful:!!(o.delimiter=ge),bestDelimiter:ge}})(O,o.newline,o.skipEmptyLines,o.comments,o.delimitersToGuess)).successful?o.delimiter=P.bestDelimiter:(R=!0,o.delimiter=d.DefaultDelimiter),I.meta.delimiter=o.delimiter),U(o));return o.preview&&o.header&&P.preview++,a=O,h=new w(P),I=h.parse(a,L,b),A(),k?{meta:{paused:!0}}:I||{meta:{paused:!1}}},this.paused=function(){return k},this.pause=function(){k=!0,h.abort(),a=H(o.chunk)?"":a.substring(h.getCharIndex())},this.resume=function(){S.streamer._halted?(k=!1,S.streamer.parseChunk(a,!0)):setTimeout(S.resume,3)},this.aborted=function(){return $},this.abort=function(){$=!0,h.abort(),I.meta.aborted=!0,H(o.complete)&&o.complete(I),a=""},this.guessLineEndings=function(X,P){X=X.substring(0,1048576);var P=new RegExp(z(P)+"([^]*?)"+z(P),"gm"),b=(X=X.replace(P,"")).split("\r"),P=X.split(`
`),X=1<P.length&&P[0].length<b[0].length;if(b.length===1||X)return`
`;for(var ee=0,ne=0;ne<b.length;ne++)b[ne][0]===`
`&&ee++;return ee>=b.length/2?`\r
`:"\r"}}function z(o){return o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function w(o){var a=(o=o||{}).delimiter,h=o.newline,R=o.comments,N=o.step,W=o.preview,G=o.fastMode,se=null,_=!1,S=o.quoteChar==null?'"':o.quoteChar,q=S;if(o.escapeChar!==void 0&&(q=o.escapeChar),(typeof a!="string"||-1<d.BAD_DELIMITERS.indexOf(a))&&(a=","),R===a)throw new Error("Comment character same as delimiter");R===!0?R="#":(typeof R!="string"||-1<d.BAD_DELIMITERS.indexOf(R))&&(R=!1),h!==`
`&&h!=="\r"&&h!==`\r
`&&(h=`
`);var f=0,k=!1;this.parse=function($,B,I){if(typeof $!="string")throw new Error("Input must be a string");var j=$.length,A=a.length,K=h.length,J=R.length,O=H(N),L=[],b=[],P=[],X=f=0;if(!$)return je();if(G||G!==!1&&$.indexOf(S)===-1){for(var ee=$.split(h),ne=0;ne<ee.length;ne++){if(P=ee[ne],f+=P.length,ne!==ee.length-1)f+=h.length;else if(I)return je();if(!R||P.substring(0,J)!==R){if(O){if(L=[],ae(P.split(a)),Re(),k)return je()}else ae(P.split(a));if(W&&W<=ne)return L=L.slice(0,W),je(!0)}}return je()}for(var te=$.indexOf(a,f),re=$.indexOf(h,f),ge=new RegExp(z(q)+z(S),"g"),Z=$.indexOf(S,f);;)if($[f]===S)for(Z=f,f++;;){if((Z=$.indexOf(S,Z+1))===-1)return I||b.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:L.length,index:f}),xe();if(Z===j-1)return xe($.substring(f,Z).replace(ge,S));if(S===q&&$[Z+1]===q)Z++;else if(S===q||Z===0||$[Z-1]!==q){te!==-1&&te<Z+1&&(te=$.indexOf(a,Z+1));var le=de((re=re!==-1&&re<Z+1?$.indexOf(h,Z+1):re)===-1?te:Math.min(te,re));if($.substr(Z+1+le,A)===a){P.push($.substring(f,Z).replace(ge,S)),$[f=Z+1+le+A]!==S&&(Z=$.indexOf(S,f)),te=$.indexOf(a,f),re=$.indexOf(h,f);break}if(le=de(re),$.substring(Z+1+le,Z+1+le+K)===h){if(P.push($.substring(f,Z).replace(ge,S)),lt(Z+1+le+K),te=$.indexOf(a,f),Z=$.indexOf(S,f),O&&(Re(),k))return je();if(W&&L.length>=W)return je(!0);break}b.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:L.length,index:f}),Z++}}else if(R&&P.length===0&&$.substring(f,f+J)===R){if(re===-1)return je();f=re+K,re=$.indexOf(h,f),te=$.indexOf(a,f)}else if(te!==-1&&(te<re||re===-1))P.push($.substring(f,te)),f=te+A,te=$.indexOf(a,f);else{if(re===-1)break;if(P.push($.substring(f,re)),lt(re+K),O&&(Re(),k))return je();if(W&&L.length>=W)return je(!0)}return xe();function ae(ye){L.push(ye),X=f}function de(ye){var Se=0;return Se=ye!==-1&&(ye=$.substring(Z+1,ye))&&ye.trim()===""?ye.length:Se}function xe(ye){return I||(ye===void 0&&(ye=$.substring(f)),P.push(ye),f=j,ae(P),O&&Re()),je()}function lt(ye){f=ye,ae(P),P=[],re=$.indexOf(h,f)}function je(ye){if(o.header&&!B&&L.length&&!_){var Se=L[0],Oe={},Rt=new Set(Se);let qt=!1;for(let Qe=0;Qe<Se.length;Qe++){let $e=Se[Qe];if(Oe[$e=H(o.transformHeader)?o.transformHeader($e,Qe):$e]){let ct,Gt=Oe[$e];for(;ct=$e+"_"+Gt,Gt++,Rt.has(ct););Rt.add(ct),Se[Qe]=ct,Oe[$e]++,qt=!0,(se=se===null?{}:se)[ct]=$e}else Oe[$e]=1,Se[Qe]=$e;Rt.add($e)}qt&&console.warn("Duplicate headers found and renamed."),_=!0}return{data:L,errors:b,meta:{delimiter:a,linebreak:h,aborted:k,truncated:!!ye,cursor:X+(B||0),renamedHeaders:se}}}function Re(){N(je()),L=[],b=[]}},this.abort=function(){k=!0},this.getCharIndex=function(){return f}}function V(o){var a=o.data,h=m[a.workerId],R=!1;if(a.error)h.userError(a.error,a.file);else if(a.results&&a.results.data){var N={abort:function(){R=!0,M(a.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:F,resume:F};if(H(h.userStep)){for(var W=0;W<a.results.data.length&&(h.userStep({data:a.results.data[W],errors:a.results.errors,meta:a.results.meta},N),!R);W++);delete a.results}else H(h.userChunk)&&(h.userChunk(a.results,N,a.file),delete a.results)}a.finished&&!R&&M(a.workerId,a.results)}function M(o,a){var h=m[o];H(h.userComplete)&&h.userComplete(a),h.terminate(),delete m[o]}function F(){throw new Error("Not implemented.")}function U(o){if(typeof o!="object"||o===null)return o;var a,h=Array.isArray(o)?[]:{};for(a in o)h[a]=U(o[a]);return h}function Y(o,a){return function(){o.apply(a,arguments)}}function H(o){return typeof o=="function"}return d.parse=function(o,a){var h=(a=a||{}).dynamicTyping||!1;if(H(h)&&(a.dynamicTypingFunction=h,h={}),a.dynamicTyping=h,a.transform=!!H(a.transform)&&a.transform,!a.worker||!d.WORKERS_SUPPORTED)return h=null,d.NODE_STREAM_INPUT,typeof o=="string"?(o=(R=>R.charCodeAt(0)!==65279?R:R.slice(1))(o),h=new(a.download?g:C)(a)):o.readable===!0&&H(o.read)&&H(o.on)?h=new D(a):(n.File&&o instanceof File||o instanceof Object)&&(h=new v(a)),h.stream(o);(h=(()=>{var R;return!!d.WORKERS_SUPPORTED&&(R=(()=>{var N=n.URL||n.webkitURL||null,W=s.toString();return d.BLOB_URL||(d.BLOB_URL=N.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",W,")();"],{type:"text/javascript"})))})(),(R=new n.Worker(R)).onmessage=V,R.id=p++,m[R.id]=R)})()).userStep=a.step,h.userChunk=a.chunk,h.userComplete=a.complete,h.userError=a.error,a.step=H(a.step),a.chunk=H(a.chunk),a.complete=H(a.complete),a.error=H(a.error),delete a.worker,h.postMessage({input:o,config:a,workerId:h.id})},d.unparse=function(o,a){var h=!1,R=!0,N=",",W=`\r
`,G='"',se=G+G,_=!1,S=null,q=!1,f=((()=>{if(typeof a=="object"){if(typeof a.delimiter!="string"||d.BAD_DELIMITERS.filter(function(B){return a.delimiter.indexOf(B)!==-1}).length||(N=a.delimiter),typeof a.quotes!="boolean"&&typeof a.quotes!="function"&&!Array.isArray(a.quotes)||(h=a.quotes),typeof a.skipEmptyLines!="boolean"&&typeof a.skipEmptyLines!="string"||(_=a.skipEmptyLines),typeof a.newline=="string"&&(W=a.newline),typeof a.quoteChar=="string"&&(G=a.quoteChar),typeof a.header=="boolean"&&(R=a.header),Array.isArray(a.columns)){if(a.columns.length===0)throw new Error("Option columns is empty");S=a.columns}a.escapeChar!==void 0&&(se=a.escapeChar+G),a.escapeFormulae instanceof RegExp?q=a.escapeFormulae:typeof a.escapeFormulae=="boolean"&&a.escapeFormulae&&(q=/^[=+\-@\t\r].*$/)}})(),new RegExp(z(G),"g"));if(typeof o=="string"&&(o=JSON.parse(o)),Array.isArray(o)){if(!o.length||Array.isArray(o[0]))return k(null,o,_);if(typeof o[0]=="object")return k(S||Object.keys(o[0]),o,_)}else if(typeof o=="object")return typeof o.data=="string"&&(o.data=JSON.parse(o.data)),Array.isArray(o.data)&&(o.fields||(o.fields=o.meta&&o.meta.fields||S),o.fields||(o.fields=Array.isArray(o.data[0])?o.fields:typeof o.data[0]=="object"?Object.keys(o.data[0]):[]),Array.isArray(o.data[0])||typeof o.data[0]=="object"||(o.data=[o.data])),k(o.fields||[],o.data||[],_);throw new Error("Unable to serialize unrecognized input");function k(B,I,j){var A="",K=(typeof B=="string"&&(B=JSON.parse(B)),typeof I=="string"&&(I=JSON.parse(I)),Array.isArray(B)&&0<B.length),J=!Array.isArray(I[0]);if(K&&R){for(var O=0;O<B.length;O++)0<O&&(A+=N),A+=$(B[O],O);0<I.length&&(A+=W)}for(var L=0;L<I.length;L++){var b=(K?B:I[L]).length,P=!1,X=K?Object.keys(I[L]).length===0:I[L].length===0;if(j&&!K&&(P=j==="greedy"?I[L].join("").trim()==="":I[L].length===1&&I[L][0].length===0),j==="greedy"&&K){for(var ee=[],ne=0;ne<b;ne++){var te=J?B[ne]:ne;ee.push(I[L][te])}P=ee.join("").trim()===""}if(!P){for(var re=0;re<b;re++){0<re&&!X&&(A+=N);var ge=K&&J?B[re]:re;A+=$(I[L][ge],re)}L<I.length-1&&(!j||0<b&&!X)&&(A+=W)}}return A}function $(B,I){var j,A;return B==null?"":B.constructor===Date?JSON.stringify(B).slice(1,25):(A=!1,q&&typeof B=="string"&&q.test(B)&&(B="'"+B,A=!0),j=B.toString().replace(f,se),(A=A||h===!0||typeof h=="function"&&h(B,I)||Array.isArray(h)&&h[I]||((K,J)=>{for(var O=0;O<J.length;O++)if(-1<K.indexOf(J[O]))return!0;return!1})(j,d.BAD_DELIMITERS)||-1<j.indexOf(N)||j.charAt(0)===" "||j.charAt(j.length-1)===" ")?G+j+G:j)}},d.RECORD_SEP="",d.UNIT_SEP="",d.BYTE_ORDER_MARK="\uFEFF",d.BAD_DELIMITERS=["\r",`
`,'"',d.BYTE_ORDER_MARK],d.WORKERS_SUPPORTED=!i&&!!n.Worker,d.NODE_STREAM_INPUT=1,d.LocalChunkSize=10485760,d.RemoteChunkSize=5242880,d.DefaultDelimiter=",",d.Parser=w,d.ParserHandle=T,d.NetworkStreamer=g,d.FileStreamer=v,d.StringStreamer=C,d.ReadableStreamStreamer=D,n.jQuery&&((l=n.jQuery).fn.parse=function(o){var a=o.config||{},h=[];return this.each(function(W){if(!(l(this).prop("tagName").toUpperCase()==="INPUT"&&l(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var G=0;G<this.files.length;G++)h.push({file:this.files[G],inputElem:this,instanceConfig:l.extend({},a)})}),R(),this;function R(){if(h.length===0)H(o.complete)&&o.complete();else{var W,G,se,_,S=h[0];if(H(o.before)){var q=o.before(S.file,S.inputElem);if(typeof q=="object"){if(q.action==="abort")return W="AbortError",G=S.file,se=S.inputElem,_=q.reason,void(H(o.error)&&o.error({name:W},G,se,_));if(q.action==="skip")return void N();typeof q.config=="object"&&(S.instanceConfig=l.extend(S.instanceConfig,q.config))}else if(q==="skip")return void N()}var f=S.instanceConfig.complete;S.instanceConfig.complete=function(k){H(f)&&f(k,S.file,S.inputElem),N()},d.parse(S.file,S.instanceConfig)}}function N(){h.splice(0,1),R()}}),c&&(n.onmessage=function(o){o=o.data,d.WORKER_ID===void 0&&o&&(d.WORKER_ID=o.workerId),typeof o.input=="string"?n.postMessage({workerId:d.WORKER_ID,results:d.parse(o.input,o.config),finished:!0}):(n.File&&o.input instanceof File||o.input instanceof Object)&&(o=d.parse(o.input,o.config))&&n.postMessage({workerId:d.WORKER_ID,results:o,finished:!0})}),(g.prototype=Object.create(u.prototype)).constructor=g,(v.prototype=Object.create(u.prototype)).constructor=v,(C.prototype=Object.create(C.prototype)).constructor=C,(D.prototype=Object.create(u.prototype)).constructor=D,d})}(xt)),xt.exports}var Fn=wn();const En=Wr(Fn),Dn=async(t,r)=>{switch(r){case"csv":return Rn(t);case"excel":return $n(t);case"json":return In(t);case"xml":return kn(t);case"pdf":return Mn(t);case"txt":return An(t);default:throw new Error(`Unsupported file type: ${r}`)}},Rn=t=>new Promise((r,s)=>{En.parse(t,{header:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:n=>{const l=n.meta.fields||[],i=n.data;r({columns:l,data:i.slice(0,100)})},error:n=>{s(new Error(`Error parsing CSV: ${n.message}`))}})}),$n=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=async l=>{var i;try{const c=(i=l.target)==null?void 0:i.result;if(!c){s(new Error("Failed to read Excel file"));return}const m=await yr(()=>import("./xlsx-DkH2s96g.js"),[]),p=m.read(c,{type:"array"}),d=p.SheetNames[0],u=p.Sheets[d],g=m.utils.sheet_to_json(u,{header:1});if(g.length===0){s(new Error("Excel file is empty"));return}const v=g[0].map(String),C=g.slice(1).map(D=>{const T={};return D.forEach((z,w)=>{w<v.length&&(T[v[w]]=z)}),T});r({columns:v,data:C.slice(0,100)})}catch(c){s(new Error(`Error parsing Excel file: ${c instanceof Error?c.message:"Unknown error"}`))}},n.onerror=()=>{s(new Error("Error reading Excel file"))},n.readAsArrayBuffer(t)}),In=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=l=>{var i;try{const c=(i=l.target)==null?void 0:i.result,m=JSON.parse(c);if(Array.isArray(m)){if(m.length===0){s(new Error("JSON file contains an empty array"));return}const p=Array.from(new Set(m.flatMap(d=>Object.keys(d))));r({columns:p,data:m.slice(0,100)})}else if(m&&typeof m=="object"){const p=Object.keys(m).find(d=>Array.isArray(m[d]));if(p&&m[p].length>0){const d=m[p],u=Array.from(new Set(d.flatMap(g=>Object.keys(g))));r({columns:u,data:d.slice(0,100)})}else{const d=Object.keys(m);r({columns:d,data:[m]})}}else s(new Error("JSON file format not recognized"))}catch(c){s(new Error(`Error parsing JSON file: ${c instanceof Error?c.message:"Invalid JSON"}`))}},n.onerror=()=>{s(new Error("Error reading JSON file"))},n.readAsText(t)}),kn=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=l=>{var i,c;try{const m=(i=l.target)==null?void 0:i.result,d=new DOMParser().parseFromString(m,"text/xml"),u=d.getElementsByTagName("*"),g=new Map;for(let M=0;M<u.length;M++){const F=u[M].tagName;g.set(F,(g.get(F)||0)+1)}const v=Array.from(g.entries()).filter(([M,F])=>F>1).map(([M])=>M).sort((M,F)=>(g.get(F)||0)-(g.get(M)||0));if(v.length===0){s(new Error("Could not identify repeating elements in XML"));return}const C=v[0],D=d.getElementsByTagName(C);if(D.length===0){s(new Error(`No elements found with tag ${C}`));return}const T=D[0],w=Array.from(T.children).map(M=>M.tagName),V=[];for(let M=0;M<Math.min(D.length,100);M++){const F=D[M],U={};for(const Y of w){const H=((c=F.getElementsByTagName(Y)[0])==null?void 0:c.textContent)||"";U[Y]=H}V.push(U)}r({columns:w,data:V})}catch(m){s(new Error(`Error parsing XML file: ${m instanceof Error?m.message:"Invalid XML"}`))}},n.onerror=()=>{s(new Error("Error reading XML file"))},n.readAsText(t)}),Mn=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=async l=>{var i;try{if(!((i=l.target)==null?void 0:i.result)){s(new Error("Failed to read PDF file"));return}r({columns:["Information"],data:[{Information:"PDF files are not currently supported for direct parsing in the browser."},{Information:"Please convert your PDF to CSV, Excel, or JSON format for processing."},{Information:"Alternatively, copy and paste the data from your PDF into a text file."},{Information:`File name: ${t.name}`},{Information:`File size: ${(t.size/1024).toFixed(2)} KB`},{Information:"Supported formats: CSV, Excel (.xlsx, .xls), JSON, XML, TXT"}]})}catch(c){s(new Error(`Error processing PDF: ${c instanceof Error?c.message:"Unknown error"}`))}},n.onerror=()=>{s(new Error("Error reading PDF file"))},n.readAsArrayBuffer(t)}),An=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=l=>{var i;try{const c=(i=l.target)==null?void 0:i.result;if(!c){s(new Error("Failed to read text file"));return}const m=c.split(`
`).map(g=>g.trim()).filter(g=>g.length>0);if(m.length===0){s(new Error("Text file is empty"));return}const p=[",","	","|",";"];let d="",u=0;for(const g of p){const v=m.slice(0,10).map(T=>T.split(g).length),C=v.reduce((T,z)=>T+z,0)/v.length;v.every(T=>Math.abs(T-C)<=1&&T>1)&&C>u&&(u=C,d=g)}if(d&&u>1){const g=m[0].split(d).map(C=>C.trim()),v=[];for(let C=1;C<Math.min(m.length,100);C++){const D=m[C].split(d).map(z=>z.trim()),T={};for(let z=0;z<g.length;z++)T[g[z]]=D[z]||"";v.push(T)}r({columns:g,data:v})}else{const g=m.slice(0,100).map((v,C)=>({LineNumber:C+1,Text:v}));r({columns:["LineNumber","Text"],data:g})}}catch(c){s(new Error(`Error parsing text file: ${c instanceof Error?c.message:"Unknown error"}`))}},n.onerror=()=>{s(new Error("Error reading text file"))},n.readAsText(t)}),On=()=>{const t=ft(),r=Je(n=>n.formatter.selectedTool),s=n=>{const l=n.target.value,i=Kt.find(c=>c.id===l);i&&t(Yr(i))};return e.jsxs(y,{sx:{my:3},children:[e.jsx(x,{variant:"h6",gutterBottom:!0,children:"Select Target Tool"}),e.jsxs(pe,{container:!0,spacing:2,children:[e.jsx(pe,{size:{xs:12,md:6},children:e.jsxs(qe,{fullWidth:!0,children:[e.jsx(Ke,{id:"tool-select-label",children:"Tool"}),e.jsx(Xe,{labelId:"tool-select-label",id:"tool-select",value:(r==null?void 0:r.id)||"",label:"Tool",onChange:s,children:Kt.map(n=>e.jsx(ie,{value:n.id,children:n.name},n.id))})]})}),e.jsx(pe,{size:12,children:r&&e.jsxs(me,{variant:"outlined",sx:{p:2,mt:2,borderColor:"primary.light"},children:[e.jsx(x,{variant:"subtitle1",gutterBottom:!0,children:r.name}),e.jsx(x,{variant:"body2",paragraph:!0,children:r.description}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Required fields: ",r.requiredFields.map(n=>n.name).join(", ")]})]})})]})]})},_n=()=>{const t=ft(),r=E.useRef(null),{sourceColumns:s,selectedTool:n}=Je(M=>M.formatter),[l,i]=E.useState("csv"),[c,m]=E.useState(!1),[p,d]=E.useState(null),[u,g]=E.useState(null),v=M=>{i(M.target.value)},C=async M=>{var U;const F=(U=M.target.files)==null?void 0:U[0];if(F){g(F.name),m(!0),d(null);try{t(Pe("uploading"));const Y={id:`file-${Date.now()}`,name:F.name,type:l,size:F.size,lastModified:F.lastModified},{columns:H,data:o}=await Dn(F,l);t(qr(Y)),t(Gr(H)),t(br(o)),t(Pe("idle")),setTimeout(()=>{t(He(1))},500)}catch(Y){d(Y instanceof Error?Y.message:"Failed to parse file"),t(Pe("error"))}finally{m(!1)}}},D=()=>{var M;(M=r.current)==null||M.click()},T=M=>{var U;M.preventDefault(),M.stopPropagation();const F=(U=M.dataTransfer.files)==null?void 0:U[0];if(F&&r.current){const Y=new DataTransfer;Y.items.add(F),r.current.files=Y.files,C({target:{files:Y.files}})}},z=M=>{M.preventDefault(),M.stopPropagation()},w=()=>{t(He(1))},V=s.length>0&&n!==null;return e.jsxs(y,{sx:{width:"100%"},children:[e.jsx(x,{variant:"h5",gutterBottom:!0,children:"Upload Data File"}),e.jsx(x,{variant:"body1",paragraph:!0,children:"Select a file to upload. The formatter supports CSV, Excel (.xlsx, .xls, .xlsm), PDF, JSON, XML, and plain text files."}),e.jsxs(pe,{container:!0,spacing:3,children:[e.jsx(pe,{size:{xs:12,md:4},children:e.jsxs(qe,{fullWidth:!0,children:[e.jsx(Ke,{id:"file-type-select-label",children:"File Type"}),e.jsxs(Xe,{labelId:"file-type-select-label",id:"file-type-select",value:l,label:"File Type",onChange:v,children:[e.jsx(ie,{value:"csv",children:"CSV"}),e.jsx(ie,{value:"excel",children:"Excel (.xlsx/.xls/.xlsm)"}),e.jsx(ie,{value:"json",children:"JSON"}),e.jsx(ie,{value:"xml",children:"XML"}),e.jsx(ie,{value:"pdf",children:"PDF"}),e.jsx(ie,{value:"txt",children:"Text File"})]})]})}),e.jsxs(pe,{size:12,children:[e.jsx("input",{type:"file",ref:r,onChange:C,style:{display:"none"},accept:l==="csv"?".csv":l==="excel"?".xlsx,.xls,.xlsm":l==="json"?".json":l==="xml"?".xml":l==="pdf"?".pdf":l==="txt"?".txt":void 0}),e.jsx(me,{elevation:0,onDrop:T,onDragOver:z,sx:{border:"2px dashed #ccc",borderRadius:2,p:3,textAlign:"center",cursor:"pointer",bgcolor:"#f8f9fa","&:hover":{borderColor:"primary.main"}},onClick:D,children:c?e.jsxs(y,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(Ye,{}),e.jsx(x,{variant:"body1",sx:{mt:2},children:"Processing file..."})]}):e.jsxs(y,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(Xt,{fontSize:"large",color:"primary"}),e.jsx(x,{variant:"h6",sx:{mt:2},children:u?`Selected: ${u}`:"Drag & drop file here or click to browse"}),e.jsxs(x,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Supports ",l==="csv"?"CSV":l==="excel"?"Excel (.xlsx, .xls, .xlsm)":l==="json"?"JSON":l==="xml"?"XML":l==="pdf"?"PDF":"Text"," files"]})]})}),p&&e.jsx(ue,{severity:"error",sx:{mt:2},children:p}),u&&!c&&!p&&e.jsxs(ue,{severity:"success",sx:{mt:2},children:["File selected: ",u]})]}),e.jsx(pe,{size:12,sx:{mt:2,display:"flex",justifyContent:"center"},children:e.jsx(Q,{variant:"contained",size:"large",onClick:D,startIcon:e.jsx(Xt,{}),disabled:c,children:"Browse Files"})})]}),e.jsx(be,{sx:{my:4}}),e.jsx(On,{}),e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mt:4},children:e.jsx(Q,{variant:"contained",size:"large",endIcon:e.jsx(Yt,{}),onClick:w,disabled:!V,children:"Continue to Field Mapping"})}),!V&&e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mt:2,textAlign:"right"},children:s.length?"Select a target tool to continue":"Upload a file to continue"})]})},dt=oe(e.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"})),ar=t=>["dispatch_time","enroute_time","arrival_time","clear_time"].includes(t),Ot=t=>["incident_date"].includes(t),Pn=t=>{if(!t||typeof t!="string")return t;const r=[/^\d{1,2}\/\d{1,2}\/\d{4}\s+(\d{1,2}:\d{2}:\d{2})$/,/^\d{4}-\d{2}-\d{2}\s+(\d{1,2}:\d{2}:\d{2})$/,/^\d{1,2}\/\d{1,2}\/\d{4}\s+(\d{1,2}:\d{2})$/,/^\d{4}-\d{2}-\d{2}\s+(\d{1,2}:\d{2})$/,/^.+\s+(\d{1,2}:\d{2}(?::\d{2})?)$/];for(const n of r){const l=t.match(n);if(l&&l[1])return l[1]}return/^\d{1,2}:\d{2}(?::\d{2})?$/.test(t.trim())?t.trim():t},Ln=t=>{if(console.log(` DATE EXTRACTION: Input "${t}" (type: ${typeof t})`),!t||typeof t!="string")return console.log(" DATE EXTRACTION: Invalid input, returning original"),t;const r=[/^(\d{1,2}\/\d{1,2}\/\d{4})\s+\d{1,2}:\d{2}(?::\d{2})?$/,/^(\d{4}-\d{2}-\d{2})\s+\d{1,2}:\d{2}(?::\d{2})?$/,/^([^\\s]+)\s+\d{1,2}:\d{2}(?::\d{2})?$/];for(let n=0;n<r.length;n++){const l=r[n],i=t.match(l);if(console.log(` Pattern ${n+1} test: "${t}"  ${i?`MATCH: "${i[1]}"`:"NO MATCH"}`),i&&i[1])return console.log(` DATE EXTRACTION SUCCESS: "${t}"  "${i[1]}"`),i[1]}const s=[/^\d{1,2}\/\d{1,2}\/\d{4}$/,/^\d{4}-\d{2}-\d{2}$/];for(const n of s)if(n.test(t.trim()))return t.trim();return t},Or=(t,r)=>!t||!t.length||!r||!r.length?[]:t.map(s=>{const n={},l=new Set;return r.forEach(i=>{const{sourceField:c,targetField:m,transformations:p}=i;let d;if(c==="__default__"&&p&&p.length>0){const u=p.find(g=>g.type==="convert"&&g.params.defaultValue);u?(console.log(`Using default value for ${m}:`,u.params.defaultValue),d=u.params.defaultValue):(console.log(`No default value found for ${m}, using null`),d=null)}else if(c.includes("_")&&c.split("_").length>=2){const[u,...g]=c.split("_"),v=g.join("_"),C=[`${u}_parsed_${v}`,`${u}_parsed_${m}`,c];console.log(` PARSED FIELD LOOKUP for ${m} from sourceField "${c}"`),console.log(" Trying parsed keys:",C),console.log(" Available row keys:",Object.keys(s).filter(T=>T.includes("parsed")));let D=!1;for(const T of C)if(s[T]!==void 0&&s[T]!==null){d=s[T],console.log(`  Using PARSED value for ${m} from key "${T}":`,d),D=!0;break}D||(d=s[c],console.log(`  No parsed data found, using source value for ${m} from ${c}:`,d))}else d=s[c],console.log(`Using source value for ${m} from ${c}:`,d);if(p&&p.length>0){console.log(`Applying ${p.length} transformations to ${m}:`,p);const u=d;d=Nn(d,p,m),console.log(`Transformation result for ${m}:`,u,"",d)}if(console.log(` CHECKING FIELD: ${m}, isTimeOnly: ${ar(m)}, isDateOnly: ${Ot(m)}, value type: ${typeof d}`),d&&typeof d=="string")if(ar(m)){const u=Pn(d);u!==d?(console.log(` Auto-extracted time for ${m}: "${d}"  "${u}"`),d=u):console.log(` No time extraction needed for ${m}: "${d}"`)}else if(Ot(m)){console.log(` ATTEMPTING DATE EXTRACTION for ${m}: Input value "${d}"`);const u=Ln(d);console.log(` DATE EXTRACTION RESULT: "${d}"  "${u}" (changed: ${u!==d})`),u!==d?(console.log(`  Auto-extracted date for ${m}: "${d}"  "${u}"`),d=u):console.log(`  No date extraction needed for ${m}: "${d}"`)}else m==="incident_time"&&console.log(` Keeping full datetime for ${m}: "${d}"`);if(n[m]=d,c!==m&&c!=="__default__"&&!l.has(c)){if(r.some(g=>g.targetField===c))console.log(` SKIPPING PRESERVATION: "${c}" is also a target field - keeping transformed value`);else{let g=d;Ot(m)&&s[c]&&typeof s[c]=="string"&&s[c].includes(" ")&&(g=s[c],console.log(` PRESERVING FULL DATETIME for original field "${c}": "${g}" (target "${m}" gets date-only: "${d}")`)),n[c]=g,console.log(` PRESERVED ORIGINAL FIELD NAME: "${c}"  "${g}" (also mapped to ${m})`)}l.add(c)}}),n}),Nn=(t,r,s)=>r.reduce((n,l)=>_r(n,l,s),t),_r=(t,r,s)=>{const{type:n,params:l}=r,i=s?{...l,fieldName:s}:l;switch(n){case"split":return Bn(t,i);case"join":return Un(t,i);case"format":return Hn(t,i);case"convert":return Wn(t,i);case"extract":return zn(t,i);case"replace":return Vn(t,i);default:return t}},zn=(t,r)=>{if(typeof t!="string")return t;const{pattern:s}=r;try{const n=new RegExp(s),l=t.match(n);if(l&&l.length>0)return l[1]||l[0]}catch{console.error("Invalid regex pattern:",s)}return t},Vn=(t,r)=>{if(typeof t!="string")return t;const{from:s,to:n="",useRegex:l=!1}=r;if(!s)return t;try{if(l){const i=new RegExp(s,"g");return t.replace(i,n)}else return t.replace(new RegExp(s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n)}catch(i){return console.error("Error in replace transformation:",i),t}},Bn=(t,r)=>{if(typeof t!="string")return t;const{delimiter:s,index:n}=r,l=t.split(s);return n!==void 0?l[n]||"":l},Un=(t,r)=>{if(!Array.isArray(t))return t;const{delimiter:s=", "}=r;return t.join(s)},Hn=(t,r)=>{const{format:s,type:n,fieldName:l}=r;if(console.log("applyFormatTransformation called with:",{value:t,format:s,type:n,fieldName:l}),n==="date"&&t)try{const i=new Date(t);if(isNaN(i.getTime()))return t;switch(s){case"MM/DD/YYYY":return`${i.getMonth()+1}/${i.getDate()}/${i.getFullYear()}`;case"YYYY-MM-DD":return`${i.getFullYear()}-${(i.getMonth()+1).toString().padStart(2,"0")}-${i.getDate().toString().padStart(2,"0")}`;case"DD/MM/YYYY":return`${i.getDate()}/${i.getMonth()+1}/${i.getFullYear()}`;case"date-only":return i.toLocaleDateString();case"custom":return(r.customFormat||"YYYY-MM-DD").replace("YYYY",i.getFullYear().toString()).replace("MM",(i.getMonth()+1).toString().padStart(2,"0")).replace("DD",i.getDate().toString().padStart(2,"0")).replace("HH",i.getHours().toString().padStart(2,"0")).replace("mm",i.getMinutes().toString().padStart(2,"0")).replace("ss",i.getSeconds().toString().padStart(2,"0"));case"ISO":return i.toISOString();default:return t}}catch{return t}if(n==="number"&&t!==void 0&&t!==null)try{const i=Number(t);if(isNaN(i))return t;switch(s){case"integer":return Math.round(i);case"fixed2":return i.toFixed(2);case"currency":return`$${i.toFixed(2)}`;case"percent":return`${(i*100).toFixed(1)}%`;default:return t}}catch{return t}return t},Wn=(t,r)=>{const{targetType:s}=r;switch(s){case"string":return t!=null?String(t):"";case"number":if(t==null||t==="")return null;const n=Number(t);return isNaN(n)?t:n;case"boolean":return typeof t=="string"?["true","yes","1","y"].includes(t.toLowerCase()):!!t;case"date":if(!t)return null;try{const l=new Date(t);return isNaN(l.getTime())?t:l}catch{return t}default:return t}},Yn=oe(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"})),ir=oe(e.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})),qn=oe(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"})),Gn=oe(e.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"})),ht=oe(e.jsx("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.996.996 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"})),Jn=oe(e.jsx("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"})),Kn=oe(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2m-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"})),Pr=oe(e.jsx("path",{d:"M16.59 7.58 10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"})),Xn=oe(e.jsx("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"})),Zn=oe(e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"})),Ut=oe(e.jsx("path",{d:"M15 4v2h3v12h-3v2h5V4zM4 20h5v-2H6V6h3V4H4z"})),Lr=oe(e.jsx("path",{d:"M4 7v2c0 .55-.45 1-1 1H2v4h1c.55 0 1 .45 1 1v2c0 1.65 1.35 3 3 3h3v-2H7c-.55 0-1-.45-1-1v-2c0-1.3-.84-2.42-2-2.83v-.34C5.16 11.42 6 10.3 6 9V7c0-.55.45-1 1-1h3V4H7C5.35 4 4 5.35 4 7m17 3c-.55 0-1-.45-1-1V7c0-1.65-1.35-3-3-3h-3v2h3c.55 0 1 .45 1 1v2c0 1.3.84 2.42 2 2.83v.34c-1.16.41-2 1.52-2 2.83v2c0 .55-.45 1-1 1h-3v2h3c1.65 0 3-1.35 3-3v-2c0-.55.45-1 1-1h1v-4z"})),Nr=oe(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"})),Ct=oe(e.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"})),lr=oe(e.jsx("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 12H4V8h16z"})),Qn=oe(e.jsx("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"})),eo=oe(e.jsx("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"})),zr=oe(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"})),cr=oe(e.jsx("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),to=oe(e.jsx("path",{d:"m20.5 10 .5-2h-4l1-4h-2l-1 4h-4l1-4h-2L9 8H5l-.5 2h4l-1 4h-4L3 16h4l-1 4h2l1-4h4l-1 4h2l1-4h4l.5-2h-4l1-4zm-7 4h-4l1-4h4z"})),dr=oe([e.jsx("path",{d:"M13 8.57c-.79 0-1.43.64-1.43 1.43s.64 1.43 1.43 1.43 1.43-.64 1.43-1.43-.64-1.43-1.43-1.43"},"0"),e.jsx("path",{d:"M13 3C9.25 3 6.2 5.94 6.02 9.64L4.1 12.2c-.25.33-.01.8.4.8H6v3c0 1.1.9 2 2 2h1v3h7v-4.68c2.36-1.12 4-3.53 4-6.32 0-3.87-3.13-7-7-7m3 7c0 .13-.01.26-.02.39l.83.66c.08.06.1.16.05.25l-.8 1.39c-.05.09-.16.12-.24.09l-.99-.4c-.21.16-.43.29-.67.39L14 13.83c-.01.1-.1.17-.2.17h-1.6c-.1 0-.18-.07-.2-.17l-.15-1.06c-.25-.1-.47-.23-.68-.39l-.99.4c-.09.03-.2 0-.25-.09l-.8-1.39c-.05-.08-.03-.19.05-.25l.84-.66c-.01-.13-.02-.26-.02-.39s.02-.27.04-.39l-.85-.66c-.08-.06-.1-.16-.05-.26l.8-1.38c.05-.09.15-.12.24-.09l1 .4c.2-.15.43-.29.67-.39L12 6.17c.02-.1.1-.17.2-.17h1.6c.1 0 .18.07.2.17l.15 1.06c.24.1.46.23.67.39l1-.4c.09-.03.2 0 .24.09l.8 1.38c.05.09.03.2-.05.26l-.85.66c.03.12.04.25.04.39"},"1")]),ro=oe(e.jsx("path",{d:"M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27zM12 17.3c-.72 0-1.3-.58-1.3-1.3s.58-1.3 1.3-1.3 1.3.58 1.3 1.3-.58 1.3-1.3 1.3m1-4.3h-2V7h2z"})),Vr=oe(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"})),ur=oe(e.jsx("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3M7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13"})),so=oe([e.jsx("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),e.jsx("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")]),_t=[{id:"incident_type",name:" Incident Type",description:"Fire, medical, accident, alarm, etc.",pattern:/(fire|medical|ems|accident|mva|alarm|rescue|hazmat)/gi,enabled:!0},{id:"response_time",name:" Response Time",description:'Time values like "30 min", "1:20", "half hour"',pattern:/(\d+)\s*(min|minutes|hour|hours|hr|hrs)|(\d{1,2}):(\d{2})|half.hour|quarter.hour/gi,enabled:!0},{id:"location",name:" Location",description:"Addresses, street names, landmarks",pattern:/\d+\s+[\w\s]+(street|st|avenue|ave|road|rd|drive|dr|lane|ln|boulevard|blvd)/gi,enabled:!1},{id:"date_time",name:" Date/Time",description:'Dates like "12/04/25", "April 12", times',pattern:/(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})|(\w+\s+\d{1,2})|(\d{1,2}:\d{2})/gi,enabled:!1},{id:"units_resources",name:" Units/Resources",description:"Fire trucks, ambulances, personnel count",pattern:/(engine|truck|ambulance|rescue|ladder|chief|\d+\s*(firefighter|personnel|crew))/gi,enabled:!1}],no=({open:t,onClose:r,columnName:s,sampleData:n,onParse:l})=>{const[i,c]=E.useState(["incident_type","response_time"]),[m,p]=E.useState(!1),[d,u]=E.useState([]),[g,v]=E.useState(!1);E.useEffect(()=>{i.length>0&&n.length>0&&D()},[i,n]);const C=o=>{c(a=>a.includes(o)?a.filter(h=>h!==o):[...a,o])},D=async()=>{p(!0);try{await new Promise(a=>setTimeout(a,500));const o=n.slice(0,5).map((a,h)=>({rowIndex:h,originalText:a,parsedFields:T(a,i)}));u(o)}catch(o){console.error("Error generating preview:",o)}finally{p(!1)}},T=(o,a)=>{const h={};return a.forEach(R=>{const N=_t.find(G=>G.id===R);if(!N)return;const W=o.match(N.pattern);if(W&&W.length>0){const G=W[0];console.log(` PARSING DEBUG - Field: ${R}, Pattern: ${N.pattern}, Text: "${o}", Match: "${G}"`),h[R]={value:z(R,G),confidence:F(R,G),original:G}}}),h},z=(o,a)=>{switch(o){case"incident_type":return w(a);case"response_time":return V(a);case"location":return M(a);default:return a}},w=o=>{const a=o.toLowerCase();return a.includes("fire")?"Structure Fire":a.includes("medical")||a.includes("ems")?"Medical Emergency":a.includes("accident")||a.includes("mva")?"Motor Vehicle Accident":a.includes("alarm")?"Alarm Response":o},V=o=>{const a=o.match(/(\d+)\s*(min|minutes|hour|hours|hr|hrs)/i);if(a){const R=parseInt(a[1]);return a[2].toLowerCase().startsWith("h")?`${R} hour${R!==1?"s":""}`:`${R} minute${R!==1?"s":""}`}const h=o.match(/(\d{1,2}):(\d{2})/);if(h){const R=parseInt(h[1]),N=parseInt(h[2]);return`${R}:${N.toString().padStart(2,"0")}`}return o},M=o=>o.replace(/\b\w/g,a=>a.toUpperCase()),F=(o,a,h)=>o==="response_time"&&a.match(/\d+\s*(min|minutes)/i)?.95:o==="incident_type"&&["fire","medical","accident"].includes(a.toLowerCase())?.9:.7,U=async()=>{if(i.length!==0){v(!0);try{await new Promise(a=>setTimeout(a,1e3));const o=n.map((a,h)=>({rowIndex:h,originalText:a,parsedFields:T(a,i)}));l(i,o),r()}catch(o){console.error("Error parsing narrative data:",o)}finally{v(!1)}}},Y=()=>i.length,H=()=>d.filter(o=>Object.keys(o.parsedFields).length>0).length;return e.jsxs(nt,{open:t,onClose:r,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"70vh"}},children:[e.jsxs(ot,{sx:{display:"flex",alignItems:"center",pb:1},children:[e.jsx(ur,{sx:{mr:1,color:"primary.main"}}),'Parse Narrative: "',s,'"']}),e.jsxs(at,{sx:{pb:1},children:[e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Extract structured data from narrative text using pattern matching and NLP. Select the fields you want to extract and preview the results."}),e.jsx(x,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"1. Select Fields to Extract"}),e.jsx(Rr,{sx:{mb:3},children:_t.map(o=>e.jsx(tt,{control:e.jsx(ps,{checked:i.includes(o.id),onChange:()=>C(o.id)}),label:e.jsxs(y,{children:[e.jsx(x,{variant:"body2",sx:{fontWeight:"medium"},children:o.name}),e.jsx(x,{variant:"caption",color:"text.secondary",children:o.description})]})},o.id))}),e.jsx(be,{sx:{my:2}}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(x,{variant:"h6",sx:{flexGrow:1},children:"2. Preview Results"}),m&&e.jsx(Ye,{size:20,sx:{ml:2}})]}),i.length===0?e.jsx(ue,{severity:"info",sx:{mb:2},children:"Select at least one field to see preview results."}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(ce,{label:`${Y()} fields selected`,size:"small",color:"primary"}),e.jsx(ce,{label:`${H()}/${d.length} rows with data`,size:"small",color:"success"})]}),e.jsxs(yt,{size:"small",sx:{mb:2},children:[e.jsx(bt,{children:e.jsxs(Be,{children:[e.jsx(Te,{children:"Original Text"}),i.map(o=>{const a=_t.find(h=>h.id===o);return e.jsx(Te,{children:a==null?void 0:a.name},o)})]})}),e.jsx(vt,{children:d.map((o,a)=>e.jsxs(Be,{children:[e.jsx(Te,{sx:{maxWidth:200},children:e.jsx(x,{variant:"body2",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o.originalText})}),i.map(h=>e.jsx(Te,{children:o.parsedFields[h]?e.jsxs(y,{children:[e.jsx(x,{variant:"body2",children:o.parsedFields[h].value}),e.jsxs(x,{variant:"caption",color:"success.main",children:[Math.round(o.parsedFields[h].confidence*100),"% confident"]})]}):e.jsx(x,{variant:"caption",color:"text.secondary",children:"No match"})},h))]},a))})]}),e.jsx(ue,{severity:"info",sx:{mb:2},children:e.jsxs(x,{variant:"body2",children:[e.jsx("strong",{children:"Preview shows first 5 rows."})," Parsing accuracy is typically 70-85%. You can edit any incorrect values after parsing."]})})]})]}),e.jsxs(it,{sx:{p:3,pt:1},children:[e.jsx(Q,{onClick:r,children:"Cancel"}),e.jsx(Q,{variant:"contained",onClick:U,disabled:i.length===0||g,startIcon:g?e.jsx(Ye,{size:20}):e.jsx(ur,{}),children:g?"Parsing...":`Parse ${s}`})]})]})},oo=({columnName:t,onClick:r,variant:s="icon",size:n="small",disabled:l=!1})=>{const i=()=>{r(t)};return s==="button"?e.jsx(Q,{size:n,startIcon:e.jsx(ht,{}),onClick:i,disabled:l,sx:{minWidth:"auto",textTransform:"none",color:"primary.main","&:hover":{backgroundColor:"primary.50"}},children:"Parse"}):e.jsx(We,{title:`Parse narrative text in "${t}" column`,children:e.jsx("span",{children:e.jsx(Fe,{size:n,onClick:i,disabled:l,sx:{color:"primary.main","&:hover":{backgroundColor:"primary.50",transform:"scale(1.1)"},transition:"all 0.2s ease-in-out"},children:e.jsx(ht,{fontSize:n})})})})},ao=({parsedFields:t,onFieldDragStart:r,onDeleteParsedField:s})=>{if(t.length===0)return null;const n=i=>i>=.9?"success":i>=.7?"warning":"error",l=i=>i>=.9?"High confidence":i>=.7?"Medium confidence":"Low confidence";return e.jsxs(y,{sx:{mt:1,ml:2},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(dr,{sx:{fontSize:16,color:"primary.main",mr:.5}}),e.jsx(x,{variant:"caption",color:"primary.main",sx:{fontWeight:"medium"},children:"Parsed Fields"})]}),e.jsx(jt,{spacing:.5,children:t.map(i=>e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(ce,{label:i.name,size:"small",color:"secondary",variant:"outlined",draggable:!0,onDragStart:c=>{c.stopPropagation(),r(c,i.id)},sx:{cursor:"grab","&:active":{cursor:"grabbing"},"&:hover":{backgroundColor:"secondary.50"}},icon:e.jsx(dr,{})}),e.jsx(We,{title:`${i.parsedCount}/${i.totalRows} rows parsed`,children:e.jsxs(x,{variant:"caption",color:"text.secondary",children:[Math.round(i.parsedCount/i.totalRows*100),"%"]})}),e.jsx(We,{title:l(i.confidence),children:e.jsx(rt,{sx:{fontSize:14,color:`${n(i.confidence)}.main`}})}),e.jsx(We,{title:"Delete parsed field",children:e.jsx(Fe,{size:"small",onClick:()=>s(i.id),sx:{ml:.5,"&:hover":{color:"error.main"}},children:e.jsx(ut,{sx:{fontSize:14}})})})]},i.id))}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:"Drag parsed fields to target fields "})]})},io=({id:t,isMapped:r,targetFields:s,sampleValue:n,dataType:l,onParseColumn:i,parsedFields:c=[],onParsedFieldDragStart:m,onDeleteParsedField:p})=>{const d=(l==="Text"||!l&&typeof n=="string")&&typeof n=="string"&&n.length>20;t==="Notes"&&console.log(" NARRATIVE PARSER DEBUG for Notes column:",{fieldId:t,dataType:l,sampleValue:n,sampleValueType:typeof n,sampleValueLength:typeof n=="string"?n.length:"N/A",isTextColumn:d,onParseColumn:!!i});const u={backgroundColor:r?"#f0f7ff":void 0,border:r?"1px solid #90caf9":"1px solid #e0e0e0",cursor:"grab",padding:"8px 12px",borderRadius:"4px",marginBottom:"8px",position:"relative"},g=C=>{console.log("DRAG START on source field:",t),C.dataTransfer.setData("text/plain",t),C.dataTransfer.effectAllowed="move",console.log("Verifying dataTransfer was set:",C.dataTransfer.types);const D=document.createElement("div");D.className="drag-ghost",D.innerHTML=`<div style="padding: 10px; background: #1976d2; color: white; border-radius: 4px;">Dragging: ${t}</div>`,document.body.appendChild(D),C.dataTransfer.setDragImage(D,20,20);const T=C.currentTarget;T.style.opacity="0.6",T.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.2)",setTimeout(()=>{document.body.removeChild(D)},0),console.log("Drag started with field:",t)},v=C=>{const D=C.currentTarget;D.style.opacity="",D.style.boxShadow="",console.log("Drag ended for field:",t)};return e.jsx("div",{style:u,"data-field-id":t,className:"draggable-source-field",draggable:!0,onDragStart:g,onDragEnd:v,children:e.jsxs(y,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsxs(y,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(x,{variant:"body2",fontWeight:"medium",children:t}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[d&&i&&e.jsx(oo,{columnName:t,onClick:i,variant:"icon",size:"small"}),r&&e.jsx(ce,{size:"small",icon:e.jsx(Yn,{fontSize:"small"}),label:s.length===1?s[0]:`${s.length} fields`,color:"primary",variant:"outlined"})]})]}),n!==void 0&&e.jsxs(y,{sx:{mt:.5,display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"0.75rem"},children:[e.jsx(x,{variant:"caption",sx:{color:"text.secondary",fontFamily:"monospace",bgcolor:"grey.100",px:.5,borderRadius:.5,maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:typeof n=="object"?JSON.stringify(n):String(n)}),l&&e.jsx(ce,{label:l,size:"small",variant:"outlined",sx:{height:"16px",fontSize:"0.65rem","& .MuiChip-label":{px:.5,py:0}}})]}),c.length>0&&e.jsx(ao,{parsedFields:c.map(C=>({id:C.id,name:C.name,sourceColumn:C.sourceColumn,parsedCount:C.parsedCount,totalRows:C.totalRows,confidence:C.confidence})),onFieldDragStart:m||(()=>{}),onDeleteParsedField:p||(()=>{})})]})})},lo=({sourceColumns:t,filter:r,setFilter:s,mappings:n,sampleData:l=[],onAddParsedFields:i})=>{const[c,m]=E.useState(!1),[p,d]=E.useState(""),[u,g]=E.useState({}),v=o=>{d(o),m(!0)},C=()=>{m(!1),d("")},D=(o,a)=>{console.log(" Parsing completed for column:",p),console.log(" Selected fields:",o),console.log(" Results:",a);const h=o.map(R=>{const N=T(R),W=[];let G=0,se=0;a.forEach(S=>{S.parsedFields[R]?(W.push(S.parsedFields[R].value),G++,se+=S.parsedFields[R].confidence):W.push(null)});const _=G>0?se/G:0;return{id:`${p}_${R}`,name:N,sourceColumn:p,parsedCount:G,totalRows:a.length,confidence:_,data:W}});if(g(R=>({...R,[p]:h})),l&&l.length>0){const R=l.map((N,W)=>{const G={...N};return h.forEach(se=>{if(se.data[W]!==null){const _=se.id.split("_").slice(1).join("_"),S=`${p}_parsed_${_}`;G[S]=se.data[W],console.log(` INJECTED parsed data: ${S} = "${se.data[W]}"`)}}),G});console.log(" Updated sample data with parsed fields:",R)}i&&i(p,h)},T=o=>({incident_type:" Parsed Incident Type",response_time:" Parsed Response Time",location:" Parsed Location",date_time:" Parsed Date/Time",units_resources:" Parsed Units/Resources"})[o]||` Parsed ${o}`,z=(o,a)=>{console.log(" Dragging parsed field:",a),o.dataTransfer.setData("text/plain",a),o.dataTransfer.effectAllowed="move"},w=o=>{console.log(" Deleting parsed field:",o);const a=Object.keys(u).find(h=>u[h].some(R=>R.id===o));a&&g(h=>({...h,[a]:h[a].filter(R=>R.id!==o)}))},V=o=>!l||l.length===0?[]:l.slice(0,10).map(a=>a[o]||"").filter(Boolean),M=E.useMemo(()=>{if(!r)return t;const o=r.toLowerCase();return t.filter(a=>a.toLowerCase().includes(o))},[t,r]),F=E.useMemo(()=>{const o={};return n.forEach(a=>{o[a.sourceField]||(o[a.sourceField]=[]),o[a.sourceField].push(a.targetField)}),o},[n]),U=E.useMemo(()=>Object.keys(F).length,[F]),Y=E.useMemo(()=>{if(!l||l.length===0)return{};const o=l[0],a={};return t.forEach(h=>{a[h]=o[h]}),a},[l,t]),H=E.useMemo(()=>{const o={};return Object.entries(Y).forEach(([a,h])=>{if(h==null){o[a]="Unknown";return}if(typeof h=="string"){if([/^\d{4}-\d{2}-\d{2}$/,/^\d{1,2}\/\d{1,2}\/\d{2,4}$/,/^\d{4}\/\d{2}\/\d{2}$/].some(W=>W.test(h))){o[a]="Date";return}if([/^\d{1,2}:\d{2}(:\d{2})?$/,/^\d{1,2}:\d{2}(:\d{2})?\s*(AM|PM)$/i].some(W=>W.test(h))){o[a]="Time";return}if(!isNaN(Number(h))){o[a]="Number";return}o[a]="Text";return}typeof h=="number"?o[a]="Number":typeof h=="boolean"?o[a]="Boolean":Array.isArray(h)?o[a]="Array":typeof h=="object"?o[a]="Object":o[a]=typeof h}),o},[Y]);return e.jsxs(me,{sx:{height:"100%",p:2,display:"flex",flexDirection:"column",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",border:"2px solid #e0e0e0",borderRadius:"8px",overflow:"hidden"},children:[e.jsx(Ce,{size:"small",placeholder:"Search source fields...",value:r,onChange:o=>s(o.target.value),fullWidth:!0,sx:{mb:2},InputProps:{startAdornment:e.jsx(_e,{position:"start",children:e.jsx(pt,{fontSize:"small"})})}}),e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(x,{variant:"body2",color:"text.secondary",children:[M.length," fields"]}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:[U," mapped"]})]}),e.jsx(y,{sx:{mb:2,p:1,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1,border:"1px dashed",borderColor:"primary.main"},children:e.jsx(x,{variant:"body2",color:"primary",sx:{fontWeight:"bold"},children:"Drag fields from here to the Target Fields panel"})}),e.jsx(be,{sx:{mb:2}}),e.jsxs(y,{sx:{flexGrow:1,overflow:"auto",maxHeight:"calc(100% - 180px)",scrollbarWidth:"thin",border:"1px solid #e0e0e0",borderRadius:"4px",padding:"8px",backgroundColor:"#fafafa","&::-webkit-scrollbar":{width:"10px"},"&::-webkit-scrollbar-track":{background:"#f1f1f1",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{background:"#2196f3",borderRadius:"4px","&:hover":{background:"#1976d2"}}},children:[M.map(o=>e.jsx(io,{id:o,isMapped:!!F[o],targetFields:F[o]||[],sampleValue:Y[o],dataType:H[o],onParseColumn:v,parsedFields:u[o]||[],onParsedFieldDragStart:z,onDeleteParsedField:w},o)),M.length===0&&e.jsx(y,{sx:{textAlign:"center",py:4},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"No fields match your search"})})]}),e.jsx(no,{open:c,onClose:C,columnName:p,sampleData:V(p),onParse:D})]})},co=({open:t,onClose:r,fieldName:s,mapping:n,sampleData:l,onSave:i})=>{const[c,m]=E.useState(0),[p,d]=E.useState([]),[u,g]=E.useState("auto"),[v,C]=E.useState(""),[D,T]=E.useState(","),[z,w]=E.useState(0),[V,M]=E.useState("string");E.useEffect(()=>{if(n){if(n.sourceField&&l.length>0){const a=l.map(h=>h[n.sourceField]).filter(h=>h!=null).slice(0,5);d(a)}n.transformations&&n.transformations.length>0&&n.transformations.forEach(a=>{switch(a.type){case"format":const h=a.params.format||a.params.dateFormat;h&&(h==="custom"?(g("custom"),C(a.params.customFormat||"")):g(h));break;case"split":T(a.params.delimiter||","),w(a.params.index||0);break;case"convert":M(a.params.toType||"string");break}})}},[n,l]);const F=(a,h)=>{m(h)},U=()=>{const a=[];c===0&&u!=="auto"&&a.push({type:"format",params:{type:"date",format:u,fieldName:s,...u==="custom"?{customFormat:v}:{}}}),c===1&&a.push({type:"split",params:{delimiter:D,index:z}}),c===2&&a.push({type:"convert",params:{toType:V}}),i(s,a)},Y=p.length>0,o=(()=>{if(!Y)return[];switch(c){case 0:return p.map(a=>{if(!a)return"N/A";try{const h=new Date(a);if(isNaN(h.getTime()))return"Invalid date";switch(u){case"auto":return h.toLocaleString();case"MM/DD/YYYY":return`${h.getMonth()+1}/${h.getDate()}/${h.getFullYear()}`;case"YYYY-MM-DD":return`${h.getFullYear()}-${(h.getMonth()+1).toString().padStart(2,"0")}-${h.getDate().toString().padStart(2,"0")}`;case"DD/MM/YYYY":return`${h.getDate()}/${h.getMonth()+1}/${h.getFullYear()}`;case"date-only":return new Date(a).toLocaleDateString();case"custom":return v.replace("YYYY",h.getFullYear().toString()).replace("MM",(h.getMonth()+1).toString().padStart(2,"0")).replace("DD",h.getDate().toString().padStart(2,"0")).replace("HH",h.getHours().toString().padStart(2,"0")).replace("mm",h.getMinutes().toString().padStart(2,"0")).replace("ss",h.getSeconds().toString().padStart(2,"0"));default:return h.toLocaleString()}}catch{return"Error formatting date"}});case 1:return p.map(a=>{if(!a)return"N/A";try{return a.toString().split(D)[z]||`Index ${z} not found`}catch{return"Error splitting value"}});case 2:return p.map(a=>{if(a==null)return"N/A";try{switch(V){case"string":return String(a);case"number":return Number(a);case"boolean":return(!!a).toString();default:return String(a)}}catch{return"Error converting value"}})}return[]})();return e.jsxs(nt,{open:t,onClose:r,maxWidth:"md",fullWidth:!0,children:[e.jsxs(ot,{children:["Transform Field: ",s]}),e.jsx(at,{dividers:!0,children:e.jsxs(y,{sx:{width:"100%"},children:[e.jsx(y,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Tt,{value:c,onChange:F,"aria-label":"transformation tabs",children:[e.jsx(Ie,{label:"Date/Time Format"}),e.jsx(Ie,{label:"Split/Extract"}),e.jsx(Ie,{label:"Type Conversion"})]})}),e.jsxs(y,{role:"tabpanel",hidden:c!==0,sx:{p:2},children:[e.jsx(x,{variant:"subtitle1",gutterBottom:!0,children:"Date Format Settings"}),e.jsx(x,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Choose how date and time values should be formatted. Date-only formats automatically strip time components."}),e.jsxs(qe,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Ke,{id:"date-format-label",children:"Date Format"}),e.jsxs(Xe,{labelId:"date-format-label",id:"date-format-select",value:u,label:"Date Format",onChange:a=>g(a.target.value),children:[e.jsx(ie,{value:"auto",children:"Auto-detect"}),e.jsx(ie,{value:"MM/DD/YYYY",children:"MM/DD/YYYY (date only)"}),e.jsx(ie,{value:"DD/MM/YYYY",children:"DD/MM/YYYY (date only)"}),e.jsx(ie,{value:"YYYY-MM-DD",children:"YYYY-MM-DD (date only)"}),e.jsx(ie,{value:"date-only",children:"Date Only (strip time)"}),e.jsx(ie,{value:"custom",children:"Custom Format"})]})]}),u==="custom"&&e.jsx(Ce,{fullWidth:!0,label:"Custom Format",value:v,onChange:a=>C(a.target.value),helperText:"Use YYYY for year, MM for month, DD for day, HH for hour, mm for minute, ss for second",sx:{mb:2}})]}),e.jsxs(y,{role:"tabpanel",hidden:c!==1,sx:{p:2},children:[e.jsx(x,{variant:"subtitle1",gutterBottom:!0,children:"Split or Extract Value"}),e.jsx(x,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Split a field by a delimiter and extract a specific part."}),e.jsx(Ce,{fullWidth:!0,label:"Delimiter",value:D,onChange:a=>T(a.target.value),helperText:"Character or text that separates the parts",sx:{mb:2}}),e.jsx(Ce,{fullWidth:!0,label:"Index",type:"number",value:z,onChange:a=>w(parseInt(a.target.value)||0),helperText:"Position of the part to extract (0 = first part)",sx:{mb:2}})]}),e.jsxs(y,{role:"tabpanel",hidden:c!==2,sx:{p:2},children:[e.jsx(x,{variant:"subtitle1",gutterBottom:!0,children:"Type Conversion"}),e.jsx(x,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Convert the value to a different data type."}),e.jsxs(qe,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Ke,{id:"convert-type-label",children:"Convert To"}),e.jsxs(Xe,{labelId:"convert-type-label",id:"convert-type-select",value:V,label:"Convert To",onChange:a=>M(a.target.value),children:[e.jsx(ie,{value:"string",children:"Text (String)"}),e.jsx(ie,{value:"number",children:"Number"}),e.jsx(ie,{value:"boolean",children:"True/False (Boolean)"})]})]})]}),e.jsx(be,{sx:{my:2}}),e.jsx(x,{variant:"subtitle1",gutterBottom:!0,children:"Preview"}),Y?e.jsxs(y,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(y,{sx:{display:"flex",borderBottom:1,borderColor:"divider",pb:1},children:[e.jsx(x,{variant:"body2",fontWeight:"bold",sx:{width:"50%"},children:"Original Value"}),e.jsx(x,{variant:"body2",fontWeight:"bold",sx:{width:"50%"},children:"Transformed Value"})]}),p.map((a,h)=>e.jsxs(y,{sx:{display:"flex",py:1,borderBottom:"1px solid #eee"},children:[e.jsx(x,{variant:"body2",sx:{width:"50%"},children:a==null?"Null/Empty":String(a)}),e.jsx(x,{variant:"body2",sx:{width:"50%"},children:o[h]})]},h))]}):e.jsx(ue,{severity:"info",children:"No sample data available for preview."})]})}),e.jsxs(it,{children:[e.jsx(Q,{onClick:r,children:"Cancel"}),e.jsx(Q,{onClick:U,variant:"contained",children:"Apply Transformation"})]})]})},uo=t=>{switch(t.dataType){case"string":return`DEFAULT-${t.name}`;case"number":return"0";case"boolean":return"false";case"date":return new Date().toISOString().split("T")[0];case"location":return"0.0,0.0";default:return""}},po=({open:t,onClose:r,unmappedRequiredFields:s,onAddDefaultMappings:n})=>{const[l,i]=E.useState(()=>{const d={};return s.forEach(u=>{d[u.name]=uo(u)}),d}),c=(d,u)=>{i(g=>({...g,[d]:u}))},m=()=>{console.log("Creating default mappings for fields:",s),console.log("Default values:",l);const d=s.map(u=>{const g={sourceField:"__default__",targetField:u.name,transformations:[{type:"convert",params:{defaultValue:l[u.name],targetType:u.dataType}}]};return console.log(`Created default mapping for ${u.name}:`,g),g});console.log("All default mappings:",d),n(d),r()},p=d=>{switch(d){case"number":return"number";case"date":return"date";default:return"text"}};return e.jsxs(nt,{open:t,onClose:r,"aria-labelledby":"default-value-dialog-title",maxWidth:"md",fullWidth:!0,children:[e.jsx(ot,{id:"default-value-dialog-title",children:"Set Default Values for Required Fields"}),e.jsxs(at,{children:[e.jsx(x,{variant:"body1",sx:{mb:3},children:"The following required fields don't have mappings. Please provide default values for them."}),e.jsx(pe,{container:!0,spacing:3,children:s.map(d=>e.jsxs(pe,{size:{xs:12,sm:6},children:[e.jsxs(y,{sx:{mb:1},children:[e.jsxs(x,{variant:"subtitle2",children:[d.name,e.jsx(ce,{size:"small",label:d.dataType,color:"primary",variant:"outlined",sx:{ml:1}})]}),e.jsx(x,{variant:"caption",color:"text.secondary",children:d.description})]}),d.dataType==="boolean"?e.jsxs(Ce,{select:!0,fullWidth:!0,value:l[d.name]||"false",onChange:u=>c(d.name,u.target.value),variant:"outlined",size:"small",children:[e.jsx(ie,{value:"true",children:"True"}),e.jsx(ie,{value:"false",children:"False"})]}):e.jsx(Ce,{fullWidth:!0,value:l[d.name]||"",onChange:u=>c(d.name,u.target.value),type:p(d.dataType),variant:"outlined",size:"small",placeholder:`Enter default value for ${d.name}`,InputLabelProps:{shrink:!0}}),e.jsx(hs,{children:"Default value for all records"})]},d.name))})]}),e.jsxs(it,{children:[e.jsx(Q,{onClick:r,color:"primary",children:"Cancel"}),e.jsx(Q,{onClick:m,color:"primary",variant:"contained",children:"Apply Default Values"})]})]})},ho=({mapping:t,sampleData:r,onClose:s})=>{const n=Ht(),l=E.useMemo(()=>!t||!r.length?[]:r.slice(0,5).map(c=>({sourceValue:c[t.sourceField],transformedValue:(t.transformations||[]).reduce((m,p)=>_r(m,p,t.targetField),c[t.sourceField])})),[t,r]);if(!t)return e.jsx(me,{sx:{p:2,mt:2,backgroundColor:he(n.palette.info.light,.1),border:`1px dashed ${n.palette.info.main}`,borderRadius:1},children:e.jsx(x,{variant:"body2",color:"text.secondary",align:"center",children:"Select a field mapping to see transformation preview"})});if(!l.length||!t.sourceField)return e.jsx(me,{sx:{p:2,mt:2,backgroundColor:he(n.palette.warning.light,.1),border:`1px dashed ${n.palette.warning.main}`,borderRadius:1},children:e.jsxs(x,{variant:"body2",color:"text.secondary",children:["No sample data available for ",t.sourceField||"this field"]})});const i=t.transformations||[];return e.jsxs(me,{sx:{p:2,mt:2,borderRadius:1,border:`1px solid ${n.palette.divider}`,boxShadow:n.shadows[1],position:"relative"},children:[s&&e.jsx(Fe,{size:"small",onClick:s,sx:{position:"absolute",top:8,right:8,color:n.palette.grey[500],"&:hover":{backgroundColor:he(n.palette.grey[100],.9),color:n.palette.grey[800]}},"aria-label":"close preview",children:e.jsx(es,{fontSize:"small"})}),e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,pr:4},children:[e.jsxs(x,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:["Field Transformation Preview: ",t.targetField]}),e.jsx(ce,{size:"small",label:`${i.length} transformation${i.length!==1?"s":""}`,color:i.length>0?"primary":"default",icon:i.length>0?e.jsx(ht,{}):void 0})]}),e.jsx(be,{sx:{mb:2}}),e.jsx(y,{sx:{maxHeight:200,overflow:"auto"},children:l.map((c,m)=>{const p=c.sourceValue!==void 0&&c.sourceValue!==null,d=i.length>0,u=typeof c.sourceValue,g=typeof c.transformedValue,v=u!==g;return e.jsxs(y,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:m%2===0?he(n.palette.background.default,.5):"transparent",display:"flex",alignItems:"center"},children:[e.jsxs(y,{sx:{flexBasis:"45%"},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Source (",t.sourceField,")"]}),e.jsx(x,{variant:"body2",sx:{fontFamily:"monospace",backgroundColor:p?he(n.palette.success.light,.1):he(n.palette.error.light,.1),p:.5,borderRadius:.5,wordBreak:"break-all"},children:p?String(c.sourceValue):"(empty)"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:u})]}),e.jsx(y,{sx:{flexBasis:"10%",textAlign:"center"},children:e.jsx(Gn,{color:d?"primary":"action"})}),e.jsxs(y,{sx:{flexBasis:"45%"},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Result (",t.targetField,")"]}),e.jsx(x,{variant:"body2",sx:{fontFamily:"monospace",backgroundColor:c.transformedValue!==void 0?he(n.palette.success.light,.1):he(n.palette.error.light,.1),p:.5,borderRadius:.5,wordBreak:"break-all"},children:c.transformedValue!==void 0?String(c.transformedValue):"(empty)"}),e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:g}),v&&e.jsx(ce,{size:"small",label:`Type: ${u}  ${g}`,color:"warning",variant:"outlined",sx:{height:16,fontSize:"0.6rem"}})]})]})]},m)})}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(be,{sx:{my:2}}),e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"Transformation Steps Applied:"}),e.jsx(y,{sx:{display:"flex",flexDirection:"column",gap:1},children:i.map((c,m)=>{var p,d,u,g,v,C,D,T,z;return e.jsxs(y,{sx:{display:"flex",alignItems:"center",p:1,borderRadius:1,backgroundColor:he(n.palette.primary.light,.05),border:`1px solid ${he(n.palette.primary.light,.2)}`},children:[e.jsxs(y,{sx:{mr:1,color:n.palette.primary.main},children:[m+1,"."]}),e.jsxs(x,{variant:"body2",children:[e.jsxs("strong",{children:[c.type,":"]})," "," ",c.type==="convert"&&((p=c.params)==null?void 0:p.dataType)&&`Convert to ${c.params.dataType}`,c.type==="convert"&&((d=c.params)==null?void 0:d.defaultValue)!==void 0&&`Set default value to "${c.params.defaultValue}"`,c.type==="format"&&((u=c.params)==null?void 0:u.type)==="date"&&(((g=c.params)==null?void 0:g.format)||((v=c.params)==null?void 0:v.dateFormat))&&`Format date as "${c.params.format||c.params.dateFormat}"${c.params.customFormat?` (${c.params.customFormat})`:""}`,c.type==="format"&&((C=c.params)==null?void 0:C.pattern)&&`Format using pattern "${c.params.pattern}"`,c.type==="extract"&&((D=c.params)==null?void 0:D.pattern)&&`Extract using pattern "${c.params.pattern}"`,c.type==="replace"&&((T=c.params)==null?void 0:T.from)&&((z=c.params)==null?void 0:z.to)&&`Replace "${c.params.from}" with "${c.params.to}"`]})]},m)})})]}),t.targetField&&e.jsxs(y,{sx:{mt:2,p:1,borderRadius:1,display:"flex",alignItems:"center",backgroundColor:l.some(c=>c.transformedValue===void 0||c.transformedValue===null)?he(n.palette.warning.light,.1):he(n.palette.success.light,.1)},children:[l.some(c=>c.transformedValue===void 0||c.transformedValue===null)?e.jsx(Ct,{color:"warning",sx:{mr:1}}):e.jsx(Pr,{color:"success",sx:{mr:1}}),e.jsx(x,{variant:"body2",children:l.some(c=>c.transformedValue===void 0||c.transformedValue===null)?"Some values could not be transformed. Consider adding a default value.":"All sample values were successfully transformed."})]})]})},fo=fe(({className:t,...r})=>e.jsx(We,{...r,classes:{popper:t}}))(()=>({"& .MuiTooltip-tooltip":{backgroundColor:"transparent",padding:0,maxWidth:320}})),mo=fe(me)(({theme:t})=>({padding:t.spacing(2),backgroundColor:t.palette.background.paper,boxShadow:t.shadows[3],borderRadius:t.shape.borderRadius,border:`1px solid ${t.palette.divider}`,minWidth:200,maxWidth:320})),go=fe(x)(({theme:t})=>({fontWeight:600,marginBottom:t.spacing(1),borderBottom:`1px solid ${t.palette.divider}`,paddingBottom:t.spacing(.5),color:t.palette.primary.main})),et=({title:t,children:r,content:s,icon:n=!1,placement:l="top",enterDelay:i=100,leaveDelay:c=100})=>{console.log(`EnhancedTooltip rendering: ${t} with icon=${n}`);const m=n?e.jsxs(y,{sx:{display:"inline-flex",alignItems:"center"},children:[r,e.jsx(eo,{color:"action",fontSize:"small",sx:{ml:.5,opacity:.7}})]}):r;return e.jsx(fo,{title:e.jsxs(mo,{children:[e.jsx(go,{variant:"subtitle2",children:t}),s]}),placement:l,arrow:!0,enterDelay:i,leaveDelay:c,children:m})},xo=({toolConfig:t,showAllFields:r,setShowAllFields:s,filter:n,setFilter:l,mappings:i,onMappingChange:c,onRemoveMapping:m,validationErrors:p,sampleData:d,sourceColumns:u=[]})=>{const g=Ht();console.log("TargetFieldsPanel received sourceColumns:",u),console.log("TargetFieldsPanel received toolConfig:",t),console.log("TargetFieldsPanel received mappings:",i);const[v,C]=E.useState(null),[D,T]=E.useState(null),[z,w]=E.useState({Timing:!0,Location:!0,"Incident Details":!0}),V=E.useMemo(()=>{const f={};return p.forEach(k=>{f[k.field]={message:k.message,severity:k.severity}}),f},[p]),M=E.useMemo(()=>{const f={};return i.forEach(k=>{f[k.targetField]=k.sourceField}),f},[i]),F=E.useMemo(()=>{const f={};return[...t.requiredFields,...t.optionalFields].forEach($=>{let B;$.dataType==="date"||$.name.toLowerCase().includes("time")||$.name.toLowerCase().includes("date")?B="Timing":$.dataType==="location"||$.name.toLowerCase().includes("lat")||$.name.toLowerCase().includes("lon")||$.name.toLowerCase().includes("address")?B="Location":B="Incident Details",f[B]||(f[B]=[]),f[B].push($)}),f},[t]),U=E.useMemo(()=>{if(!n)return r?[...t.requiredFields,...t.optionalFields]:F;const f=n.toLowerCase(),$=[...t.requiredFields,...t.optionalFields].filter(I=>{var j;return I.name.toLowerCase().includes(f)||((j=I.description)==null?void 0:j.toLowerCase().includes(f))});if(r)return $;const B={};return $.forEach(I=>{let j;for(const[A,K]of Object.entries(F))if(K.some(J=>J.id===I.id)){j=A;break}j||(j="Other"),B[j]||(B[j]=[]),B[j].push(I)}),B},[t,n,r,F]),Y=f=>{w({...z,[f]:!z[f]})},H=(f,k)=>{console.log("Dropdown selection - mapping",k,"to",f);try{if(!k){m(f);return}c({sourceField:k,targetField:f}),console.log("Mapping updated via dropdown successfully")}catch($){console.error("Error updating mapping via dropdown:",$)}},o=f=>{C(f)},a=()=>{C(null)},h=f=>{T(k=>k===f?null:f)},R=(f,k)=>{const $=i.find(B=>B.targetField===f);$&&c({...$,transformations:k}),C(null)},N=f=>{switch(f){case"string":return{icon:e.jsx(Zt,{fontSize:"small"}),color:"info"};case"number":return{icon:e.jsx(to,{fontSize:"small"}),color:"secondary"};case"date":return{icon:e.jsx(Jn,{fontSize:"small"}),color:"warning"};case"boolean":return{icon:e.jsx(Kn,{fontSize:"small"}),color:"success"};case"location":return{icon:e.jsx(gs,{fontSize:"small"}),color:"error"};default:return{icon:e.jsx(Zt,{fontSize:"small"}),color:"default"}}},W=f=>{const k=M[f.id],$=V[f.id],B=D===f.id;console.log(` FIELD RENDER: ${f.name} (ID: ${f.id}), mapped to: ${k||"none"}`);const I=L=>{L.preventDefault(),L.stopPropagation(),L.dataTransfer.dropEffect="move";const b=L.currentTarget;b.style.boxShadow="0 0 0 2px #1976d2",b.style.borderColor="#1976d2",b.style.backgroundColor="#f0f7ff",b.style.transform="scale(1.01)",b.style.transition="all 0.2s ease",console.log("DRAG OVER on target field:",f.name)},j=L=>{L.preventDefault(),L.stopPropagation();const b=L.currentTarget;b.style.boxShadow="",b.style.borderColor=$?$.severity==="error"?"#f44336":"#ff9800":k?"#4caf50":"#e0e0e0",b.style.backgroundColor=$?$.severity==="error"?"#fff5f5":"#fffbf0":k?"#f4fbf4":"#ffffff",b.style.transform="",console.log("DRAG LEAVE from field:",f.name)},A=L=>{L.preventDefault(),L.stopPropagation(),console.log("DROP EVENT TRIGGERED on field:",f.name);try{const b=L.dataTransfer.getData("text/plain");if(console.log("Dropped source field data:",b),!b){console.error("No source field data found in the drop event");return}const P=L.currentTarget;P.style.boxShadow="",P.style.borderColor="",P.style.backgroundColor="",P.style.transform="",c({sourceField:b,targetField:f.id}),T(f.id),P.style.boxShadow="0 0 0 2px #4caf50",P.style.borderColor="#4caf50",P.style.backgroundColor="#f4fbf4",P.style.transform="scale(1.02)";const X=b;setTimeout(()=>{try{X?(P.style.borderColor="#4caf50",P.style.backgroundColor="#f4fbf4"):(P.style.borderColor=$?$.severity==="error"?"#f44336":"#ff9800":"#e0e0e0",P.style.backgroundColor=$?$.severity==="error"?"#fff5f5":"#fffbf0":"#ffffff"),P.style.boxShadow="",P.style.transform=""}catch(ee){console.error("Error in animation cleanup:",ee)}},1e3),console.log(`Successfully dropped ${b} onto ${f.name}`)}catch(b){console.error("Error in drop handler:",b)}},K=()=>{k&&h(f.name)},J=()=>e.jsxs(y,{children:[e.jsxs(x,{variant:"body2",children:[e.jsx("strong",{children:"Required Format:"})," ",f.format||"No specific format required"]}),f.examples&&e.jsxs(y,{sx:{mt:1},children:[e.jsx(x,{variant:"body2",children:e.jsx("strong",{children:"Examples:"})}),e.jsx(y,{component:"ul",sx:{mt:.5,pl:2},children:f.examples.map((L,b)=>e.jsx(y,{component:"li",children:e.jsx(x,{variant:"body2",fontFamily:"monospace",children:L})},b))})]}),f.validation&&e.jsxs(x,{variant:"body2",sx:{mt:1},children:[e.jsx("strong",{children:"Validation:"})," ",String(f.validation)]})]}),O=()=>{let L="";switch(f.dataType){case"string":L="Text value. Can contain any characters.";break;case"number":L="Numeric value. Can be integer or decimal.";break;case"date":L="Date value. Should be in a standard format.";break;case"boolean":L="True/False value.";break;case"location":L="Geographic coordinates or address.";break;default:L=`${f.dataType} data type.`}return e.jsxs(y,{children:[e.jsx(x,{variant:"body2",children:L}),f.dataType==="date"&&e.jsx(x,{variant:"body2",sx:{mt:1},children:"Common formats: YYYY-MM-DD, MM/DD/YYYY"})]})};return e.jsxs(y,{sx:{p:2,mb:2,border:"1px solid",borderColor:$?$.severity==="error"?"error.main":"warning.main":k?"success.light":"divider",borderRadius:1,bgcolor:$?$.severity==="error"?he(g.palette.error.light,.1):he(g.palette.warning.light,.1):k?he(g.palette.success.light,.1):"background.paper",position:"relative",transition:"all 0.3s ease",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",cursor:k?"pointer":"default",...B&&{boxShadow:"0 0 0 2px #1976d2",border:"1px solid #1976d2"},"&:hover":k?{boxShadow:"0 2px 4px rgba(0,0,0,0.1)",transform:"translateY(-2px)"}:{}},draggable:!1,id:`target-field-${f.id}`,"data-target-field":f.id,onDragOver:I,onDragLeave:j,onDrop:A,onClick:K,children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(y,{children:[e.jsx(et,{title:`${f.name} Field`,content:J(),placement:"top-start",icon:!0,children:e.jsxs(x,{variant:"subtitle2",component:"div",sx:{display:"inline-flex",alignItems:"center",cursor:"help"},children:[f.name,f.isRequired&&e.jsx(ce,{size:"small",label:"Required",color:"primary",sx:{ml:1,height:20}}),k&&e.jsx(ce,{size:"small",label:"Click to preview",color:"info",variant:"outlined",sx:{ml:1,height:20,display:{xs:"none",sm:"flex"},animation:B?"none":"pulse 1.5s infinite","@keyframes pulse":{"0%":{boxShadow:"0 0 0 0 rgba(33, 150, 243, 0.4)"},"70%":{boxShadow:"0 0 0 6px rgba(33, 150, 243, 0)"},"100%":{boxShadow:"0 0 0 0 rgba(33, 150, 243, 0)"}}}})]})}),f.dataType&&e.jsx(et,{title:`${f.dataType} Data Type`,content:O(),children:e.jsx(ce,{size:"small",label:f.dataType,color:N(f.dataType).color,variant:"outlined",icon:N(f.dataType).icon,sx:{mt:1,mr:1,height:20}})}),e.jsx(x,{variant:"body2",color:"text.secondary",children:f.description})]}),e.jsxs(y,{sx:{display:"flex",alignItems:"flex-start"},children:[$&&e.jsx(et,{title:"Validation Issue",content:e.jsx(x,{variant:"body2",children:$.message}),type:$.severity==="error"?"warning":"info",children:e.jsx(y,{sx:{display:"flex",alignItems:"center",mr:1},children:$.severity==="error"?e.jsx(Nr,{color:"error",fontSize:"small"}):e.jsx(wr,{color:"warning",fontSize:"small"})})}),k&&e.jsxs(e.Fragment,{children:[e.jsx(et,{title:"Edit Transformations",content:e.jsx(x,{variant:"body2",children:"Configure data transformations for this field mapping. Apply operations like splitting, joining, formatting and type conversion."}),children:e.jsx(Fe,{size:"small",onClick:L=>{L.stopPropagation(),o(f.id)},sx:{mr:1},children:e.jsx(Fr,{fontSize:"small"})})}),e.jsx(et,{title:"Remove Mapping",content:e.jsx(x,{variant:"body2",children:"Remove the current mapping between source and target fields."}),type:"warning",children:e.jsx(Fe,{size:"small",onClick:L=>{L.stopPropagation(),m(f.id)},children:e.jsx(ut,{fontSize:"small"})})})]})]})]}),e.jsxs(qe,{fullWidth:!0,size:"small",children:[e.jsx(Ke,{id:`${f.id}-source-label`,children:"Select source field"}),e.jsxs(Xe,{labelId:`${f.id}-source-label`,id:`${f.id}-source-select`,value:k||"",label:"Select source field",onChange:L=>{try{H(f.id,L.target.value),L.target.value?T(f.name):D===f.name&&T(null)}catch(b){console.error("Error in dropdown change handler:",b)}},MenuProps:{anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{elevation:4,style:{maxHeight:300}}}},renderValue:L=>L||e.jsx("em",{style:{color:"rgba(0, 0, 0, 0.54)"},children:"Select field or drag from left"}),endAdornment:k&&e.jsx(_e,{position:"end",children:e.jsx(et,{title:"Field is Mapped",content:e.jsxs(x,{variant:"body2",children:['This field is mapped to source field "',k,'". Click the field to preview the mapping.']}),children:e.jsx(rt,{color:"success",fontSize:"small"})})}),onClick:L=>L.stopPropagation(),children:[e.jsx(ie,{value:"",children:e.jsx("em",{style:{color:"rgba(0, 0, 0, 0.54)"},children:"Select field or drag from left"})}),Array.isArray(u)&&u.length>0?u.map(L=>{const b=d&&d.length>0?d[0][L]:void 0;let P="Unknown";b!=null&&(typeof b=="string"?[/^\d{4}-\d{2}-\d{2}$/,/^\d{1,2}\/\d{1,2}\/\d{2,4}$/].some(ne=>ne.test(b))?P="Date":/^\d{1,2}:\d{2}(:\d{2})?(\s*(AM|PM))?$/i.test(b)?P="Time":isNaN(Number(b))?P="Text":P="Number":P=typeof b);const X=ee=>ee==null?"":typeof ee=="object"?JSON.stringify(ee).substring(0,30):String(ee).substring(0,30);return e.jsx(ie,{value:L,children:e.jsxs(y,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsx(x,{variant:"body2",children:L}),b!==void 0&&e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsx(x,{variant:"caption",sx:{fontFamily:"monospace",bgcolor:"grey.100",px:.5,borderRadius:.5,maxWidth:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"text.secondary"},children:X(b)}),e.jsx(ce,{label:P,size:"small",sx:{height:16,fontSize:"0.65rem","& .MuiChip-label":{px:.5,py:0}}})]})]})},L)}):e.jsx(ie,{disabled:!0,children:e.jsx("em",{children:"No source fields available"})})]})]})]},f.id)},G=()=>{if(r){const f=Array.isArray(U)?U:Object.values(U).flat();return e.jsx(y,{children:f.map(W)})}else return Object.entries(U).map(([f,k])=>e.jsxs(Sr,{expanded:z[f]||!1,onChange:()=>Y(f),sx:{mb:2},children:[e.jsxs(Cr,{expandIcon:e.jsx(wt,{}),children:[e.jsx(x,{variant:"subtitle1",children:f}),e.jsxs(x,{variant:"body2",color:"text.secondary",sx:{ml:2},children:[k.length," fields"]})]}),e.jsx(Tr,{children:k.map(W)})]},f))},[se,_]=E.useState(!1),S=E.useMemo(()=>t.requiredFields.filter(k=>!i.some($=>$.targetField===k.name)),[t.requiredFields,i]),q=f=>{console.log("Received default mappings:",f),f.forEach(k=>{console.log("Adding default mapping for:",k.targetField,k),c(k)}),console.log("Current mappings after adding defaults:",i)};return e.jsxs(me,{sx:{p:2,height:"100%",display:"flex",flexDirection:"column",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",border:"2px solid #e0e0e0",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[S.length>0&&e.jsxs(Q,{variant:"outlined",size:"small",startIcon:e.jsx(ts,{}),onClick:()=>_(!0),color:"primary",children:["Set Default Values (",S.length,")"]}),e.jsx(tt,{control:e.jsx(rs,{checked:r,onChange:f=>s(f.target.checked),size:"small"}),label:"Show all fields A-Z"})]}),S.length>0&&e.jsxs(ue,{severity:"warning",sx:{mb:2},action:e.jsx(Q,{color:"inherit",size:"small",onClick:()=>_(!0),children:"Set Defaults"}),children:[S.length," required ",S.length===1?"field":"fields"," not mapped. Please map or set default values to continue."]}),e.jsx(Ce,{size:"small",placeholder:"Search target fields...",value:n,onChange:f=>l(f.target.value),fullWidth:!0,sx:{mb:2},InputProps:{startAdornment:e.jsx(_e,{position:"start",children:e.jsx(pt,{fontSize:"small"})})}}),e.jsx(be,{sx:{mb:2}}),e.jsx(y,{sx:{mb:2,p:1,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1,border:"1px dashed",borderColor:"primary.main"},children:e.jsx(x,{variant:"body2",color:"primary",sx:{fontWeight:"bold"},children:"Drop source fields onto target fields or use the drop-down menus below"})}),D&&e.jsx(ho,{mapping:i.find(f=>f.targetField===D)||null,sampleData:d,onClose:()=>T(null)}),e.jsx(y,{sx:{flexGrow:1,maxHeight:"calc(100% - 220px)",overflow:"auto",scrollbarWidth:"thin",border:"1px solid #e0e0e0",borderRadius:"4px",padding:"8px",backgroundColor:"#fafafa","&::-webkit-scrollbar":{width:"10px"},"&::-webkit-scrollbar-track":{background:"#f1f1f1",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{background:"#2196f3",borderRadius:"4px","&:hover":{background:"#1976d2"}}},children:G()}),v&&e.jsx(co,{open:!!v,onClose:a,fieldName:v,mapping:i.find(f=>f.targetField===v),sampleData:d,onSave:R}),e.jsx(po,{open:se,onClose:()=>_(!1),unmappedRequiredFields:S,onAddDefaultMappings:q})]})},yo=({validationErrors:t,jumpToField:r})=>{const[s,n]=st.useState(!1),l=t.filter(m=>m.severity==="error").length,i=t.filter(m=>m.severity==="warning").length,c=()=>{n(!s)};return e.jsxs(me,{sx:{p:2,position:"sticky",top:16},children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:c,children:[e.jsxs(x,{variant:"h6",color:l>0?"error":"warning",children:["Validation Issues ",l>0?`(${l} errors, ${i} warnings)`:`(${i} warnings)`]}),e.jsx(Q,{size:"small",endIcon:s?e.jsx(vr,{}):e.jsx(wt,{}),children:s?"Collapse":"Expand"})]}),e.jsxs(Er,{in:s,children:[e.jsx(be,{sx:{my:1}}),e.jsx(y,{sx:{maxHeight:"200px",overflow:"auto"},children:e.jsx(Ze,{dense:!0,children:t.map((m,p)=>e.jsxs(Ee,{sx:{bgcolor:m.severity==="error"?"error.lightest":"warning.lightest",mb:.5,borderRadius:1},children:[e.jsx(Ve,{children:m.severity==="error"?e.jsx(Nr,{color:"error"}):e.jsx(wr,{color:"warning"})}),e.jsx(De,{primary:m.field,secondary:m.message}),e.jsx(Q,{size:"small",variant:"outlined",color:m.severity==="error"?"error":"warning",onClick:()=>r(m.field),children:"Go to Field"})]},p))})})]})]})},bo=({sampleData:t,mappings:r,toolConfig:s})=>{const n=E.useMemo(()=>t.length>0?t[0]:null,[t]),l=E.useMemo(()=>{if(!n||!r.length)return null;const p=Or([n],r);return p.length>0?p[0]:null},[n,r]);if(!n||!l)return e.jsx(y,{sx:{p:2,textAlign:"center"},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"No data available for preview. Upload a file and map fields to see a live preview."})});const i=Object.keys(n),c=Object.keys(l);console.log(" LIVE PREVIEW DEBUG: Transformed row keys:",c),console.log(" LIVE PREVIEW DEBUG: Mappings count:",r.length),console.log(" LIVE PREVIEW DEBUG: Mappings:",r.map(p=>`${p.sourceField}  ${p.targetField}`)),console.log(" LIVE PREVIEW DEBUG: Tool config available:",!!s),console.log(" LIVE PREVIEW DEBUG: Field ID  Display Name conversions incoming...");const m=p=>{if(!s)return console.log(` LIVE PREVIEW: No toolConfig for field ${p}`),p;const u=[...s.requiredFields||[],...s.optionalFields||[]].find(g=>g.id===p);return console.log(` LIVE PREVIEW: Converting field ID "${p}"  display name "${u?u.name:p}"`),u?u.name:p};return e.jsxs(y,{children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(x,{variant:"subtitle1",children:"Live Preview"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Showing all mapped fields  Scroll horizontally to see more "})]}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:2,overflowX:"auto"},children:[e.jsx(Vt,{component:me,variant:"outlined",sx:{flex:1,minWidth:"400px",maxHeight:"200px",overflowX:"auto"},children:e.jsxs(yt,{size:"small",stickyHeader:!0,children:[e.jsx(bt,{children:e.jsx(Be,{children:i.map(p=>e.jsx(Te,{sx:{minWidth:"120px",whiteSpace:"nowrap"},children:e.jsx(x,{variant:"caption",fontWeight:"bold",children:p})},p))})}),e.jsx(vt,{children:e.jsx(Be,{children:i.map(p=>e.jsx(Te,{sx:{minWidth:"120px"},children:e.jsx(x,{variant:"caption",sx:{wordBreak:"break-word"},children:n[p]!==null&&n[p]!==void 0?String(n[p]):"null"})},p))})})]})}),e.jsx(y,{sx:{display:"flex",justifyContent:"center",alignItems:"center",px:2,flexShrink:0},children:e.jsx(qn,{color:"primary"})}),e.jsx(Vt,{component:me,variant:"outlined",sx:{flex:1,minWidth:"400px",maxHeight:"200px",overflowX:"auto"},children:e.jsxs(yt,{size:"small",stickyHeader:!0,children:[e.jsx(bt,{children:e.jsx(Be,{children:c.map(p=>e.jsx(Te,{sx:{minWidth:"120px",whiteSpace:"nowrap"},children:e.jsx(x,{variant:"caption",fontWeight:"bold",children:m(p)})},p))})}),e.jsx(vt,{children:e.jsx(Be,{children:c.map(p=>e.jsx(Te,{sx:{minWidth:"120px"},children:e.jsx(x,{variant:"caption",sx:{wordBreak:"break-word"},children:l[p]!==null&&l[p]!==void 0?String(l[p]):"null"})},p))})})]})})]})]})},Br=(t,r)=>{E.useEffect(()=>{if(r)try{localStorage.setItem(`tmpl:${t.id}`,JSON.stringify(t)),console.log(`Template "${t.name}" saved to localStorage`)}catch(u){console.error("Failed to save template to localStorage:",u)}},[t,r]);const s=u=>{try{let C=Object.keys(localStorage).filter(D=>D.startsWith("tmpl:")).map(D=>{const T=localStorage.getItem(D);return T?JSON.parse(T):null}).filter(Boolean);return u&&(C=C.filter(D=>D.toolId===u)),C.sort((D,T)=>T.lastModified-D.lastModified)}catch(g){return console.error("Failed to load templates from localStorage:",g),[]}},n=u=>{try{return localStorage.removeItem(`tmpl:${u}`),!0}catch(g){return console.error("Failed to delete template:",g),!1}};return{loadTemplates:s,deleteTemplate:n,saveToServer:async()=>(console.log("Saving template to server:",t),new Promise(u=>{setTimeout(()=>{console.log("Template saved to server successfully"),u()},500)})),loadFromServer:async()=>s(),autoSaveTemplate:(u,g)=>{if(!u||u.length===0)return;const v={id:`auto-${g}-${Date.now()}`,name:`Auto-saved ${g} mapping`,description:"Automatically saved field mapping configuration",toolId:g,mappings:u,lastModified:Date.now()};try{localStorage.setItem(`tmpl:${v.id}`,JSON.stringify(v)),console.log("Template auto-saved:",v.name)}catch(C){console.error("Failed to auto-save template:",C)}},getTemplateStats:()=>{var v;const u=s(),g={total:u.length,byTool:{},mostRecent:((v=u[0])==null?void 0:v.lastModified)||0,totalMappings:u.reduce((C,D)=>{var T;return C+(((T=D.mappings)==null?void 0:T.length)||0)},0)};return u.forEach(C=>{const D=C.toolId||"unknown";g.byTool[D]=(g.byTool[D]||0)+1}),g},findSimilarTemplates:(u,g)=>{if(!u||u.length===0)return[];const v=s(g),C=new Set(u.map(D=>D.sourceField.toLowerCase()));return v.map(D=>{const T=new Set(D.mappings.map(V=>V.sourceField.toLowerCase())),w=new Set([...C].filter(V=>T.has(V))).size/Math.max(C.size,T.size);return{template:D,similarity:w}}).filter(({similarity:D})=>D>.3).sort((D,T)=>T.similarity-D.similarity).map(({template:D})=>D)},cleanupAutoSaved:()=>{try{s().filter(v=>v.name.startsWith("Auto-saved")).sort((v,C)=>C.lastModified-v.lastModified).slice(5).forEach(v=>{n(v.id)})}catch(u){console.error("Failed to cleanup auto-saved templates:",u)}}}},vo=({currentTemplate:t,setCurrentTemplate:r,setTemplateDirty:s,onTemplateApplied:n,disabled:l=!1})=>{const[i,c]=E.useState(null),[m,p]=E.useState(!1),[d,u]=E.useState(!1),[g,v]=E.useState(t.name),[C,D]=E.useState(t.description||""),[T,z]=E.useState([]),{loadTemplates:w,deleteTemplate:V,saveToServer:M}=Br(t,!1);E.useEffect(()=>{const S=w();z(S)},[]);const F=S=>{c(S.currentTarget)},U=()=>{c(null)},Y=()=>{const S=t.name==="Untitled Mapping"?_():t.name;v(S),D(t.description||""),p(!0),U()},H=()=>{const S=w();z(S),u(!0),U()},o=()=>{const S={...t,name:g,description:C,lastModified:Date.now()};r(S),M(),s(!1),p(!1)},a=S=>{r(S),s(!1),n&&n(S),u(!1)},h=S=>{V(S);const q=w();z(q)},R=S=>{const q={...S,id:`template-${Date.now()}`,name:`${S.name} (Copy)`,lastModified:Date.now()};localStorage.setItem(`tmpl:${q.id}`,JSON.stringify(q));const f=w();z(f)},N=S=>{const q=new Date(S),k=(new Date().getTime()-q.getTime())/(1e3*60*60);return k<24?`${Math.floor(k)} hours ago`:k<24*7?`${Math.floor(k/24)} days ago`:q.toLocaleDateString()},W=S=>{const q=S.name.toLowerCase(),f=(S.description||"").toLowerCase(),k=`${q} ${f}`;return k.includes("tyler")||k.includes("cad")?"CAD System":k.includes("monthly")||k.includes("export")?"Monthly Report":k.includes("response")||k.includes("time")?"Response Time":k.includes("fire")||k.includes("map")?"Fire Map":k.includes("test")||k.includes("sample")?"Test Data":"General"},G=S=>{switch(S){case"CAD System":return"primary";case"Monthly Report":return"success";case"Response Time":return"info";case"Fire Map":return"warning";case"Test Data":return"secondary";default:return"secondary"}},se=T.reduce((S,q)=>{const f=q.toolId||"unknown";return S[f]||(S[f]=[]),S[f].push(q),S},{}),_=()=>{const S=t.toolId||"Tool",q=new Date,f=q.toLocaleDateString("en-US",{month:"long"});if(t.mappings.length>0){const k=t.mappings.map($=>$.sourceField.toLowerCase());if(k.some($=>$.includes("tyler")))return`Tyler CAD Export - ${f} ${q.getFullYear()}`;if(k.some($=>$.includes("dispatch")||$.includes("call")))return`${S} Monthly Export - ${f}`}return`${S} Mapping Template`};return e.jsxs(e.Fragment,{children:[e.jsx(We,{title:l?"Complete field mapping to access templates":"Save and load field mapping templates",children:e.jsx("span",{children:e.jsx(Q,{variant:"outlined",size:"small",onClick:F,startIcon:e.jsx(lr,{}),disabled:l,children:"Templates"})})}),e.jsxs(fs,{anchorEl:i,open:!!i,onClose:U,children:[e.jsxs(ie,{onClick:Y,children:[e.jsx(jr,{fontSize:"small",sx:{mr:1}}),"Save Template As..."]}),e.jsxs(ie,{onClick:H,children:[e.jsx(lr,{fontSize:"small",sx:{mr:1}}),"Load Template"]})]}),e.jsxs(nt,{open:m,onClose:()=>p(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ot,{children:"Save Mapping Template"}),e.jsxs(at,{children:[e.jsx(ue,{severity:"info",sx:{mb:3},children:e.jsx(x,{variant:"body2",children:"Save this field mapping configuration for future use. Templates help you quickly map data from the same source system."})}),e.jsx(Ce,{autoFocus:!0,margin:"dense",label:"Template Name",fullWidth:!0,value:g,onChange:S=>v(S.target.value),sx:{mb:2},placeholder:"e.g., Tyler CAD Monthly Export, Fire Map Pro Standard"}),e.jsx(Ce,{margin:"dense",label:"Description (optional)",fullWidth:!0,multiline:!0,rows:2,value:C,onChange:S=>D(S.target.value),placeholder:"e.g., Standard monthly incident export from Tyler Technologies CAD system"}),e.jsx(Ft,{variant:"outlined",sx:{mt:2},children:e.jsxs(Et,{children:[e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"Template Preview"}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Tool: ",t.toolId||"Unknown"]}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Mappings: ",t.mappings.length," field mappings"]}),t.mappings.length>0&&e.jsx(y,{sx:{mt:1},children:e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Sample mappings: ",t.mappings.slice(0,3).map(S=>`${S.sourceField}  ${S.targetField}`).join(", "),t.mappings.length>3&&` +${t.mappings.length-3} more`]})})]})})]}),e.jsxs(it,{children:[e.jsx(Q,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(Q,{onClick:o,variant:"contained",children:"Save Template"})]})]}),e.jsxs(nt,{open:d,onClose:()=>u(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(ot,{children:"Load Mapping Template"}),e.jsx(at,{children:T.length===0?e.jsxs(y,{sx:{textAlign:"center",py:4},children:[e.jsx(er,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(x,{variant:"h6",gutterBottom:!0,children:"No saved templates found"}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Templates save your field mapping configurations for reuse with similar data exports."}),e.jsx(ue,{severity:"info",children:e.jsxs(x,{variant:"body2",children:[e.jsx("strong",{children:"Pro Tip:"})," After mapping fields for your CAD system, save it as a template. Next month's export will auto-map instantly!"]})})]}):e.jsxs(y,{children:[e.jsx(ue,{severity:"success",sx:{mb:2},children:e.jsxs(x,{variant:"body2",children:["Found ",T.length," saved template",T.length!==1?"s":"",". Click any template to apply its field mappings instantly."]})}),Object.entries(se).map(([S,q])=>e.jsxs(y,{sx:{mb:3},children:[e.jsxs(x,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(er,{sx:{mr:1,fontSize:20}}),S==="unknown"?"General Templates":`${S} Templates`,e.jsx(ce,{label:q.length,size:"small",sx:{ml:1}})]}),e.jsx(Ze,{children:q.map(f=>{var k;return e.jsx(st.Fragment,{children:e.jsxs(Ee,{component:"button",onClick:()=>a(f),sx:{py:2,borderRadius:1,mb:1,"&:hover":{backgroundColor:"action.hover"}},children:[e.jsx(De,{primary:e.jsxs(jt,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(x,{variant:"subtitle1",children:f.name}),e.jsx(ce,{label:W(f),size:"small",color:G(W(f)),variant:"outlined"})]}),secondary:e.jsxs(y,{sx:{mt:.5},children:[f.description&&e.jsx(x,{variant:"body2",sx:{mb:.5},children:f.description}),e.jsxs(jt,{direction:"row",spacing:2,alignItems:"center",children:[e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center"},children:[e.jsx(zr,{sx:{fontSize:12,mr:.5}}),N(f.lastModified)]}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[((k=f.mappings)==null?void 0:k.length)||0," field mappings"]})]}),f.mappings&&f.mappings.length>0&&e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:["Fields: ",f.mappings.slice(0,2).map($=>$.sourceField).join(", "),f.mappings.length>2&&` +${f.mappings.length-2} more`]})]})}),e.jsxs(zt,{children:[e.jsx(We,{title:"Duplicate template",children:e.jsx(Fe,{edge:"end",onClick:$=>{$.stopPropagation(),R(f)},sx:{mr:1},children:e.jsx(Zn,{fontSize:"small"})})}),e.jsx(We,{title:"Delete template",children:e.jsx(Fe,{edge:"end",onClick:$=>{$.stopPropagation(),h(f.id)},children:e.jsx(ut,{fontSize:"small"})})})]})]})},f.id)})})]},S))]})}),e.jsx(it,{children:e.jsx(Q,{onClick:()=>u(!1),children:"Cancel"})})]})]})},jo=(t,r)=>{if(!r)return t;const s=[...r.requiredFields,...r.optionalFields];if(s.find(i=>i.id===t))return console.log(` Field ID already correct: "${t}"`),t;const l=s.find(i=>i.name===t);return l?(console.log(` Converting display name "${t}" to field ID "${l.id}"`),l.id):(console.warn(` Unknown target field: "${t}" - keeping as-is`),t)},pr=(t,r)=>{if(!r||!t)return t;console.log(" Starting field mapping migration...");const s=t.map(n=>{const l=n.targetField,i=jo(n.targetField,r);return l!==i&&console.log(` Migrating: "${n.sourceField}"  "${l}" becomes "${n.sourceField}"  "${i}"`),{...n,targetField:i}});return console.log(" Field mapping migration complete"),s},hr=(t,r)=>{if(!r||!t)return{isConsistent:!0,issues:[]};const s=[...r.requiredFields,...r.optionalFields],n=[];return t.forEach(l=>{const i=s.some(m=>m.id===l.targetField),c=s.some(m=>m.name===l.targetField);c&&!i?n.push(`Mapping "${l.sourceField}"  "${l.targetField}" uses display name instead of field ID`):!i&&!c&&n.push(`Mapping "${l.sourceField}"  "${l.targetField}" targets unknown field`)}),{isConsistent:n.length===0,issues:n}},So=t=>{if(!t||typeof t!="string")return{city:null,state:null};const r=t.trim(),s=[/^.+\s+([A-Za-z\s]+?)\s+([A-Z]{2})\s+\d{5}(?:-\d{4})?\s*$/,/^.+\s+([A-Za-z\s]+?)\s+([A-Z]{2})\s*$/,/^.+?\s+([A-Za-z\s]{2,}?)\s+([A-Z]{2})(?:\s+\d{5}(?:-\d{4})?)?\s*$/];for(const l of s){const i=r.match(l);if(i){const c=i[1].trim(),m=i[2].trim();if(c.length>=2&&c.length<=50&&m.length===2)return{city:c,state:m}}}const n=r.match(/\s+([A-Z]{2})\s*$/);if(n){const l=n[1],i=r.match(/\s+([A-Za-z\s]+?)\s+[A-Z]{2}\s*$/);if(i){const c=i[1].trim();if(c.length>=2)return{city:c,state:l}}}return{city:null,state:null}},Co=t=>({incident_id:["incident_number","incidentnumber","incident_num","case_number","call_number","event_id","event_number","report_number"],incident_time:["call_received_time","callreceivedtime","received_time","call_time","incident_datetime","receive_time","time_received","incident_date"],arrival_time:["arrive_time","arrivetime","on_scene_time","onscenetime","scene_time","arrival_datetime","on_scene_datetime"],dispatch_time:["dispatched_time","dispatchedtime","dispatch_datetime","notification_time","notified_time"],enroute_time:["en_route_time","enroutetime","turnout_time","turnouttime","responding_time","travel_start_time"],clear_time:["cleared_time","clearedtime","clear_datetime","back_in_service_time","available_time","service_time","unit_clear_time"],latitude:["lat","y_coord","y_coordinate","gps_lat","coord_y"],longitude:["lng","lon","long","x_coord","x_coordinate","gps_lng","gps_lon","coord_x"],address:["incident_address","location","street_address","full_address","addr"],responding_unit:["unit","primary_unit","first_unit","apparatus","resource"]})[t]||[],To=()=>{const t=ft(),{sourceColumns:r,sampleData:s,selectedTool:n,mappings:l,processingStatus:i}=Je(j=>j.formatter),[c,m]=E.useState({id:`template-${Date.now()}`,name:"Untitled Mapping",toolId:(n==null?void 0:n.id)||"",mappings:l||[],lastModified:Date.now()}),[p,d]=E.useState(!1),[u,g]=E.useState([]),[v,C]=E.useState(!1),[D,T]=E.useState([]),[z,w]=E.useState({message:"",severity:"info",open:!1}),[V,M]=E.useState(""),[F,U]=E.useState(""),[Y,H]=E.useState(!1),o=n||void 0,{saveToServer:a,autoSaveTemplate:h,findSimilarTemplates:R,getTemplateStats:N,cleanupAutoSaved:W}=Br(c,p),G=N();E.useEffect(()=>{Object.keys(localStorage).filter(A=>A.startsWith("tmpl:")).forEach(A=>{var J;const K=localStorage.getItem(A);if(K)try{((J=JSON.parse(K).mappings)==null?void 0:J.some(b=>b.targetField&&b.targetField.includes(" ")))&&(console.log(` CLEARING OUTDATED TEMPLATE: ${A} (uses display names instead of field IDs)`),localStorage.removeItem(A))}catch{console.log(` CLEARING CORRUPTED TEMPLATE: ${A}`),localStorage.removeItem(A)}})},[]),E.useEffect(()=>{console.log("Redux mappings changed:",l),m(j=>{const A={...j,mappings:[...l],lastModified:Date.now()};return console.log("Updated template with Redux mappings:",A),A}),l.length>0&&d(!0)},[l]),E.useEffect(()=>{if(!o||!l||l.length===0)return;console.log(" Checking for legacy mappings that need migration...");const j=hr(l,o);if(j.isConsistent)console.log(" All mappings already use field IDs - no migration needed");else{console.log(" Legacy mappings detected - auto-migrating to field IDs"),console.log("Issues found:",j.issues);const A=pr(l,o);JSON.stringify(l)!==JSON.stringify(A)&&(console.log(" Auto-migration complete - updating mappings"),t(Ge(A)))}},[o,l==null?void 0:l.length]),E.useEffect(()=>{S()},[l,o]);const se=j=>{console.log("handleMappingChange called with:",j);try{const A=[...l],K=A.findIndex(J=>J.targetField===j.targetField);K>=0?(console.log(`Updating existing mapping for ${j.targetField}`),A[K]=j):(console.log(`Adding new mapping for ${j.targetField}`),A.push(j)),t(Ge(A)),console.log("Mapping updated successfully:",j),w({message:`Mapped ${j.sourceField} to ${j.targetField}`,severity:"success",open:!0})}catch(A){console.error("Error updating mapping:",A)}},_=j=>{console.log("handleRemoveMapping called for:",j);try{const A=l.filter(K=>K.targetField!==j);t(Ge(A)),console.log(`Mapping for ${j} removed successfully`)}catch(A){console.error("Error removing mapping:",A)}},S=()=>{if(!o)return;console.log(" FIELD MAPPING AUDIT - Current State Analysis:"),console.log("=========================================="),console.log(" Tool Configuration:"),console.log("  Required Fields:",o.requiredFields.map(O=>({id:O.id,name:O.name}))),console.log("  Optional Fields:",o.optionalFields.map(O=>({id:O.id,name:O.name}))),console.log(" Current Mappings:"),console.log("  Mappings Array:",l.map(O=>({source:O.sourceField,target:O.targetField})));const j=[...o.requiredFields,...o.optionalFields],A=l.map(O=>{const L=j.find(P=>P.id===O.targetField),b=j.find(P=>P.name===O.targetField);return{source:O.sourceField,target:O.targetField,isFieldId:!!L,isDisplayName:!!b,shouldBeFieldId:b?b.id:O.targetField}});console.log(" Mapping Analysis:"),A.forEach(O=>{console.log(`  "${O.source}"  "${O.target}"`),console.log(`    - Is Field ID: ${O.isFieldId}`),console.log(`    - Is Display Name: ${O.isDisplayName}`),O.isDisplayName&&!O.isFieldId&&console.log(`    -  PROBLEM: Should be "${O.shouldBeFieldId}" instead`)});const K=l.find(O=>O.targetField==="Call Received Date/Time");K&&(console.log(" SPECIFIC ISSUE DETECTED:"),console.log(`  Mapping: "${K.sourceField}"  "${K.targetField}"`),console.log(`  Should be: "${K.sourceField}"  "incident_time"`)),console.log("==========================================");const J=[];o.requiredFields.forEach(O=>{const L=l.find(P=>P.targetField===O.id),b=l.find(P=>P.targetField===O.name);if(console.log(`Checking required field ${O.id} (display: ${O.name})`),console.log(`  - Mapping by ID: ${L?`"${L.sourceField}"  ${L.targetField}`:"none"}`),console.log(`  - Mapping by Name: ${b?`"${b.sourceField}"  ${b.targetField}`:"none"}`),L)console.log(`   Correct mapping found for ${O.id}`);else if(b){console.log(`   Legacy mapping detected for ${O.id} - migrating from display name to field ID`);const P=l.findIndex(X=>X.targetField===O.name);if(P>=0){const X=[...l];X[P]={...X[P],targetField:O.id},console.log(`   Auto-migrated: "${O.name}"  "${O.id}"`),t(Ge(X))}}else console.log(`   No mapping found for required field ${O.id}`),J.push({field:O.id,message:`Required field ${O.name} is not mapped`,severity:"error"})}),T(J)},q=async()=>{if(!(!r||!o)){C(!0);try{console.log(" AUTO-MAPPING - Starting with systematic fix approach");const A=[...pr(c.mappings,o)],K=b=>A.some(P=>P.targetField===b),J=b=>b.toLowerCase().replace(/[\s_-]/g,""),O=[...o.requiredFields,...o.optionalFields];console.log(" AUTO-MAPPING - Available target fields:",O.map(b=>({id:b.id,name:b.name}))),console.log(" AUTO-MAPPING - Source columns:",r),console.log(" AUTO-MAPPING - Tool config details:",{toolId:o.id,requiredCount:o.requiredFields.length,optionalCount:o.optionalFields.length,totalFields:O.length,optionalFieldsList:o.optionalFields.map(b=>b.id)}),O.forEach(b=>{K(b.id)&&console.log(` Target field ${b.id} already mapped - checking for dual mapping opportunity`),console.log(` Attempting to map target field: ${b.id} (display: ${b.name})`);const P=r.find(ae=>ae.toLowerCase()===b.name.toLowerCase());if(P){A.find(de=>de.sourceField===P&&de.targetField===b.id)?console.log(` Dual mapping already exists: "${P}"  ${b.id}`):(console.log(` Exact match found: "${P}"  ${b.id}`),A.push({sourceField:P,targetField:b.id}));return}const X=J(b.name),ee=r.find(ae=>J(ae)===X);if(ee){A.find(de=>de.sourceField===ee&&de.targetField===b.id)?console.log(` Dual mapping already exists: "${ee}"  ${b.id}`):(console.log(` Normalized match found: "${ee}"  ${b.id}`),A.push({sourceField:ee,targetField:b.id}));return}const ne=J(b.id),te=r.find(ae=>J(ae)===ne);if(te){A.find(de=>de.sourceField===te&&de.targetField===b.id)?console.log(` Dual mapping already exists: "${te}"  ${b.id}`):(console.log(` Field ID match found: "${te}"  ${b.id}`),A.push({sourceField:te,targetField:b.id}));return}const re=Co(b.id);let ge;for(const ae of re)if(ge=r.find(de=>J(de)===J(ae)),ge){A.find(xe=>xe.sourceField===ge&&xe.targetField===b.id)?console.log(` Dual mapping already exists: "${ge}"  ${b.id}`):(console.log(` Field variation match found: "${ge}"  ${b.id} (via variation "${ae}")`),A.push({sourceField:ge,targetField:b.id}));return}const le=r.map(J).findIndex(ae=>ae.includes(X)||X.includes(ae));if(le>=0){console.log(` Partial match found: "${r[le]}"  ${b.id}`),A.push({sourceField:r[le],targetField:b.id});return}if((b.id==="city"||b.id==="state")&&!K(b.id)){const ae=r.find(de=>J(de).includes("address")||J(de).includes("location")||J(de).includes("addr"));if(ae&&s&&s.length>0){const de=s[0][ae];if(typeof de=="string"&&de.trim()){const xe=So(de);if(b.id==="city"&&xe.city){console.log(` Smart address parsing: Extracting city "${xe.city}" from "${ae}"`),A.push({sourceField:ae,targetField:b.id,transformations:[{type:"extract",params:{pattern:"\\s+([A-Za-z\\s]+)\\s+[A-Z]{2}\\s*$",description:"Extract city from full address"}}]});return}if(b.id==="state"&&xe.state){console.log(` Smart address parsing: Extracting state "${xe.state}" from "${ae}"`),A.push({sourceField:ae,targetField:b.id,transformations:[{type:"extract",params:{pattern:"\\s+([A-Z]{2})\\s*$",description:"Extract state from full address"}}]});return}}}}console.log(` No match found for target field: ${b.id}`)}),console.log(" AUTO-MAPPING - Final mappings:",A.map(b=>({source:b.sourceField,target:b.targetField})));const L=hr(A,o);if(L.isConsistent||console.warn(" AUTO-MAPPING - Consistency issues detected:",L.issues),t(Ge(A)),A.length>=3&&(n!=null&&n.id)&&(console.log(" AUTO-SAVING TEMPLATE: Significant mappings detected"),h(A,n.id),W()),n!=null&&n.id){const b=R(A,n.id);g(b.slice(0,3)),console.log(" TEMPLATE SUGGESTIONS:",b.length,"similar templates found")}}finally{C(!1)}}},f=async()=>{try{await a(),d(!1)}catch(j){console.error("Failed to save template:",j)}},k=()=>{t(He(0))},$=()=>{try{t(Pe("transforming")),console.log(" TRANSFORMATION DEBUG: Using Redux mappings directly for transformation"),console.log("Redux mappings:",l),console.log("currentTemplate.mappings:",c.mappings),console.log("Sample data:",s);const j=Or(s,l);console.log(" Transformed data with latest mappings:",j),t(Jr(j)),t(Pe("mapping")),t(He(2))}catch(j){console.error("Error transforming data:",j),t(Pe("error")),w({message:`Error transforming data: ${j instanceof Error?j.message:"Unknown error"}`,severity:"error",open:!0})}},B=E.useMemo(()=>{if(console.log("Checking if can proceed with validationErrors:",D),console.log("Current mappings:",l),o){const j=o.requiredFields.filter(A=>!l.some(K=>K.targetField===A.id));return console.log("Unmapped required fields:",j),j.length===0}return D.every(j=>j.severity!=="error")},[D,l,o]),I=j=>{var O;j.preventDefault();const A=j.dataTransfer.getData("text/plain");if(!A){w({message:"Drag and drop error: No source field data found",severity:"error",open:!0});return}const J=(O=j.target.closest("[data-target-field]"))==null?void 0:O.getAttribute("data-target-field");if(!J){w({message:"Drag and drop error: No target field found. Try dropping directly on a target field.",severity:"warning",open:!0});return}se({sourceField:A,targetField:J}),w({message:`Mapped ${A} to ${J}`,severity:"success",open:!0})};return r.length?o?i==="uploading"?e.jsxs(y,{sx:{p:3,textAlign:"center"},children:[e.jsx(Ye,{}),e.jsx(x,{sx:{mt:2},children:"Processing file data..."})]}):e.jsxs(y,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(x,{variant:"h5",children:["Map Fields for ",o.name]}),e.jsxs(jt,{direction:"row",spacing:1,children:[e.jsx(Q,{variant:"outlined",size:"small",startIcon:e.jsx(jr,{}),onClick:f,disabled:!p,children:"Save Template"}),e.jsx(vo,{currentTemplate:c,setCurrentTemplate:j=>{m(j),j.mappings&&j.mappings.length>0&&(t(Ge(j.mappings)),w({message:`Applied template "${j.name}" with ${j.mappings.length} field mappings`,severity:"success",open:!0}))},setTemplateDirty:d,disabled:!n||r.length===0})]})]}),u.length>0&&e.jsxs(ue,{severity:"info",sx:{mb:2},children:[e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:" Smart Template Suggestions"}),e.jsxs(x,{variant:"body2",sx:{mb:1},children:["Found ",u.length," template",u.length!==1?"s":""," with similar field patterns:"]}),e.jsx(y,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:u.map(j=>e.jsxs(Q,{variant:"outlined",size:"small",onClick:()=>{m(j),t(Ge(j.mappings)),d(!1),g([]),w({message:`Applied suggested template "${j.name}"`,severity:"success",open:!0})},sx:{textTransform:"none"},children:[j.name,e.jsxs(x,{component:"span",variant:"caption",sx:{ml:1,opacity:.7},children:["(",j.mappings.length," mappings)"]})]},j.id))})]}),G.total>0&&e.jsx(ue,{severity:"success",sx:{mb:2},children:e.jsxs(x,{variant:"body2",children:[" You have ",G.total," saved template",G.total!==1?"s":"","(",G.totalMappings," total field mappings).",G.byTool[(n==null?void 0:n.id)||""]&&e.jsxs("strong",{children:[G.byTool[(n==null?void 0:n.id)||""]," template",G.byTool[(n==null?void 0:n.id)||""]!==1?"s":""," for ",n==null?void 0:n.name]})]})}),e.jsxs(y,{sx:{display:"flex",gap:2,height:"700px",minHeight:"700px",border:"1px solid #eaeaea",borderRadius:"4px",padding:"4px"},children:[e.jsxs(y,{sx:{width:"35%",height:"100%",display:"flex",flexDirection:"column",position:"relative",borderRight:"1px solid #eaeaea",paddingRight:"8px"},children:[e.jsx(x,{variant:"h6",sx:{position:"sticky",top:0,zIndex:10,backgroundColor:"#fff",paddingBottom:"8px",borderBottom:"2px solid #1976d2",marginBottom:"8px",color:"#1976d2",fontWeight:"bold",textAlign:"center"},children:"Source Fields Panel  (Scrollable)"}),e.jsx(lo,{sourceColumns:r,filter:V,setFilter:M,mappings:l,sampleData:s,onAddParsedFields:(j,A)=>{if(console.log(" PARENT: Received parsed fields for column:",j,A),s&&s.length>0&&A.length>0){const K=s.map((J,O)=>{const L={...J};return A.forEach(b=>{if(b.data[O]!==null){const P=b.id.split("_").slice(1).join("_"),X=`${j}_parsed_${P}`;L[X]=b.data[O],console.log(` PARENT: Injecting parsed data: ${X} = "${b.data[O]}"`)}}),L});console.log(" PARENT: Updating Redux sampleData with parsed fields"),t(br(K)),w({message:`Added ${A.length} parsed fields for ${j}`,severity:"success",open:!0})}}})]}),e.jsxs(y,{sx:{width:"65%",height:"100%",display:"flex",flexDirection:"column",gap:2,overflow:"hidden",position:"relative"},onDragOver:j=>{j.target===j.currentTarget&&(j.preventDefault(),console.log("Parent container dragOver"))},onDrop:j=>{j.target===j.currentTarget&&(j.preventDefault(),I(j),console.log("Parent container drop"))},children:[e.jsx(x,{variant:"h6",sx:{position:"sticky",top:0,zIndex:10,backgroundColor:"#fff",paddingBottom:"8px",borderBottom:"2px solid #1976d2",marginBottom:"8px",color:"#1976d2",fontWeight:"bold",textAlign:"center"},children:"Target Fields Panel  (Scrollable)"}),e.jsx(xo,{toolConfig:o,showAllFields:Y,setShowAllFields:H,filter:F,setFilter:U,mappings:l,onMappingChange:se,onRemoveMapping:_,validationErrors:D,sampleData:s,sourceColumns:r}),D.length>0&&e.jsx(y,{sx:{flexShrink:0,marginTop:"auto",borderTop:"1px solid #eaeaea",paddingTop:"8px"},children:e.jsx(yo,{validationErrors:D,jumpToField:j=>{const A=document.getElementById(`target-field-${j}`);A&&(A.scrollIntoView({behavior:"smooth",block:"center"}),A.classList.add("highlight-field"),setTimeout(()=>{A.classList.remove("highlight-field")},2e3))}})})]})]}),e.jsx(me,{sx:{p:2,mt:2},children:e.jsx(bo,{sampleData:s,mappings:l,toolConfig:o})}),e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",mt:2},children:[e.jsx(Q,{variant:"outlined",startIcon:e.jsx(dt,{}),onClick:k,children:"Back"}),e.jsxs(y,{children:[e.jsx(Q,{variant:"outlined",onClick:q,disabled:v||!r.length,sx:{mr:1},children:v?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{size:20,sx:{mr:1}}),"Auto-mapping..."]}):"Auto-Map Fields"}),e.jsx(Q,{variant:"contained",endIcon:e.jsx(Yt,{}),onClick:$,disabled:!B,children:"Continue"})]})]}),e.jsx(Dr,{open:z.open,autoHideDuration:6e3,onClose:()=>w({...z,open:!1}),children:e.jsx(ue,{onClose:()=>w({...z,open:!1}),severity:z.severity,children:z.message})})]}):e.jsxs(y,{sx:{p:3,textAlign:"center"},children:[e.jsx(ue,{severity:"error",children:"No tool selected. Please select a tool first."}),e.jsx(Q,{sx:{mt:2},variant:"outlined",startIcon:e.jsx(dt,{}),onClick:k,children:"Go Back to Upload"})]}):e.jsxs(y,{sx:{p:3,textAlign:"center"},children:[e.jsx(ue,{severity:"error",children:"No source columns available. Please upload a file first."}),e.jsx(Q,{sx:{mt:2},variant:"outlined",startIcon:e.jsx(dt,{}),onClick:k,children:"Go Back to Upload"})]})},wo=({data:t,validationErrors:r,highlightedCell:s})=>{const[n,l]=E.useState(0),[i,c]=E.useState(10),[m,p]=E.useState(""),[d,u]=E.useState("");E.useEffect(()=>{if(s){const F=Math.floor(s.rowIndex/i);F!==n&&l(F)}},[s,i,n]);const g=t.length>0?Object.keys(t[0]):[],v={};r.forEach(F=>{F.rowIndex!==void 0&&(v[F.rowIndex]||(v[F.rowIndex]={}),v[F.rowIndex][F.field]||(v[F.rowIndex][F.field]=[]),v[F.rowIndex][F.field].push(F))});const C=(F,U)=>{l(U)},D=F=>{c(parseInt(F.target.value,10)),l(0)},T=F=>{p(F.target.value),l(0)},z=F=>{u(F.target.value),l(0)},w=()=>{u(""),l(0)},V=t.filter(F=>{if(!d)return!0;if(m){const U=F[m];return U!==void 0&&String(U).toLowerCase().includes(d.toLowerCase())}return Object.values(F).some(U=>U!==void 0&&String(U).toLowerCase().includes(d.toLowerCase()))}),M=V.slice(n*i,n*i+i);return t.length===0?e.jsx(y,{children:e.jsx(x,{variant:"h6",gutterBottom:!0,children:"No data available for preview"})}):e.jsxs(y,{children:[e.jsx(Kr,{styles:{"@keyframes pulse":{"0%":{opacity:.7},"100%":{opacity:1}}}}),e.jsxs(y,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(Ce,{label:"Search",value:d,onChange:z,sx:{flexGrow:1},InputProps:{startAdornment:e.jsx(_e,{position:"start",children:e.jsx(pt,{})}),endAdornment:d&&e.jsx(_e,{position:"end",children:e.jsx(Fe,{onClick:w,edge:"end",size:"small",children:e.jsx(Bt,{})})})}}),e.jsxs(qe,{sx:{minWidth:200},children:[e.jsx(Ke,{id:"filter-field-label",children:"Filter Field"}),e.jsxs(Xe,{labelId:"filter-field-label",id:"filter-field",value:m,label:"Filter Field",onChange:T,children:[e.jsx(ie,{value:"",children:"All Fields"}),g.map(F=>e.jsx(ie,{value:F,children:F},F))]})]})]}),e.jsxs(me,{sx:{width:"100%",mb:2},children:[e.jsx(Vt,{sx:{maxHeight:500},children:e.jsxs(yt,{stickyHeader:!0,"aria-label":"data preview table",children:[e.jsx(bt,{children:e.jsxs(Be,{children:[e.jsx(Te,{children:"#"}),g.map(F=>e.jsx(Te,{children:F},F))]})}),e.jsx(vt,{children:M.map((F,U)=>{const Y=n*i+U,H=v[Y];return e.jsxs(Be,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0},backgroundColor:H?"#fff8f8":"inherit"},children:[e.jsx(Te,{children:Y+1}),g.map(o=>{const a=(H==null?void 0:H[o])||[],h=a.length>0,R=s&&s.rowIndex===Y&&s.field===o;return e.jsxs(Te,{sx:{backgroundColor:R?"#fff3e0":h?"#ffebee":"inherit",position:"relative",border:R?"2px solid #ff9800":"inherit",transition:"all 0.3s ease"},children:[F[o]!==void 0?String(F[o]):"",h&&e.jsx(y,{sx:{position:"absolute",top:0,right:0},children:e.jsx(ce,{color:"error",size:"small",label:a.length,sx:{height:16,fontSize:"0.6rem"}})}),R&&e.jsx(y,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"2px solid #ff9800",borderRadius:"4px",pointerEvents:"none",animation:"pulse 1s ease-in-out infinite alternate"}})]},o)})]},U)})})]})}),e.jsx(xs,{rowsPerPageOptions:[5,10,25,50,100],component:"div",count:V.length,rowsPerPage:i,page:n,onPageChange:C,onRowsPerPageChange:D})]})]})};class Fo{constructor(){Jt(this,"defaultFields",{})}registerField(r,s){console.log(`Registering default value for ${r}:`,s),this.defaultFields[r]=s}hasDefaultValue(r){return this.defaultFields[r]!==void 0}getDefaultValue(r){return this.defaultFields[r]}registerMappings(r){this.defaultFields={},r.forEach(s=>{if(s.sourceField==="__default__"&&s.transformations){const n=s.transformations.find(l=>l.type==="convert"&&l.params&&l.params.defaultValue!==void 0);n&&n.params.defaultValue!==void 0&&this.registerField(s.targetField,n.params.defaultValue)}}),console.log("Registered default values:",this.defaultFields)}clear(){this.defaultFields={}}}const fr=new Fo,Eo=(t,r)=>{const s=[];return t.forEach((n,l)=>{r.forEach(i=>{let c=n[i.name];const m=fr.hasDefaultValue(i.name);if((c==null||c==="")&&m&&(c=fr.getDefaultValue(i.name),console.log(`Using default value for validation of ${i.name}:`,c)),i.name==="Incident ID"){i.isRequired&&!m&&(c==null||c==="")&&s.push({rowIndex:l,field:i.name,message:`${i.name} is required`,type:"required"});return}if(i.name.includes("Time")&&typeof c=="string"){i.isRequired&&!m&&(c==null||c==="")&&s.push({rowIndex:l,field:i.name,message:`${i.name} is required`,type:"required"});return}if(i.isRequired&&!m&&(c==null||c==="")){s.push({rowIndex:l,field:i.name,message:`${i.name} is required`,type:"required"});return}if(c==null||c==="")return;const p=Do(c,i.dataType,i.name,l);if(p){s.push(p);return}i.validationRules&&i.validationRules.forEach(d=>{const u=Ro(c,d,i.name,l);u&&s.push(u)})})}),console.log("Validation completed with errors:",s),s},Do=(t,r,s,n)=>{switch(r){case"string":if(typeof t!="string")return{rowIndex:n,field:s,message:`${s} must be a string`,type:"custom"};break;case"number":if(typeof t!="number"&&(typeof t!="string"||isNaN(Number(t))))return{rowIndex:n,field:s,message:`${s} must be a number`,type:"custom"};break;case"date":if(!(typeof t=="string"||t instanceof Date))return{rowIndex:n,field:s,message:`${s} must be a date`,type:"custom"};const l=new Date(t);if(isNaN(l.getTime()))return{rowIndex:n,field:s,message:`${s} contains an invalid date format`,type:"custom"};break;case"boolean":if(typeof t!="boolean"&&t!=="true"&&t!=="false"&&t!=="0"&&t!=="1")return{rowIndex:n,field:s,message:`${s} must be a boolean value`,type:"custom"};break;case"location":if(typeof t=="string"){if(!/^-?\d+(\.\d+)?,\s*-?\d+(\.\d+)?$/.test(t))return{rowIndex:n,field:s,message:`${s} must be a valid location format (latitude,longitude)`,type:"custom"}}else if(!t.lat||!t.lng)return{rowIndex:n,field:s,message:`${s} must be a valid location object or string`,type:"custom"};break}return null},Ro=(t,r,s,n)=>{switch(r.type){case"required":break;case"min":if(typeof t=="number"||!isNaN(Number(t))){if(Number(t)<r.params.value)return{rowIndex:n,field:s,message:`${s} must be at least ${r.params.value}`,type:"min"}}else if(typeof t=="string"&&t.length<r.params.value)return{rowIndex:n,field:s,message:`${s} must be at least ${r.params.value} characters`,type:"min"};break;case"max":if(typeof t=="number"||!isNaN(Number(t))){if(Number(t)>r.params.value)return{rowIndex:n,field:s,message:`${s} must be at most ${r.params.value}`,type:"max"}}else if(typeof t=="string"&&t.length>r.params.value)return{rowIndex:n,field:s,message:`${s} must be at most ${r.params.value} characters`,type:"max"};break;case"pattern":if(typeof t=="string"&&!new RegExp(r.params.regex).test(t))return{rowIndex:n,field:s,message:r.params.message||`${s} does not match the required pattern`,type:"pattern"};break;case"oneOf":const l=r.params.values;if(!l.includes(t))return{rowIndex:n,field:s,message:`${s} must be one of: ${l.join(", ")}`,type:"oneOf"};break;case"custom":if(r.params.validateFn&&typeof r.params.validateFn=="function"&&!r.params.validateFn(t))return{rowIndex:n,field:s,message:r.params.message||`${s} is invalid`,type:"custom"};break}return null},$o=t=>{const r={total:t.length,byType:{},byField:{}};return t.forEach(s=>{r.byType[s.type]||(r.byType[s.type]=0),r.byType[s.type]++,r.byField[s.field]||(r.byField[s.field]=0),r.byField[s.field]++}),r},Pt=t=>{const{children:r,value:s,index:n,...l}=t;return e.jsx("div",{role:"tabpanel",hidden:s!==n,id:`validation-tabpanel-${n}`,"aria-labelledby":`validation-tab-${n}`,...l,children:s===n&&e.jsx(y,{sx:{p:2},children:r})})},Io=({errors:t,onJumpToError:r})=>{const[s,n]=E.useState(0),[l,i]=E.useState(""),c=$o(t),m=(g,v)=>{n(v)},p=t.filter(g=>g.field.toLowerCase().includes(l.toLowerCase())||g.message.toLowerCase().includes(l.toLowerCase())),d={};p.forEach(g=>{d[g.field]||(d[g.field]=[]),d[g.field].push(g)});const u=g=>{let v="default";switch(g){case"required":v="error";break;case"pattern":case"min":case"max":v="warning";break;case"oneOf":case"custom":v="info";break}return e.jsx(ce,{size:"small",label:g,color:v})};return e.jsxs(me,{sx:{p:0,mb:3},children:[e.jsx(y,{sx:{p:2,bgcolor:t.length>0?"#ffebee":"#e8f5e9",borderRadius:"4px 4px 0 0"},children:e.jsxs(x,{variant:"h6",component:"h3",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ct,{}),"Validation Results",e.jsx(ce,{label:`${t.length} ${t.length===1?"error":"errors"}`,color:t.length>0?"error":"success",sx:{ml:2}})]})}),e.jsx(be,{}),e.jsx(y,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Tt,{value:s,onChange:m,"aria-label":"validation tabs",children:[e.jsx(Ie,{label:"Summary",id:"validation-tab-0","aria-controls":"validation-tabpanel-0"}),e.jsx(Ie,{label:"By Field",id:"validation-tab-1","aria-controls":"validation-tabpanel-1"}),e.jsx(Ie,{label:"All Errors",id:"validation-tab-2","aria-controls":"validation-tabpanel-2"})]})}),e.jsx(Pt,{value:s,index:0,children:t.length===0?e.jsx(ue,{severity:"success",children:"No validation errors found. Your data is ready for export!"}):e.jsxs(e.Fragment,{children:[e.jsxs(ue,{severity:"warning",children:["Found ",t.length," validation ",t.length===1?"error":"errors"," that need to be addressed before export."]}),e.jsxs(y,{sx:{mt:2},children:[e.jsx(x,{variant:"subtitle1",gutterBottom:!0,children:"Error Distribution by Field"}),e.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:Object.entries(c.byField).map(([g,v])=>e.jsx(ce,{label:`${g}: ${v}`,color:"error",variant:"outlined",onClick:()=>n(1)},g))}),e.jsx(x,{variant:"subtitle1",gutterBottom:!0,children:"Error Types"}),e.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Object.entries(c.byType).map(([g,v])=>e.jsx(ce,{label:`${g}: ${v}`,color:"primary",variant:"outlined"},g))})]})]})}),e.jsxs(Pt,{value:s,index:1,children:[e.jsx(Ce,{fullWidth:!0,placeholder:"Search errors by field or message",value:l,onChange:g=>i(g.target.value),sx:{mb:2},InputProps:{startAdornment:e.jsx(_e,{position:"start",children:e.jsx(pt,{})}),endAdornment:l&&e.jsx(_e,{position:"end",children:e.jsx(Fe,{onClick:()=>i(""),edge:"end",size:"small",children:e.jsx(Bt,{})})})}}),Object.keys(d).length===0?e.jsx(ue,{severity:"info",children:"No errors match your search criteria."}):Object.entries(d).map(([g,v])=>e.jsxs(Sr,{defaultExpanded:Object.keys(d).length===1,children:[e.jsx(Cr,{expandIcon:e.jsx(wt,{}),children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(x,{children:g}),e.jsx(ce,{size:"small",label:v.length,color:"error",sx:{ml:"auto"}})]})}),e.jsx(Tr,{children:e.jsx(Ze,{dense:!0,disablePadding:!0,children:v.map((C,D)=>e.jsxs(st.Fragment,{children:[D>0&&e.jsx(be,{component:"li"}),e.jsx(Ee,{secondaryAction:C.rowIndex!==void 0&&r&&e.jsx(Q,{size:"small",variant:"outlined",onClick:()=>C.rowIndex!==void 0&&r(C.rowIndex,C.field),children:"Jump to Row"}),children:e.jsx(De,{primary:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[C.message,u(C.type)]}),secondary:C.rowIndex!==void 0?`Row ${C.rowIndex+1}`:"Global error"})})]},D))})})]},g))]}),e.jsxs(Pt,{value:s,index:2,children:[e.jsx(Ce,{fullWidth:!0,placeholder:"Search errors by field or message",value:l,onChange:g=>i(g.target.value),sx:{mb:2},InputProps:{startAdornment:e.jsx(_e,{position:"start",children:e.jsx(pt,{})}),endAdornment:l&&e.jsx(_e,{position:"end",children:e.jsx(Fe,{onClick:()=>i(""),edge:"end",size:"small",children:e.jsx(Bt,{})})})}}),e.jsx(Ze,{dense:!0,children:p.length===0?e.jsx(ue,{severity:"info",children:"No errors match your search criteria."}):p.map((g,v)=>e.jsxs(st.Fragment,{children:[v>0&&e.jsx(be,{component:"li"}),e.jsx(Ee,{secondaryAction:g.rowIndex!==void 0&&r&&e.jsx(Q,{size:"small",variant:"outlined",onClick:()=>g.rowIndex!==void 0&&r(g.rowIndex,g.field),children:"Jump to Row"}),children:e.jsx(De,{primary:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(x,{component:"span",sx:{fontWeight:500},children:[g.field,":"]}),g.message,u(g.type)]}),secondary:g.rowIndex!==void 0?`Row ${g.rowIndex+1}`:"Global error"})})]},v))})]})]})},ko=t=>{switch(t){case"string":return"Default Value";case"number":return"0";case"date":return new Date().toISOString().split("T")[0];case"boolean":return"false";case"location":return"0.0,0.0";default:return""}},Mo=({errors:t,targetFields:r,mappings:s,onAddDefaultValue:n,onJumpToMapping:l})=>{const i=Ht(),[c,m]=E.useState(!1),[p,d]=E.useState(null),[u,g]=E.useState(""),v=E.useMemo(()=>{const w={};return t.forEach(V=>{w[V.field]||(w[V.field]={errors:[],count:0}),w[V.field].errors.push(V),w[V.field].count++}),w},[t]),C=E.useMemo(()=>Object.entries(v).sort((w,V)=>V[1].count-w[1].count).map(([w,V])=>{const M=r.find(o=>o.name===w);if(!M)return null;const F=s.some(o=>o.targetField===w),U=s.some(o=>o.targetField===w&&o.sourceField==="__default__"),Y=V.errors.some(o=>o.type==="required");let H="unknown";return Y&&!F?H="map_field":Y&&!U?H="add_default":!Y&&F&&(H="fix_transformation"),{fieldName:w,fieldDef:M,errorCount:V.count,errors:V.errors,hasMapping:F,hasDefaultMapping:U,actionType:H}}).filter(Boolean),[v,r,s]),D=E.useMemo(()=>C.filter(w=>(w==null?void 0:w.actionType)==="add_default").length,[C]),T=w=>{d(w),g(ko(w.dataType)),m(!0)},z=()=>{if(!p)return;const w={sourceField:"__default__",targetField:p.name,transformations:[{type:"convert",params:{defaultValue:u,targetType:p.dataType}}]};n(w),m(!1)};return t.length===0?e.jsx(ue,{severity:"success",sx:{my:2},children:"No validation errors detected. Your data is ready for export!"}):e.jsxs(me,{sx:{p:0,my:2,borderRadius:1,border:`1px solid ${i.palette.divider}`,overflow:"hidden"},elevation:2,children:[e.jsxs(y,{sx:{p:2,bgcolor:i.palette.mode==="dark"?he(i.palette.error.dark,.2):he(i.palette.error.light,.1),borderBottom:`1px solid ${i.palette.divider}`},children:[e.jsxs(x,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ct,{color:"error"}),"Validation Solutions",e.jsx(ce,{label:`${t.length} ${t.length===1?"issue":"issues"}`,color:"error",size:"small",sx:{ml:1}})]}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:D>0?`${D} ${D===1?"issue":"issues"} can be fixed with default values.`:"Review the suggested actions to resolve validation issues."})]}),e.jsxs(Ze,{sx:{py:0},children:[D>0&&e.jsxs(Ee,{sx:{bgcolor:he(i.palette.success.light,.1),borderBottom:`1px solid ${i.palette.divider}`,"&:hover":{bgcolor:he(i.palette.success.light,.2)}},children:[e.jsx(Ve,{children:e.jsx(ht,{color:"success"})}),e.jsx(De,{primary:"Fix Required Fields with Default Values",secondary:`Add default values to ${D} unmapped required ${D===1?"field":"fields"}`}),e.jsx(zt,{children:e.jsx(Q,{variant:"outlined",color:"success",size:"small",onClick:()=>{const w=C.find(V=>(V==null?void 0:V.actionType)==="add_default");w!=null&&w.fieldDef&&T(w.fieldDef)},children:"Set Default Values"})})]}),C.map((w,V)=>{var Y;if(!w)return null;let M=e.jsx(Ct,{color:"error"}),F="error",U="";switch(w.actionType){case"map_field":M=e.jsx(Qn,{color:"info"}),F="info",U="Field requires mapping to source data";break;case"add_default":M=e.jsx(ir,{color:"success"}),F="success",U="Field requires a value, add a default";break;case"fix_transformation":M=e.jsx(Fr,{color:"warning"}),F="warning",U="Field has validation issues with current mapping";break}return e.jsxs(st.Fragment,{children:[V>0&&e.jsx(be,{}),e.jsxs(Ee,{sx:{py:1.5,"&:hover":{bgcolor:he(i.palette.primary.light,.05)}},children:[e.jsx(Ve,{children:M}),e.jsx(De,{primary:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{variant:"subtitle2",children:w.fieldName}),e.jsx(ce,{size:"small",label:`${w.errorCount} ${w.errorCount===1?"error":"errors"}`,color:"error",variant:"outlined"}),w.fieldDef&&e.jsx(ce,{size:"small",label:w.fieldDef.dataType,color:"default",variant:"outlined"})]}),secondary:e.jsxs(y,{sx:{mt:.5},children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:U}),e.jsxs(x,{variant:"caption",color:"error",sx:{display:"block",mt:.5},children:[(Y=w.errors[0])==null?void 0:Y.message,w.errors.length>1&&` (+ ${w.errors.length-1} more)`]})]})}),e.jsxs(zt,{children:[w.actionType==="add_default"&&w.fieldDef&&e.jsx(Q,{variant:"outlined",color:F,size:"small",startIcon:e.jsx(ir,{}),onClick:()=>T(w.fieldDef),children:"Add Default"}),(w.actionType==="map_field"||w.actionType==="fix_transformation")&&e.jsx(Q,{variant:"outlined",color:F,size:"small",startIcon:e.jsx(ss,{}),onClick:()=>l(w.fieldName),children:w.actionType==="map_field"?"Map Field":"Fix Mapping"})]})]})]},w.fieldName)})]}),e.jsxs(nt,{open:c,onClose:()=>m(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(ot,{children:["Set Default Value for ",p==null?void 0:p.name]}),e.jsx(at,{children:e.jsxs(y,{sx:{mt:1},children:[e.jsx(x,{variant:"body2",gutterBottom:!0,children:p==null?void 0:p.description}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(x,{variant:"caption",children:"Data Type:"}),e.jsx(ce,{size:"small",label:p==null?void 0:p.dataType,color:"primary",variant:"outlined"})]}),(p==null?void 0:p.dataType)==="boolean"?e.jsxs(Ce,{select:!0,fullWidth:!0,value:u,onChange:w=>g(w.target.value),label:"Default Value",variant:"outlined",margin:"normal",children:[e.jsx(ie,{value:"true",children:"True"}),e.jsx(ie,{value:"false",children:"False"})]}):e.jsx(Ce,{fullWidth:!0,value:u,onChange:w=>g(w.target.value),label:"Default Value",variant:"outlined",margin:"normal",type:(p==null?void 0:p.dataType)==="number"?"number":"text",helperText:`This value will be used for all records where ${p==null?void 0:p.name} is not mapped or empty`})]})}),e.jsxs(it,{children:[e.jsx(Q,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(Q,{onClick:z,variant:"contained",color:"primary",startIcon:e.jsx(ht,{}),children:"Apply Default Value"})]})]})]})},mr=t=>{const{children:r,value:s,index:n,...l}=t;return e.jsx("div",{role:"tabpanel",hidden:s!==n,id:`preview-tabpanel-${n}`,"aria-labelledby":`preview-tab-${n}`,...l,children:s===n&&e.jsx(y,{sx:{p:2},children:r})})},Ao=()=>{const t=ft(),{sourceFile:r,transformedData:s,validationErrors:n,selectedTool:l,mappings:i}=Je(F=>F.formatter),[c,m]=E.useState(0),[p,d]=E.useState(!1),[u,g]=E.useState(null),v=E.useRef(null),C=(F,U)=>{m(U)},D=()=>{t(He(1))},T=()=>{t(He(3))},z=()=>{if(!(!s||!l)){d(!0);try{const F=[...l.requiredFields,...l.optionalFields],U=Je(a=>a.formatter.mappings),Y={};U&&U.forEach(a=>{if(a.sourceField==="__default__"&&a.transformations){const h=a.transformations.find(R=>R.type==="convert"&&R.params&&R.params.defaultValue!==void 0);h&&(Y[a.targetField]=!0,console.log(`Field ${a.targetField} has default value: ${h.params.defaultValue}`))}});const H=s.map(a=>{const h={...a};return Object.keys(Y).forEach(R=>{typeof window<"u"&&window.defaultValueRegistry&&window.defaultValueRegistry.register(R,!0)}),h}),o=Eo(H,F);t(Xr(o)),o.length===0?t(Pe("complete")):t(Pe("error"))}catch(F){console.error("Validation error:",F),t(Pe("error"))}finally{d(!1)}}},w=(F,U)=>{m(0),g({rowIndex:F,field:U}),setTimeout(()=>{v.current&&v.current.scrollIntoView({behavior:"smooth"})},100),setTimeout(()=>{g(null)},3e3)},V=F=>{console.log("Adding default value mapping:",F),t(Zr(F)),setTimeout(()=>{z()},100)},M=F=>{t(He(1))};return E.useEffect(()=>{s&&s.length>0&&z()},[s]),!s||s.length===0?e.jsxs(me,{sx:{p:3,textAlign:"center"},children:[e.jsxs(ue,{severity:"warning",sx:{mb:2},children:[e.jsx(ws,{children:"No Data Available"}),"There is no transformed data to preview. Please go back to the field mapping step."]}),e.jsx(Q,{variant:"contained",startIcon:e.jsx(cr,{}),onClick:D,children:"Back to Field Mapping"})]}):e.jsxs(y,{children:[e.jsx(x,{variant:"h5",gutterBottom:!0,sx:{mb:3},children:"Preview & Validate Data"}),e.jsx(me,{sx:{p:2,mb:3},children:e.jsxs(pe,{container:!0,spacing:2,children:[e.jsx(pe,{size:{xs:12,md:6},children:e.jsxs(y,{children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Source File"}),e.jsxs(x,{variant:"body1",children:[(r==null?void 0:r.name)||"No file"," (",r==null?void 0:r.type,")"]})]})}),e.jsx(pe,{size:{xs:12,md:6},children:e.jsxs(y,{children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Records"}),e.jsxs(x,{variant:"body1",children:[s.length," records processed"]})]})}),e.jsx(pe,{size:12,children:e.jsxs(y,{children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Validation Status"}),e.jsx(y,{sx:{display:"flex",alignItems:"center",gap:1},children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{size:20}),e.jsx(x,{children:"Validating data..."})]}):n.length===0?e.jsxs(e.Fragment,{children:[e.jsx(Pr,{color:"success"}),e.jsx(x,{color:"success.main",children:"Data validation passed! Ready for export."})]}):e.jsxs(e.Fragment,{children:[e.jsx(so,{color:"error"}),e.jsxs(x,{color:"error",children:[n.length," validation ",n.length===1?"error":"errors"," found"]})]})})]})})]})}),e.jsx(y,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Tt,{value:c,onChange:C,"aria-label":"preview and validation tabs",children:[e.jsx(Ie,{label:"Data Preview",id:"preview-tab-0","aria-controls":"preview-tabpanel-0"}),e.jsx(Ie,{label:`Validation & Solutions ${n.length>0?`(${n.length})`:""}`,id:"preview-tab-1","aria-controls":"preview-tabpanel-1",sx:{color:n.length>0?"error.main":"inherit"}})]})}),e.jsx(mr,{value:c,index:0,children:e.jsx(y,{ref:v,children:e.jsx(wo,{data:s,validationErrors:n,highlightedCell:u})})}),e.jsxs(mr,{value:c,index:1,children:[n.length>0&&l&&e.jsx(Mo,{errors:n,targetFields:[...l.requiredFields,...l.optionalFields],mappings:i,onAddDefaultValue:V,onJumpToMapping:M}),e.jsx(Io,{errors:n,onJumpToError:w})]}),e.jsx(be,{sx:{my:3}}),e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Q,{variant:"outlined",startIcon:e.jsx(cr,{}),onClick:D,children:"Back to Field Mapping"}),e.jsx(Q,{variant:"contained",endIcon:e.jsx(Yt,{}),onClick:T,disabled:n.length>0,children:"Continue to Export"})]})]})},Oo=({selectedFormat:t,onFormatChange:r})=>{const s=n=>{r(n.target.value)};return e.jsx(Ft,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(Et,{children:[e.jsx(x,{variant:"h6",gutterBottom:!0,children:"Select Export Format"}),e.jsx(qe,{component:"fieldset",children:e.jsxs(Ks,{"aria-label":"export-format",name:"export-format",value:t,onChange:s,children:[e.jsxs(y,{sx:{mb:2,p:1,border:"1px solid",borderColor:t==="csv"?"primary.main":"divider",borderRadius:1,bgcolor:t==="csv"?"action.hover":"transparent"},children:[e.jsx(tt,{value:"csv",control:e.jsx(mt,{}),label:e.jsxs(y,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:1},children:[e.jsx(ys,{color:"primary"}),e.jsx(x,{variant:"body1",children:"CSV"}),e.jsx(ce,{size:"small",label:"Most Compatible",color:"success"})]})}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"Comma-separated values format, widely supported by spreadsheet applications like Excel and Google Sheets."})]}),e.jsxs(y,{sx:{mb:2,p:1,border:"1px solid",borderColor:t==="json"?"primary.main":"divider",borderRadius:1,bgcolor:t==="json"?"action.hover":"transparent"},children:[e.jsx(tt,{value:"json",control:e.jsx(mt,{}),label:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xn,{color:"info"}),e.jsx(x,{variant:"body1",children:"JSON"})]})}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"JavaScript Object Notation, ideal for programmatic use or importing into other applications."})]}),e.jsxs(y,{sx:{p:1,border:"1px solid",borderColor:t==="excel"?"primary.main":"divider",borderRadius:1,bgcolor:t==="excel"?"action.hover":"transparent"},children:[e.jsx(tt,{value:"excel",control:e.jsx(mt,{}),label:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(St,{color:"success"}),e.jsx(x,{variant:"body1",children:"Excel"})]})}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"Export directly to native Excel format (.xlsx) with proper formatting and column sizing."})]}),e.jsxs(y,{sx:{p:1,border:"1px solid",borderColor:t==="pdf"?"primary.main":"divider",borderRadius:1,bgcolor:t==="pdf"?"action.hover":"transparent"},children:[e.jsx(tt,{value:"pdf",control:e.jsx(mt,{}),label:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($r,{color:"error"}),e.jsx(x,{variant:"body1",children:"PDF"}),e.jsx(ce,{size:"small",label:"Professional",color:"secondary"})]})}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"Create a professional PDF document with formatted data table, ideal for reports and presentations."})]})]})})]})})},Lt=[{id:"fire-map-pro",name:"Fire Map Pro",description:"Professional mapping and visualization for incident locations and analysis",icon:e.jsx(tr,{fontSize:"large",sx:{color:"#dc2626"}}),requiredFields:["incidentId","latitude","longitude"],optionalFields:["incidentType","incidentDate","incidentTime","address","city","state","priority","respondingUnit","responseCategory"]},{id:"response-time-analyzer",name:"Response Time Analyzer",description:"Analyze incident response times and visualize performance metrics",icon:e.jsx(bs,{fontSize:"large",sx:{color:"#2196f3"}}),requiredFields:["incidentId","incidentDate"],optionalFields:["dispatchTime","enRouteTime","arrivalTime","latitude","longitude"]},{id:"call-density-heatmap",name:"Call Density Heatmap",description:"Visualize incident density across geographic areas",icon:e.jsx(tr,{fontSize:"large",sx:{color:"#ff9800"}}),requiredFields:["incidentId","latitude","longitude"]},{id:"incident-dashboard",name:"Incident Dashboard",description:"Interactive dashboard for incident analysis and reporting",icon:e.jsx(vs,{fontSize:"large",sx:{color:"#4caf50"}}),requiredFields:["incidentId","incidentType","incidentDate"]},{id:"trend-analyzer",name:"Trend Analyzer",description:"Identify incident trends and patterns over time",icon:e.jsx(ns,{fontSize:"large",sx:{color:"#9c27b0"}}),requiredFields:["incidentId","incidentDate","incidentType"]}],_o=({selectedTool:t,onToolSelect:r,transformedData:s,onSendToTool:n,isSending:l,preTransformedData:i})=>{console.log(" SEND TO TOOL PANEL RENDER - FRESH BUILD JUN 13 2025 16:48 - selectedTool:",t),console.log(" SEND TO TOOL PANEL RENDER - onSendToTool function:",!!n),console.log(" SEND TO TOOL PANEL RENDER - transformedData length:",s==null?void 0:s.length),console.log(" SEND TO TOOL PANEL RENDER - preTransformedData exists:",!!i),console.log(" SEND TO TOOL PANEL RENDER - preTransformedData length:",i==null?void 0:i.length),i&&i.length>0&&console.log(" SEND TO TOOL PANEL RENDER - preTransformedData sample:",i[0]);const c=d=>{r(d.target.value)},p=t?(d=>{const u=Lt.find(T=>T.id===d);if(!u)return{compatible:!1,missingFields:[]};if(d==="fire-map-pro")if(console.log(" FIRE MAP PRO COMPATIBILITY CHECK - ENHANCED FOR ADDRESS PARSING"),console.log("preTransformedData exists:",!!i),console.log("preTransformedData length:",i==null?void 0:i.length),console.log("transformedData sample:",s[0]),i&&i.length>0){const T=Object.keys(s[0]);console.log(" Available transformed data fields:",T);const z=u.optionalFields?u.optionalFields.filter(V=>{const M=T.includes(V);return console.log(` Fire Map Pro optional field ${V}: ${M?"AVAILABLE":"NOT AVAILABLE"}`),M}):[],w=u.optionalFields?u.optionalFields.filter(V=>!T.includes(V)):[];return console.log(" Fire Map Pro data is compatible - features exist"),console.log(" Available optional fields:",z),console.log(" Missing optional fields:",w),{compatible:!0,missingFields:[],hasOptionalFields:z,missingOptionalFields:w}}else return console.log(" Fire Map Pro data not compatible - no features"),{compatible:!1,missingFields:["incidentId","latitude","longitude"],hasOptionalFields:[],missingOptionalFields:u.optionalFields||[]};if(d==="response-time-analyzer"){console.log(" RESPONSE TIME ANALYZER COMPATIBILITY CHECK - FLEXIBLE FIELD MATCHING");const T=Object.keys(s[0]);console.log(" Available data fields:",T),console.log(" Required fields (camelCase):",u.requiredFields);const z=u.requiredFields.filter(M=>{if(T.includes(M))return console.log(` Found exact match for ${M}`),!1;const F=M.replace(/[A-Z]/g,U=>`_${U.toLowerCase()}`);return T.includes(F)?(console.log(` Found snake_case match for ${M} -> ${F}`),!1):(console.log(` No match found for ${M} (tried ${M} and ${F})`),!0)});console.log(" CHECKING OPTIONAL FIELDS:"),console.log(" Tool optional fields:",u.optionalFields);const w=u.optionalFields?u.optionalFields.filter(M=>{let F=M.replace(/[A-Z]/g,H=>`_${H.toLowerCase()}`);M==="enRouteTime"&&(F="enroute_time");const U=T.includes(M),Y=T.includes(F);return console.log(` Optional field ${M}: camelCase=${U}, snake_case(${F})=${Y}`),U||Y}):[],V=u.optionalFields?u.optionalFields.filter(M=>{let F=M.replace(/[A-Z]/g,U=>`_${U.toLowerCase()}`);return M==="enRouteTime"&&(F="enroute_time"),!T.includes(M)&&!T.includes(F)}):[];return console.log(" OPTIONAL FIELDS RESULT:"),console.log(" Has optional fields:",w),console.log(" Missing optional fields:",V),{compatible:z.length===0,missingFields:z,hasOptionalFields:w,missingOptionalFields:V}}const g=Object.keys(s[0]);console.log(` ${d.toUpperCase()} COMPATIBILITY CHECK`),console.log("Available fields:",g),console.log("Required fields:",u.requiredFields);const v=u.requiredFields.filter(T=>!g.includes(T)),C=u.optionalFields?u.optionalFields.filter(T=>g.includes(T)):[],D=u.optionalFields?u.optionalFields.filter(T=>!g.includes(T)):[];return{compatible:v.length===0,missingFields:v,hasOptionalFields:C,missingOptionalFields:D}})(t):{compatible:!1,missingFields:[]};return e.jsxs(y,{children:[e.jsx(x,{variant:"h6",gutterBottom:!0,children:"Send to FireEMS Tool"}),e.jsx(ue,{severity:"info",sx:{mb:3},children:"Send your formatted data directly to another FireEMS tool for analysis and visualization."}),e.jsxs(qe,{fullWidth:!0,sx:{mb:3},children:[e.jsx(Ke,{id:"tool-select-label",children:"Select Tool"}),e.jsxs(Xe,{labelId:"tool-select-label",id:"tool-select",value:t||"",label:"Select Tool",onChange:c,children:[e.jsx(ie,{value:"",children:e.jsx("em",{children:"Select a tool..."})}),Lt.map(d=>e.jsx(ie,{value:d.id,children:d.name},d.id))]})]}),t&&e.jsx(pe,{container:!0,spacing:3,children:Lt.filter(d=>d.id===t).map(d=>e.jsx(pe,{size:12,children:e.jsxs(Ft,{variant:"outlined",children:[e.jsxs(Et,{children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",mb:2},children:[d.icon,e.jsxs(y,{sx:{ml:2},children:[e.jsx(x,{variant:"h6",children:d.name}),e.jsx(x,{variant:"body2",color:"text.secondary",children:d.description})]})]}),e.jsx(be,{sx:{mb:2}}),e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"Required Fields:"}),e.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:d.requiredFields.map((u,g)=>e.jsx(x,{variant:"body2",sx:{backgroundColor:p.missingFields.includes(u)?"error.light":"success.light",color:p.missingFields.includes(u)?"error.contrastText":"success.contrastText",borderRadius:1,px:1,py:.5},children:u},g))}),d.optionalFields&&e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"Optional Fields:"}),e.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:d.optionalFields.map((u,g)=>{var v,C;return e.jsx(x,{variant:"body2",sx:{backgroundColor:(v=p.hasOptionalFields)!=null&&v.includes(u)?"info.light":"action.disabledBackground",color:(C=p.hasOptionalFields)!=null&&C.includes(u)?"info.contrastText":"text.secondary",borderRadius:1,px:1,py:.5},children:u},g)})})]}),!p.compatible&&e.jsxs(ue,{severity:"warning",icon:e.jsx(ro,{}),sx:{mb:2},children:[e.jsx(x,{variant:"body2",gutterBottom:!0,children:"Your data is missing required fields for this tool:"}),e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:p.missingFields.map((u,g)=>e.jsx("li",{children:u},g))})]}),p.compatible&&e.jsxs(ue,{severity:"success",sx:{mb:2},children:[e.jsx(x,{variant:"body2",gutterBottom:!0,children:"Your data is compatible with this tool. All required fields are present."}),d.optionalFields&&p.hasOptionalFields&&p.hasOptionalFields.length>0&&e.jsxs(x,{variant:"body2",children:[p.hasOptionalFields.length," of ",d.optionalFields.length," optional fields are available for enhanced analysis."]})]})]}),e.jsx(Os,{children:e.jsx(Q,{type:"button",variant:"contained",color:"primary",fullWidth:!0,disabled:!p.compatible||l,startIcon:l?e.jsx(Ye,{size:20}):e.jsx(Vr,{}),onClick:u=>{u.preventDefault(),u.stopPropagation(),console.log(" SEND TO TOOL BUTTON CLICKED - FRESH BUILD JUN 13 2025 16:49 - tool.id:",d.id),console.log(" SEND TO TOOL BUTTON - onSendToTool function:",n),n()},children:l?"Sending...":`Send to ${d.name}`})})]})},d.id))})]})},Po=({dataCount:t,fields:r,format:s})=>{const n=()=>{let i=15;s==="json"?i=25:s==="excel"?i=30:s==="pdf"&&(i=40);const c=t*r.length*i;let m=0;s==="excel"?m=5120:s==="pdf"&&(m=15360);const p=c+m;return p<1048576?`${Math.round(p/1024)} KB`:`${(p/1048576).toFixed(2)} MB`},l=()=>{switch(s){case"csv":return e.jsx(Ut,{color:"primary"});case"json":return e.jsx(Lr,{color:"info"});case"excel":return e.jsx(St,{color:"success"});case"pdf":return e.jsx($r,{color:"error"});default:return e.jsx(Ut,{})}};return e.jsx(Ft,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(Et,{children:[e.jsx(x,{variant:"h6",gutterBottom:!0,children:"Export Summary"}),e.jsxs(Ze,{disablePadding:!0,children:[e.jsxs(Ee,{children:[e.jsx(Ve,{sx:{minWidth:"40px"},children:l()}),e.jsx(De,{primary:"Format",secondary:s.toUpperCase()})]}),e.jsx(be,{component:"li"}),e.jsxs(Ee,{children:[e.jsx(Ve,{sx:{minWidth:"40px"},children:e.jsx(rt,{color:"success"})}),e.jsx(De,{primary:"Records",secondary:`${t} records will be exported`})]}),e.jsx(be,{component:"li"}),e.jsxs(Ee,{children:[e.jsx(Ve,{sx:{minWidth:"40px"},children:e.jsx(rt,{color:"success"})}),e.jsx(De,{primary:"Fields",secondary:`${r.length} fields per record`})]}),e.jsx(be,{component:"li"}),e.jsxs(Ee,{children:[e.jsx(Ve,{sx:{minWidth:"40px"},children:e.jsx(rt,{color:"success"})}),e.jsx(De,{primary:"Estimated Size",secondary:n()})]})]}),e.jsx(x,{variant:"subtitle2",sx:{mt:2},children:"Fields included:"}),e.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:r.map((i,c)=>e.jsx(ce,{label:i,size:"small"},c))})]})})};console.log(" EXPORT CONTAINER LOADED - NEW VERSION WITH UPFRONT TRANSFORMATION AT",new Date().toISOString());const Lo=t=>!t||t.length===0?t:JSON.parse(JSON.stringify(t)).map(s=>{const n={...s};return["Incident Date"].forEach(c=>{if(n[c]&&typeof n[c]=="string")try{const m=new Date(n[c]);if(isNaN(m.getTime()))n[c].includes(" ")&&(n[c]=n[c].split(" ")[0]);else{const p=(m.getMonth()+1).toString().padStart(2,"0"),d=m.getDate().toString().padStart(2,"0"),u=m.getFullYear();n[c]=`${p}/${d}/${u}`}}catch{n[c].includes(" ")&&(n[c]=n[c].split(" ")[0])}}),["Dispatch Time","En Route Time","Arrival Time","Incident Time"].forEach(c=>{if(n[c]&&typeof n[c]=="string")try{const m=new Date(n[c]);if(isNaN(m.getTime())){if(n[c].includes(" ")){const p=n[c].split(" ");p.length>1&&(n[c]=p[1])}}else{const p=m.getHours().toString().padStart(2,"0"),d=m.getMinutes().toString().padStart(2,"0"),u=m.getSeconds().toString().padStart(2,"0");n[c]=`${p}:${d}:${u}`}}catch{if(n[c].includes(" ")){const p=n[c].split(" ");p.length>1&&(n[c]=p[1])}}}),n}),gr=t=>{const{children:r,value:s,index:n,...l}=t;return e.jsx("div",{role:"tabpanel",hidden:s!==n,id:`export-tabpanel-${n}`,"aria-labelledby":`export-tab-${n}`,...l,children:s===n&&e.jsx(y,{sx:{p:2},children:r})})},No=()=>{const t=ft(),{sourceFile:r,transformedData:s,validationErrors:n}=Je(_=>_.formatter),[l,i]=E.useState(0),[c,m]=E.useState("csv"),[p,d]=E.useState(null),[u,g]=E.useState(null),[v,C]=E.useState(!1),[D,T]=E.useState({success:!1,message:"",open:!1}),[z,w]=E.useState([]),[V,M]=E.useState(!1);E.useEffect(()=>{try{const _=localStorage.getItem("fireEmsExportHistory");_&&w(JSON.parse(_))}catch(_){console.error("Error loading export history:",_)}},[]),E.useEffect(()=>{try{localStorage.setItem("fireEmsExportHistory",JSON.stringify(z))}catch(_){console.error("Error saving export history:",_)}},[z]);const F=(_,S)=>{i(S)},U=_=>{m(_)},Y=_=>{var S,q;if(console.log(" CRITICAL DEBUG: handleToolChange CALLED AT",new Date().toISOString()),console.log(" TOOL SELECTION CHANGED - TRANSFORMING DATA UPFRONT:",_),console.log(" transformedData exists:",!!s),console.log(" transformedData length:",s==null?void 0:s.length),console.log(' toolId === "response-time-analyzer":',_==="response-time-analyzer"),d(_),_==="response-time-analyzer"&&s&&s.length>0){console.log(" APPLYING RESPONSE TIME ANALYZER TRANSFORMATION - UPFRONT METHOD"),console.log("Original data sample (first record):",s[0]),console.log("Original field names:",Object.keys(s[0]));try{const f=$t.transformToResponseTimeAnalyzer(s);if(!f.success){console.error(" Data transformation failed:",f.errors),g(null);return}const k=f.data||[];console.log(" UPFRONT TRANSFORMATION SUCCESS"),console.log("Transformed data sample (first record):",k[0]),console.log("Transformed field names:",Object.keys(k[0])),console.log("incidentTime value:",(S=k[0])==null?void 0:S.incidentTime),g(k)}catch(f){console.error(" Error during upfront transformation:",f),g(null)}}else if(_==="fire-map-pro"&&s&&s.length>0){console.log(" APPLYING FIRE MAP PRO TRANSFORMATION - UPFRONT METHOD"),console.log("Original data sample (first record):",s[0]),console.log("Original field names:",Object.keys(s[0]));try{const f=$t.transformToFireMapPro(s);if(!f.success){console.error(" Fire Map Pro transformation failed:",f.errors),g(null);return}const k=((q=f.data)==null?void 0:q.features)||[];console.log(" FIRE MAP PRO UPFRONT TRANSFORMATION SUCCESS"),console.log("Transformed features count:",k.length),console.log("Sample feature:",k[0]),g(k)}catch(f){console.error(" Error during Fire Map Pro upfront transformation:",f),g(null)}}else g(null)},H=(_,S,q,f,k)=>{const $={id:`export-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,timestamp:Date.now(),format:_,recordCount:S,success:q,destination:f,fileName:k};w(B=>[$,...B].slice(0,20))},o=()=>{w([])},a=()=>{const _=new Date;return _.toLocaleDateString()+" "+_.toLocaleTimeString()},h=async()=>{if(!s||s.length===0){T({success:!1,message:"No data to export",open:!0});return}C(!0);try{const _=Lo(s);let S=`formatted_data_${Date.now()}`;if(c==="excel"){const I=await yr(()=>import("./xlsx-DkH2s96g.js"),[]),j=I.utils.json_to_sheet(_),A={},K=Object.keys(s[0]);K.forEach(O=>{A[O]=Math.max(10,O.length+2)}),s.forEach(O=>{K.forEach(L=>{const b=String(O[L]||"");A[L]=Math.min(50,Math.max(A[L],b.length+2))})}),j["!cols"]=K.map(O=>({wch:A[O]}));const J=I.utils.book_new();J.Props={Title:"FireEMS Formatted Data",Subject:"Incident Data",Author:"FireEMS Data Formatter",CreatedDate:new Date},I.utils.book_append_sheet(J,j,"Formatted Data"),S=`formatted_data_${Date.now()}.xlsx`,I.writeFile(J,S),H("Excel",_.length,!0,"File Download",S),T({success:!0,message:"Data exported successfully as EXCEL",open:!0}),C(!1);return}if(c==="pdf"){const I=new ms;I.setFontSize(18),I.text("FireEMS Formatted Data",14,22),I.setFontSize(11),I.text(`Export Date: ${a()}`,14,30),I.text(`Records: ${_.length}`,14,36);const j=Object.keys(_[0]);_.length>500&&I.text("Note: Export limited to 500 records for PDF format.",14,42);const A=_.length>500?48:42,K=30,J=10,O=10;I.setFontSize(10),I.setTextColor(0,0,0),I.setFillColor(220,220,220),j.forEach((b,P)=>{I.rect(O+P*K,A,K,J,"FD"),I.text(b,O+P*K+2,A+7)});const L=Math.min(_.length,20);for(let b=0;b<L;b++){const P=A+(b+1)*J;j.forEach((X,ee)=>{I.rect(O+ee*K,P,K,J,"S");const ne=_[b][X]||"";let te=String(ne);te.length>10&&(te=te.substring(0,8)+"..."),I.text(te,O+ee*K+2,P+7)})}I.setFontSize(8),I.text(`Generated by FireEMS Tools - ${new Date().toLocaleString()}`,I.internal.pageSize.width/2,I.internal.pageSize.height-10,{align:"center"}),S=`formatted_data_${Date.now()}.pdf`,I.save(S),H("PDF",_.length,!0,"File Download",S),T({success:!0,message:"Data exported successfully as PDF",open:!0}),C(!1);return}let q="",f="";if(c==="csv"){const I=Object.keys(_[0]);q=I.join(",")+`
`,_.forEach(j=>{const A=I.map(K=>{const J=j[K];return J==null?"":typeof J=="string"&&(J.includes(",")||J.includes('"')||J.includes(`
`))?`"${J.replace(/"/g,'""')}"`:J});q+=A.join(",")+`
`}),S=`formatted_data_${Date.now()}.csv`,f="text/csv"}else c==="json"&&(q=JSON.stringify(_,null,2),S=`formatted_data_${Date.now()}.json`,f="application/json");const k=new Blob([q],{type:f}),$=URL.createObjectURL(k),B=document.createElement("a");B.href=$,B.download=S,document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL($),H(c.toUpperCase(),_.length,!0,"File Download",S),T({success:!0,message:`Data exported successfully as ${c.toUpperCase()}`,open:!0})}catch(_){console.error("Export error:",_),T({success:!1,message:`Error exporting data: ${_ instanceof Error?_.message:"Unknown error"}`,open:!0}),H(c.toUpperCase(),s.length,!1,"File Download")}finally{C(!1)}},R=_=>({"response-time-analyzer":"Response Time Analyzer","call-density-heatmap":"Call Density Heatmap","incident-dashboard":"Incident Dashboard","trend-analyzer":"Trend Analyzer"})[_]||_,N=async()=>{var S,q;if(console.log(" CRITICAL DEBUG: handleSendToTool FUNCTION CALLED AT",new Date().toISOString()),console.log(" selectedExportTool:",p),console.log(" transformedData length:",s==null?void 0:s.length),console.log(" preTransformedData length:",u==null?void 0:u.length),console.log(" transformedData sample:",s==null?void 0:s[0]),!s||s.length===0||!p){console.log(" SEND TO TOOL FAILED - Missing data or tool selection"),console.log(" transformedData:",!!s),console.log(" transformedData.length:",s==null?void 0:s.length),console.log(" selectedExportTool:",p),T({success:!1,message:"No data or tool selected",open:!0});return}C(!0);const _=R(p);console.log(" Tool name resolved:",_);try{let f;if(console.log(' CHECKING TOOL TYPE - selectedExportTool === "response-time-analyzer":',p==="response-time-analyzer"),console.log(" CHECKING PRE-TRANSFORMED DATA AVAILABILITY:",!!u),p==="response-time-analyzer"&&u&&u.length>0)console.log(" USING PRE-TRANSFORMED DATA FROM TOOL SELECTION - NO REDUNDANT TRANSFORMATION"),console.log("Pre-transformed data sample (first record):",u[0]),console.log("Pre-transformed field names:",Object.keys(u[0])),console.log("incidentTime value:",(S=u[0])==null?void 0:S.incidentTime),f=u;else if(p==="fire-map-pro"){console.log(" APPLYING FIRE MAP PRO TRANSFORMATION");const $=$t.transformToFireMapPro(s);if(!$.success)throw console.error(" Data transformation failed:",$.errors),new Error(`Data transformation failed: ${$.errors.join(", ")}`);f=((q=$.data)==null?void 0:q.features)||[]}else console.log(" USING STANDARD DATA FORMATTING"),console.log("DEBUG - USING ALREADY TRANSFORMED DATA: Sample data fields:",s.length>0?Object.keys(s[0]):"No data"),f=s.map($=>{const B={...$};return console.log("DEBUG - USING MAPPED DATA: Record fields:",Object.keys($)),Object.keys(B).forEach(I=>{if(B[I]&&typeof B[I]=="string"&&B[I].includes(" ")){const[j,A]=B[I].split(" ");console.log(`DATETIME SPLIT: Field "${I}" = "${B[I]}" -> Date: "${j}", Time: "${A}"`),I.toLowerCase().includes("date")?(console.log(`SETTING DATE FIELD "${I}" to "${j}"`),B[I]=j):I.toLowerCase().includes("time")&&(console.log(`SETTING TIME FIELD "${I}" to "${A}"`),B[I]=A)}}),B});const k={toolId:p,toolName:_,data:f,sourceFile:r==null?void 0:r.name,timestamp:Date.now(),fields:Object.keys(f[0]),recordCount:f.length,exportVersion:"2.0"};if(f.length>0){console.log("Sample record being sent (using user-mapped fields):",f[0]);const $=f[0],B=Object.keys($);console.log("All field names (as mapped by user):",B),console.log("Field values:",$)}sessionStorage.removeItem("fireEmsExportedData"),console.log("VERIFY: Field names being stored in sessionStorage:",k.data&&k.data.length>0?Object.keys(k.data[0]):"No data"),sessionStorage.setItem("fireEmsExportedData",JSON.stringify(k)),console.log(`Data prepared for ${p}. Data size: ${f.length} records`),f.length>0&&(console.log("FIELD NAMES CHECK - Sample record being sent to session storage:"),console.log(JSON.stringify(f[0]))),H("Data Transfer",f.length,!0,_),T({success:!0,message:`Data sent to ${_} successfully!`,open:!0}),setTimeout(()=>{const I=`http://${window.location.hostname}:5006`;let j="";if(p==="fire-map-pro")j=`${window.location.origin}/app/fire-map-pro`;else if(p==="response-time-analyzer")j=`${window.location.origin}/app/response-time-analyzer`;else if(p==="call-density-heatmap")j=`${I}/call-density-heatmap`;else if(p==="incident-dashboard")j=`${I}/incident-dashboard`;else if(p==="trend-analyzer")j=`${I}/trend-analyzer`;else{console.log(`Tool ID not recognized: ${p}`);return}console.log(`Redirecting to: ${j}`),window.location.href=j},500)}catch(f){console.error("Send to tool error:",f),T({success:!1,message:`Error sending data to tool: ${f instanceof Error?f.message:"Unknown error"}`,open:!0}),H("Data Transfer",s.length,!1,_)}finally{C(!1)}},W=()=>{t(He(2))};if(!s||s.length===0)return e.jsxs(y,{children:[e.jsx(ue,{severity:"warning",sx:{mb:2},children:"No data available to export. Please go back and ensure your data is processed correctly."}),e.jsx(Q,{variant:"outlined",startIcon:e.jsx(dt,{}),onClick:W,children:"Back to Validation"})]});const G=_=>new Date(_).toLocaleString(),se=()=>z.length===0?e.jsx(y,{sx:{p:2,textAlign:"center"},children:e.jsx(x,{color:"text.secondary",children:"No export history available"})}):e.jsx(Ze,{sx:{width:"100%",bgcolor:"background.paper"},dense:!0,children:z.map(_=>e.jsxs(Ee,{secondaryAction:e.jsx(Fe,{edge:"end","aria-label":"delete",onClick:()=>{w(S=>S.filter(q=>q.id!==_.id))},children:e.jsx(ut,{fontSize:"small"})}),sx:{borderLeft:"4px solid",borderColor:_.success?"success.main":"error.main",mb:1,bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},children:[e.jsxs(Ve,{children:[_.format==="Excel"&&e.jsx(St,{color:"success"}),_.format==="CSV"&&e.jsx(Ut,{color:"primary"}),_.format==="JSON"&&e.jsx(Lr,{color:"info"}),_.format==="PDF"&&e.jsx(St,{color:"error"}),_.format==="Data Transfer"&&e.jsx(Vr,{color:"secondary"})]}),e.jsx(De,{primary:e.jsx(x,{variant:"body2",fontWeight:"medium",children:_.format==="Data Transfer"?`Sent to ${_.destination}`:`${_.format} Export${_.fileName?` - ${_.fileName}`:""}`}),secondary:e.jsxs(x,{variant:"caption",display:"block",children:[G(_.timestamp),"  ",_.recordCount," records",!_.success&&"  Failed"]})})]},_.id))});return console.log(" EXPORT CONTAINER RENDER - FRESH BUILD JUN 13 2025 16:47 - transformedData length:",s==null?void 0:s.length),console.log(" EXPORT CONTAINER RENDER - selectedExportTool:",p),console.log(" EXPORT CONTAINER RENDER - tabValue:",l),e.jsxs(y,{children:[e.jsx(x,{variant:"h5",gutterBottom:!0,sx:{mb:3},children:"Export Formatted Data"}),e.jsxs(me,{sx:{p:2,mb:3},children:[e.jsxs(pe,{container:!0,spacing:2,children:[e.jsx(pe,{size:{xs:12,md:4},children:e.jsxs(y,{children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Source File"}),e.jsxs(x,{variant:"body1",children:[(r==null?void 0:r.name)||"No file"," (",r==null?void 0:r.type,")"]})]})}),e.jsx(pe,{size:{xs:12,md:4},children:e.jsxs(y,{children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Records"}),e.jsxs(x,{variant:"body1",children:[s.length," records processed"]})]})}),e.jsx(pe,{size:{xs:12,md:4},children:e.jsxs(y,{children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Validation Status"}),e.jsx(y,{sx:{display:"flex",alignItems:"center",gap:1},children:n.length===0?e.jsxs(e.Fragment,{children:[e.jsx(rt,{color:"success"}),e.jsx(x,{color:"success.main",children:"All data is valid"})]}):e.jsx(e.Fragment,{children:e.jsxs(ue,{severity:"warning",sx:{mt:1},children:[n.length," validation issues found. Consider reviewing before export."]})})})]})})]}),e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2,pt:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(zr,{color:"action",fontSize:"small"}),e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Export History"}),z.length>0&&e.jsx(Is,{badgeContent:z.length,color:"primary",sx:{ml:1}})]}),e.jsxs(y,{children:[e.jsx(Fe,{size:"small",onClick:()=>M(!V),"aria-label":V?"Hide history":"Show history",children:V?e.jsx(vr,{}):e.jsx(wt,{})}),z.length>0&&V&&e.jsx(Q,{size:"small",startIcon:e.jsx(ut,{}),onClick:o,sx:{ml:1},children:"Clear"})]})]}),e.jsx(Er,{in:V,children:e.jsx(y,{sx:{mt:2},children:se()})})]}),e.jsx(y,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Tt,{value:l,onChange:F,"aria-label":"export options tabs",children:[e.jsx(Ie,{label:"Download File",id:"export-tab-0","aria-controls":"export-tabpanel-0"}),e.jsx(Ie,{label:"Send to Tool",id:"export-tab-1","aria-controls":"export-tabpanel-1"})]})}),e.jsx(gr,{value:l,index:0,children:e.jsxs(pe,{container:!0,spacing:3,children:[e.jsx(pe,{size:{xs:12,md:6},children:e.jsx(Oo,{selectedFormat:c,onFormatChange:U})}),e.jsx(pe,{size:{xs:12,md:6},children:e.jsx(Po,{dataCount:s.length,fields:Object.keys(s[0]),format:c})}),e.jsx(pe,{size:12,children:e.jsx(Q,{variant:"contained",color:"primary",fullWidth:!0,size:"large",onClick:h,disabled:v,startIcon:v?e.jsx(Ye,{size:20}):e.jsx(js,{}),sx:{mt:2},children:v?"Exporting...":`Download as ${c.toUpperCase()}`})})]})}),e.jsx(gr,{value:l,index:1,children:e.jsx(_o,{selectedTool:p,onToolSelect:Y,transformedData:s,onSendToTool:N,isSending:v,preTransformedData:u})}),e.jsx(be,{sx:{my:3}}),e.jsx(y,{sx:{display:"flex",justifyContent:"space-between"},children:e.jsx(Q,{variant:"outlined",startIcon:e.jsx(dt,{}),onClick:W,children:"Back to Validation"})}),e.jsx(Dr,{open:D.open,autoHideDuration:6e3,onClose:()=>T({...D,open:!1}),children:e.jsx(ue,{onClose:()=>T({...D,open:!1}),severity:D.success?"success":"error",children:D.message})})]})},zo=["Upload File","Map Fields","Preview & Validate","Export"],Yo=()=>{const{currentStep:t}=Je(n=>n.formatter),r=()=>{const n=window.location.pathname;return n.includes("fire-map-pro")?"FireEMS Fire Map Pro":n.includes("response-time-analyzer")?"FireEMS Response Time Analyzer":"FireEMS Data Formatter"};st.useEffect(()=>{const n=r();document.title=n},[]);const s=n=>{switch(n){case 0:return e.jsx(_n,{});case 1:return e.jsx(To,{});case 2:return e.jsx(Ao,{});case 3:return e.jsx(No,{});default:return e.jsx(x,{children:"Unknown step"})}};return e.jsx(Qr,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsxs(me,{elevation:3,sx:{p:3},children:[e.jsx(x,{variant:"h4",component:"h1",gutterBottom:!0,children:r()}),e.jsx(Cn,{activeStep:t,sx:{mb:4},children:zo.map(n=>e.jsx(en,{children:e.jsx(Ar,{children:n})},n))}),e.jsx(y,{sx:{mt:2},children:s(t)})]})})};export{Yo as default};
