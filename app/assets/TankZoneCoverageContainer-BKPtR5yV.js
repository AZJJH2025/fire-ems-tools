import{j as e,k as K,l as o,aN as Q,aO as ne,aP as X,aQ as Y,aR as ee,aS as re,aT as ae,B as r,aU as ie,aV as D,aW as oe,aX as le,aY as ce,aZ as de,a_ as xe,a$ as me,b0 as ue,b1 as he,b2 as pe,r as Z,b3 as ge,R as H,b4 as ve}from"./index-CBLmr-ib.js";import{S as be,A as je,a as ye,M as fe,E as ke,D as Te,b as Ce}from"./A11yProvider-5NaBLQ7s.js";import{c as te,T as t,P as k,u as Ae}from"./Typography-2C6iVcR8.js";import{L as N}from"./LocalFireDepartment-DCptVao1.js";import{h as Se,i as j,T as F,M as h,L as O,l as V,m as Ie,n as U,C as $,p as we,g as T,A as C,k as Re,f as y,D as De,E as Fe,q as Ee}from"./Settings-C4So_X2J.js";import{B as b}from"./Button-a4HCbeZC.js";import{A as Me,D as ze,S as f,a as Be}from"./Delete-Be4DDNLx.js";import{F as Le,L as Pe}from"./FilterList-Bd3LVmMO.js";import{A as We}from"./Assessment-DLSfjFV3.js";import{D as _}from"./Download-DAWgxWLe.js";import{u as Ge,F as Ze,a as Oe}from"./leaflet-BgyAKENc.js";const Ve=te(e.jsx("path",{d:"M8 5v14l11-7z"})),J=te(e.jsx("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"})),Ue=({mode:p})=>{const s=K(),d=o(Q),A=o(ne);o(X);const l=o(Y),n=o(ee),c=o(re),m=o(ae),S=(a,x)=>{s(ie(x))},M=()=>{if(d.length===0){alert("Please add at least one tank before running analysis.");return}s(he()),console.log("🔬 Starting coverage analysis for",d.length,"tanks..."),setTimeout(()=>{var x;const a={totalTanks:d.length,coveragePercentage:75+Math.random()*20,gapAreas:[{id:"gap-1",area:160934,severity:"critical",geometry:[],nearestTank:{tankId:((x=d[0])==null?void 0:x.id)||"tank-1",distance:2100,accessTime:8},riskAssessment:"high"}],redundancyAreas:[],recommendations:[{id:"rec-1",type:"new-tank",priority:"high",title:"Add Tank in Northern Coverage Gap",description:"Critical coverage gap identified in northern sector requiring additional water supply.",estimatedCost:75e3,expectedBenefit:"Reduce response time by 4 minutes for 150 properties",implementation:"Install 25,000 gallon tank with road access"}],generatedAt:new Date,analysisParameters:c};s(pe(a)),console.log("✅ Analysis complete:",a)},2e3)},u=a=>{n.selectedTanks.includes(a)?s(xe(a)):s(me(a))},z=a=>{s(ue(a))},I=()=>{const a={name:`Tank ${d.length+1}`,location:{latitude:39.8283+(Math.random()-.5)*.1,longitude:-98.5795+(Math.random()-.5)*.1},capacity:1e4+Math.floor(Math.random()*5e4),type:["municipal","private","emergency"][Math.floor(Math.random()*3)],accessRating:["excellent","good","fair"][Math.floor(Math.random()*3)],operationalStatus:"active",owner:"Sample Owner",notes:"Added via Add Tank button"};s(de(a)),console.log("🎯 Tank added:",a)},g=()=>{const a=document.createElement("input");a.type="file",a.accept=".csv",a.onchange=x=>{var R;const v=(R=x.target.files)==null?void 0:R[0];v&&(console.log("📁 CSV file selected:",v.name),alert(`CSV Import selected: ${v.name}

CSV parsing will be implemented in the next development phase.`))},a.click()},B=()=>e.jsxs(r,{sx:{p:2},children:[e.jsxs(r,{sx:{mb:2,display:"flex",gap:1},children:[e.jsx(b,{variant:"outlined",startIcon:e.jsx(Me,{}),size:"small",fullWidth:!0,onClick:I,children:"Add Tank"}),e.jsx(b,{variant:"outlined",startIcon:e.jsx(J,{}),size:"small",fullWidth:!0,onClick:g,children:"Import CSV"})]}),e.jsxs(k,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(t,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(Le,{sx:{mr:1,verticalAlign:"middle"}}),"Filters"]}),e.jsxs(F,{select:!0,size:"small",label:"Tank Type",fullWidth:!0,margin:"dense",value:n.filterCriteria.tankTypes[0]||"all",children:[e.jsx(h,{value:"all",children:"All Types"}),e.jsx(h,{value:"municipal",children:"Municipal"}),e.jsx(h,{value:"private",children:"Private"}),e.jsx(h,{value:"emergency",children:"Emergency"})]}),e.jsxs(F,{select:!0,size:"small",label:"Status",fullWidth:!0,margin:"dense",value:n.filterCriteria.operationalStatus[0]||"active",children:[e.jsx(h,{value:"active",children:"Active"}),e.jsx(h,{value:"inactive",children:"Inactive"}),e.jsx(h,{value:"maintenance",children:"Maintenance"})]}),e.jsx(t,{variant:"caption",display:"block",sx:{mt:1,mb:1},children:"Capacity Range (gallons)"}),e.jsx(be,{size:"small",value:n.filterCriteria.capacityRange,min:0,max:1e5,step:5e3,valueLabelDisplay:"auto",marks:[{value:0,label:"0"},{value:5e4,label:"50K"},{value:1e5,label:"100K"}]})]}),e.jsxs(t,{variant:"subtitle2",gutterBottom:!0,children:["Water Tanks (",A.length,")"]}),e.jsx(O,{dense:!0,children:A.map(a=>e.jsxs(V,{button:!0,selected:n.selectedTanks.includes(a.id),onClick:()=>u(a.id),sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:[e.jsx(Ie,{children:e.jsx(N,{color:a.operationalStatus==="active"?"primary":"disabled"})}),e.jsx(U,{primary:a.name,secondary:e.jsxs(r,{children:[e.jsxs(t,{variant:"caption",display:"block",children:[a.capacity.toLocaleString()," gal • ",a.type]}),e.jsx($,{size:"small",label:a.accessRating,color:a.accessRating==="excellent"?"success":"default"})]})}),e.jsx(we,{children:e.jsx(T,{size:"small",onClick:x=>{x.stopPropagation(),z(a.id)},children:e.jsx(ze,{})})})]},a.id))}),A.length===0&&e.jsx(C,{severity:"info",sx:{mt:2},children:"No tanks found. Add tanks or adjust filters."})]}),i=()=>e.jsxs(r,{sx:{p:2},children:[e.jsxs(k,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(t,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(Re,{sx:{mr:1,verticalAlign:"middle"}}),"Analysis Parameters"]}),e.jsx(F,{size:"small",label:"Max Effective Distance (ft)",fullWidth:!0,margin:"dense",type:"number",value:c.maxEffectiveDistance,onChange:a=>s(D({maxEffectiveDistance:parseInt(a.target.value)||1500}))}),e.jsx(F,{size:"small",label:"Min Flow Rate (GPM)",fullWidth:!0,margin:"dense",type:"number",value:c.minimumFlowRate,onChange:a=>s(D({minimumFlowRate:parseInt(a.target.value)||250}))}),e.jsx(y,{control:e.jsx(f,{checked:c.terrainFactor,onChange:a=>s(D({terrainFactor:a.target.checked}))}),label:"Consider Terrain"}),e.jsx(y,{control:e.jsx(f,{checked:c.seasonalFactors,onChange:a=>s(D({seasonalFactors:a.target.checked}))}),label:"Seasonal Factors"})]}),e.jsx(b,{variant:"contained",startIcon:e.jsx(Ve,{}),fullWidth:!0,size:"large",onClick:M,disabled:d.length===0||m,sx:{mb:2},children:m?"Analyzing...":"Analyze Coverage"}),m&&e.jsx(Pe,{sx:{mb:2}}),e.jsxs(k,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Display Options"}),e.jsx(y,{control:e.jsx(f,{checked:n.showCoverageZones,onChange:()=>s(oe())}),label:"Coverage Zones"}),e.jsx(y,{control:e.jsx(f,{checked:n.showGapAreas,onChange:()=>s(le())}),label:"Gap Areas"}),e.jsx(y,{control:e.jsx(f,{checked:n.showRedundancyAreas,onChange:()=>s(ce())}),label:"Redundancy Areas"})]}),l&&e.jsxs(k,{variant:"outlined",sx:{p:2},children:[e.jsxs(t,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(We,{sx:{mr:1,verticalAlign:"middle"}}),"Analysis Results"]}),e.jsxs(t,{variant:"body2",gutterBottom:!0,children:["Coverage: ",l.coveragePercentage.toFixed(1),"%"]}),e.jsxs(t,{variant:"body2",gutterBottom:!0,children:["Tanks: ",l.totalTanks]}),e.jsxs(t,{variant:"body2",gutterBottom:!0,children:["Critical Gaps: ",l.gapAreas.filter(a=>a.severity==="critical").length]}),e.jsx(b,{variant:"outlined",size:"small",startIcon:e.jsx(_,{}),fullWidth:!0,sx:{mt:1},children:"Export Report"})]})]}),L=()=>e.jsxs(r,{sx:{p:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Coverage Gaps"}),l?e.jsx(O,{dense:!0,children:l.gapAreas.map(a=>e.jsx(V,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:e.jsx(U,{primary:`Gap ${a.id}`,secondary:e.jsxs(r,{children:[e.jsxs(t,{variant:"caption",display:"block",children:["Severity: ",e.jsx($,{size:"small",label:a.severity,color:a.severity==="critical"?"error":a.severity==="high"?"warning":"default"})]}),e.jsxs(t,{variant:"caption",display:"block",children:["Area: ",(a.area/43560).toFixed(1)," acres"]})]})})},a.id))}):e.jsx(C,{severity:"info",children:"Run coverage analysis to identify gaps."})]}),w=()=>e.jsxs(r,{sx:{p:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Recommendations"}),l?e.jsx(O,{dense:!0,children:l.recommendations.map(a=>e.jsx(V,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:e.jsx(U,{primary:a.title,secondary:e.jsxs(r,{children:[e.jsx(t,{variant:"body2",gutterBottom:!0,children:a.description}),e.jsx($,{size:"small",label:a.priority,color:a.priority==="critical"?"error":a.priority==="high"?"warning":"default"}),a.estimatedCost&&e.jsxs(t,{variant:"caption",display:"block",sx:{mt:1},children:["Est. Cost: $",a.estimatedCost.toLocaleString()]})]})})},a.id))}):e.jsx(C,{severity:"info",children:"Run coverage analysis to see recommendations."})]}),P=()=>e.jsxs(r,{sx:{p:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Data Import"}),e.jsx(C,{severity:"info",sx:{mb:2},children:"Import tank locations from CSV or place manually on map."}),e.jsx(b,{variant:"outlined",startIcon:e.jsx(J,{}),fullWidth:!0,sx:{mb:2},children:"Upload Tank Data (CSV)"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"CSV should include: Name, Latitude, Longitude, Capacity, Type, Owner"}),e.jsx(De,{sx:{my:2}}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Export Data"}),e.jsx(b,{variant:"outlined",startIcon:e.jsx(_,{}),fullWidth:!0,disabled:d.length===0,children:"Export Tank Data"})]});return e.jsxs(r,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(r,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[e.jsxs(t,{variant:"h6",component:"div",sx:{display:"flex",alignItems:"center"},children:[e.jsx(N,{sx:{mr:1}}),"Tank Coverage"]}),p&&e.jsxs(t,{variant:"caption",color:"text.secondary",children:["Mode: ",p]})]}),e.jsxs(Se,{value:n.sidebarTab,onChange:S,variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(j,{label:"Tanks",value:"tanks"}),e.jsx(j,{label:"Analysis",value:"analysis"}),e.jsx(j,{label:"Gaps",value:"gaps"}),e.jsx(j,{label:"Recommendations",value:"recommendations"}),e.jsx(j,{label:"Import",value:"import"})]}),e.jsxs(r,{sx:{flexGrow:1,overflow:"auto"},children:[n.sidebarTab==="tanks"&&B(),n.sidebarTab==="analysis"&&i(),n.sidebarTab==="gaps"&&L(),n.sidebarTab==="recommendations"&&w(),n.sidebarTab==="import"&&P()]})]})},E=320,aa=({initialTanks:p=[],initialAnalysisParams:s,onAnalysisComplete:d,onTankUpdate:A,mode:l="analysis"})=>{const n=K(),c=Ae(),m=Ge(c.breakpoints.down("md"));Z.useEffect(()=>{document.title="FireEMS Tank Zone Coverage"},[]);const S=o(Q),M=o(X),u=o(Y);o(ee);const z=o(ae),I=o(ge),[g,B]=H.useState(!m),[i,L]=H.useState(!1);Z.useEffect(()=>{p.length>0&&console.log("Loading initial tanks:",p),s&&console.log("Loading initial analysis parameters:",s)},[p,s]),Z.useEffect(()=>{u&&d&&d(u)},[u,d]);const w=()=>{B(!g)},P=()=>{L(!i),i?document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()},a=()=>{const W={tanks:S,coverageZones:M,activeAnalysis:u,timestamp:new Date};localStorage.setItem("tankZoneCoverage_autosave",JSON.stringify(W)),console.log("Tank zone coverage data saved")},x=()=>{if(u){const W={analysis:u,tanks:S,exportedAt:new Date},se=new Blob([JSON.stringify(W,null,2)],{type:"application/json"}),q=URL.createObjectURL(se),G=document.createElement("a");G.href=q,G.download=`tank-coverage-analysis-${new Date().toISOString().split("T")[0]}.json`,G.click(),URL.revokeObjectURL(q)}},v=()=>{n(ve())},R={marginLeft:!m&&g?`${E}px`:0,width:!m&&g?`calc(100% - ${E}px)`:"100%",height:i?"100vh":"calc(100vh - 64px)",transition:c.transitions.create(["margin","width"],{easing:c.transitions.easing.sharp,duration:c.transitions.duration.leavingScreen})};return e.jsx(je,{children:e.jsxs(r,{sx:{display:"flex",height:"100vh",overflow:"hidden",bgcolor:"background.default",position:i?"fixed":"relative",top:i?0:"auto",left:i?0:"auto",right:i?0:"auto",bottom:i?0:"auto",zIndex:i?1300:"auto"},role:"main","aria-label":"Tank Zone Coverage Analysis Tool",children:[!i&&e.jsx(ye,{position:"fixed",sx:{zIndex:c.zIndex.drawer+1,bgcolor:"primary.main"},children:e.jsxs(Fe,{children:[e.jsx(T,{color:"inherit","aria-label":"toggle sidebar",onClick:w,edge:"start",sx:{mr:2},children:e.jsx(fe,{})}),e.jsx(N,{sx:{mr:1}}),e.jsxs(t,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:["Tank Zone Coverage Analysis",l==="planning"&&" - Planning Mode",l==="presentation"&&" - Presentation Mode"]}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(T,{color:"inherit",onClick:a,title:"Save Analysis",children:e.jsx(Be,{})}),e.jsx(T,{color:"inherit",onClick:x,title:"Export Results",disabled:!u,children:e.jsx(ke,{})}),e.jsx(T,{color:"inherit",onClick:P,title:"Toggle Fullscreen",children:i?e.jsx(Ze,{}):e.jsx(Oe,{})})]})]})}),e.jsx(Te,{variant:m?"temporary":"persistent",anchor:"left",open:g,onClose:w,sx:{width:E,flexShrink:0,"& .MuiDrawer-paper":{width:E,boxSizing:"border-box",marginTop:i?0:"64px",height:i?"100vh":"calc(100vh - 64px)",borderRight:`1px solid ${c.palette.divider}`}},ModalProps:{keepMounted:!0,disablePortal:!1,hideBackdrop:!m,disableAutoFocus:!0,disableEnforceFocus:!0,disableRestoreFocus:!0},PaperProps:{"aria-hidden":!1,role:"complementary","aria-label":"Tank Zone Coverage Tools"},children:e.jsx(Ue,{mode:l})}),e.jsxs(r,{component:"main",sx:{flexGrow:1,position:"relative",...R},children:[e.jsx(k,{elevation:0,sx:{height:"100%",width:"100%",borderRadius:0,overflow:"hidden",position:"relative",minHeight:"500px",display:"flex",flexDirection:"column","& .leaflet-container":{background:"transparent !important",outline:"none"},"& .leaflet-tile-pane":{opacity:"1 !important",visibility:"visible !important"},"& .leaflet-tile":{opacity:"1 !important",visibility:"visible !important",display:"block !important",imageRendering:"auto",transform:"translateZ(0)",backfaceVisibility:"hidden"},"& .leaflet-layer":{opacity:"1 !important",visibility:"visible !important"}},children:e.jsx(Ce,{})}),z&&e.jsx(r,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsx(t,{variant:"h6",children:"Analyzing Tank Coverage..."})})]}),e.jsx(Ee,{open:!!I,autoHideDuration:6e3,onClose:v,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(C,{onClose:v,severity:"error",sx:{width:"100%"},children:I})})]})})};export{aa as default};
