var kr=Object.defineProperty;var Er=(t,r,s)=>r in t?kr(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var Yt=(t,r,s)=>Er(t,typeof r!="symbol"?r+"":r,s);import{r as w,g as Ee,a as Ie,u as ze,j as e,s as ue,c as ve,b as Re,m as Le,d as me,e as kt,f as or,h as ce,i as Ir,_ as ir,k as dt,l as Ye,B as b,t as Ut,n as Rr,C as Qe,o as $e,p as Mr,q as _r,v as $r,w as Be,R as Ze,x as jt,y as zr,G as Lr,z as Or,A as Pr,D as Ar}from"./index-B9hRz0BL.js";import{U as Wt,D as at,C as Vr,T as Nr,A as Br,S as Hr,a as ft,b as qt,E as lr,c as cr,d as Yr,L as Ur,e as Wr}from"./Timeline-BLtu8Y4o.js";import{T as g,u as Gt,c as te,a as qr,b as Gr,d as pt,S as Jr,e as Kr,f as Xr,g as Qr,h as Zr,G as le,F as He,I as Ue,i as We,M as ae,P as he,A as pe,B as Z,D as xe,j as be,k as _e,l as ot,C as de,m as it,n as lt,o as gt,p as De,q as ct,r as es,s as Ot,t as ke,v as rt,w as dr,x as ur,E as yt,y as pr,z as hr,H as fr,J as xr,L as qe,K as Se,N as Ae,O as we,Q as ts,R as Et,U as mr,V as Jt}from"./Map-BX1ej8X2.js";import{F as rs,C as st,L as ss,T as It,a as Rt,b as Mt,c as Xe,d as Ve,e as _t,S as ns,f as $t,g as as,h as Pt,i as At,j as os,P as gr,A as is,B as ls,D as cs}from"./AccessTime-BAG9WZTd.js";const yr=t=>{const r=w.useRef({});return w.useEffect(()=>{r.current=t}),r.current};function ds(t){return Ee("MuiAlertTitle",t)}Ie("MuiAlertTitle",["root"]);const us=t=>{const{classes:r}=t;return Re({root:["root"]},ds,r)},ps=ue(g,{name:"MuiAlertTitle",slot:"Root",overridesResolver:(t,r)=>r.root})(Le(({theme:t})=>({fontWeight:t.typography.fontWeightMedium,marginTop:-2}))),hs=w.forwardRef(function(r,s){const n=ze({props:r,name:"MuiAlertTitle"}),{className:i,...u}=n,a=n,p=us(a);return e.jsx(ps,{gutterBottom:!0,component:"div",ownerState:a,ref:s,className:ve(p.root,i),...u})});function fs(t){const{badgeContent:r,invisible:s=!1,max:n=99,showZero:i=!1}=t,u=yr({badgeContent:r,max:n});let a=s;s===!1&&r===0&&!i&&(a=!0);const{badgeContent:p,max:d=n}=a?u:t,c=p&&Number(p)>d?`${d}+`:p;return{badgeContent:p,invisible:a,max:d,displayValue:c}}function xs(t){return Ee("MuiBadge",t)}const Pe=Ie("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),St=10,wt=4,ms=t=>{const{color:r,anchorOrigin:s,invisible:n,overlap:i,variant:u,classes:a={}}=t,p={root:["root"],badge:["badge",u,n&&"invisible",`anchorOrigin${me(s.vertical)}${me(s.horizontal)}`,`anchorOrigin${me(s.vertical)}${me(s.horizontal)}${me(i)}`,`overlap${me(i)}`,r!=="default"&&`color${me(r)}`]};return Re(p,xs,a)},gs=ue("span",{name:"MuiBadge",slot:"Root",overridesResolver:(t,r)=>r.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),ys=ue("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.badge,r[s.variant],r[`anchorOrigin${me(s.anchorOrigin.vertical)}${me(s.anchorOrigin.horizontal)}${me(s.overlap)}`],s.color!=="default"&&r[`color${me(s.color)}`],s.invisible&&r.invisible]}})(Le(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:St*2,lineHeight:1,padding:"0 6px",height:St*2,borderRadius:St,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen}),variants:[...Object.entries(t.palette).filter(kt(["contrastText"])).map(([r])=>({props:{color:r},style:{backgroundColor:(t.vars||t).palette[r].main,color:(t.vars||t).palette[r].contrastText}})),{props:{variant:"dot"},style:{borderRadius:wt,height:wt*2,minWidth:wt*2,padding:0}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})}}]})));function Kt(t){return{vertical:(t==null?void 0:t.vertical)??"top",horizontal:(t==null?void 0:t.horizontal)??"right"}}const bs=w.forwardRef(function(r,s){const n=ze({props:r,name:"MuiBadge"}),{anchorOrigin:i,className:u,classes:a,component:p,components:d={},componentsProps:c={},children:x,overlap:f="rectangular",color:v="default",invisible:k=!1,max:E=99,badgeContent:z,slots:N,slotProps:F,showZero:B=!1,variant:I="standard",...C}=n,{badgeContent:L,invisible:O,max:V,displayValue:l}=fs({max:E,invisible:k,badgeContent:z,showZero:B}),o=yr({anchorOrigin:Kt(i),color:v,overlap:f,variant:I,badgeContent:z}),m=O||L==null&&I!=="dot",{color:j=v,overlap:R=f,anchorOrigin:H,variant:T=I}=m?o:n,Y=Kt(H),K=T!=="dot"?l:void 0,S={...n,badgeContent:L,invisible:m,max:V,displayValue:K,showZero:B,anchorOrigin:Y,color:j,overlap:R,variant:T},$=ms(S),h=(N==null?void 0:N.root)??d.Root??gs,D=(N==null?void 0:N.badge)??d.Badge??ys,y=(F==null?void 0:F.root)??c.root,P=(F==null?void 0:F.badge)??c.badge,M=Gt({elementType:h,externalSlotProps:y,externalForwardedProps:C,additionalProps:{ref:s,as:p},ownerState:S,className:ve(y==null?void 0:y.className,$.root,u)}),W=Gt({elementType:D,externalSlotProps:P,ownerState:S,className:ve($.badge,P==null?void 0:P.className)});return e.jsxs(h,{...M,children:[x,e.jsx(D,{...W,children:K})]})});function vs(t){return Ee("MuiCardActions",t)}Ie("MuiCardActions",["root","spacing"]);const js=t=>{const{classes:r,disableSpacing:s}=t;return Re({root:["root",!s&&"spacing"]},vs,r)},Ss=ue("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,!s.disableSpacing&&r.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),ws=w.forwardRef(function(r,s){const n=ze({props:r,name:"MuiCardActions"}),{disableSpacing:i=!1,className:u,...a}=n,p={...n,disableSpacing:i},d=js(p);return e.jsx(Ss,{className:ve(d.root,u),ownerState:p,ref:s,...a})}),Cs=te(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),Ts=te(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),Fs=ue("span",{shouldForwardProp:or})({position:"relative",display:"flex"}),Ds=ue(Cs)({transform:"scale(1)"}),ks=ue(Ts)(Le(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function br(t){const{checked:r=!1,classes:s={},fontSize:n}=t,i={...t,checked:r};return e.jsxs(Fs,{className:s.root,ownerState:i,children:[e.jsx(Ds,{fontSize:n,className:s.background,ownerState:i}),e.jsx(ks,{fontSize:n,className:s.dot,ownerState:i})]})}const vr=w.createContext(void 0);function Es(){return w.useContext(vr)}function Is(t){return Ee("MuiRadio",t)}const Xt=Ie("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Rs=t=>{const{classes:r,color:s,size:n}=t,i={root:["root",`color${me(s)}`,n!=="medium"&&`size${me(n)}`]};return{...r,...Re(i,Is,r)}},Ms=ue(Jr,{shouldForwardProp:t=>or(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,s.size!=="medium"&&r[`size${me(s.size)}`],r[`color${me(s.color)}`]]}})(Le(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${Xt.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:ce(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(kt()).map(([r])=>({props:{color:r,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:ce(t.palette[r].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(kt()).map(([r])=>({props:{color:r,disabled:!1},style:{[`&.${Xt.checked}`]:{color:(t.vars||t).palette[r].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function _s(t,r){return typeof r=="object"&&r!==null?t===r:String(t)===String(r)}const $s=e.jsx(br,{checked:!0}),zs=e.jsx(br,{}),ut=w.forwardRef(function(r,s){const n=ze({props:r,name:"MuiRadio"}),{checked:i,checkedIcon:u=$s,color:a="primary",icon:p=zs,name:d,onChange:c,size:x="medium",className:f,disabled:v,disableRipple:k=!1,slots:E={},slotProps:z={},inputProps:N,...F}=n,B=qr();let I=v;B&&typeof I>"u"&&(I=B.disabled),I??(I=!1);const C={...n,disabled:I,disableRipple:k,color:a,size:x},L=Rs(C),O=Es();let V=i;const l=Gr(c,O&&O.onChange);let o=d;O&&(typeof V>"u"&&(V=_s(O.value,n.value)),typeof o>"u"&&(o=O.name));const m=z.input??N,[j,R]=pt("root",{ref:s,elementType:Ms,className:ve(L.root,f),shouldForwardComponentProp:!0,externalForwardedProps:{slots:E,slotProps:z,...F},getSlotProps:H=>({...H,onChange:(T,...Y)=>{var K;(K=H.onChange)==null||K.call(H,T,...Y),l(T,...Y)}}),ownerState:C,additionalProps:{type:"radio",icon:w.cloneElement(p,{fontSize:p.props.fontSize??x}),checkedIcon:w.cloneElement(u,{fontSize:u.props.fontSize??x}),disabled:I,name:o,checked:V,slots:E,slotProps:{input:typeof m=="function"?m(C):m}}});return e.jsx(j,{...R,classes:L})});function Ls(t){return Ee("MuiRadioGroup",t)}Ie("MuiRadioGroup",["root","row","error"]);const Os=t=>{const{classes:r,row:s,error:n}=t;return Re({root:["root",s&&"row",n&&"error"]},Ls,r)},Ps=w.forwardRef(function(r,s){const{actions:n,children:i,className:u,defaultValue:a,name:p,onChange:d,value:c,...x}=r,f=w.useRef(null),v=Os(r),[k,E]=Kr({controlled:c,default:a,name:"RadioGroup"});w.useImperativeHandle(n,()=>({focus:()=>{let B=f.current.querySelector("input:not(:disabled):checked");B||(B=f.current.querySelector("input:not(:disabled)")),B&&B.focus()}}),[]);const z=Xr(s,f),N=Qr(p),F=w.useMemo(()=>({name:N,onChange(B){E(B.target.value),d&&d(B,B.target.value)},value:k}),[N,d,E,k]);return e.jsx(vr.Provider,{value:F,children:e.jsx(rs,{role:"radiogroup",ref:z,className:ve(v.root,u),...x,children:i})})}),bt=w.createContext({}),Vt=w.createContext({});function As(t){return Ee("MuiStep",t)}Ie("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const Vs=t=>{const{classes:r,orientation:s,alternativeLabel:n,completed:i}=t;return Re({root:["root",s,n&&"alternativeLabel",i&&"completed"]},As,r)},Ns=ue("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.completed&&r.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),Bs=w.forwardRef(function(r,s){const n=ze({props:r,name:"MuiStep"}),{active:i,children:u,className:a,component:p="div",completed:d,disabled:c,expanded:x=!1,index:f,last:v,...k}=n,{activeStep:E,connector:z,alternativeLabel:N,orientation:F,nonLinear:B}=w.useContext(bt);let[I=!1,C=!1,L=!1]=[i,d,c];E===f?I=i!==void 0?i:!0:!B&&E>f?C=d!==void 0?d:!0:!B&&E<f&&(L=c!==void 0?c:!0);const O=w.useMemo(()=>({index:f,last:v,expanded:x,icon:f+1,active:I,completed:C,disabled:L}),[f,v,x,I,C,L]),V={...n,active:I,orientation:F,alternativeLabel:N,completed:C,disabled:L,expanded:x,component:p},l=Vs(V),o=e.jsxs(Ns,{as:p,className:ve(l.root,a),ref:s,ownerState:V,...k,children:[z&&N&&f!==0?z:null,u]});return e.jsx(Vt.Provider,{value:O,children:z&&!N&&f!==0?e.jsxs(w.Fragment,{children:[z,o]}):o})}),Hs=te(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"})),Ys=te(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}));function Us(t){return Ee("MuiStepIcon",t)}const Ct=Ie("MuiStepIcon",["root","active","completed","error","text"]);var Qt;const Ws=t=>{const{classes:r,active:s,completed:n,error:i}=t;return Re({root:["root",s&&"active",n&&"completed",i&&"error"],text:["text"]},Us,r)},Tt=ue(Zr,{name:"MuiStepIcon",slot:"Root",overridesResolver:(t,r)=>r.root})(Le(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${Ct.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${Ct.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${Ct.error}`]:{color:(t.vars||t).palette.error.main}}))),qs=ue("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(t,r)=>r.text})(Le(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),Gs=w.forwardRef(function(r,s){const n=ze({props:r,name:"MuiStepIcon"}),{active:i=!1,className:u,completed:a=!1,error:p=!1,icon:d,...c}=n,x={...n,active:i,completed:a,error:p},f=Ws(x);if(typeof d=="number"||typeof d=="string"){const v=ve(u,f.root);return p?e.jsx(Tt,{as:Ys,className:v,ref:s,ownerState:x,...c}):a?e.jsx(Tt,{as:Hs,className:v,ref:s,ownerState:x,...c}):e.jsxs(Tt,{className:v,ref:s,ownerState:x,...c,children:[Qt||(Qt=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(qs,{className:f.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:x,children:d})]})}return d});function Js(t){return Ee("MuiStepLabel",t)}const Ne=Ie("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),Ks=t=>{const{classes:r,orientation:s,active:n,completed:i,error:u,disabled:a,alternativeLabel:p}=t;return Re({root:["root",s,u&&"error",a&&"disabled",p&&"alternativeLabel"],label:["label",n&&"active",i&&"completed",u&&"error",a&&"disabled",p&&"alternativeLabel"],iconContainer:["iconContainer",n&&"active",i&&"completed",u&&"error",a&&"disabled",p&&"alternativeLabel"],labelContainer:["labelContainer",p&&"alternativeLabel"]},Js,r)},Xs=ue("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation]]}})({display:"flex",alignItems:"center",[`&.${Ne.alternativeLabel}`]:{flexDirection:"column"},[`&.${Ne.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),Qs=ue("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(t,r)=>r.label})(Le(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${Ne.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Ne.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Ne.alternativeLabel}`]:{marginTop:16},[`&.${Ne.error}`]:{color:(t.vars||t).palette.error.main}}))),Zs=ue("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(t,r)=>r.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${Ne.alternativeLabel}`]:{paddingRight:0}}),en=ue("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(t,r)=>r.labelContainer})(Le(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${Ne.alternativeLabel}`]:{textAlign:"center"}}))),jr=w.forwardRef(function(r,s){const n=ze({props:r,name:"MuiStepLabel"}),{children:i,className:u,componentsProps:a={},error:p=!1,icon:d,optional:c,slots:x={},slotProps:f={},StepIconComponent:v,StepIconProps:k,...E}=n,{alternativeLabel:z,orientation:N}=w.useContext(bt),{active:F,disabled:B,completed:I,icon:C}=w.useContext(Vt),L=d||C;let O=v;L&&!O&&(O=Gs);const V={...n,active:F,alternativeLabel:z,completed:I,disabled:B,error:p,orientation:N},l=Ks(V),o={slots:x,slotProps:{stepIcon:k,...a,...f}},[m,j]=pt("root",{elementType:Xs,externalForwardedProps:{...o,...E},ownerState:V,ref:s,className:ve(l.root,u)}),[R,H]=pt("label",{elementType:Qs,externalForwardedProps:o,ownerState:V}),[T,Y]=pt("stepIcon",{elementType:O,externalForwardedProps:o,ownerState:V});return e.jsxs(m,{...j,children:[L||T?e.jsx(Zs,{className:l.iconContainer,ownerState:V,children:e.jsx(T,{completed:I,active:F,error:p,icon:L,...Y})}):null,e.jsxs(en,{className:l.labelContainer,ownerState:V,children:[i?e.jsx(R,{...H,className:ve(l.label,H==null?void 0:H.className),children:i}):null,c]})]})});jr.muiName="StepLabel";function tn(t){return Ee("MuiStepConnector",t)}Ie("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const rn=t=>{const{classes:r,orientation:s,alternativeLabel:n,active:i,completed:u,disabled:a}=t,p={root:["root",s,n&&"alternativeLabel",i&&"active",u&&"completed",a&&"disabled"],line:["line",`line${me(s)}`]};return Re(p,tn,r)},sn=ue("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.completed&&r.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),nn=ue("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.line,r[`line${me(s.orientation)}`]]}})(Le(({theme:t})=>{const r=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:r,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),an=w.forwardRef(function(r,s){const n=ze({props:r,name:"MuiStepConnector"}),{className:i,...u}=n,{alternativeLabel:a,orientation:p="horizontal"}=w.useContext(bt),{active:d,disabled:c,completed:x}=w.useContext(Vt),f={...n,alternativeLabel:a,orientation:p,active:d,completed:x,disabled:c},v=rn(f);return e.jsx(sn,{className:ve(v.root,i),ref:s,ownerState:f,...u,children:e.jsx(nn,{className:v.line,ownerState:f})})});function on(t){return Ee("MuiStepper",t)}Ie("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const ln=t=>{const{orientation:r,nonLinear:s,alternativeLabel:n,classes:i}=t;return Re({root:["root",r,s&&"nonLinear",n&&"alternativeLabel"]},on,i)},cn=ue("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.nonLinear&&r.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),dn=e.jsx(an,{}),un=w.forwardRef(function(r,s){const n=ze({props:r,name:"MuiStepper"}),{activeStep:i=0,alternativeLabel:u=!1,children:a,className:p,component:d="div",connector:c=dn,nonLinear:x=!1,orientation:f="horizontal",...v}=n,k={...n,nonLinear:x,alternativeLabel:u,orientation:f,component:d},E=ln(k),z=w.Children.toArray(a).filter(Boolean),N=z.map((B,I)=>w.cloneElement(B,{index:I,last:I+1===z.length,...B.props})),F=w.useMemo(()=>({activeStep:i,alternativeLabel:u,connector:c,nonLinear:x,orientation:f}),[i,u,c,x,f]);return e.jsx(bt.Provider,{value:F,children:e.jsx(cn,{as:d,ownerState:k,className:ve(E.root,p),ref:s,...v,children:N})})}),Nt=te(e.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}));var ht={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/var pn=ht.exports,Zt;function hn(){return Zt||(Zt=1,function(t,r){((s,n)=>{t.exports=n()})(pn,function s(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},i,u=!n.document&&!!n.postMessage,a=n.IS_PAPA_WORKER||!1,p={},d=0,c={};function x(l){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(o){var m=L(o);m.chunkSize=parseInt(m.chunkSize),o.step||o.chunk||(m.chunkSize=null),this._handle=new z(m),(this._handle.streamer=this)._config=m}).call(this,l),this.parseChunk=function(o,m){var j=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<j){let H=this._config.newline;H||(R=this._config.quoteChar||'"',H=this._handle.guessLineEndings(o,R)),o=[...o.split(H).slice(j)].join(H)}this.isFirstChunk&&V(this._config.beforeFirstChunk)&&(R=this._config.beforeFirstChunk(o))!==void 0&&(o=R),this.isFirstChunk=!1,this._halted=!1;var j=this._partialLine+o,R=(this._partialLine="",this._handle.parse(j,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(o=R.meta.cursor,j=(this._finished||(this._partialLine=j.substring(o-this._baseIndex),this._baseIndex=o),R&&R.data&&(this._rowCount+=R.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),a)n.postMessage({results:R,workerId:c.WORKER_ID,finished:j});else if(V(this._config.chunk)&&!m){if(this._config.chunk(R,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=R=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(R.data),this._completeResults.errors=this._completeResults.errors.concat(R.errors),this._completeResults.meta=R.meta),this._completed||!j||!V(this._config.complete)||R&&R.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),j||R&&R.meta.paused||this._nextChunk(),R}this._halted=!0},this._sendError=function(o){V(this._config.error)?this._config.error(o):a&&this._config.error&&n.postMessage({workerId:c.WORKER_ID,error:o,finished:!1})}}function f(l){var o;(l=l||{}).chunkSize||(l.chunkSize=c.RemoteChunkSize),x.call(this,l),this._nextChunk=u?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(m){this._input=m,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(o=new XMLHttpRequest,this._config.withCredentials&&(o.withCredentials=this._config.withCredentials),u||(o.onload=O(this._chunkLoaded,this),o.onerror=O(this._chunkError,this)),o.open(this._config.downloadRequestBody?"POST":"GET",this._input,!u),this._config.downloadRequestHeaders){var m,j=this._config.downloadRequestHeaders;for(m in j)o.setRequestHeader(m,j[m])}var R;this._config.chunkSize&&(R=this._start+this._config.chunkSize-1,o.setRequestHeader("Range","bytes="+this._start+"-"+R));try{o.send(this._config.downloadRequestBody)}catch(H){this._chunkError(H.message)}u&&o.status===0&&this._chunkError()}},this._chunkLoaded=function(){o.readyState===4&&(o.status<200||400<=o.status?this._chunkError():(this._start+=this._config.chunkSize||o.responseText.length,this._finished=!this._config.chunkSize||this._start>=(m=>(m=m.getResponseHeader("Content-Range"))!==null?parseInt(m.substring(m.lastIndexOf("/")+1)):-1)(o),this.parseChunk(o.responseText)))},this._chunkError=function(m){m=o.statusText||m,this._sendError(new Error(m))}}function v(l){(l=l||{}).chunkSize||(l.chunkSize=c.LocalChunkSize),x.call(this,l);var o,m,j=typeof FileReader<"u";this.stream=function(R){this._input=R,m=R.slice||R.webkitSlice||R.mozSlice,j?((o=new FileReader).onload=O(this._chunkLoaded,this),o.onerror=O(this._chunkError,this)):o=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var R=this._input,H=(this._config.chunkSize&&(H=Math.min(this._start+this._config.chunkSize,this._input.size),R=m.call(R,this._start,H)),o.readAsText(R,this._config.encoding));j||this._chunkLoaded({target:{result:H}})},this._chunkLoaded=function(R){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(R.target.result)},this._chunkError=function(){this._sendError(o.error)}}function k(l){var o;x.call(this,l=l||{}),this.stream=function(m){return o=m,this._nextChunk()},this._nextChunk=function(){var m,j;if(!this._finished)return m=this._config.chunkSize,o=m?(j=o.substring(0,m),o.substring(m)):(j=o,""),this._finished=!o,this.parseChunk(j)}}function E(l){x.call(this,l=l||{});var o=[],m=!0,j=!1;this.pause=function(){x.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){x.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(R){this._input=R,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){j&&o.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),o.length?this.parseChunk(o.shift()):m=!0},this._streamData=O(function(R){try{o.push(typeof R=="string"?R:R.toString(this._config.encoding)),m&&(m=!1,this._checkIsFinished(),this.parseChunk(o.shift()))}catch(H){this._streamError(H)}},this),this._streamError=O(function(R){this._streamCleanUp(),this._sendError(R)},this),this._streamEnd=O(function(){this._streamCleanUp(),j=!0,this._streamData("")},this),this._streamCleanUp=O(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function z(l){var o,m,j,R,H=Math.pow(2,53),T=-H,Y=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,K=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,S=this,$=0,h=0,D=!1,y=!1,P=[],M={data:[],errors:[],meta:{}};function W(q){return l.skipEmptyLines==="greedy"?q.join("").trim()==="":q.length===1&&q[0].length===0}function G(){if(M&&j&&(re("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+c.DefaultDelimiter+"'"),j=!1),l.skipEmptyLines&&(M.data=M.data.filter(function(A){return!W(A)})),X()){let A=function(ne,ee){V(l.transformHeader)&&(ne=l.transformHeader(ne,ee)),P.push(ne)};if(M)if(Array.isArray(M.data[0])){for(var q=0;X()&&q<M.data.length;q++)M.data[q].forEach(A);M.data.splice(0,1)}else M.data.forEach(A)}function _(A,ne){for(var ee=l.header?{}:[],se=0;se<A.length;se++){var oe=se,Q=A[se],Q=((je,J)=>(ie=>(l.dynamicTypingFunction&&l.dynamicTyping[ie]===void 0&&(l.dynamicTyping[ie]=l.dynamicTypingFunction(ie)),(l.dynamicTyping[ie]||l.dynamicTyping)===!0))(je)?J==="true"||J==="TRUE"||J!=="false"&&J!=="FALSE"&&((ie=>{if(Y.test(ie)&&(ie=parseFloat(ie),T<ie&&ie<H))return 1})(J)?parseFloat(J):K.test(J)?new Date(J):J===""?null:J):J)(oe=l.header?se>=P.length?"__parsed_extra":P[se]:oe,Q=l.transform?l.transform(Q,oe):Q);oe==="__parsed_extra"?(ee[oe]=ee[oe]||[],ee[oe].push(Q)):ee[oe]=Q}return l.header&&(se>P.length?re("FieldMismatch","TooManyFields","Too many fields: expected "+P.length+" fields but parsed "+se,h+ne):se<P.length&&re("FieldMismatch","TooFewFields","Too few fields: expected "+P.length+" fields but parsed "+se,h+ne)),ee}var U;M&&(l.header||l.dynamicTyping||l.transform)&&(U=1,!M.data.length||Array.isArray(M.data[0])?(M.data=M.data.map(_),U=M.data.length):M.data=_(M.data,0),l.header&&M.meta&&(M.meta.fields=P),h+=U)}function X(){return l.header&&P.length===0}function re(q,_,U,A){q={type:q,code:_,message:U},A!==void 0&&(q.row=A),M.errors.push(q)}V(l.step)&&(R=l.step,l.step=function(q){M=q,X()?G():(G(),M.data.length!==0&&($+=q.data.length,l.preview&&$>l.preview?m.abort():(M.data=M.data[0],R(M,S))))}),this.parse=function(q,_,U){var A=l.quoteChar||'"',A=(l.newline||(l.newline=this.guessLineEndings(q,A)),j=!1,l.delimiter?V(l.delimiter)&&(l.delimiter=l.delimiter(q),M.meta.delimiter=l.delimiter):((A=((ne,ee,se,oe,Q)=>{var je,J,ie,Oe;Q=Q||[",","	","|",";",c.RECORD_SEP,c.UNIT_SEP];for(var Ge=0;Ge<Q.length;Ge++){for(var Ce,et=Q[Ge],ge=0,Te=0,fe=0,ye=(ie=void 0,new F({comments:oe,delimiter:et,newline:ee,preview:10}).parse(ne)),Me=0;Me<ye.data.length;Me++)se&&W(ye.data[Me])?fe++:(Ce=ye.data[Me].length,Te+=Ce,ie===void 0?ie=Ce:0<Ce&&(ge+=Math.abs(Ce-ie),ie=Ce));0<ye.data.length&&(Te/=ye.data.length-fe),(J===void 0||ge<=J)&&(Oe===void 0||Oe<Te)&&1.99<Te&&(J=ge,je=et,Oe=Te)}return{successful:!!(l.delimiter=je),bestDelimiter:je}})(q,l.newline,l.skipEmptyLines,l.comments,l.delimitersToGuess)).successful?l.delimiter=A.bestDelimiter:(j=!0,l.delimiter=c.DefaultDelimiter),M.meta.delimiter=l.delimiter),L(l));return l.preview&&l.header&&A.preview++,o=q,m=new F(A),M=m.parse(o,_,U),G(),D?{meta:{paused:!0}}:M||{meta:{paused:!1}}},this.paused=function(){return D},this.pause=function(){D=!0,m.abort(),o=V(l.chunk)?"":o.substring(m.getCharIndex())},this.resume=function(){S.streamer._halted?(D=!1,S.streamer.parseChunk(o,!0)):setTimeout(S.resume,3)},this.aborted=function(){return y},this.abort=function(){y=!0,m.abort(),M.meta.aborted=!0,V(l.complete)&&l.complete(M),o=""},this.guessLineEndings=function(ne,A){ne=ne.substring(0,1048576);var A=new RegExp(N(A)+"([^]*?)"+N(A),"gm"),U=(ne=ne.replace(A,"")).split("\r"),A=ne.split(`
`),ne=1<A.length&&A[0].length<U[0].length;if(U.length===1||ne)return`
`;for(var ee=0,se=0;se<U.length;se++)U[se][0]===`
`&&ee++;return ee>=U.length/2?`\r
`:"\r"}}function N(l){return l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function F(l){var o=(l=l||{}).delimiter,m=l.newline,j=l.comments,R=l.step,H=l.preview,T=l.fastMode,Y=null,K=!1,S=l.quoteChar==null?'"':l.quoteChar,$=S;if(l.escapeChar!==void 0&&($=l.escapeChar),(typeof o!="string"||-1<c.BAD_DELIMITERS.indexOf(o))&&(o=","),j===o)throw new Error("Comment character same as delimiter");j===!0?j="#":(typeof j!="string"||-1<c.BAD_DELIMITERS.indexOf(j))&&(j=!1),m!==`
`&&m!=="\r"&&m!==`\r
`&&(m=`
`);var h=0,D=!1;this.parse=function(y,P,M){if(typeof y!="string")throw new Error("Input must be a string");var W=y.length,G=o.length,X=m.length,re=j.length,q=V(R),_=[],U=[],A=[],ne=h=0;if(!y)return ge();if(T||T!==!1&&y.indexOf(S)===-1){for(var ee=y.split(m),se=0;se<ee.length;se++){if(A=ee[se],h+=A.length,se!==ee.length-1)h+=m.length;else if(M)return ge();if(!j||A.substring(0,re)!==j){if(q){if(_=[],Oe(A.split(o)),Te(),D)return ge()}else Oe(A.split(o));if(H&&H<=se)return _=_.slice(0,H),ge(!0)}}return ge()}for(var oe=y.indexOf(o,h),Q=y.indexOf(m,h),je=new RegExp(N($)+N(S),"g"),J=y.indexOf(S,h);;)if(y[h]===S)for(J=h,h++;;){if((J=y.indexOf(S,J+1))===-1)return M||U.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:_.length,index:h}),Ce();if(J===W-1)return Ce(y.substring(h,J).replace(je,S));if(S===$&&y[J+1]===$)J++;else if(S===$||J===0||y[J-1]!==$){oe!==-1&&oe<J+1&&(oe=y.indexOf(o,J+1));var ie=Ge((Q=Q!==-1&&Q<J+1?y.indexOf(m,J+1):Q)===-1?oe:Math.min(oe,Q));if(y.substr(J+1+ie,G)===o){A.push(y.substring(h,J).replace(je,S)),y[h=J+1+ie+G]!==S&&(J=y.indexOf(S,h)),oe=y.indexOf(o,h),Q=y.indexOf(m,h);break}if(ie=Ge(Q),y.substring(J+1+ie,J+1+ie+X)===m){if(A.push(y.substring(h,J).replace(je,S)),et(J+1+ie+X),oe=y.indexOf(o,h),J=y.indexOf(S,h),q&&(Te(),D))return ge();if(H&&_.length>=H)return ge(!0);break}U.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:_.length,index:h}),J++}}else if(j&&A.length===0&&y.substring(h,h+re)===j){if(Q===-1)return ge();h=Q+X,Q=y.indexOf(m,h),oe=y.indexOf(o,h)}else if(oe!==-1&&(oe<Q||Q===-1))A.push(y.substring(h,oe)),h=oe+G,oe=y.indexOf(o,h);else{if(Q===-1)break;if(A.push(y.substring(h,Q)),et(Q+X),q&&(Te(),D))return ge();if(H&&_.length>=H)return ge(!0)}return Ce();function Oe(fe){_.push(fe),ne=h}function Ge(fe){var ye=0;return ye=fe!==-1&&(fe=y.substring(J+1,fe))&&fe.trim()===""?fe.length:ye}function Ce(fe){return M||(fe===void 0&&(fe=y.substring(h)),A.push(fe),h=W,Oe(A),q&&Te()),ge()}function et(fe){h=fe,Oe(A),A=[],Q=y.indexOf(m,h)}function ge(fe){if(l.header&&!P&&_.length&&!K){var ye=_[0],Me={},vt=new Set(ye);let Bt=!1;for(let Je=0;Je<ye.length;Je++){let Fe=ye[Je];if(Me[Fe=V(l.transformHeader)?l.transformHeader(Fe,Je):Fe]){let tt,Ht=Me[Fe];for(;tt=Fe+"_"+Ht,Ht++,vt.has(tt););vt.add(tt),ye[Je]=tt,Me[Fe]++,Bt=!0,(Y=Y===null?{}:Y)[tt]=Fe}else Me[Fe]=1,ye[Je]=Fe;vt.add(Fe)}Bt&&console.warn("Duplicate headers found and renamed."),K=!0}return{data:_,errors:U,meta:{delimiter:o,linebreak:m,aborted:D,truncated:!!fe,cursor:ne+(P||0),renamedHeaders:Y}}}function Te(){R(ge()),_=[],U=[]}},this.abort=function(){D=!0},this.getCharIndex=function(){return h}}function B(l){var o=l.data,m=p[o.workerId],j=!1;if(o.error)m.userError(o.error,o.file);else if(o.results&&o.results.data){var R={abort:function(){j=!0,I(o.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:C,resume:C};if(V(m.userStep)){for(var H=0;H<o.results.data.length&&(m.userStep({data:o.results.data[H],errors:o.results.errors,meta:o.results.meta},R),!j);H++);delete o.results}else V(m.userChunk)&&(m.userChunk(o.results,R,o.file),delete o.results)}o.finished&&!j&&I(o.workerId,o.results)}function I(l,o){var m=p[l];V(m.userComplete)&&m.userComplete(o),m.terminate(),delete p[l]}function C(){throw new Error("Not implemented.")}function L(l){if(typeof l!="object"||l===null)return l;var o,m=Array.isArray(l)?[]:{};for(o in l)m[o]=L(l[o]);return m}function O(l,o){return function(){l.apply(o,arguments)}}function V(l){return typeof l=="function"}return c.parse=function(l,o){var m=(o=o||{}).dynamicTyping||!1;if(V(m)&&(o.dynamicTypingFunction=m,m={}),o.dynamicTyping=m,o.transform=!!V(o.transform)&&o.transform,!o.worker||!c.WORKERS_SUPPORTED)return m=null,c.NODE_STREAM_INPUT,typeof l=="string"?(l=(j=>j.charCodeAt(0)!==65279?j:j.slice(1))(l),m=new(o.download?f:k)(o)):l.readable===!0&&V(l.read)&&V(l.on)?m=new E(o):(n.File&&l instanceof File||l instanceof Object)&&(m=new v(o)),m.stream(l);(m=(()=>{var j;return!!c.WORKERS_SUPPORTED&&(j=(()=>{var R=n.URL||n.webkitURL||null,H=s.toString();return c.BLOB_URL||(c.BLOB_URL=R.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",H,")();"],{type:"text/javascript"})))})(),(j=new n.Worker(j)).onmessage=B,j.id=d++,p[j.id]=j)})()).userStep=o.step,m.userChunk=o.chunk,m.userComplete=o.complete,m.userError=o.error,o.step=V(o.step),o.chunk=V(o.chunk),o.complete=V(o.complete),o.error=V(o.error),delete o.worker,m.postMessage({input:l,config:o,workerId:m.id})},c.unparse=function(l,o){var m=!1,j=!0,R=",",H=`\r
`,T='"',Y=T+T,K=!1,S=null,$=!1,h=((()=>{if(typeof o=="object"){if(typeof o.delimiter!="string"||c.BAD_DELIMITERS.filter(function(P){return o.delimiter.indexOf(P)!==-1}).length||(R=o.delimiter),typeof o.quotes!="boolean"&&typeof o.quotes!="function"&&!Array.isArray(o.quotes)||(m=o.quotes),typeof o.skipEmptyLines!="boolean"&&typeof o.skipEmptyLines!="string"||(K=o.skipEmptyLines),typeof o.newline=="string"&&(H=o.newline),typeof o.quoteChar=="string"&&(T=o.quoteChar),typeof o.header=="boolean"&&(j=o.header),Array.isArray(o.columns)){if(o.columns.length===0)throw new Error("Option columns is empty");S=o.columns}o.escapeChar!==void 0&&(Y=o.escapeChar+T),o.escapeFormulae instanceof RegExp?$=o.escapeFormulae:typeof o.escapeFormulae=="boolean"&&o.escapeFormulae&&($=/^[=+\-@\t\r].*$/)}})(),new RegExp(N(T),"g"));if(typeof l=="string"&&(l=JSON.parse(l)),Array.isArray(l)){if(!l.length||Array.isArray(l[0]))return D(null,l,K);if(typeof l[0]=="object")return D(S||Object.keys(l[0]),l,K)}else if(typeof l=="object")return typeof l.data=="string"&&(l.data=JSON.parse(l.data)),Array.isArray(l.data)&&(l.fields||(l.fields=l.meta&&l.meta.fields||S),l.fields||(l.fields=Array.isArray(l.data[0])?l.fields:typeof l.data[0]=="object"?Object.keys(l.data[0]):[]),Array.isArray(l.data[0])||typeof l.data[0]=="object"||(l.data=[l.data])),D(l.fields||[],l.data||[],K);throw new Error("Unable to serialize unrecognized input");function D(P,M,W){var G="",X=(typeof P=="string"&&(P=JSON.parse(P)),typeof M=="string"&&(M=JSON.parse(M)),Array.isArray(P)&&0<P.length),re=!Array.isArray(M[0]);if(X&&j){for(var q=0;q<P.length;q++)0<q&&(G+=R),G+=y(P[q],q);0<M.length&&(G+=H)}for(var _=0;_<M.length;_++){var U=(X?P:M[_]).length,A=!1,ne=X?Object.keys(M[_]).length===0:M[_].length===0;if(W&&!X&&(A=W==="greedy"?M[_].join("").trim()==="":M[_].length===1&&M[_][0].length===0),W==="greedy"&&X){for(var ee=[],se=0;se<U;se++){var oe=re?P[se]:se;ee.push(M[_][oe])}A=ee.join("").trim()===""}if(!A){for(var Q=0;Q<U;Q++){0<Q&&!ne&&(G+=R);var je=X&&re?P[Q]:Q;G+=y(M[_][je],Q)}_<M.length-1&&(!W||0<U&&!ne)&&(G+=H)}}return G}function y(P,M){var W,G;return P==null?"":P.constructor===Date?JSON.stringify(P).slice(1,25):(G=!1,$&&typeof P=="string"&&$.test(P)&&(P="'"+P,G=!0),W=P.toString().replace(h,Y),(G=G||m===!0||typeof m=="function"&&m(P,M)||Array.isArray(m)&&m[M]||((X,re)=>{for(var q=0;q<re.length;q++)if(-1<X.indexOf(re[q]))return!0;return!1})(W,c.BAD_DELIMITERS)||-1<W.indexOf(R)||W.charAt(0)===" "||W.charAt(W.length-1)===" ")?T+W+T:W)}},c.RECORD_SEP="",c.UNIT_SEP="",c.BYTE_ORDER_MARK="\uFEFF",c.BAD_DELIMITERS=["\r",`
`,'"',c.BYTE_ORDER_MARK],c.WORKERS_SUPPORTED=!u&&!!n.Worker,c.NODE_STREAM_INPUT=1,c.LocalChunkSize=10485760,c.RemoteChunkSize=5242880,c.DefaultDelimiter=",",c.Parser=F,c.ParserHandle=z,c.NetworkStreamer=f,c.FileStreamer=v,c.StringStreamer=k,c.ReadableStreamStreamer=E,n.jQuery&&((i=n.jQuery).fn.parse=function(l){var o=l.config||{},m=[];return this.each(function(H){if(!(i(this).prop("tagName").toUpperCase()==="INPUT"&&i(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var T=0;T<this.files.length;T++)m.push({file:this.files[T],inputElem:this,instanceConfig:i.extend({},o)})}),j(),this;function j(){if(m.length===0)V(l.complete)&&l.complete();else{var H,T,Y,K,S=m[0];if(V(l.before)){var $=l.before(S.file,S.inputElem);if(typeof $=="object"){if($.action==="abort")return H="AbortError",T=S.file,Y=S.inputElem,K=$.reason,void(V(l.error)&&l.error({name:H},T,Y,K));if($.action==="skip")return void R();typeof $.config=="object"&&(S.instanceConfig=i.extend(S.instanceConfig,$.config))}else if($==="skip")return void R()}var h=S.instanceConfig.complete;S.instanceConfig.complete=function(D){V(h)&&h(D,S.file,S.inputElem),R()},c.parse(S.file,S.instanceConfig)}}function R(){m.splice(0,1),j()}}),a&&(n.onmessage=function(l){l=l.data,c.WORKER_ID===void 0&&l&&(c.WORKER_ID=l.workerId),typeof l.input=="string"?n.postMessage({workerId:c.WORKER_ID,results:c.parse(l.input,l.config),finished:!0}):(n.File&&l.input instanceof File||l.input instanceof Object)&&(l=c.parse(l.input,l.config))&&n.postMessage({workerId:c.WORKER_ID,results:l,finished:!0})}),(f.prototype=Object.create(x.prototype)).constructor=f,(v.prototype=Object.create(x.prototype)).constructor=v,(k.prototype=Object.create(k.prototype)).constructor=k,(E.prototype=Object.create(x.prototype)).constructor=E,c})}(ht)),ht.exports}var fn=hn();const xn=Ir(fn),mn=async(t,r)=>{switch(r){case"csv":return gn(t);case"excel":return yn(t);case"json":return bn(t);case"xml":return vn(t);case"pdf":return jn(t);case"txt":return Sn(t);default:throw new Error(`Unsupported file type: ${r}`)}},gn=t=>new Promise((r,s)=>{xn.parse(t,{header:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:n=>{const i=n.meta.fields||[],u=n.data;r({columns:i,data:u.slice(0,100)})},error:n=>{s(new Error(`Error parsing CSV: ${n.message}`))}})}),yn=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=async i=>{var u;try{const a=(u=i.target)==null?void 0:u.result;if(!a){s(new Error("Failed to read Excel file"));return}const p=await ir(()=>import("./xlsx-DkH2s96g.js"),[]),d=p.read(a,{type:"array"}),c=d.SheetNames[0],x=d.Sheets[c],f=p.utils.sheet_to_json(x,{header:1});if(f.length===0){s(new Error("Excel file is empty"));return}const v=f[0].map(String),k=f.slice(1).map(E=>{const z={};return E.forEach((N,F)=>{F<v.length&&(z[v[F]]=N)}),z});r({columns:v,data:k.slice(0,100)})}catch(a){s(new Error(`Error parsing Excel file: ${a instanceof Error?a.message:"Unknown error"}`))}},n.onerror=()=>{s(new Error("Error reading Excel file"))},n.readAsArrayBuffer(t)}),bn=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=i=>{var u;try{const a=(u=i.target)==null?void 0:u.result,p=JSON.parse(a);if(Array.isArray(p)){if(p.length===0){s(new Error("JSON file contains an empty array"));return}const d=Array.from(new Set(p.flatMap(c=>Object.keys(c))));r({columns:d,data:p.slice(0,100)})}else if(p&&typeof p=="object"){const d=Object.keys(p).find(c=>Array.isArray(p[c]));if(d&&p[d].length>0){const c=p[d],x=Array.from(new Set(c.flatMap(f=>Object.keys(f))));r({columns:x,data:c.slice(0,100)})}else{const c=Object.keys(p);r({columns:c,data:[p]})}}else s(new Error("JSON file format not recognized"))}catch(a){s(new Error(`Error parsing JSON file: ${a instanceof Error?a.message:"Invalid JSON"}`))}},n.onerror=()=>{s(new Error("Error reading JSON file"))},n.readAsText(t)}),vn=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=i=>{var u,a;try{const p=(u=i.target)==null?void 0:u.result,c=new DOMParser().parseFromString(p,"text/xml"),x=c.getElementsByTagName("*"),f=new Map;for(let I=0;I<x.length;I++){const C=x[I].tagName;f.set(C,(f.get(C)||0)+1)}const v=Array.from(f.entries()).filter(([I,C])=>C>1).map(([I])=>I).sort((I,C)=>(f.get(C)||0)-(f.get(I)||0));if(v.length===0){s(new Error("Could not identify repeating elements in XML"));return}const k=v[0],E=c.getElementsByTagName(k);if(E.length===0){s(new Error(`No elements found with tag ${k}`));return}const z=E[0],F=Array.from(z.children).map(I=>I.tagName),B=[];for(let I=0;I<Math.min(E.length,100);I++){const C=E[I],L={};for(const O of F){const V=((a=C.getElementsByTagName(O)[0])==null?void 0:a.textContent)||"";L[O]=V}B.push(L)}r({columns:F,data:B})}catch(p){s(new Error(`Error parsing XML file: ${p instanceof Error?p.message:"Invalid XML"}`))}},n.onerror=()=>{s(new Error("Error reading XML file"))},n.readAsText(t)}),jn=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=async i=>{var u;try{if(!((u=i.target)==null?void 0:u.result)){s(new Error("Failed to read PDF file"));return}r({columns:["Information"],data:[{Information:"PDF files are not currently supported for direct parsing in the browser."},{Information:"Please convert your PDF to CSV, Excel, or JSON format for processing."},{Information:"Alternatively, copy and paste the data from your PDF into a text file."},{Information:`File name: ${t.name}`},{Information:`File size: ${(t.size/1024).toFixed(2)} KB`},{Information:"Supported formats: CSV, Excel (.xlsx, .xls), JSON, XML, TXT"}]})}catch(a){s(new Error(`Error processing PDF: ${a instanceof Error?a.message:"Unknown error"}`))}},n.onerror=()=>{s(new Error("Error reading PDF file"))},n.readAsArrayBuffer(t)}),Sn=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=i=>{var u;try{const a=(u=i.target)==null?void 0:u.result;if(!a){s(new Error("Failed to read text file"));return}const p=a.split(`
`).map(f=>f.trim()).filter(f=>f.length>0);if(p.length===0){s(new Error("Text file is empty"));return}const d=[",","	","|",";"];let c="",x=0;for(const f of d){const v=p.slice(0,10).map(z=>z.split(f).length),k=v.reduce((z,N)=>z+N,0)/v.length;v.every(z=>Math.abs(z-k)<=1&&z>1)&&k>x&&(x=k,c=f)}if(c&&x>1){const f=p[0].split(c).map(k=>k.trim()),v=[];for(let k=1;k<Math.min(p.length,100);k++){const E=p[k].split(c).map(N=>N.trim()),z={};for(let N=0;N<f.length;N++)z[f[N]]=E[N]||"";v.push(z)}r({columns:f,data:v})}else{const f=p.slice(0,100).map((v,k)=>({LineNumber:k+1,Text:v}));r({columns:["LineNumber","Text"],data:f})}}catch(a){s(new Error(`Error parsing text file: ${a instanceof Error?a.message:"Unknown error"}`))}},n.onerror=()=>{s(new Error("Error reading text file"))},n.readAsText(t)}),wn=()=>{const t=dt(),r=Ye(n=>n.formatter.selectedTool),s=n=>{const i=n.target.value,u=Ut.find(a=>a.id===i);u&&t(Rr(u))};return e.jsxs(b,{sx:{my:3},children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Select Target Tool"}),e.jsxs(le,{container:!0,spacing:2,children:[e.jsx(le,{size:{xs:12,md:6},children:e.jsxs(He,{fullWidth:!0,children:[e.jsx(Ue,{id:"tool-select-label",children:"Tool"}),e.jsx(We,{labelId:"tool-select-label",id:"tool-select",value:(r==null?void 0:r.id)||"",label:"Tool",onChange:s,children:Ut.map(n=>e.jsx(ae,{value:n.id,children:n.name},n.id))})]})}),e.jsx(le,{size:12,children:r&&e.jsxs(he,{variant:"outlined",sx:{p:2,mt:2,borderColor:"primary.light"},children:[e.jsx(g,{variant:"subtitle1",gutterBottom:!0,children:r.name}),e.jsx(g,{variant:"body2",paragraph:!0,children:r.description}),e.jsxs(g,{variant:"body2",color:"text.secondary",children:["Required fields: ",r.requiredFields.map(n=>n.name).join(", ")]})]})})]})]})},Cn=()=>{const t=dt(),r=w.useRef(null),{sourceColumns:s,selectedTool:n}=Ye(I=>I.formatter),[i,u]=w.useState("csv"),[a,p]=w.useState(!1),[d,c]=w.useState(null),[x,f]=w.useState(null),v=I=>{u(I.target.value)},k=async I=>{var L;const C=(L=I.target.files)==null?void 0:L[0];if(C){f(C.name),p(!0),c(null);try{t($e("uploading"));const O={id:`file-${Date.now()}`,name:C.name,type:i,size:C.size,lastModified:C.lastModified},{columns:V,data:l}=await mn(C,i);t(Mr(O)),t(_r(V)),t($r(l)),t($e("idle")),setTimeout(()=>{t(Be(1))},500)}catch(O){c(O instanceof Error?O.message:"Failed to parse file"),t($e("error"))}finally{p(!1)}}},E=()=>{var I;(I=r.current)==null||I.click()},z=I=>{var L;I.preventDefault(),I.stopPropagation();const C=(L=I.dataTransfer.files)==null?void 0:L[0];if(C&&r.current){const O=new DataTransfer;O.items.add(C),r.current.files=O.files,k({target:{files:O.files}})}},N=I=>{I.preventDefault(),I.stopPropagation()},F=()=>{t(Be(1))},B=s.length>0&&n!==null;return e.jsxs(b,{sx:{width:"100%"},children:[e.jsx(g,{variant:"h5",gutterBottom:!0,children:"Upload Data File"}),e.jsx(g,{variant:"body1",paragraph:!0,children:"Select a file to upload. The formatter supports CSV, Excel (.xlsx, .xls, .xlsm), PDF, JSON, XML, and plain text files."}),e.jsxs(le,{container:!0,spacing:3,children:[e.jsx(le,{size:{xs:12,md:4},children:e.jsxs(He,{fullWidth:!0,children:[e.jsx(Ue,{id:"file-type-select-label",children:"File Type"}),e.jsxs(We,{labelId:"file-type-select-label",id:"file-type-select",value:i,label:"File Type",onChange:v,children:[e.jsx(ae,{value:"csv",children:"CSV"}),e.jsx(ae,{value:"excel",children:"Excel (.xlsx/.xls/.xlsm)"}),e.jsx(ae,{value:"json",children:"JSON"}),e.jsx(ae,{value:"xml",children:"XML"}),e.jsx(ae,{value:"pdf",children:"PDF"}),e.jsx(ae,{value:"txt",children:"Text File"})]})]})}),e.jsxs(le,{size:12,children:[e.jsx("input",{type:"file",ref:r,onChange:k,style:{display:"none"},accept:i==="csv"?".csv":i==="excel"?".xlsx,.xls,.xlsm":i==="json"?".json":i==="xml"?".xml":i==="pdf"?".pdf":i==="txt"?".txt":void 0}),e.jsx(he,{elevation:0,onDrop:z,onDragOver:N,sx:{border:"2px dashed #ccc",borderRadius:2,p:3,textAlign:"center",cursor:"pointer",bgcolor:"#f8f9fa","&:hover":{borderColor:"primary.main"}},onClick:E,children:a?e.jsxs(b,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(Qe,{}),e.jsx(g,{variant:"body1",sx:{mt:2},children:"Processing file..."})]}):e.jsxs(b,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(Wt,{fontSize:"large",color:"primary"}),e.jsx(g,{variant:"h6",sx:{mt:2},children:x?`Selected: ${x}`:"Drag & drop file here or click to browse"}),e.jsxs(g,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Supports ",i==="csv"?"CSV":i==="excel"?"Excel (.xlsx, .xls, .xlsm)":i==="json"?"JSON":i==="xml"?"XML":i==="pdf"?"PDF":"Text"," files"]})]})}),d&&e.jsx(pe,{severity:"error",sx:{mt:2},children:d}),x&&!a&&!d&&e.jsxs(pe,{severity:"success",sx:{mt:2},children:["File selected: ",x]})]}),e.jsx(le,{size:12,sx:{mt:2,display:"flex",justifyContent:"center"},children:e.jsx(Z,{variant:"contained",size:"large",onClick:E,startIcon:e.jsx(Wt,{}),disabled:a,children:"Browse Files"})})]}),e.jsx(xe,{sx:{my:4}}),e.jsx(wn,{}),e.jsx(b,{sx:{display:"flex",justifyContent:"flex-end",mt:4},children:e.jsx(Z,{variant:"contained",size:"large",endIcon:e.jsx(Nt,{}),onClick:F,disabled:!B,children:"Continue to Field Mapping"})}),!B&&e.jsx(g,{variant:"body2",color:"text.secondary",sx:{mt:2,textAlign:"right"},children:s.length?"Select a target tool to continue":"Upload a file to continue"})]})},nt=te(e.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"})),Tn=(t,r)=>!t||!t.length||!r||!r.length?[]:t.map(s=>{const n={};return r.forEach(i=>{const{sourceField:u,targetField:a,transformations:p}=i;let d;if(u==="__default__"&&p&&p.length>0){const c=p.find(x=>x.type==="convert"&&x.params.defaultValue);c?(console.log(`Using default value for ${a}:`,c.params.defaultValue),d=c.params.defaultValue):(console.log(`No default value found for ${a}, using null`),d=null)}else d=s[u],console.log(`Using source value for ${a} from ${u}:`,d);p&&p.length>0&&(d=Fn(d,p)),n[a]=d}),n}),Fn=(t,r)=>r.reduce((s,n)=>Sr(s,n),t),Sr=(t,r)=>{const{type:s,params:n}=r;switch(s){case"split":return En(t,n);case"join":return In(t,n);case"format":return Rn(t,n);case"convert":return Mn(t,n);case"extract":return Dn(t,n);case"replace":return kn(t,n);default:return t}},Dn=(t,r)=>{if(typeof t!="string")return t;const{pattern:s}=r;try{const n=new RegExp(s),i=t.match(n);if(i&&i.length>0)return i[1]||i[0]}catch{console.error("Invalid regex pattern:",s)}return t},kn=(t,r)=>{if(typeof t!="string")return t;const{from:s,to:n="",useRegex:i=!1}=r;if(!s)return t;try{if(i){const u=new RegExp(s,"g");return t.replace(u,n)}else return t.replace(new RegExp(s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n)}catch(u){return console.error("Error in replace transformation:",u),t}},En=(t,r)=>{if(typeof t!="string")return t;const{delimiter:s,index:n}=r,i=t.split(s);return n!==void 0?i[n]||"":i},In=(t,r)=>{if(!Array.isArray(t))return t;const{delimiter:s=", "}=r;return t.join(s)},Rn=(t,r)=>{const{format:s,type:n}=r;if(n==="date"&&t)try{const i=new Date(t);if(isNaN(i.getTime()))return t;switch(s){case"MM/DD/YYYY":return`${(i.getMonth()+1).toString().padStart(2,"0")}/${i.getDate().toString().padStart(2,"0")}/${i.getFullYear()}`;case"YYYY-MM-DD":return`${i.getFullYear()}-${(i.getMonth()+1).toString().padStart(2,"0")}-${i.getDate().toString().padStart(2,"0")}`;case"ISO":return i.toISOString();default:return t}}catch{return t}if(n==="number"&&t!==void 0&&t!==null)try{const i=Number(t);if(isNaN(i))return t;switch(s){case"integer":return Math.round(i);case"fixed2":return i.toFixed(2);case"currency":return`$${i.toFixed(2)}`;case"percent":return`${(i*100).toFixed(1)}%`;default:return t}}catch{return t}return t},Mn=(t,r)=>{const{targetType:s}=r;switch(s){case"string":return t!=null?String(t):"";case"number":if(t==null||t==="")return null;const n=Number(t);return isNaN(n)?t:n;case"boolean":return typeof t=="string"?["true","yes","1","y"].includes(t.toLowerCase()):!!t;case"date":if(!t)return null;try{const i=new Date(t);return isNaN(i.getTime())?t:i}catch{return t}default:return t}},_n=te(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"})),$n=({id:t,isMapped:r,targetFields:s,sampleValue:n,dataType:i})=>{const u={backgroundColor:r?"#f0f7ff":void 0,border:r?"1px solid #90caf9":"1px solid #e0e0e0",cursor:"grab",padding:"8px 12px",borderRadius:"4px",marginBottom:"8px",position:"relative"},a=d=>{console.log("DRAG START on source field:",t),d.dataTransfer.setData("text/plain",t),d.dataTransfer.effectAllowed="move",console.log("Verifying dataTransfer was set:",d.dataTransfer.types);const c=document.createElement("div");c.className="drag-ghost",c.innerHTML=`<div style="padding: 10px; background: #1976d2; color: white; border-radius: 4px;">Dragging: ${t}</div>`,document.body.appendChild(c),d.dataTransfer.setDragImage(c,20,20);const x=d.currentTarget;x.style.opacity="0.6",x.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.2)",setTimeout(()=>{document.body.removeChild(c)},0),console.log("Drag started with field:",t)},p=d=>{const c=d.currentTarget;c.style.opacity="",c.style.boxShadow="",console.log("Drag ended for field:",t)};return e.jsx("div",{style:u,"data-field-id":t,className:"draggable-source-field",draggable:!0,onDragStart:a,onDragEnd:p,children:e.jsxs(b,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsxs(b,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(g,{variant:"body2",fontWeight:"medium",children:t}),r&&e.jsx(de,{size:"small",icon:e.jsx(_n,{fontSize:"small"}),label:s.length===1?s[0]:`${s.length} fields`,color:"primary",variant:"outlined"})]}),n!==void 0&&e.jsxs(b,{sx:{mt:.5,display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"0.75rem"},children:[e.jsx(g,{variant:"caption",sx:{color:"text.secondary",fontFamily:"monospace",bgcolor:"grey.100",px:.5,borderRadius:.5,maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:typeof n=="object"?JSON.stringify(n):String(n)}),i&&e.jsx(de,{label:i,size:"small",variant:"outlined",sx:{height:"16px",fontSize:"0.65rem","& .MuiChip-label":{px:.5,py:0}}})]})]})})},zn=({sourceColumns:t,filter:r,setFilter:s,mappings:n,sampleData:i=[]})=>{const u=w.useMemo(()=>{if(!r)return t;const x=r.toLowerCase();return t.filter(f=>f.toLowerCase().includes(x))},[t,r]),a=w.useMemo(()=>{const x={};return n.forEach(f=>{x[f.sourceField]||(x[f.sourceField]=[]),x[f.sourceField].push(f.targetField)}),x},[n]),p=w.useMemo(()=>Object.keys(a).length,[a]),d=w.useMemo(()=>{if(!i||i.length===0)return{};const x=i[0],f={};return t.forEach(v=>{f[v]=x[v]}),f},[i,t]),c=w.useMemo(()=>{const x={};return Object.entries(d).forEach(([f,v])=>{if(v==null){x[f]="Unknown";return}if(typeof v=="string"){if([/^\d{4}-\d{2}-\d{2}$/,/^\d{1,2}\/\d{1,2}\/\d{2,4}$/,/^\d{4}\/\d{2}\/\d{2}$/].some(z=>z.test(v))){x[f]="Date";return}if([/^\d{1,2}:\d{2}(:\d{2})?$/,/^\d{1,2}:\d{2}(:\d{2})?\s*(AM|PM)$/i].some(z=>z.test(v))){x[f]="Time";return}if(!isNaN(Number(v))){x[f]="Number";return}x[f]="Text";return}typeof v=="number"?x[f]="Number":typeof v=="boolean"?x[f]="Boolean":Array.isArray(v)?x[f]="Array":typeof v=="object"?x[f]="Object":x[f]=typeof v}),x},[d]);return e.jsxs(he,{sx:{height:"100%",p:2,display:"flex",flexDirection:"column",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",border:"2px solid #e0e0e0",borderRadius:"8px",overflow:"hidden"},children:[e.jsx(be,{size:"small",placeholder:"Search source fields...",value:r,onChange:x=>s(x.target.value),fullWidth:!0,sx:{mb:2},InputProps:{startAdornment:e.jsx(_e,{position:"start",children:e.jsx(ot,{fontSize:"small"})})}}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(g,{variant:"body2",color:"text.secondary",children:[u.length," fields"]}),e.jsxs(g,{variant:"body2",color:"text.secondary",children:[p," mapped"]})]}),e.jsx(b,{sx:{mb:2,p:1,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1,border:"1px dashed",borderColor:"primary.main"},children:e.jsx(g,{variant:"body2",color:"primary",sx:{fontWeight:"bold"},children:"Drag fields from here to the Target Fields panel"})}),e.jsx(xe,{sx:{mb:2}}),e.jsxs(b,{sx:{flexGrow:1,overflow:"auto",maxHeight:"calc(100% - 180px)",scrollbarWidth:"thin",border:"1px solid #e0e0e0",borderRadius:"4px",padding:"8px",backgroundColor:"#fafafa","&::-webkit-scrollbar":{width:"10px"},"&::-webkit-scrollbar-track":{background:"#f1f1f1",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{background:"#2196f3",borderRadius:"4px","&:hover":{background:"#1976d2"}}},children:[u.map(x=>e.jsx($n,{id:x,isMapped:!!a[x],targetFields:a[x]||[],sampleValue:d[x],dataType:c[x]},x)),u.length===0&&e.jsx(b,{sx:{textAlign:"center",py:4},children:e.jsx(g,{variant:"body2",color:"text.secondary",children:"No fields match your search"})})]})]})},wr=te(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"})),Ln=te(e.jsx("path",{d:"m20.5 10 .5-2h-4l1-4h-2l-1 4h-4l1-4h-2L9 8H5l-.5 2h4l-1 4h-4L3 16h4l-1 4h2l1-4h4l-1 4h2l1-4h4l.5-2h-4l1-4zm-7 4h-4l1-4h4z"})),On=te(e.jsx("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"})),Pn=te(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2m-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"})),An=({open:t,onClose:r,fieldName:s,mapping:n,sampleData:i,onSave:u})=>{const[a,p]=w.useState(0),[d,c]=w.useState([]),[x,f]=w.useState("auto"),[v,k]=w.useState(""),[E,z]=w.useState(","),[N,F]=w.useState(0),[B,I]=w.useState("string");w.useEffect(()=>{if(n){if(n.sourceField&&i.length>0){const o=i.map(m=>m[n.sourceField]).filter(m=>m!=null).slice(0,5);c(o)}n.transformations&&n.transformations.length>0&&n.transformations.forEach(o=>{switch(o.type){case"format":o.params.dateFormat&&(o.params.dateFormat==="custom"?(f("custom"),k(o.params.customFormat||"")):f(o.params.dateFormat));break;case"split":z(o.params.delimiter||","),F(o.params.index||0);break;case"convert":I(o.params.toType||"string");break}})}},[n,i]);const C=(o,m)=>{p(m)},L=()=>{const o=[];a===0&&x!=="auto"&&o.push({type:"format",params:{dateFormat:x,...x==="custom"?{customFormat:v}:{}}}),a===1&&o.push({type:"split",params:{delimiter:E,index:N}}),a===2&&o.push({type:"convert",params:{toType:B}}),u(s,o)},O=d.length>0,l=(()=>{if(!O)return[];switch(a){case 0:return d.map(o=>{if(!o)return"N/A";try{const m=new Date(o);if(isNaN(m.getTime()))return"Invalid date";switch(x){case"auto":return m.toLocaleString();case"MM/DD/YYYY":return`${m.getMonth()+1}/${m.getDate()}/${m.getFullYear()}`;case"YYYY-MM-DD":return`${m.getFullYear()}-${(m.getMonth()+1).toString().padStart(2,"0")}-${m.getDate().toString().padStart(2,"0")}`;case"DD/MM/YYYY":return`${m.getDate()}/${m.getMonth()+1}/${m.getFullYear()}`;case"custom":return v.replace("YYYY",m.getFullYear().toString()).replace("MM",(m.getMonth()+1).toString().padStart(2,"0")).replace("DD",m.getDate().toString().padStart(2,"0")).replace("HH",m.getHours().toString().padStart(2,"0")).replace("mm",m.getMinutes().toString().padStart(2,"0")).replace("ss",m.getSeconds().toString().padStart(2,"0"));default:return m.toLocaleString()}}catch{return"Error formatting date"}});case 1:return d.map(o=>{if(!o)return"N/A";try{return o.toString().split(E)[N]||`Index ${N} not found`}catch{return"Error splitting value"}});case 2:return d.map(o=>{if(o==null)return"N/A";try{switch(B){case"string":return String(o);case"number":return Number(o);case"boolean":return(!!o).toString();default:return String(o)}}catch{return"Error converting value"}})}return[]})();return e.jsxs(it,{open:t,onClose:r,maxWidth:"md",fullWidth:!0,children:[e.jsxs(at,{children:["Transform Field: ",s]}),e.jsx(lt,{dividers:!0,children:e.jsxs(b,{sx:{width:"100%"},children:[e.jsx(b,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(gt,{value:a,onChange:C,"aria-label":"transformation tabs",children:[e.jsx(De,{label:"Date/Time Format"}),e.jsx(De,{label:"Split/Extract"}),e.jsx(De,{label:"Type Conversion"})]})}),e.jsxs(b,{role:"tabpanel",hidden:a!==0,sx:{p:2},children:[e.jsx(g,{variant:"subtitle1",gutterBottom:!0,children:"Date Format Settings"}),e.jsx(g,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Choose how date and time values should be formatted."}),e.jsxs(He,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Ue,{id:"date-format-label",children:"Date Format"}),e.jsxs(We,{labelId:"date-format-label",id:"date-format-select",value:x,label:"Date Format",onChange:o=>f(o.target.value),children:[e.jsx(ae,{value:"auto",children:"Auto-detect"}),e.jsx(ae,{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),e.jsx(ae,{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),e.jsx(ae,{value:"YYYY-MM-DD",children:"YYYY-MM-DD"}),e.jsx(ae,{value:"custom",children:"Custom Format"})]})]}),x==="custom"&&e.jsx(be,{fullWidth:!0,label:"Custom Format",value:v,onChange:o=>k(o.target.value),helperText:"Use YYYY for year, MM for month, DD for day, HH for hour, mm for minute, ss for second",sx:{mb:2}})]}),e.jsxs(b,{role:"tabpanel",hidden:a!==1,sx:{p:2},children:[e.jsx(g,{variant:"subtitle1",gutterBottom:!0,children:"Split or Extract Value"}),e.jsx(g,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Split a field by a delimiter and extract a specific part."}),e.jsx(be,{fullWidth:!0,label:"Delimiter",value:E,onChange:o=>z(o.target.value),helperText:"Character or text that separates the parts",sx:{mb:2}}),e.jsx(be,{fullWidth:!0,label:"Index",type:"number",value:N,onChange:o=>F(parseInt(o.target.value)||0),helperText:"Position of the part to extract (0 = first part)",sx:{mb:2}})]}),e.jsxs(b,{role:"tabpanel",hidden:a!==2,sx:{p:2},children:[e.jsx(g,{variant:"subtitle1",gutterBottom:!0,children:"Type Conversion"}),e.jsx(g,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Convert the value to a different data type."}),e.jsxs(He,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Ue,{id:"convert-type-label",children:"Convert To"}),e.jsxs(We,{labelId:"convert-type-label",id:"convert-type-select",value:B,label:"Convert To",onChange:o=>I(o.target.value),children:[e.jsx(ae,{value:"string",children:"Text (String)"}),e.jsx(ae,{value:"number",children:"Number"}),e.jsx(ae,{value:"boolean",children:"True/False (Boolean)"})]})]})]}),e.jsx(xe,{sx:{my:2}}),e.jsx(g,{variant:"subtitle1",gutterBottom:!0,children:"Preview"}),O?e.jsxs(b,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(b,{sx:{display:"flex",borderBottom:1,borderColor:"divider",pb:1},children:[e.jsx(g,{variant:"body2",fontWeight:"bold",sx:{width:"50%"},children:"Original Value"}),e.jsx(g,{variant:"body2",fontWeight:"bold",sx:{width:"50%"},children:"Transformed Value"})]}),d.map((o,m)=>e.jsxs(b,{sx:{display:"flex",py:1,borderBottom:"1px solid #eee"},children:[e.jsx(g,{variant:"body2",sx:{width:"50%"},children:o==null?"Null/Empty":String(o)}),e.jsx(g,{variant:"body2",sx:{width:"50%"},children:l[m]})]},m))]}):e.jsx(pe,{severity:"info",children:"No sample data available for preview."})]})}),e.jsxs(ct,{children:[e.jsx(Z,{onClick:r,children:"Cancel"}),e.jsx(Z,{onClick:L,variant:"contained",children:"Apply Transformation"})]})]})},Vn=t=>{switch(t.dataType){case"string":return`DEFAULT-${t.name}`;case"number":return"0";case"boolean":return"false";case"date":return new Date().toISOString().split("T")[0];case"location":return"0.0,0.0";default:return""}},Nn=({open:t,onClose:r,unmappedRequiredFields:s,onAddDefaultMappings:n})=>{const[i,u]=w.useState(()=>{const c={};return s.forEach(x=>{c[x.name]=Vn(x)}),c}),a=(c,x)=>{u(f=>({...f,[c]:x}))},p=()=>{console.log("Creating default mappings for fields:",s),console.log("Default values:",i);const c=s.map(x=>{const f={sourceField:"__default__",targetField:x.name,transformations:[{type:"convert",params:{defaultValue:i[x.name],targetType:x.dataType}}]};return console.log(`Created default mapping for ${x.name}:`,f),f});console.log("All default mappings:",c),n(c),r()},d=c=>{switch(c){case"number":return"number";case"date":return"date";default:return"text"}};return e.jsxs(it,{open:t,onClose:r,"aria-labelledby":"default-value-dialog-title",maxWidth:"md",fullWidth:!0,children:[e.jsx(at,{id:"default-value-dialog-title",children:"Set Default Values for Required Fields"}),e.jsxs(lt,{children:[e.jsx(g,{variant:"body1",sx:{mb:3},children:"The following required fields don't have mappings. Please provide default values for them."}),e.jsx(le,{container:!0,spacing:3,children:s.map(c=>e.jsxs(le,{size:{xs:12,sm:6},children:[e.jsxs(b,{sx:{mb:1},children:[e.jsxs(g,{variant:"subtitle2",children:[c.name,e.jsx(de,{size:"small",label:c.dataType,color:"primary",variant:"outlined",sx:{ml:1}})]}),e.jsx(g,{variant:"caption",color:"text.secondary",children:c.description})]}),c.dataType==="boolean"?e.jsxs(be,{select:!0,fullWidth:!0,value:i[c.name]||"false",onChange:x=>a(c.name,x.target.value),variant:"outlined",size:"small",children:[e.jsx(ae,{value:"true",children:"True"}),e.jsx(ae,{value:"false",children:"False"})]}):e.jsx(be,{fullWidth:!0,value:i[c.name]||"",onChange:x=>a(c.name,x.target.value),type:d(c.dataType),variant:"outlined",size:"small",placeholder:`Enter default value for ${c.name}`,InputLabelProps:{shrink:!0}}),e.jsx(es,{children:"Default value for all records"})]},c.name))})]}),e.jsxs(ct,{children:[e.jsx(Z,{onClick:r,color:"primary",children:"Cancel"}),e.jsx(Z,{onClick:p,color:"primary",variant:"contained",children:"Apply Default Values"})]})]})},Bn=te(e.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"})),zt=te(e.jsx("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.996.996 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"})),xt=te(e.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"})),Cr=te(e.jsx("path",{d:"M16.59 7.58 10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"})),Hn=({mapping:t,sampleData:r,onClose:s})=>{const n=Ot(),i=w.useMemo(()=>!t||!r.length?[]:r.slice(0,5).map(a=>({sourceValue:a[t.sourceField],transformedValue:(t.transformations||[]).reduce((p,d)=>Sr(p,d),a[t.sourceField])})),[t,r]);if(!t)return e.jsx(he,{sx:{p:2,mt:2,backgroundColor:ce(n.palette.info.light,.1),border:`1px dashed ${n.palette.info.main}`,borderRadius:1},children:e.jsx(g,{variant:"body2",color:"text.secondary",align:"center",children:"Select a field mapping to see transformation preview"})});if(!i.length||!t.sourceField)return e.jsx(he,{sx:{p:2,mt:2,backgroundColor:ce(n.palette.warning.light,.1),border:`1px dashed ${n.palette.warning.main}`,borderRadius:1},children:e.jsxs(g,{variant:"body2",color:"text.secondary",children:["No sample data available for ",t.sourceField||"this field"]})});const u=t.transformations||[];return e.jsxs(he,{sx:{p:2,mt:2,borderRadius:1,border:`1px solid ${n.palette.divider}`,boxShadow:n.shadows[1],position:"relative"},children:[s&&e.jsx(ke,{size:"small",onClick:s,sx:{position:"absolute",top:8,right:8,color:n.palette.grey[500],"&:hover":{backgroundColor:ce(n.palette.grey[100],.9),color:n.palette.grey[800]}},"aria-label":"close preview",children:e.jsx(Vr,{fontSize:"small"})}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,pr:4},children:[e.jsxs(g,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:["Field Transformation Preview: ",t.targetField]}),e.jsx(de,{size:"small",label:`${u.length} transformation${u.length!==1?"s":""}`,color:u.length>0?"primary":"default",icon:u.length>0?e.jsx(zt,{}):void 0})]}),e.jsx(xe,{sx:{mb:2}}),e.jsx(b,{sx:{maxHeight:200,overflow:"auto"},children:i.map((a,p)=>{const d=a.sourceValue!==void 0&&a.sourceValue!==null,c=u.length>0,x=typeof a.sourceValue,f=typeof a.transformedValue,v=x!==f;return e.jsxs(b,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:p%2===0?ce(n.palette.background.default,.5):"transparent",display:"flex",alignItems:"center"},children:[e.jsxs(b,{sx:{flexBasis:"45%"},children:[e.jsxs(g,{variant:"caption",color:"text.secondary",children:["Source (",t.sourceField,")"]}),e.jsx(g,{variant:"body2",sx:{fontFamily:"monospace",backgroundColor:d?ce(n.palette.success.light,.1):ce(n.palette.error.light,.1),p:.5,borderRadius:.5,wordBreak:"break-all"},children:d?String(a.sourceValue):"(empty)"}),e.jsx(g,{variant:"caption",color:"text.secondary",children:x})]}),e.jsx(b,{sx:{flexBasis:"10%",textAlign:"center"},children:e.jsx(Bn,{color:c?"primary":"action"})}),e.jsxs(b,{sx:{flexBasis:"45%"},children:[e.jsxs(g,{variant:"caption",color:"text.secondary",children:["Result (",t.targetField,")"]}),e.jsx(g,{variant:"body2",sx:{fontFamily:"monospace",backgroundColor:a.transformedValue!==void 0?ce(n.palette.success.light,.1):ce(n.palette.error.light,.1),p:.5,borderRadius:.5,wordBreak:"break-all"},children:a.transformedValue!==void 0?String(a.transformedValue):"(empty)"}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsx(g,{variant:"caption",color:"text.secondary",children:f}),v&&e.jsx(de,{size:"small",label:`Type: ${x}  ${f}`,color:"warning",variant:"outlined",sx:{height:16,fontSize:"0.6rem"}})]})]})]},p)})}),u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{sx:{my:2}}),e.jsx(g,{variant:"subtitle2",gutterBottom:!0,children:"Transformation Steps Applied:"}),e.jsx(b,{sx:{display:"flex",flexDirection:"column",gap:1},children:u.map((a,p)=>{var d,c,x,f,v,k;return e.jsxs(b,{sx:{display:"flex",alignItems:"center",p:1,borderRadius:1,backgroundColor:ce(n.palette.primary.light,.05),border:`1px solid ${ce(n.palette.primary.light,.2)}`},children:[e.jsxs(b,{sx:{mr:1,color:n.palette.primary.main},children:[p+1,"."]}),e.jsxs(g,{variant:"body2",children:[e.jsxs("strong",{children:[a.type,":"]})," "," ",a.type==="convert"&&((d=a.params)==null?void 0:d.dataType)&&`Convert to ${a.params.dataType}`,a.type==="convert"&&((c=a.params)==null?void 0:c.defaultValue)!==void 0&&`Set default value to "${a.params.defaultValue}"`,a.type==="format"&&((x=a.params)==null?void 0:x.pattern)&&`Format using pattern "${a.params.pattern}"`,a.type==="extract"&&((f=a.params)==null?void 0:f.pattern)&&`Extract using pattern "${a.params.pattern}"`,a.type==="replace"&&((v=a.params)==null?void 0:v.from)&&((k=a.params)==null?void 0:k.to)&&`Replace "${a.params.from}" with "${a.params.to}"`]})]},p)})})]}),t.targetField&&e.jsxs(b,{sx:{mt:2,p:1,borderRadius:1,display:"flex",alignItems:"center",backgroundColor:i.some(a=>a.transformedValue===void 0||a.transformedValue===null)?ce(n.palette.warning.light,.1):ce(n.palette.success.light,.1)},children:[i.some(a=>a.transformedValue===void 0||a.transformedValue===null)?e.jsx(xt,{color:"warning",sx:{mr:1}}):e.jsx(Cr,{color:"success",sx:{mr:1}}),e.jsx(g,{variant:"body2",children:i.some(a=>a.transformedValue===void 0||a.transformedValue===null)?"Some values could not be transformed. Consider adding a default value.":"All sample values were successfully transformed."})]})]})},Yn=te(e.jsx("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"})),Un=ue(({className:t,...r})=>e.jsx(Nr,{...r,classes:{popper:t}}))(()=>({"& .MuiTooltip-tooltip":{backgroundColor:"transparent",padding:0,maxWidth:320}})),Wn=ue(he)(({theme:t})=>({padding:t.spacing(2),backgroundColor:t.palette.background.paper,boxShadow:t.shadows[3],borderRadius:t.shape.borderRadius,border:`1px solid ${t.palette.divider}`,minWidth:200,maxWidth:320})),qn=ue(g)(({theme:t})=>({fontWeight:600,marginBottom:t.spacing(1),borderBottom:`1px solid ${t.palette.divider}`,paddingBottom:t.spacing(.5),color:t.palette.primary.main})),Ke=({title:t,children:r,content:s,icon:n=!1,placement:i="top",enterDelay:u=100,leaveDelay:a=100})=>{console.log(`EnhancedTooltip rendering: ${t} with icon=${n}`);const p=n?e.jsxs(b,{sx:{display:"inline-flex",alignItems:"center"},children:[r,e.jsx(Yn,{color:"action",fontSize:"small",sx:{ml:.5,opacity:.7}})]}):r;return e.jsx(Un,{title:e.jsxs(Wn,{children:[e.jsx(qn,{variant:"subtitle2",children:t}),s]}),placement:i,arrow:!0,enterDelay:u,leaveDelay:a,children:p})},Gn=({toolConfig:t,showAllFields:r,setShowAllFields:s,filter:n,setFilter:i,mappings:u,onMappingChange:a,onRemoveMapping:p,validationErrors:d,sampleData:c,sourceColumns:x=[]})=>{const f=Ot();console.log("TargetFieldsPanel received sourceColumns:",x),console.log("TargetFieldsPanel received toolConfig:",t),console.log("TargetFieldsPanel received mappings:",u);const[v,k]=w.useState(null),[E,z]=w.useState(null),[N,F]=w.useState({Timing:!0,Location:!0,"Incident Details":!0}),B=w.useMemo(()=>{const h={};return d.forEach(D=>{h[D.field]={message:D.message,severity:D.severity}}),h},[d]),I=w.useMemo(()=>{const h={};return u.forEach(D=>{h[D.targetField]=D.sourceField}),h},[u]),C=w.useMemo(()=>{const h={};return[...t.requiredFields,...t.optionalFields].forEach(y=>{let P;y.dataType==="date"||y.name.toLowerCase().includes("time")||y.name.toLowerCase().includes("date")?P="Timing":y.dataType==="location"||y.name.toLowerCase().includes("lat")||y.name.toLowerCase().includes("lon")||y.name.toLowerCase().includes("address")?P="Location":P="Incident Details",h[P]||(h[P]=[]),h[P].push(y)}),h},[t]),L=w.useMemo(()=>{if(!n)return r?[...t.requiredFields,...t.optionalFields]:C;const h=n.toLowerCase(),y=[...t.requiredFields,...t.optionalFields].filter(M=>{var W;return M.name.toLowerCase().includes(h)||((W=M.description)==null?void 0:W.toLowerCase().includes(h))});if(r)return y;const P={};return y.forEach(M=>{let W;for(const[G,X]of Object.entries(C))if(X.some(re=>re.id===M.id)){W=G;break}W||(W="Other"),P[W]||(P[W]=[]),P[W].push(M)}),P},[t,n,r,C]),O=h=>{F({...N,[h]:!N[h]})},V=(h,D)=>{console.log("Dropdown selection - mapping",D,"to",h);try{if(!D){p(h);return}a({sourceField:D,targetField:h}),console.log("Mapping updated via dropdown successfully")}catch(y){console.error("Error updating mapping via dropdown:",y)}},l=h=>{k(h)},o=()=>{k(null)},m=h=>{z(D=>D===h?null:h)},j=(h,D)=>{const y=u.find(P=>P.targetField===h);y&&a({...y,transformations:D}),k(null)},R=h=>{switch(h){case"string":return{icon:e.jsx(qt,{fontSize:"small"}),color:"info"};case"number":return{icon:e.jsx(Ln,{fontSize:"small"}),color:"secondary"};case"date":return{icon:e.jsx(On,{fontSize:"small"}),color:"warning"};case"boolean":return{icon:e.jsx(Pn,{fontSize:"small"}),color:"success"};case"location":return{icon:e.jsx(ss,{fontSize:"small"}),color:"error"};default:return{icon:e.jsx(qt,{fontSize:"small"}),color:"default"}}},H=h=>{const D=I[h.name],y=B[h.name],P=E===h.name;console.log(`Rendering field ${h.name}, mapped to: ${D||"none"}`);const M=_=>{_.preventDefault(),_.stopPropagation(),_.dataTransfer.dropEffect="move";const U=_.currentTarget;U.style.boxShadow="0 0 0 2px #1976d2",U.style.borderColor="#1976d2",U.style.backgroundColor="#f0f7ff",U.style.transform="scale(1.01)",U.style.transition="all 0.2s ease",console.log("DRAG OVER on target field:",h.name)},W=_=>{_.preventDefault(),_.stopPropagation();const U=_.currentTarget;U.style.boxShadow="",U.style.borderColor=y?y.severity==="error"?"#f44336":"#ff9800":D?"#4caf50":"#e0e0e0",U.style.backgroundColor=y?y.severity==="error"?"#fff5f5":"#fffbf0":D?"#f4fbf4":"#ffffff",U.style.transform="",console.log("DRAG LEAVE from field:",h.name)},G=_=>{_.preventDefault(),_.stopPropagation(),console.log("DROP EVENT TRIGGERED on field:",h.name);try{const U=_.dataTransfer.getData("text/plain");if(console.log("Dropped source field data:",U),!U){console.error("No source field data found in the drop event");return}const A=_.currentTarget;A.style.boxShadow="",A.style.borderColor="",A.style.backgroundColor="",A.style.transform="",a({sourceField:U,targetField:h.name}),z(h.name),A.style.boxShadow="0 0 0 2px #4caf50",A.style.borderColor="#4caf50",A.style.backgroundColor="#f4fbf4",A.style.transform="scale(1.02)";const ne=U;setTimeout(()=>{try{ne?(A.style.borderColor="#4caf50",A.style.backgroundColor="#f4fbf4"):(A.style.borderColor=y?y.severity==="error"?"#f44336":"#ff9800":"#e0e0e0",A.style.backgroundColor=y?y.severity==="error"?"#fff5f5":"#fffbf0":"#ffffff"),A.style.boxShadow="",A.style.transform=""}catch(ee){console.error("Error in animation cleanup:",ee)}},1e3),console.log(`Successfully dropped ${U} onto ${h.name}`)}catch(U){console.error("Error in drop handler:",U)}},X=()=>{D&&m(h.name)},re=()=>e.jsxs(b,{children:[e.jsxs(g,{variant:"body2",children:[e.jsx("strong",{children:"Required Format:"})," ",h.format||"No specific format required"]}),h.examples&&e.jsxs(b,{sx:{mt:1},children:[e.jsx(g,{variant:"body2",children:e.jsx("strong",{children:"Examples:"})}),e.jsx(b,{component:"ul",sx:{mt:.5,pl:2},children:h.examples.map((_,U)=>e.jsx(b,{component:"li",children:e.jsx(g,{variant:"body2",fontFamily:"monospace",children:_})},U))})]}),h.validation&&e.jsxs(g,{variant:"body2",sx:{mt:1},children:[e.jsx("strong",{children:"Validation:"})," ",String(h.validation)]})]}),q=()=>{let _="";switch(h.dataType){case"string":_="Text value. Can contain any characters.";break;case"number":_="Numeric value. Can be integer or decimal.";break;case"date":_="Date value. Should be in a standard format.";break;case"boolean":_="True/False value.";break;case"location":_="Geographic coordinates or address.";break;default:_=`${h.dataType} data type.`}return e.jsxs(b,{children:[e.jsx(g,{variant:"body2",children:_}),h.dataType==="date"&&e.jsx(g,{variant:"body2",sx:{mt:1},children:"Common formats: YYYY-MM-DD, MM/DD/YYYY"})]})};return e.jsxs(b,{sx:{p:2,mb:2,border:"1px solid",borderColor:y?y.severity==="error"?"error.main":"warning.main":D?"success.light":"divider",borderRadius:1,bgcolor:y?y.severity==="error"?ce(f.palette.error.light,.1):ce(f.palette.warning.light,.1):D?ce(f.palette.success.light,.1):"background.paper",position:"relative",transition:"all 0.3s ease",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",cursor:D?"pointer":"default",...P&&{boxShadow:"0 0 0 2px #1976d2",border:"1px solid #1976d2"},"&:hover":D?{boxShadow:"0 2px 4px rgba(0,0,0,0.1)",transform:"translateY(-2px)"}:{}},draggable:!1,id:`target-field-${h.name}`,"data-target-field":h.name,onDragOver:M,onDragLeave:W,onDrop:G,onClick:X,children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(b,{children:[e.jsx(Ke,{title:`${h.name} Field`,content:re(),placement:"top-start",icon:!0,children:e.jsxs(g,{variant:"subtitle2",component:"div",sx:{display:"inline-flex",alignItems:"center",cursor:"help"},children:[h.name,h.isRequired&&e.jsx(de,{size:"small",label:"Required",color:"primary",sx:{ml:1,height:20}}),D&&e.jsx(de,{size:"small",label:"Click to preview",color:"info",variant:"outlined",sx:{ml:1,height:20,display:{xs:"none",sm:"flex"},animation:P?"none":"pulse 1.5s infinite","@keyframes pulse":{"0%":{boxShadow:"0 0 0 0 rgba(33, 150, 243, 0.4)"},"70%":{boxShadow:"0 0 0 6px rgba(33, 150, 243, 0)"},"100%":{boxShadow:"0 0 0 0 rgba(33, 150, 243, 0)"}}}})]})}),h.dataType&&e.jsx(Ke,{title:`${h.dataType} Data Type`,content:q(),children:e.jsx(de,{size:"small",label:h.dataType,color:R(h.dataType).color,variant:"outlined",icon:R(h.dataType).icon,sx:{mt:1,mr:1,height:20}})}),e.jsx(g,{variant:"body2",color:"text.secondary",children:h.description})]}),e.jsxs(b,{sx:{display:"flex",alignItems:"flex-start"},children:[y&&e.jsx(Ke,{title:"Validation Issue",content:e.jsx(g,{variant:"body2",children:y.message}),type:y.severity==="error"?"warning":"info",children:e.jsx(b,{sx:{display:"flex",alignItems:"center",mr:1},children:y.severity==="error"?e.jsx(wr,{color:"error",fontSize:"small"}):e.jsx(hr,{color:"warning",fontSize:"small"})})}),D&&e.jsxs(e.Fragment,{children:[e.jsx(Ke,{title:"Edit Transformations",content:e.jsx(g,{variant:"body2",children:"Configure data transformations for this field mapping. Apply operations like splitting, joining, formatting and type conversion."}),children:e.jsx(ke,{size:"small",onClick:_=>{_.stopPropagation(),l(h.name)},sx:{mr:1},children:e.jsx(fr,{fontSize:"small"})})}),e.jsx(Ke,{title:"Remove Mapping",content:e.jsx(g,{variant:"body2",children:"Remove the current mapping between source and target fields."}),type:"warning",children:e.jsx(ke,{size:"small",onClick:_=>{_.stopPropagation(),p(h.name)},children:e.jsx(ft,{fontSize:"small"})})})]})]})]}),e.jsxs(He,{fullWidth:!0,size:"small",children:[e.jsx(Ue,{id:`${h.id}-source-label`,children:"Select source field"}),e.jsxs(We,{labelId:`${h.id}-source-label`,id:`${h.id}-source-select`,value:D||"",label:"Select source field",onChange:_=>{try{V(h.name,_.target.value),_.target.value?z(h.name):E===h.name&&z(null)}catch(U){console.error("Error in dropdown change handler:",U)}},MenuProps:{anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{elevation:4,style:{maxHeight:300}}}},renderValue:_=>_||e.jsx("em",{style:{color:"rgba(0, 0, 0, 0.54)"},children:"Select field or drag from left"}),endAdornment:D&&e.jsx(_e,{position:"end",children:e.jsx(Ke,{title:"Field is Mapped",content:e.jsxs(g,{variant:"body2",children:['This field is mapped to source field "',D,'". Click the field to preview the mapping.']}),children:e.jsx(st,{color:"success",fontSize:"small"})})}),onClick:_=>_.stopPropagation(),children:[e.jsx(ae,{value:"",children:e.jsx("em",{style:{color:"rgba(0, 0, 0, 0.54)"},children:"Select field or drag from left"})}),Array.isArray(x)&&x.length>0?x.map(_=>{const U=c&&c.length>0?c[0][_]:void 0;let A="Unknown";U!=null&&(typeof U=="string"?[/^\d{4}-\d{2}-\d{2}$/,/^\d{1,2}\/\d{1,2}\/\d{2,4}$/].some(se=>se.test(U))?A="Date":/^\d{1,2}:\d{2}(:\d{2})?(\s*(AM|PM))?$/i.test(U)?A="Time":isNaN(Number(U))?A="Text":A="Number":A=typeof U);const ne=ee=>ee==null?"":typeof ee=="object"?JSON.stringify(ee).substring(0,30):String(ee).substring(0,30);return e.jsx(ae,{value:_,children:e.jsxs(b,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsx(g,{variant:"body2",children:_}),U!==void 0&&e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsx(g,{variant:"caption",sx:{fontFamily:"monospace",bgcolor:"grey.100",px:.5,borderRadius:.5,maxWidth:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"text.secondary"},children:ne(U)}),e.jsx(de,{label:A,size:"small",sx:{height:16,fontSize:"0.65rem","& .MuiChip-label":{px:.5,py:0}}})]})]})},_)}):e.jsx(ae,{disabled:!0,children:e.jsx("em",{children:"No source fields available"})})]})]})]},h.id)},T=()=>{if(r){const h=Array.isArray(L)?L:Object.values(L).flat();return e.jsx(b,{children:h.map(H)})}else return Object.entries(L).map(([h,D])=>e.jsxs(dr,{expanded:N[h]||!1,onChange:()=>O(h),sx:{mb:2},children:[e.jsxs(ur,{expandIcon:e.jsx(yt,{}),children:[e.jsx(g,{variant:"subtitle1",children:h}),e.jsxs(g,{variant:"body2",color:"text.secondary",sx:{ml:2},children:[D.length," fields"]})]}),e.jsx(pr,{children:D.map(H)})]},h))},[Y,K]=w.useState(!1),S=w.useMemo(()=>t.requiredFields.filter(D=>!u.some(y=>y.targetField===D.name)),[t.requiredFields,u]),$=h=>{console.log("Received default mappings:",h),h.forEach(D=>{console.log("Adding default mapping for:",D.targetField,D),a(D)}),console.log("Current mappings after adding defaults:",u)};return e.jsxs(he,{sx:{p:2,height:"100%",display:"flex",flexDirection:"column",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",border:"2px solid #e0e0e0",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[S.length>0&&e.jsxs(Z,{variant:"outlined",size:"small",startIcon:e.jsx(Br,{}),onClick:()=>K(!0),color:"primary",children:["Set Default Values (",S.length,")"]}),e.jsx(rt,{control:e.jsx(Hr,{checked:r,onChange:h=>s(h.target.checked),size:"small"}),label:"Show all fields A-Z"})]}),S.length>0&&e.jsxs(pe,{severity:"warning",sx:{mb:2},action:e.jsx(Z,{color:"inherit",size:"small",onClick:()=>K(!0),children:"Set Defaults"}),children:[S.length," required ",S.length===1?"field":"fields"," not mapped. Please map or set default values to continue."]}),e.jsx(be,{size:"small",placeholder:"Search target fields...",value:n,onChange:h=>i(h.target.value),fullWidth:!0,sx:{mb:2},InputProps:{startAdornment:e.jsx(_e,{position:"start",children:e.jsx(ot,{fontSize:"small"})})}}),e.jsx(xe,{sx:{mb:2}}),e.jsx(b,{sx:{mb:2,p:1,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1,border:"1px dashed",borderColor:"primary.main"},children:e.jsx(g,{variant:"body2",color:"primary",sx:{fontWeight:"bold"},children:"Drop source fields onto target fields or use the drop-down menus below"})}),E&&e.jsx(Hn,{mapping:u.find(h=>h.targetField===E)||null,sampleData:c,onClose:()=>z(null)}),e.jsx(b,{sx:{flexGrow:1,maxHeight:"calc(100% - 220px)",overflow:"auto",scrollbarWidth:"thin",border:"1px solid #e0e0e0",borderRadius:"4px",padding:"8px",backgroundColor:"#fafafa","&::-webkit-scrollbar":{width:"10px"},"&::-webkit-scrollbar-track":{background:"#f1f1f1",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{background:"#2196f3",borderRadius:"4px","&:hover":{background:"#1976d2"}}},children:T()}),v&&e.jsx(An,{open:!!v,onClose:o,fieldName:v,mapping:u.find(h=>h.targetField===v),sampleData:c,onSave:j}),e.jsx(Nn,{open:Y,onClose:()=>K(!1),unmappedRequiredFields:S,onAddDefaultMappings:$})]})},Jn=({validationErrors:t,jumpToField:r})=>{const[s,n]=Ze.useState(!1),i=t.filter(p=>p.severity==="error").length,u=t.filter(p=>p.severity==="warning").length,a=()=>{n(!s)};return e.jsxs(he,{sx:{p:2,position:"sticky",top:16},children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:a,children:[e.jsxs(g,{variant:"h6",color:i>0?"error":"warning",children:["Validation Issues ",i>0?`(${i} errors, ${u} warnings)`:`(${u} warnings)`]}),e.jsx(Z,{size:"small",endIcon:s?e.jsx(lr,{}):e.jsx(yt,{}),children:s?"Collapse":"Expand"})]}),e.jsxs(xr,{in:s,children:[e.jsx(xe,{sx:{my:1}}),e.jsx(b,{sx:{maxHeight:"200px",overflow:"auto"},children:e.jsx(qe,{dense:!0,children:t.map((p,d)=>e.jsxs(Se,{sx:{bgcolor:p.severity==="error"?"error.lightest":"warning.lightest",mb:.5,borderRadius:1},children:[e.jsx(Ae,{children:p.severity==="error"?e.jsx(wr,{color:"error"}):e.jsx(hr,{color:"warning"})}),e.jsx(we,{primary:p.field,secondary:p.message}),e.jsx(Z,{size:"small",variant:"outlined",color:p.severity==="error"?"error":"warning",onClick:()=>r(p.field),children:"Go to Field"})]},d))})})]})]})},Kn=te(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"})),Xn=(t,r)=>{if(t==null)return t;try{switch(r.type){case"format":return Qn(t,r.params);case"split":return Zn(t,r.params);case"join":return ea(t,r.params);case"convert":return ta(t,r.params);default:return t}}catch(s){return console.error("Error transforming value:",s),t}},Qn=(t,r)=>{if(r.dateFormat){const s=new Date(t);if(isNaN(s.getTime()))return t;switch(r.dateFormat){case"MM/DD/YYYY":return`${s.getMonth()+1}/${s.getDate()}/${s.getFullYear()}`;case"DD/MM/YYYY":return`${s.getDate()}/${s.getMonth()+1}/${s.getFullYear()}`;case"YYYY-MM-DD":return`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}-${s.getDate().toString().padStart(2,"0")}`;case"custom":return r.customFormat.replace("YYYY",s.getFullYear().toString()).replace("MM",(s.getMonth()+1).toString().padStart(2,"0")).replace("DD",s.getDate().toString().padStart(2,"0")).replace("HH",s.getHours().toString().padStart(2,"0")).replace("mm",s.getMinutes().toString().padStart(2,"0")).replace("ss",s.getSeconds().toString().padStart(2,"0"));default:return t}}return t},Zn=(t,r)=>{const s=String(t),n=r.delimiter||",",i=r.index||0,u=s.split(n);return u.length>i?u[i].trim():t},ea=(t,r)=>{if(!Array.isArray(t))return t;const s=r.delimiter||",";return t.join(s)},ta=(t,r)=>{switch(r.toType||"string"){case"string":return String(t);case"number":const n=Number(t);return isNaN(n)?t:n;case"boolean":if(typeof t=="string"){const i=t.toLowerCase();if(["true","yes","1","y"].includes(i))return!0;if(["false","no","0","n"].includes(i))return!1}return!!t;default:return t}},ra=({sampleData:t,mappings:r})=>{const s=w.useMemo(()=>t.length>0?t[0]:null,[t]),n=w.useMemo(()=>{if(!s)return null;const a={};return r.forEach(p=>{if(p.sourceField&&s[p.sourceField]!==void 0){let d=s[p.sourceField];p.transformations&&p.transformations.length>0&&p.transformations.forEach(c=>{d=Xn(d,c)}),a[p.targetField]=d}}),a},[s,r]);if(!s||!n)return e.jsx(b,{sx:{p:2,textAlign:"center"},children:e.jsx(g,{variant:"body2",color:"text.secondary",children:"No data available for preview. Upload a file and map fields to see a live preview."})});const i=Object.keys(s).slice(0,6),u=Object.keys(n).slice(0,6);return e.jsxs(b,{children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(g,{variant:"subtitle1",children:"Live Preview"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:"Showing sample data transformation"})]}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(It,{component:he,variant:"outlined",sx:{flex:1},children:e.jsxs(Rt,{size:"small",children:[e.jsx(Mt,{children:e.jsx(Xe,{children:i.map(a=>e.jsx(Ve,{children:e.jsx(g,{variant:"caption",fontWeight:"bold",children:a})},a))})}),e.jsx(_t,{children:e.jsx(Xe,{children:i.map(a=>e.jsx(Ve,{children:e.jsx(g,{variant:"caption",children:s[a]!==null&&s[a]!==void 0?String(s[a]):"null"})},a))})})]})}),e.jsx(b,{sx:{display:"flex",justifyContent:"center",alignItems:"center",px:2},children:e.jsx(Kn,{color:"primary"})}),e.jsx(It,{component:he,variant:"outlined",sx:{flex:1},children:e.jsxs(Rt,{size:"small",children:[e.jsx(Mt,{children:e.jsx(Xe,{children:u.map(a=>e.jsx(Ve,{children:e.jsx(g,{variant:"caption",fontWeight:"bold",children:a})},a))})}),e.jsx(_t,{children:e.jsx(Xe,{children:u.map(a=>e.jsx(Ve,{children:e.jsx(g,{variant:"caption",children:n[a]!==null&&n[a]!==void 0?String(n[a]):"null"})},a))})})]})})]})]})},er=te(e.jsx("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 12H4V8h16z"})),sa=te(e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"})),Tr=(t,r)=>{w.useEffect(()=>{if(r)try{localStorage.setItem(`tmpl:${t.id}`,JSON.stringify(t)),console.log(`Template "${t.name}" saved to localStorage`)}catch(a){console.error("Failed to save template to localStorage:",a)}},[t,r]);const s=()=>{try{return Object.keys(localStorage).filter(c=>c.startsWith("tmpl:")).map(c=>{const x=localStorage.getItem(c);return x?JSON.parse(x):null}).filter(Boolean).sort((c,x)=>x.lastModified-c.lastModified)}catch(a){return console.error("Failed to load templates from localStorage:",a),[]}};return{loadTemplates:s,deleteTemplate:a=>{try{return localStorage.removeItem(`tmpl:${a}`),!0}catch(p){return console.error("Failed to delete template:",p),!1}},saveToServer:async()=>(console.log("Saving template to server:",t),new Promise(a=>{setTimeout(()=>{console.log("Template saved to server successfully"),a()},500)})),loadFromServer:async()=>s()}},na=({currentTemplate:t,setCurrentTemplate:r,setTemplateDirty:s})=>{const[n,i]=w.useState(null),[u,a]=w.useState(!1),[p,d]=w.useState(!1),[c,x]=w.useState(t.name),[f,v]=w.useState(t.description||""),[k,E]=w.useState([]),{loadTemplates:z,deleteTemplate:N,saveToServer:F}=Tr(t,!1);w.useEffect(()=>{const j=z();E(j)},[]);const B=j=>{i(j.currentTarget)},I=()=>{i(null)},C=()=>{x(t.name),v(t.description||""),a(!0),I()},L=()=>{const j=z();E(j),d(!0),I()},O=()=>{const j={...t,name:c,description:f,lastModified:Date.now()};r(j),F(),s(!1),a(!1)},V=j=>{r(j),s(!1),d(!1)},l=j=>{N(j);const R=z();E(R)},o=j=>{const R={...j,id:`template-${Date.now()}`,name:`${j.name} (Copy)`,lastModified:Date.now()};localStorage.setItem(`tmpl:${R.id}`,JSON.stringify(R));const H=z();E(H)},m=j=>new Date(j).toLocaleString();return e.jsxs(e.Fragment,{children:[e.jsx(Z,{variant:"outlined",size:"small",onClick:B,startIcon:e.jsx(er,{}),children:"Templates"}),e.jsxs(ts,{anchorEl:n,open:!!n,onClose:I,children:[e.jsxs(ae,{onClick:C,children:[e.jsx(cr,{fontSize:"small",sx:{mr:1}}),"Save Template As..."]}),e.jsxs(ae,{onClick:L,children:[e.jsx(er,{fontSize:"small",sx:{mr:1}}),"Load Template"]})]}),e.jsxs(it,{open:u,onClose:()=>a(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(at,{children:"Save Mapping Template"}),e.jsxs(lt,{children:[e.jsx(be,{autoFocus:!0,margin:"dense",label:"Template Name",fullWidth:!0,value:c,onChange:j=>x(j.target.value),sx:{mb:2}}),e.jsx(be,{margin:"dense",label:"Description (optional)",fullWidth:!0,multiline:!0,rows:2,value:f,onChange:j=>v(j.target.value)})]}),e.jsxs(ct,{children:[e.jsx(Z,{onClick:()=>a(!1),children:"Cancel"}),e.jsx(Z,{onClick:O,variant:"contained",children:"Save Template"})]})]}),e.jsxs(it,{open:p,onClose:()=>d(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(at,{children:"Load Mapping Template"}),e.jsx(lt,{children:k.length===0?e.jsxs(b,{sx:{textAlign:"center",py:4},children:[e.jsx(g,{variant:"body1",children:"No saved templates found."}),e.jsx(g,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Create and save a template to see it here."})]}):e.jsx(qe,{children:k.map(j=>e.jsxs(Ze.Fragment,{children:[e.jsxs(Se,{component:"button",onClick:()=>V(j),sx:{py:2},children:[e.jsx(we,{primary:e.jsxs(g,{variant:"subtitle1",children:[j.name,j.toolId&&e.jsxs(g,{component:"span",variant:"body2",color:"text.secondary",sx:{ml:1},children:["(",j.toolId,")"]})]}),secondary:e.jsxs(b,{children:[j.description&&e.jsx(g,{variant:"body2",children:j.description}),e.jsxs(g,{variant:"caption",color:"text.secondary",children:["Last modified: ",m(j.lastModified),j.mappings&&`  ${j.mappings.length} mappings`]})]})}),e.jsxs(Et,{children:[e.jsx(ke,{edge:"end",onClick:()=>o(j),sx:{mr:1},children:e.jsx(sa,{fontSize:"small"})}),e.jsx(ke,{edge:"end",onClick:()=>l(j.id),children:e.jsx(ft,{fontSize:"small"})})]})]}),e.jsx(xe,{})]},j.id))})}),e.jsx(ct,{children:e.jsx(Z,{onClick:()=>d(!1),children:"Cancel"})})]})]})},aa=()=>{const t=dt(),{sourceColumns:r,sampleData:s,selectedTool:n,mappings:i,processingStatus:u}=Ye(S=>S.formatter),[a,p]=w.useState({id:`template-${Date.now()}`,name:"Untitled Mapping",toolId:(n==null?void 0:n.id)||"",mappings:i||[],lastModified:Date.now()}),[d,c]=w.useState(!1),[x,f]=w.useState(!1),[v,k]=w.useState([]),[E,z]=w.useState({message:"",severity:"info",open:!1}),[N,F]=w.useState(""),[B,I]=w.useState(""),[C,L]=w.useState(!1),O=n||void 0,{saveToServer:V}=Tr(a,d);w.useEffect(()=>{console.log("Redux mappings changed:",i),p(S=>{const $={...S,mappings:[...i],lastModified:Date.now()};return console.log("Updated template with Redux mappings:",$),$}),i.length>0&&c(!0)},[i]),w.useEffect(()=>{m()},[i,O]);const l=S=>{console.log("handleMappingChange called with:",S);try{const $=[...i],h=$.findIndex(D=>D.targetField===S.targetField);h>=0?(console.log(`Updating existing mapping for ${S.targetField}`),$[h]=S):(console.log(`Adding new mapping for ${S.targetField}`),$.push(S)),t(jt($)),console.log("Mapping updated successfully:",S),z({message:`Mapped ${S.sourceField} to ${S.targetField}`,severity:"success",open:!0})}catch($){console.error("Error updating mapping:",$)}},o=S=>{console.log("handleRemoveMapping called for:",S);try{const $=i.filter(h=>h.targetField!==S);t(jt($)),console.log(`Mapping for ${S} removed successfully`)}catch($){console.error("Error removing mapping:",$)}},m=()=>{if(!O)return;const S=[];O.requiredFields.forEach($=>{const h=i.find(D=>D.targetField===$.name);console.log(`Checking required field ${$.name}, mapping:`,h),h||S.push({field:$.name,message:`Required field ${$.name} is not mapped`,severity:"error"})}),k(S)},j=async()=>{if(!(!r||!O)){f(!0);try{const S=[...a.mappings],$=y=>S.some(P=>P.targetField===y),h=y=>y.toLowerCase().replace(/[\s_-]/g,"");[...O.requiredFields,...O.optionalFields].forEach(y=>{if($(y.name))return;const P=r.find(re=>re.toLowerCase()===y.name.toLowerCase());if(P){S.push({sourceField:P,targetField:y.name});return}const M=h(y.name),W=r.find(re=>h(re)===M);if(W){S.push({sourceField:W,targetField:y.name});return}const X=r.map(h).findIndex(re=>re.includes(M)||M.includes(re));X>=0&&S.push({sourceField:r[X],targetField:y.name})}),t(jt(S))}finally{f(!1)}}},R=async()=>{try{await V(),c(!1)}catch(S){console.error("Failed to save template:",S)}},H=()=>{t(Be(0))},T=()=>{try{t($e("transforming")),console.log("Transforming data with mappings:",a.mappings),console.log("Sample data:",s);const S=Tn(s,a.mappings);console.log("Transformed data:",S),t(zr(S)),t($e("mapping")),t(Be(2))}catch(S){console.error("Error transforming data:",S),t($e("error")),z({message:`Error transforming data: ${S instanceof Error?S.message:"Unknown error"}`,severity:"error",open:!0})}},Y=w.useMemo(()=>{if(console.log("Checking if can proceed with validationErrors:",v),console.log("Current mappings:",i),O){const S=O.requiredFields.filter($=>!i.some(h=>h.targetField===$.name));return console.log("Unmapped required fields:",S),S.length===0}return v.every(S=>S.severity!=="error")},[v,i,O]),K=S=>{var y;S.preventDefault();const $=S.dataTransfer.getData("text/plain");if(!$){z({message:"Drag and drop error: No source field data found",severity:"error",open:!0});return}const D=(y=S.target.closest("[data-target-field]"))==null?void 0:y.getAttribute("data-target-field");if(!D){z({message:"Drag and drop error: No target field found. Try dropping directly on a target field.",severity:"warning",open:!0});return}l({sourceField:$,targetField:D}),z({message:`Mapped ${$} to ${D}`,severity:"success",open:!0})};return r.length?O?u==="uploading"?e.jsxs(b,{sx:{p:3,textAlign:"center"},children:[e.jsx(Qe,{}),e.jsx(g,{sx:{mt:2},children:"Processing file data..."})]}):e.jsxs(b,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(g,{variant:"h5",children:["Map Fields for ",O.name]}),e.jsxs(ns,{direction:"row",spacing:1,children:[e.jsx(Z,{variant:"outlined",size:"small",startIcon:e.jsx(cr,{}),onClick:R,disabled:!d,children:"Save Template"}),e.jsx(na,{currentTemplate:a,setCurrentTemplate:p,setTemplateDirty:c})]})]}),e.jsxs(b,{sx:{display:"flex",gap:2,height:"700px",minHeight:"700px",border:"1px solid #eaeaea",borderRadius:"4px",padding:"4px"},children:[e.jsxs(b,{sx:{width:"35%",height:"100%",display:"flex",flexDirection:"column",position:"relative",borderRight:"1px solid #eaeaea",paddingRight:"8px"},children:[e.jsx(g,{variant:"h6",sx:{position:"sticky",top:0,zIndex:10,backgroundColor:"#fff",paddingBottom:"8px",borderBottom:"2px solid #1976d2",marginBottom:"8px",color:"#1976d2",fontWeight:"bold",textAlign:"center"},children:"Source Fields Panel  (Scrollable)"}),e.jsx(zn,{sourceColumns:r,filter:N,setFilter:F,mappings:a.mappings,sampleData:s})]}),e.jsxs(b,{sx:{width:"65%",height:"100%",display:"flex",flexDirection:"column",gap:2,overflow:"hidden",position:"relative"},onDragOver:S=>{S.target===S.currentTarget&&(S.preventDefault(),console.log("Parent container dragOver"))},onDrop:S=>{S.target===S.currentTarget&&(S.preventDefault(),K(S),console.log("Parent container drop"))},children:[e.jsx(g,{variant:"h6",sx:{position:"sticky",top:0,zIndex:10,backgroundColor:"#fff",paddingBottom:"8px",borderBottom:"2px solid #1976d2",marginBottom:"8px",color:"#1976d2",fontWeight:"bold",textAlign:"center"},children:"Target Fields Panel  (Scrollable)"}),e.jsx(Gn,{toolConfig:O,showAllFields:C,setShowAllFields:L,filter:B,setFilter:I,mappings:a.mappings,onMappingChange:l,onRemoveMapping:o,validationErrors:v,sampleData:s,sourceColumns:r}),v.length>0&&e.jsx(b,{sx:{flexShrink:0,marginTop:"auto",borderTop:"1px solid #eaeaea",paddingTop:"8px"},children:e.jsx(Jn,{validationErrors:v,jumpToField:S=>{const $=document.getElementById(`target-field-${S}`);$&&($.scrollIntoView({behavior:"smooth",block:"center"}),$.classList.add("highlight-field"),setTimeout(()=>{$.classList.remove("highlight-field")},2e3))}})})]})]}),e.jsx(he,{sx:{p:2,mt:2},children:e.jsx(ra,{sampleData:s,mappings:a.mappings})}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mt:2},children:[e.jsx(Z,{variant:"outlined",startIcon:e.jsx(nt,{}),onClick:H,children:"Back"}),e.jsxs(b,{children:[e.jsx(Z,{variant:"outlined",onClick:j,disabled:x||!r.length,sx:{mr:1},children:x?e.jsxs(e.Fragment,{children:[e.jsx(Qe,{size:20,sx:{mr:1}}),"Auto-mapping..."]}):"Auto-Map Fields"}),e.jsx(Z,{variant:"contained",endIcon:e.jsx(Nt,{}),onClick:T,disabled:!Y,children:"Continue"})]})]}),e.jsx(mr,{open:E.open,autoHideDuration:6e3,onClose:()=>z({...E,open:!1}),children:e.jsx(pe,{onClose:()=>z({...E,open:!1}),severity:E.severity,children:E.message})})]}):e.jsxs(b,{sx:{p:3,textAlign:"center"},children:[e.jsx(pe,{severity:"error",children:"No tool selected. Please select a tool first."}),e.jsx(Z,{sx:{mt:2},variant:"outlined",startIcon:e.jsx(nt,{}),onClick:H,children:"Go Back to Upload"})]}):e.jsxs(b,{sx:{p:3,textAlign:"center"},children:[e.jsx(pe,{severity:"error",children:"No source columns available. Please upload a file first."}),e.jsx(Z,{sx:{mt:2},variant:"outlined",startIcon:e.jsx(nt,{}),onClick:H,children:"Go Back to Upload"})]})},tr=te(e.jsx("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),oa=te([e.jsx("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),e.jsx("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")]),ia=({data:t,validationErrors:r,highlightedCell:s})=>{const[n,i]=w.useState(0),[u,a]=w.useState(10),[p,d]=w.useState(""),[c,x]=w.useState("");w.useEffect(()=>{if(s){const C=Math.floor(s.rowIndex/u);C!==n&&i(C)}},[s,u,n]);const f=t.length>0?Object.keys(t[0]):[],v={};r.forEach(C=>{C.rowIndex!==void 0&&(v[C.rowIndex]||(v[C.rowIndex]={}),v[C.rowIndex][C.field]||(v[C.rowIndex][C.field]=[]),v[C.rowIndex][C.field].push(C))});const k=(C,L)=>{i(L)},E=C=>{a(parseInt(C.target.value,10)),i(0)},z=C=>{d(C.target.value),i(0)},N=C=>{x(C.target.value),i(0)},F=()=>{x(""),i(0)},B=t.filter(C=>{if(!c)return!0;if(p){const L=C[p];return L!==void 0&&String(L).toLowerCase().includes(c.toLowerCase())}return Object.values(C).some(L=>L!==void 0&&String(L).toLowerCase().includes(c.toLowerCase()))}),I=B.slice(n*u,n*u+u);return t.length===0?e.jsx(b,{children:e.jsx(g,{variant:"h6",gutterBottom:!0,children:"No data available for preview"})}):e.jsxs(b,{children:[e.jsx(Lr,{styles:{"@keyframes pulse":{"0%":{opacity:.7},"100%":{opacity:1}}}}),e.jsxs(b,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(be,{label:"Search",value:c,onChange:N,sx:{flexGrow:1},InputProps:{startAdornment:e.jsx(_e,{position:"start",children:e.jsx(ot,{})}),endAdornment:c&&e.jsx(_e,{position:"end",children:e.jsx(ke,{onClick:F,edge:"end",size:"small",children:e.jsx($t,{})})})}}),e.jsxs(He,{sx:{minWidth:200},children:[e.jsx(Ue,{id:"filter-field-label",children:"Filter Field"}),e.jsxs(We,{labelId:"filter-field-label",id:"filter-field",value:p,label:"Filter Field",onChange:z,children:[e.jsx(ae,{value:"",children:"All Fields"}),f.map(C=>e.jsx(ae,{value:C,children:C},C))]})]})]}),e.jsxs(he,{sx:{width:"100%",mb:2},children:[e.jsx(It,{sx:{maxHeight:500},children:e.jsxs(Rt,{stickyHeader:!0,"aria-label":"data preview table",children:[e.jsx(Mt,{children:e.jsxs(Xe,{children:[e.jsx(Ve,{children:"#"}),f.map(C=>e.jsx(Ve,{children:C},C))]})}),e.jsx(_t,{children:I.map((C,L)=>{const O=n*u+L,V=v[O];return e.jsxs(Xe,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0},backgroundColor:V?"#fff8f8":"inherit"},children:[e.jsx(Ve,{children:O+1}),f.map(l=>{const o=(V==null?void 0:V[l])||[],m=o.length>0,j=s&&s.rowIndex===O&&s.field===l;return e.jsxs(Ve,{sx:{backgroundColor:j?"#fff3e0":m?"#ffebee":"inherit",position:"relative",border:j?"2px solid #ff9800":"inherit",transition:"all 0.3s ease"},children:[C[l]!==void 0?String(C[l]):"",m&&e.jsx(b,{sx:{position:"absolute",top:0,right:0},children:e.jsx(de,{color:"error",size:"small",label:o.length,sx:{height:16,fontSize:"0.6rem"}})}),j&&e.jsx(b,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"2px solid #ff9800",borderRadius:"4px",pointerEvents:"none",animation:"pulse 1s ease-in-out infinite alternate"}})]},l)})]},L)})})]})}),e.jsx(as,{rowsPerPageOptions:[5,10,25,50,100],component:"div",count:B.length,rowsPerPage:u,page:n,onPageChange:k,onRowsPerPageChange:E})]})]})};class la{constructor(){Yt(this,"defaultFields",{})}registerField(r,s){console.log(`Registering default value for ${r}:`,s),this.defaultFields[r]=s}hasDefaultValue(r){return this.defaultFields[r]!==void 0}getDefaultValue(r){return this.defaultFields[r]}registerMappings(r){this.defaultFields={},r.forEach(s=>{if(s.sourceField==="__default__"&&s.transformations){const n=s.transformations.find(i=>i.type==="convert"&&i.params&&i.params.defaultValue!==void 0);n&&n.params.defaultValue!==void 0&&this.registerField(s.targetField,n.params.defaultValue)}}),console.log("Registered default values:",this.defaultFields)}clear(){this.defaultFields={}}}const rr=new la,ca=(t,r)=>{const s=[];return t.forEach((n,i)=>{r.forEach(u=>{let a=n[u.name];const p=rr.hasDefaultValue(u.name);if((a==null||a==="")&&p&&(a=rr.getDefaultValue(u.name),console.log(`Using default value for validation of ${u.name}:`,a)),u.name==="Incident ID"){u.isRequired&&!p&&(a==null||a==="")&&s.push({rowIndex:i,field:u.name,message:`${u.name} is required`,type:"required"});return}if(u.name.includes("Time")&&typeof a=="string"){u.isRequired&&!p&&(a==null||a==="")&&s.push({rowIndex:i,field:u.name,message:`${u.name} is required`,type:"required"});return}if(u.isRequired&&!p&&(a==null||a==="")){s.push({rowIndex:i,field:u.name,message:`${u.name} is required`,type:"required"});return}if(a==null||a==="")return;const d=da(a,u.dataType,u.name,i);if(d){s.push(d);return}u.validationRules&&u.validationRules.forEach(c=>{const x=ua(a,c,u.name,i);x&&s.push(x)})})}),console.log("Validation completed with errors:",s),s},da=(t,r,s,n)=>{switch(r){case"string":if(typeof t!="string")return{rowIndex:n,field:s,message:`${s} must be a string`,type:"custom"};break;case"number":if(typeof t!="number"&&(typeof t!="string"||isNaN(Number(t))))return{rowIndex:n,field:s,message:`${s} must be a number`,type:"custom"};break;case"date":if(!(typeof t=="string"||t instanceof Date))return{rowIndex:n,field:s,message:`${s} must be a date`,type:"custom"};const i=new Date(t);if(isNaN(i.getTime()))return{rowIndex:n,field:s,message:`${s} contains an invalid date format`,type:"custom"};break;case"boolean":if(typeof t!="boolean"&&t!=="true"&&t!=="false"&&t!=="0"&&t!=="1")return{rowIndex:n,field:s,message:`${s} must be a boolean value`,type:"custom"};break;case"location":if(typeof t=="string"){if(!/^-?\d+(\.\d+)?,\s*-?\d+(\.\d+)?$/.test(t))return{rowIndex:n,field:s,message:`${s} must be a valid location format (latitude,longitude)`,type:"custom"}}else if(!t.lat||!t.lng)return{rowIndex:n,field:s,message:`${s} must be a valid location object or string`,type:"custom"};break}return null},ua=(t,r,s,n)=>{switch(r.type){case"required":break;case"min":if(typeof t=="number"||!isNaN(Number(t))){if(Number(t)<r.params.value)return{rowIndex:n,field:s,message:`${s} must be at least ${r.params.value}`,type:"min"}}else if(typeof t=="string"&&t.length<r.params.value)return{rowIndex:n,field:s,message:`${s} must be at least ${r.params.value} characters`,type:"min"};break;case"max":if(typeof t=="number"||!isNaN(Number(t))){if(Number(t)>r.params.value)return{rowIndex:n,field:s,message:`${s} must be at most ${r.params.value}`,type:"max"}}else if(typeof t=="string"&&t.length>r.params.value)return{rowIndex:n,field:s,message:`${s} must be at most ${r.params.value} characters`,type:"max"};break;case"pattern":if(typeof t=="string"&&!new RegExp(r.params.regex).test(t))return{rowIndex:n,field:s,message:r.params.message||`${s} does not match the required pattern`,type:"pattern"};break;case"oneOf":const i=r.params.values;if(!i.includes(t))return{rowIndex:n,field:s,message:`${s} must be one of: ${i.join(", ")}`,type:"oneOf"};break;case"custom":if(r.params.validateFn&&typeof r.params.validateFn=="function"&&!r.params.validateFn(t))return{rowIndex:n,field:s,message:r.params.message||`${s} is invalid`,type:"custom"};break}return null},pa=t=>{const r={total:t.length,byType:{},byField:{}};return t.forEach(s=>{r.byType[s.type]||(r.byType[s.type]=0),r.byType[s.type]++,r.byField[s.field]||(r.byField[s.field]=0),r.byField[s.field]++}),r},Ft=t=>{const{children:r,value:s,index:n,...i}=t;return e.jsx("div",{role:"tabpanel",hidden:s!==n,id:`validation-tabpanel-${n}`,"aria-labelledby":`validation-tab-${n}`,...i,children:s===n&&e.jsx(b,{sx:{p:2},children:r})})},ha=({errors:t,onJumpToError:r})=>{const[s,n]=w.useState(0),[i,u]=w.useState(""),a=pa(t),p=(f,v)=>{n(v)},d=t.filter(f=>f.field.toLowerCase().includes(i.toLowerCase())||f.message.toLowerCase().includes(i.toLowerCase())),c={};d.forEach(f=>{c[f.field]||(c[f.field]=[]),c[f.field].push(f)});const x=f=>{let v="default";switch(f){case"required":v="error";break;case"pattern":case"min":case"max":v="warning";break;case"oneOf":case"custom":v="info";break}return e.jsx(de,{size:"small",label:f,color:v})};return e.jsxs(he,{sx:{p:0,mb:3},children:[e.jsx(b,{sx:{p:2,bgcolor:t.length>0?"#ffebee":"#e8f5e9",borderRadius:"4px 4px 0 0"},children:e.jsxs(g,{variant:"h6",component:"h3",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xt,{}),"Validation Results",e.jsx(de,{label:`${t.length} ${t.length===1?"error":"errors"}`,color:t.length>0?"error":"success",sx:{ml:2}})]})}),e.jsx(xe,{}),e.jsx(b,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(gt,{value:s,onChange:p,"aria-label":"validation tabs",children:[e.jsx(De,{label:"Summary",id:"validation-tab-0","aria-controls":"validation-tabpanel-0"}),e.jsx(De,{label:"By Field",id:"validation-tab-1","aria-controls":"validation-tabpanel-1"}),e.jsx(De,{label:"All Errors",id:"validation-tab-2","aria-controls":"validation-tabpanel-2"})]})}),e.jsx(Ft,{value:s,index:0,children:t.length===0?e.jsx(pe,{severity:"success",children:"No validation errors found. Your data is ready for export!"}):e.jsxs(e.Fragment,{children:[e.jsxs(pe,{severity:"warning",children:["Found ",t.length," validation ",t.length===1?"error":"errors"," that need to be addressed before export."]}),e.jsxs(b,{sx:{mt:2},children:[e.jsx(g,{variant:"subtitle1",gutterBottom:!0,children:"Error Distribution by Field"}),e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:Object.entries(a.byField).map(([f,v])=>e.jsx(de,{label:`${f}: ${v}`,color:"error",variant:"outlined",onClick:()=>n(1)},f))}),e.jsx(g,{variant:"subtitle1",gutterBottom:!0,children:"Error Types"}),e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Object.entries(a.byType).map(([f,v])=>e.jsx(de,{label:`${f}: ${v}`,color:"primary",variant:"outlined"},f))})]})]})}),e.jsxs(Ft,{value:s,index:1,children:[e.jsx(be,{fullWidth:!0,placeholder:"Search errors by field or message",value:i,onChange:f=>u(f.target.value),sx:{mb:2},InputProps:{startAdornment:e.jsx(_e,{position:"start",children:e.jsx(ot,{})}),endAdornment:i&&e.jsx(_e,{position:"end",children:e.jsx(ke,{onClick:()=>u(""),edge:"end",size:"small",children:e.jsx($t,{})})})}}),Object.keys(c).length===0?e.jsx(pe,{severity:"info",children:"No errors match your search criteria."}):Object.entries(c).map(([f,v])=>e.jsxs(dr,{defaultExpanded:Object.keys(c).length===1,children:[e.jsx(ur,{expandIcon:e.jsx(yt,{}),children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(g,{children:f}),e.jsx(de,{size:"small",label:v.length,color:"error",sx:{ml:"auto"}})]})}),e.jsx(pr,{children:e.jsx(qe,{dense:!0,disablePadding:!0,children:v.map((k,E)=>e.jsxs(Ze.Fragment,{children:[E>0&&e.jsx(xe,{component:"li"}),e.jsx(Se,{secondaryAction:k.rowIndex!==void 0&&r&&e.jsx(Z,{size:"small",variant:"outlined",onClick:()=>k.rowIndex!==void 0&&r(k.rowIndex,k.field),children:"Jump to Row"}),children:e.jsx(we,{primary:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[k.message,x(k.type)]}),secondary:k.rowIndex!==void 0?`Row ${k.rowIndex+1}`:"Global error"})})]},E))})})]},f))]}),e.jsxs(Ft,{value:s,index:2,children:[e.jsx(be,{fullWidth:!0,placeholder:"Search errors by field or message",value:i,onChange:f=>u(f.target.value),sx:{mb:2},InputProps:{startAdornment:e.jsx(_e,{position:"start",children:e.jsx(ot,{})}),endAdornment:i&&e.jsx(_e,{position:"end",children:e.jsx(ke,{onClick:()=>u(""),edge:"end",size:"small",children:e.jsx($t,{})})})}}),e.jsx(qe,{dense:!0,children:d.length===0?e.jsx(pe,{severity:"info",children:"No errors match your search criteria."}):d.map((f,v)=>e.jsxs(Ze.Fragment,{children:[v>0&&e.jsx(xe,{component:"li"}),e.jsx(Se,{secondaryAction:f.rowIndex!==void 0&&r&&e.jsx(Z,{size:"small",variant:"outlined",onClick:()=>f.rowIndex!==void 0&&r(f.rowIndex,f.field),children:"Jump to Row"}),children:e.jsx(we,{primary:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(g,{component:"span",sx:{fontWeight:500},children:[f.field,":"]}),f.message,x(f.type)]}),secondary:f.rowIndex!==void 0?`Row ${f.rowIndex+1}`:"Global error"})})]},v))})]})]})},fa=te(e.jsx("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"})),sr=te(e.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})),xa=t=>{switch(t){case"string":return"Default Value";case"number":return"0";case"date":return new Date().toISOString().split("T")[0];case"boolean":return"false";case"location":return"0.0,0.0";default:return""}},ma=({errors:t,targetFields:r,mappings:s,onAddDefaultValue:n,onJumpToMapping:i})=>{const u=Ot(),[a,p]=w.useState(!1),[d,c]=w.useState(null),[x,f]=w.useState(""),v=w.useMemo(()=>{const F={};return t.forEach(B=>{F[B.field]||(F[B.field]={errors:[],count:0}),F[B.field].errors.push(B),F[B.field].count++}),F},[t]),k=w.useMemo(()=>Object.entries(v).sort((F,B)=>B[1].count-F[1].count).map(([F,B])=>{const I=r.find(l=>l.name===F);if(!I)return null;const C=s.some(l=>l.targetField===F),L=s.some(l=>l.targetField===F&&l.sourceField==="__default__"),O=B.errors.some(l=>l.type==="required");let V="unknown";return O&&!C?V="map_field":O&&!L?V="add_default":!O&&C&&(V="fix_transformation"),{fieldName:F,fieldDef:I,errorCount:B.count,errors:B.errors,hasMapping:C,hasDefaultMapping:L,actionType:V}}).filter(Boolean),[v,r,s]),E=w.useMemo(()=>k.filter(F=>(F==null?void 0:F.actionType)==="add_default").length,[k]),z=F=>{c(F),f(xa(F.dataType)),p(!0)},N=()=>{if(!d)return;const F={sourceField:"__default__",targetField:d.name,transformations:[{type:"convert",params:{defaultValue:x,targetType:d.dataType}}]};n(F),p(!1)};return t.length===0?e.jsx(pe,{severity:"success",sx:{my:2},children:"No validation errors detected. Your data is ready for export!"}):e.jsxs(he,{sx:{p:0,my:2,borderRadius:1,border:`1px solid ${u.palette.divider}`,overflow:"hidden"},elevation:2,children:[e.jsxs(b,{sx:{p:2,bgcolor:u.palette.mode==="dark"?ce(u.palette.error.dark,.2):ce(u.palette.error.light,.1),borderBottom:`1px solid ${u.palette.divider}`},children:[e.jsxs(g,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xt,{color:"error"}),"Validation Solutions",e.jsx(de,{label:`${t.length} ${t.length===1?"issue":"issues"}`,color:"error",size:"small",sx:{ml:1}})]}),e.jsx(g,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:E>0?`${E} ${E===1?"issue":"issues"} can be fixed with default values.`:"Review the suggested actions to resolve validation issues."})]}),e.jsxs(qe,{sx:{py:0},children:[E>0&&e.jsxs(Se,{sx:{bgcolor:ce(u.palette.success.light,.1),borderBottom:`1px solid ${u.palette.divider}`,"&:hover":{bgcolor:ce(u.palette.success.light,.2)}},children:[e.jsx(Ae,{children:e.jsx(zt,{color:"success"})}),e.jsx(we,{primary:"Fix Required Fields with Default Values",secondary:`Add default values to ${E} unmapped required ${E===1?"field":"fields"}`}),e.jsx(Et,{children:e.jsx(Z,{variant:"outlined",color:"success",size:"small",onClick:()=>{const F=k.find(B=>(B==null?void 0:B.actionType)==="add_default");F!=null&&F.fieldDef&&z(F.fieldDef)},children:"Set Default Values"})})]}),k.map((F,B)=>{var O;if(!F)return null;let I=e.jsx(xt,{color:"error"}),C="error",L="";switch(F.actionType){case"map_field":I=e.jsx(fa,{color:"info"}),C="info",L="Field requires mapping to source data";break;case"add_default":I=e.jsx(sr,{color:"success"}),C="success",L="Field requires a value, add a default";break;case"fix_transformation":I=e.jsx(fr,{color:"warning"}),C="warning",L="Field has validation issues with current mapping";break}return e.jsxs(Ze.Fragment,{children:[B>0&&e.jsx(xe,{}),e.jsxs(Se,{sx:{py:1.5,"&:hover":{bgcolor:ce(u.palette.primary.light,.05)}},children:[e.jsx(Ae,{children:I}),e.jsx(we,{primary:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(g,{variant:"subtitle2",children:F.fieldName}),e.jsx(de,{size:"small",label:`${F.errorCount} ${F.errorCount===1?"error":"errors"}`,color:"error",variant:"outlined"}),F.fieldDef&&e.jsx(de,{size:"small",label:F.fieldDef.dataType,color:"default",variant:"outlined"})]}),secondary:e.jsxs(b,{sx:{mt:.5},children:[e.jsx(g,{variant:"body2",color:"text.secondary",children:L}),e.jsxs(g,{variant:"caption",color:"error",sx:{display:"block",mt:.5},children:[(O=F.errors[0])==null?void 0:O.message,F.errors.length>1&&` (+ ${F.errors.length-1} more)`]})]})}),e.jsxs(Et,{children:[F.actionType==="add_default"&&F.fieldDef&&e.jsx(Z,{variant:"outlined",color:C,size:"small",startIcon:e.jsx(sr,{}),onClick:()=>z(F.fieldDef),children:"Add Default"}),(F.actionType==="map_field"||F.actionType==="fix_transformation")&&e.jsx(Z,{variant:"outlined",color:C,size:"small",startIcon:e.jsx(Yr,{}),onClick:()=>i(F.fieldName),children:F.actionType==="map_field"?"Map Field":"Fix Mapping"})]})]})]},F.fieldName)})]}),e.jsxs(it,{open:a,onClose:()=>p(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(at,{children:["Set Default Value for ",d==null?void 0:d.name]}),e.jsx(lt,{children:e.jsxs(b,{sx:{mt:1},children:[e.jsx(g,{variant:"body2",gutterBottom:!0,children:d==null?void 0:d.description}),e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(g,{variant:"caption",children:"Data Type:"}),e.jsx(de,{size:"small",label:d==null?void 0:d.dataType,color:"primary",variant:"outlined"})]}),(d==null?void 0:d.dataType)==="boolean"?e.jsxs(be,{select:!0,fullWidth:!0,value:x,onChange:F=>f(F.target.value),label:"Default Value",variant:"outlined",margin:"normal",children:[e.jsx(ae,{value:"true",children:"True"}),e.jsx(ae,{value:"false",children:"False"})]}):e.jsx(be,{fullWidth:!0,value:x,onChange:F=>f(F.target.value),label:"Default Value",variant:"outlined",margin:"normal",type:(d==null?void 0:d.dataType)==="number"?"number":"text",helperText:`This value will be used for all records where ${d==null?void 0:d.name} is not mapped or empty`})]})}),e.jsxs(ct,{children:[e.jsx(Z,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(Z,{onClick:N,variant:"contained",color:"primary",startIcon:e.jsx(zt,{}),children:"Apply Default Value"})]})]})]})},nr=t=>{const{children:r,value:s,index:n,...i}=t;return e.jsx("div",{role:"tabpanel",hidden:s!==n,id:`preview-tabpanel-${n}`,"aria-labelledby":`preview-tab-${n}`,...i,children:s===n&&e.jsx(b,{sx:{p:2},children:r})})},ga=()=>{const t=dt(),{sourceFile:r,transformedData:s,validationErrors:n,selectedTool:i,mappings:u}=Ye(C=>C.formatter),[a,p]=w.useState(0),[d,c]=w.useState(!1),[x,f]=w.useState(null),v=w.useRef(null),k=(C,L)=>{p(L)},E=()=>{t(Be(1))},z=()=>{t(Be(3))},N=()=>{if(!(!s||!i)){c(!0);try{const C=[...i.requiredFields,...i.optionalFields],L=Ye(o=>o.formatter.mappings),O={};L&&L.forEach(o=>{if(o.sourceField==="__default__"&&o.transformations){const m=o.transformations.find(j=>j.type==="convert"&&j.params&&j.params.defaultValue!==void 0);m&&(O[o.targetField]=!0,console.log(`Field ${o.targetField} has default value: ${m.params.defaultValue}`))}});const V=s.map(o=>{const m={...o};return Object.keys(O).forEach(j=>{typeof window<"u"&&window.defaultValueRegistry&&window.defaultValueRegistry.register(j,!0)}),m}),l=ca(V,C);t(Or(l)),l.length===0?t($e("complete")):t($e("error"))}catch(C){console.error("Validation error:",C),t($e("error"))}finally{c(!1)}}},F=(C,L)=>{p(0),f({rowIndex:C,field:L}),setTimeout(()=>{v.current&&v.current.scrollIntoView({behavior:"smooth"})},100),setTimeout(()=>{f(null)},3e3)},B=C=>{console.log("Adding default value mapping:",C),t(Pr(C)),setTimeout(()=>{N()},100)},I=C=>{t(Be(1))};return w.useEffect(()=>{s&&s.length>0&&N()},[s]),!s||s.length===0?e.jsxs(he,{sx:{p:3,textAlign:"center"},children:[e.jsxs(pe,{severity:"warning",sx:{mb:2},children:[e.jsx(hs,{children:"No Data Available"}),"There is no transformed data to preview. Please go back to the field mapping step."]}),e.jsx(Z,{variant:"contained",startIcon:e.jsx(tr,{}),onClick:E,children:"Back to Field Mapping"})]}):e.jsxs(b,{children:[e.jsx(g,{variant:"h5",gutterBottom:!0,sx:{mb:3},children:"Preview & Validate Data"}),e.jsx(he,{sx:{p:2,mb:3},children:e.jsxs(le,{container:!0,spacing:2,children:[e.jsx(le,{size:{xs:12,md:6},children:e.jsxs(b,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Source File"}),e.jsxs(g,{variant:"body1",children:[(r==null?void 0:r.name)||"No file"," (",r==null?void 0:r.type,")"]})]})}),e.jsx(le,{size:{xs:12,md:6},children:e.jsxs(b,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Records"}),e.jsxs(g,{variant:"body1",children:[s.length," records processed"]})]})}),e.jsx(le,{size:12,children:e.jsxs(b,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Validation Status"}),e.jsx(b,{sx:{display:"flex",alignItems:"center",gap:1},children:d?e.jsxs(e.Fragment,{children:[e.jsx(Qe,{size:20}),e.jsx(g,{children:"Validating data..."})]}):n.length===0?e.jsxs(e.Fragment,{children:[e.jsx(Cr,{color:"success"}),e.jsx(g,{color:"success.main",children:"Data validation passed! Ready for export."})]}):e.jsxs(e.Fragment,{children:[e.jsx(oa,{color:"error"}),e.jsxs(g,{color:"error",children:[n.length," validation ",n.length===1?"error":"errors"," found"]})]})})]})})]})}),e.jsx(b,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(gt,{value:a,onChange:k,"aria-label":"preview and validation tabs",children:[e.jsx(De,{label:"Data Preview",id:"preview-tab-0","aria-controls":"preview-tabpanel-0"}),e.jsx(De,{label:`Validation & Solutions ${n.length>0?`(${n.length})`:""}`,id:"preview-tab-1","aria-controls":"preview-tabpanel-1",sx:{color:n.length>0?"error.main":"inherit"}})]})}),e.jsx(nr,{value:a,index:0,children:e.jsx(b,{ref:v,children:e.jsx(ia,{data:s,validationErrors:n,highlightedCell:x})})}),e.jsxs(nr,{value:a,index:1,children:[n.length>0&&i&&e.jsx(ma,{errors:n,targetFields:[...i.requiredFields,...i.optionalFields],mappings:u,onAddDefaultValue:B,onJumpToMapping:I}),e.jsx(ha,{errors:n,onJumpToError:F})]}),e.jsx(xe,{sx:{my:3}}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Z,{variant:"outlined",startIcon:e.jsx(tr,{}),onClick:E,children:"Back to Field Mapping"}),e.jsx(Z,{variant:"contained",endIcon:e.jsx(Nt,{}),onClick:z,disabled:n.length>0,children:"Continue to Export"})]})]})},Fr=te(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"})),ya=te(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"})),mt=te(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"})),Lt=te(e.jsx("path",{d:"M15 4v2h3v12h-3v2h5V4zM4 20h5v-2H6V6h3V4H4z"})),Dr=te(e.jsx("path",{d:"M4 7v2c0 .55-.45 1-1 1H2v4h1c.55 0 1 .45 1 1v2c0 1.65 1.35 3 3 3h3v-2H7c-.55 0-1-.45-1-1v-2c0-1.3-.84-2.42-2-2.83v-.34C5.16 11.42 6 10.3 6 9V7c0-.55.45-1 1-1h3V4H7C5.35 4 4 5.35 4 7m17 3c-.55 0-1-.45-1-1V7c0-1.65-1.35-3-3-3h-3v2h3c.55 0 1 .45 1 1v2c0 1.3.84 2.42 2 2.83v.34c-1.16.41-2 1.52-2 2.83v2c0 .55-.45 1-1 1h-3v2h3c1.65 0 3-1.35 3-3v-2c0-.55.45-1 1-1h1v-4z"})),ba=te(e.jsx("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"})),va=({selectedFormat:t,onFormatChange:r})=>{const s=n=>{r(n.target.value)};return e.jsx(Pt,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(At,{children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Select Export Format"}),e.jsx(He,{component:"fieldset",children:e.jsxs(Ps,{"aria-label":"export-format",name:"export-format",value:t,onChange:s,children:[e.jsxs(b,{sx:{mb:2,p:1,border:"1px solid",borderColor:t==="csv"?"primary.main":"divider",borderRadius:1,bgcolor:t==="csv"?"action.hover":"transparent"},children:[e.jsx(rt,{value:"csv",control:e.jsx(ut,{}),label:e.jsxs(b,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:1},children:[e.jsx(os,{color:"primary"}),e.jsx(g,{variant:"body1",children:"CSV"}),e.jsx(de,{size:"small",label:"Most Compatible",color:"success"})]})}),e.jsx(g,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"Comma-separated values format, widely supported by spreadsheet applications like Excel and Google Sheets."})]}),e.jsxs(b,{sx:{mb:2,p:1,border:"1px solid",borderColor:t==="json"?"primary.main":"divider",borderRadius:1,bgcolor:t==="json"?"action.hover":"transparent"},children:[e.jsx(rt,{value:"json",control:e.jsx(ut,{}),label:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ba,{color:"info"}),e.jsx(g,{variant:"body1",children:"JSON"})]})}),e.jsx(g,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"JavaScript Object Notation, ideal for programmatic use or importing into other applications."})]}),e.jsxs(b,{sx:{p:1,border:"1px solid",borderColor:t==="excel"?"primary.main":"divider",borderRadius:1,bgcolor:t==="excel"?"action.hover":"transparent"},children:[e.jsx(rt,{value:"excel",control:e.jsx(ut,{}),label:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(mt,{color:"success"}),e.jsx(g,{variant:"body1",children:"Excel"})]})}),e.jsx(g,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"Export directly to native Excel format (.xlsx) with proper formatting and column sizing."})]}),e.jsxs(b,{sx:{p:1,border:"1px solid",borderColor:t==="pdf"?"primary.main":"divider",borderRadius:1,bgcolor:t==="pdf"?"action.hover":"transparent"},children:[e.jsx(rt,{value:"pdf",control:e.jsx(ut,{}),label:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(gr,{color:"error"}),e.jsx(g,{variant:"body1",children:"PDF"}),e.jsx(de,{size:"small",label:"Professional",color:"secondary"})]})}),e.jsx(g,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"Create a professional PDF document with formatted data table, ideal for reports and presentations."})]})]})})]})})},ja=te(e.jsx("path",{d:"M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27zM12 17.3c-.72 0-1.3-.58-1.3-1.3s.58-1.3 1.3-1.3 1.3.58 1.3 1.3-.58 1.3-1.3 1.3m1-4.3h-2V7h2z"})),Dt=[{id:"fire-map-pro",name:"Fire Map Pro",description:"Professional mapping and visualization for incident locations and analysis",icon:e.jsx(Jt,{fontSize:"large",sx:{color:"#dc2626"}}),requiredFields:["Incident ID","Latitude","Longitude"],optionalFields:["Incident Type","Incident Date","Incident Time","Address","City","State","Priority","Station","Response Category"]},{id:"response-time-analyzer",name:"Response Time Analyzer",description:"Analyze incident response times and visualize performance metrics",icon:e.jsx(is,{fontSize:"large",sx:{color:"#2196f3"}}),requiredFields:["Incident ID","Incident Date"],optionalFields:["Dispatch Time","En Route Time","Arrival Time","Latitude","Longitude"]},{id:"call-density-heatmap",name:"Call Density Heatmap",description:"Visualize incident density across geographic areas",icon:e.jsx(Jt,{fontSize:"large",sx:{color:"#ff9800"}}),requiredFields:["Incident ID","Latitude","Longitude"]},{id:"incident-dashboard",name:"Incident Dashboard",description:"Interactive dashboard for incident analysis and reporting",icon:e.jsx(ls,{fontSize:"large",sx:{color:"#4caf50"}}),requiredFields:["Incident ID","Incident Type","Incident Date"]},{id:"trend-analyzer",name:"Trend Analyzer",description:"Identify incident trends and patterns over time",icon:e.jsx(Ur,{fontSize:"large",sx:{color:"#9c27b0"}}),requiredFields:["Incident ID","Incident Date","Incident Type"]}],Sa=({selectedTool:t,onToolSelect:r,transformedData:s,onSendToTool:n,isSending:i})=>{const u=d=>{r(d.target.value)},p=t?(d=>{const c=Dt.find(E=>E.id===d);if(!c)return{compatible:!1,missingFields:[]};const x=Object.keys(s[0]),f=c.requiredFields.filter(E=>!x.includes(E)),v=c.optionalFields?c.optionalFields.filter(E=>x.includes(E)):[],k=c.optionalFields?c.optionalFields.filter(E=>!x.includes(E)):[];return{compatible:f.length===0,missingFields:f,hasOptionalFields:v,missingOptionalFields:k}})(t):{compatible:!1,missingFields:[]};return e.jsxs(b,{children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Send to FireEMS Tool"}),e.jsx(pe,{severity:"info",sx:{mb:3},children:"Send your formatted data directly to another FireEMS tool for analysis and visualization."}),e.jsxs(He,{fullWidth:!0,sx:{mb:3},children:[e.jsx(Ue,{id:"tool-select-label",children:"Select Tool"}),e.jsxs(We,{labelId:"tool-select-label",id:"tool-select",value:t||"",label:"Select Tool",onChange:u,children:[e.jsx(ae,{value:"",children:e.jsx("em",{children:"Select a tool..."})}),Dt.map(d=>e.jsx(ae,{value:d.id,children:d.name},d.id))]})]}),t&&e.jsx(le,{container:!0,spacing:3,children:Dt.filter(d=>d.id===t).map(d=>e.jsx(le,{size:12,children:e.jsxs(Pt,{variant:"outlined",children:[e.jsxs(At,{children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",mb:2},children:[d.icon,e.jsxs(b,{sx:{ml:2},children:[e.jsx(g,{variant:"h6",children:d.name}),e.jsx(g,{variant:"body2",color:"text.secondary",children:d.description})]})]}),e.jsx(xe,{sx:{mb:2}}),e.jsx(g,{variant:"subtitle2",gutterBottom:!0,children:"Required Fields:"}),e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:d.requiredFields.map((c,x)=>e.jsx(g,{variant:"body2",sx:{backgroundColor:p.missingFields.includes(c)?"error.light":"success.light",color:p.missingFields.includes(c)?"error.contrastText":"success.contrastText",borderRadius:1,px:1,py:.5},children:c},x))}),d.optionalFields&&e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"subtitle2",gutterBottom:!0,children:"Optional Fields:"}),e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:d.optionalFields.map((c,x)=>{var f,v;return e.jsx(g,{variant:"body2",sx:{backgroundColor:(f=p.hasOptionalFields)!=null&&f.includes(c)?"info.light":"action.disabledBackground",color:(v=p.hasOptionalFields)!=null&&v.includes(c)?"info.contrastText":"text.secondary",borderRadius:1,px:1,py:.5},children:c},x)})})]}),!p.compatible&&e.jsxs(pe,{severity:"warning",icon:e.jsx(ja,{}),sx:{mb:2},children:[e.jsx(g,{variant:"body2",gutterBottom:!0,children:"Your data is missing required fields for this tool:"}),e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:p.missingFields.map((c,x)=>e.jsx("li",{children:c},x))})]}),p.compatible&&e.jsxs(pe,{severity:"success",sx:{mb:2},children:[e.jsx(g,{variant:"body2",gutterBottom:!0,children:"Your data is compatible with this tool. All required fields are present."}),d.optionalFields&&p.hasOptionalFields&&p.hasOptionalFields.length>0&&e.jsxs(g,{variant:"body2",children:[p.hasOptionalFields.length," of ",d.optionalFields.length," optional fields are available for enhanced analysis."]})]})]}),e.jsx(ws,{children:e.jsx(Z,{variant:"contained",color:"primary",fullWidth:!0,disabled:!p.compatible||i,startIcon:i?e.jsx(Qe,{size:20}):e.jsx(Fr,{}),onClick:n,children:i?"Sending...":`Send to ${d.name}`})})]})},d.id))})]})},wa=({dataCount:t,fields:r,format:s})=>{const n=()=>{let u=15;s==="json"?u=25:s==="excel"?u=30:s==="pdf"&&(u=40);const a=t*r.length*u;let p=0;s==="excel"?p=5120:s==="pdf"&&(p=15360);const d=a+p;return d<1048576?`${Math.round(d/1024)} KB`:`${(d/1048576).toFixed(2)} MB`},i=()=>{switch(s){case"csv":return e.jsx(Lt,{color:"primary"});case"json":return e.jsx(Dr,{color:"info"});case"excel":return e.jsx(mt,{color:"success"});case"pdf":return e.jsx(gr,{color:"error"});default:return e.jsx(Lt,{})}};return e.jsx(Pt,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(At,{children:[e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Export Summary"}),e.jsxs(qe,{disablePadding:!0,children:[e.jsxs(Se,{children:[e.jsx(Ae,{sx:{minWidth:"40px"},children:i()}),e.jsx(we,{primary:"Format",secondary:s.toUpperCase()})]}),e.jsx(xe,{component:"li"}),e.jsxs(Se,{children:[e.jsx(Ae,{sx:{minWidth:"40px"},children:e.jsx(st,{color:"success"})}),e.jsx(we,{primary:"Records",secondary:`${t} records will be exported`})]}),e.jsx(xe,{component:"li"}),e.jsxs(Se,{children:[e.jsx(Ae,{sx:{minWidth:"40px"},children:e.jsx(st,{color:"success"})}),e.jsx(we,{primary:"Fields",secondary:`${r.length} fields per record`})]}),e.jsx(xe,{component:"li"}),e.jsxs(Se,{children:[e.jsx(Ae,{sx:{minWidth:"40px"},children:e.jsx(st,{color:"success"})}),e.jsx(we,{primary:"Estimated Size",secondary:n()})]})]}),e.jsx(g,{variant:"subtitle2",sx:{mt:2},children:"Fields included:"}),e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:r.map((u,a)=>e.jsx(de,{label:u,size:"small"},a))})]})})},Ca=t=>!t||t.length===0?t:JSON.parse(JSON.stringify(t)).map(s=>{const n={...s};return["Incident Date"].forEach(a=>{if(n[a]&&typeof n[a]=="string")try{const p=new Date(n[a]);if(isNaN(p.getTime()))n[a].includes(" ")&&(n[a]=n[a].split(" ")[0]);else{const d=(p.getMonth()+1).toString().padStart(2,"0"),c=p.getDate().toString().padStart(2,"0"),x=p.getFullYear();n[a]=`${d}/${c}/${x}`}}catch{n[a].includes(" ")&&(n[a]=n[a].split(" ")[0])}}),["Dispatch Time","En Route Time","Arrival Time","Incident Time"].forEach(a=>{if(n[a]&&typeof n[a]=="string")try{const p=new Date(n[a]);if(isNaN(p.getTime())){if(n[a].includes(" ")){const d=n[a].split(" ");d.length>1&&(n[a]=d[1])}}else{const d=p.getHours().toString().padStart(2,"0"),c=p.getMinutes().toString().padStart(2,"0"),x=p.getSeconds().toString().padStart(2,"0");n[a]=`${d}:${c}:${x}`}}catch{if(n[a].includes(" ")){const d=n[a].split(" ");d.length>1&&(n[a]=d[1])}}}),n}),ar=t=>{const{children:r,value:s,index:n,...i}=t;return e.jsx("div",{role:"tabpanel",hidden:s!==n,id:`export-tabpanel-${n}`,"aria-labelledby":`export-tab-${n}`,...i,children:s===n&&e.jsx(b,{sx:{p:2},children:r})})},Ta=()=>{const t=dt(),{sourceFile:r,transformedData:s,validationErrors:n}=Ye(T=>T.formatter),[i,u]=w.useState(0),[a,p]=w.useState("csv"),[d,c]=w.useState(null),[x,f]=w.useState(!1),[v,k]=w.useState({success:!1,message:"",open:!1}),[E,z]=w.useState([]),[N,F]=w.useState(!1);w.useEffect(()=>{try{const T=localStorage.getItem("fireEmsExportHistory");T&&z(JSON.parse(T))}catch(T){console.error("Error loading export history:",T)}},[]),w.useEffect(()=>{try{localStorage.setItem("fireEmsExportHistory",JSON.stringify(E))}catch(T){console.error("Error saving export history:",T)}},[E]);const B=(T,Y)=>{u(Y)},I=T=>{p(T)},C=T=>{c(T)},L=(T,Y,K,S,$)=>{const h={id:`export-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,timestamp:Date.now(),format:T,recordCount:Y,success:K,destination:S,fileName:$};z(D=>[h,...D].slice(0,20))},O=()=>{z([])},V=()=>{const T=new Date;return T.toLocaleDateString()+" "+T.toLocaleTimeString()},l=async()=>{if(!s||s.length===0){k({success:!1,message:"No data to export",open:!0});return}f(!0);try{const T=Ca(s);let Y=`formatted_data_${Date.now()}`;if(a==="excel"){const y=await ir(()=>import("./xlsx-DkH2s96g.js"),[]),P=y.utils.json_to_sheet(T),M={},W=Object.keys(s[0]);W.forEach(X=>{M[X]=Math.max(10,X.length+2)}),s.forEach(X=>{W.forEach(re=>{const q=String(X[re]||"");M[re]=Math.min(50,Math.max(M[re],q.length+2))})}),P["!cols"]=W.map(X=>({wch:M[X]}));const G=y.utils.book_new();G.Props={Title:"FireEMS Formatted Data",Subject:"Incident Data",Author:"FireEMS Data Formatter",CreatedDate:new Date},y.utils.book_append_sheet(G,P,"Formatted Data"),Y=`formatted_data_${Date.now()}.xlsx`,y.writeFile(G,Y),L("Excel",T.length,!0,"File Download",Y),k({success:!0,message:"Data exported successfully as EXCEL",open:!0}),f(!1);return}if(a==="pdf"){const y=new Wr;y.setFontSize(18),y.text("FireEMS Formatted Data",14,22),y.setFontSize(11),y.text(`Export Date: ${V()}`,14,30),y.text(`Records: ${T.length}`,14,36);const P=Object.keys(T[0]);T.length>500&&y.text("Note: Export limited to 500 records for PDF format.",14,42);const M=T.length>500?48:42,W=30,G=10,X=10;y.setFontSize(10),y.setTextColor(0,0,0),y.setFillColor(220,220,220),P.forEach((q,_)=>{y.rect(X+_*W,M,W,G,"FD"),y.text(q,X+_*W+2,M+7)});const re=Math.min(T.length,20);for(let q=0;q<re;q++){const _=M+(q+1)*G;P.forEach((U,A)=>{y.rect(X+A*W,_,W,G,"S");const ne=T[q][U]||"";let ee=String(ne);ee.length>10&&(ee=ee.substring(0,8)+"..."),y.text(ee,X+A*W+2,_+7)})}y.setFontSize(8),y.text(`Generated by FireEMS Tools - ${new Date().toLocaleString()}`,y.internal.pageSize.width/2,y.internal.pageSize.height-10,{align:"center"}),Y=`formatted_data_${Date.now()}.pdf`,y.save(Y),L("PDF",T.length,!0,"File Download",Y),k({success:!0,message:"Data exported successfully as PDF",open:!0}),f(!1);return}let K="",S="";if(a==="csv"){const y=Object.keys(T[0]);K=y.join(",")+`
`,T.forEach(P=>{const M=y.map(W=>{const G=P[W];return G==null?"":typeof G=="string"&&(G.includes(",")||G.includes('"')||G.includes(`
`))?`"${G.replace(/"/g,'""')}"`:G});K+=M.join(",")+`
`}),Y=`formatted_data_${Date.now()}.csv`,S="text/csv"}else a==="json"&&(K=JSON.stringify(T,null,2),Y=`formatted_data_${Date.now()}.json`,S="application/json");const $=new Blob([K],{type:S}),h=URL.createObjectURL($),D=document.createElement("a");D.href=h,D.download=Y,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(h),L(a.toUpperCase(),T.length,!0,"File Download",Y),k({success:!0,message:`Data exported successfully as ${a.toUpperCase()}`,open:!0})}catch(T){console.error("Export error:",T),k({success:!1,message:`Error exporting data: ${T instanceof Error?T.message:"Unknown error"}`,open:!0}),L(a.toUpperCase(),s.length,!1,"File Download")}finally{f(!1)}},o=T=>({"response-time-analyzer":"Response Time Analyzer","call-density-heatmap":"Call Density Heatmap","incident-dashboard":"Incident Dashboard","trend-analyzer":"Trend Analyzer"})[T]||T,m=async()=>{if(!s||s.length===0||!d){k({success:!1,message:"No data or tool selected",open:!0});return}f(!0);const T=o(d);try{console.log("DEBUG - USING ALREADY TRANSFORMED DATA: Sample data fields:",s.length>0?Object.keys(s[0]):"No data");const Y=s.map(S=>{const $={...S};return console.log("DEBUG - USING MAPPED DATA: Record fields:",Object.keys(S)),Object.keys($).forEach(h=>{if($[h]&&typeof $[h]=="string"&&$[h].includes(" ")){const[D,y]=$[h].split(" ");console.log(`DATETIME SPLIT: Field "${h}" = "${$[h]}" -> Date: "${D}", Time: "${y}"`),h.toLowerCase().includes("date")?(console.log(`SETTING DATE FIELD "${h}" to "${D}"`),$[h]=D):h.toLowerCase().includes("time")&&(console.log(`SETTING TIME FIELD "${h}" to "${y}"`),$[h]=y)}}),$}),K={toolId:d,toolName:T,data:Y,sourceFile:r==null?void 0:r.name,timestamp:Date.now(),fields:Object.keys(Y[0]),recordCount:Y.length,exportVersion:"2.0"};if(Y.length>0){console.log("Sample record being sent (using user-mapped fields):",Y[0]);const S=Y[0],$=Object.keys(S);console.log("All field names (as mapped by user):",$),console.log("Field values:",S)}sessionStorage.removeItem("fireEmsExportedData"),console.log("VERIFY: Field names being stored in sessionStorage:",K.data&&K.data.length>0?Object.keys(K.data[0]):"No data"),sessionStorage.setItem("fireEmsExportedData",JSON.stringify(K)),console.log(`Data prepared for ${d}. Data size: ${Y.length} records`),Y.length>0&&(console.log("FIELD NAMES CHECK - Sample record being sent to session storage:"),console.log(JSON.stringify(Y[0]))),L("Data Transfer",Y.length,!0,T),k({success:!0,message:`Data sent to ${T} successfully!`,open:!0}),setTimeout(()=>{const h=`http://${window.location.hostname}:5006`;let D="";if(d==="fire-map-pro")D=`${window.location.origin}/app/fire-map-pro`;else if(d==="response-time-analyzer")D=`${window.location.origin}/app/response-time-analyzer`;else if(d==="call-density-heatmap")D=`${h}/call-density-heatmap`;else if(d==="incident-dashboard")D=`${h}/incident-dashboard`;else if(d==="trend-analyzer")D=`${h}/trend-analyzer`;else{console.log(`Tool ID not recognized: ${d}`);return}console.log(`Redirecting to: ${D}`),window.location.href=D},500)}catch(Y){console.error("Send to tool error:",Y),k({success:!1,message:`Error sending data to tool: ${Y instanceof Error?Y.message:"Unknown error"}`,open:!0}),L("Data Transfer",s.length,!1,T)}finally{f(!1)}},j=()=>{t(Be(2))};if(!s||s.length===0)return e.jsxs(b,{children:[e.jsx(pe,{severity:"warning",sx:{mb:2},children:"No data available to export. Please go back and ensure your data is processed correctly."}),e.jsx(Z,{variant:"outlined",startIcon:e.jsx(nt,{}),onClick:j,children:"Back to Validation"})]});const R=T=>new Date(T).toLocaleString(),H=()=>E.length===0?e.jsx(b,{sx:{p:2,textAlign:"center"},children:e.jsx(g,{color:"text.secondary",children:"No export history available"})}):e.jsx(qe,{sx:{width:"100%",bgcolor:"background.paper"},dense:!0,children:E.map(T=>e.jsxs(Se,{secondaryAction:e.jsx(ke,{edge:"end","aria-label":"delete",onClick:()=>{z(Y=>Y.filter(K=>K.id!==T.id))},children:e.jsx(ft,{fontSize:"small"})}),sx:{borderLeft:"4px solid",borderColor:T.success?"success.main":"error.main",mb:1,bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},children:[e.jsxs(Ae,{children:[T.format==="Excel"&&e.jsx(mt,{color:"success"}),T.format==="CSV"&&e.jsx(Lt,{color:"primary"}),T.format==="JSON"&&e.jsx(Dr,{color:"info"}),T.format==="PDF"&&e.jsx(mt,{color:"error"}),T.format==="Data Transfer"&&e.jsx(Fr,{color:"secondary"})]}),e.jsx(we,{primary:e.jsx(g,{variant:"body2",fontWeight:"medium",children:T.format==="Data Transfer"?`Sent to ${T.destination}`:`${T.format} Export${T.fileName?` - ${T.fileName}`:""}`}),secondary:e.jsxs(g,{variant:"caption",display:"block",children:[R(T.timestamp),"  ",T.recordCount," records",!T.success&&"  Failed"]})})]},T.id))});return e.jsxs(b,{children:[e.jsx(g,{variant:"h5",gutterBottom:!0,sx:{mb:3},children:"Export Formatted Data"}),e.jsxs(he,{sx:{p:2,mb:3},children:[e.jsxs(le,{container:!0,spacing:2,children:[e.jsx(le,{size:{xs:12,md:4},children:e.jsxs(b,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Source File"}),e.jsxs(g,{variant:"body1",children:[(r==null?void 0:r.name)||"No file"," (",r==null?void 0:r.type,")"]})]})}),e.jsx(le,{size:{xs:12,md:4},children:e.jsxs(b,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Records"}),e.jsxs(g,{variant:"body1",children:[s.length," records processed"]})]})}),e.jsx(le,{size:{xs:12,md:4},children:e.jsxs(b,{children:[e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Validation Status"}),e.jsx(b,{sx:{display:"flex",alignItems:"center",gap:1},children:n.length===0?e.jsxs(e.Fragment,{children:[e.jsx(st,{color:"success"}),e.jsx(g,{color:"success.main",children:"All data is valid"})]}):e.jsx(e.Fragment,{children:e.jsxs(pe,{severity:"warning",sx:{mt:1},children:[n.length," validation issues found. Consider reviewing before export."]})})})]})})]}),e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2,pt:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ya,{color:"action",fontSize:"small"}),e.jsx(g,{variant:"subtitle2",color:"text.secondary",children:"Export History"}),E.length>0&&e.jsx(bs,{badgeContent:E.length,color:"primary",sx:{ml:1}})]}),e.jsxs(b,{children:[e.jsx(ke,{size:"small",onClick:()=>F(!N),"aria-label":N?"Hide history":"Show history",children:N?e.jsx(lr,{}):e.jsx(yt,{})}),E.length>0&&N&&e.jsx(Z,{size:"small",startIcon:e.jsx(ft,{}),onClick:O,sx:{ml:1},children:"Clear"})]})]}),e.jsx(xr,{in:N,children:e.jsx(b,{sx:{mt:2},children:H()})})]}),e.jsx(b,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(gt,{value:i,onChange:B,"aria-label":"export options tabs",children:[e.jsx(De,{label:"Download File",id:"export-tab-0","aria-controls":"export-tabpanel-0"}),e.jsx(De,{label:"Send to Tool",id:"export-tab-1","aria-controls":"export-tabpanel-1"})]})}),e.jsx(ar,{value:i,index:0,children:e.jsxs(le,{container:!0,spacing:3,children:[e.jsx(le,{size:{xs:12,md:6},children:e.jsx(va,{selectedFormat:a,onFormatChange:I})}),e.jsx(le,{size:{xs:12,md:6},children:e.jsx(wa,{dataCount:s.length,fields:Object.keys(s[0]),format:a})}),e.jsx(le,{size:12,children:e.jsx(Z,{variant:"contained",color:"primary",fullWidth:!0,size:"large",onClick:l,disabled:x,startIcon:x?e.jsx(Qe,{size:20}):e.jsx(cs,{}),sx:{mt:2},children:x?"Exporting...":`Download as ${a.toUpperCase()}`})})]})}),e.jsx(ar,{value:i,index:1,children:e.jsx(Sa,{selectedTool:d,onToolSelect:C,transformedData:s,onSendToTool:m,isSending:x})}),e.jsx(xe,{sx:{my:3}}),e.jsx(b,{sx:{display:"flex",justifyContent:"space-between"},children:e.jsx(Z,{variant:"outlined",startIcon:e.jsx(nt,{}),onClick:j,children:"Back to Validation"})}),e.jsx(mr,{open:v.open,autoHideDuration:6e3,onClose:()=>k({...v,open:!1}),children:e.jsx(pe,{onClose:()=>k({...v,open:!1}),severity:v.success?"success":"error",children:v.message})})]})},Fa=["Upload File","Map Fields","Preview & Validate","Export"],Ma=()=>{const{currentStep:t}=Ye(n=>n.formatter),r=()=>{const n=window.location.pathname;return n.includes("fire-map-pro")?"FireEMS Fire Map Pro":n.includes("response-time-analyzer")?"FireEMS Response Time Analyzer":"FireEMS Data Formatter"};Ze.useEffect(()=>{const n=r();document.title=n},[]);const s=n=>{switch(n){case 0:return e.jsx(Cn,{});case 1:return e.jsx(aa,{});case 2:return e.jsx(ga,{});case 3:return e.jsx(Ta,{});default:return e.jsx(g,{children:"Unknown step"})}};return e.jsx(Ar,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsxs(he,{elevation:3,sx:{p:3},children:[e.jsx(g,{variant:"h4",component:"h1",gutterBottom:!0,children:r()}),e.jsx(un,{activeStep:t,sx:{mb:4},children:Fa.map(n=>e.jsx(Bs,{children:e.jsx(jr,{children:n})},n))}),e.jsx(b,{sx:{mt:2},children:s(t)})]})})};export{Ma as default};
