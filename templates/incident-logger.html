<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incident Logger - FireEMS.ai</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/incident-logger.css">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    
    <style>
    /* Fallback styles in case the CSS files don't load properly */
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background-color: #f8f9fa;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    header {
        background-color: white;
        padding: 15px 0;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }
    
    button {
        background-color: #4a89dc;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .secondary-btn {
        background-color: #f0f0f0;
        color: #333;
    }
    
    .card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .form-step {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
    }
    
    .form-group {
        margin-bottom: 15px;
    }
    
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    
    input, select, textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    .nav-links {
        display: flex;
        list-style: none;
        gap: 20px;
    }
    
    .nav-links a {
        text-decoration: none;
        color: #333;
    }
    
    .nav-links a.active {
        color: #4a89dc;
        font-weight: bold;
    }
    
    .form-progress {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid #ddd;
    }
    
    .progress-step {
        padding: 10px 15px;
        cursor: pointer;
    }
    
    .progress-step.active {
        color: #4a89dc;
        border-bottom: 3px solid #4a89dc;
    }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <a href="/">
                    <h1><i class="fas fa-fire-extinguisher"></i> FireEMS.ai</h1>
                </a>
            </div>
            <nav>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="/fire-ems-dashboard">Response Time</a></li>
                    <li><a href="/isochrone-map">Isochrone Map</a></li>
                    <li><a href="/call-density-heatmap">Density Map</a></li>
                    <li><a href="/incident-logger" class="active">Incident Logger</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <h2>Incident Logger</h2>
            <p class="tool-description">Log and manage incident data with automated formatting and validation.</p>
            
            <div class="action-bar">
                <button id="new-incident-btn" class="primary-btn">
                    <i class="fas fa-plus"></i> New Incident
                </button>
                <button id="view-incidents-btn" class="secondary-btn">
                    <i class="fas fa-list"></i> View Incidents
                </button>
                <button id="cad-import-btn" class="cad-import-btn">
                    <i class="fas fa-file-import"></i> Import CAD Data
                </button>
                <button id="export-btn" class="secondary-btn">
                    <i class="fas fa-file-export"></i> Export
                </button>
                <button id="settings-btn" class="secondary-btn">
                    <i class="fas fa-cog"></i> Settings
                </button>
            </div>

            <div id="incident-form-container" class="card">
                <form id="incident-form">
                    <div class="form-progress">
                        <div class="progress-step active" data-step="1">Basic Info</div>
                        <div class="progress-step" data-step="2">Location</div>
                        <div class="progress-step" data-step="3">Dispatch</div>
                        <div class="progress-step" data-step="4">Units & Personnel</div>
                        <div class="progress-step" data-step="5">Patient Info</div>
                        <div class="progress-step" data-step="6">Narrative</div>
                        <div class="progress-step" data-step="7">Disposition</div>
                    </div>

                    <!-- Step 1: Basic Info -->
                    <div class="form-step" data-step="1">
                        <h3>Basic Incident Information</h3>
                        
                        <div class="form-group">
                            <label for="incident-id">Incident ID</label>
                            <input type="text" id="incident-id" name="incident-id" readonly>
                            <small>Automatically generated</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="incident-timestamp">Incident Date/Time</label>
                            <input type="datetime-local" id="incident-timestamp" name="incident-timestamp" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="incident-status">Status</label>
                            <select id="incident-status" name="incident-status" required>
                                <option value="">Select Status</option>
                                <option value="draft">Draft</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        
                        <div class="form-section">
                            <h4>Incident Type</h4>
                            
                            <div class="form-group">
                                <label for="incident-primary-type">Primary Type</label>
                                <select id="incident-primary-type" name="incident-primary-type" required>
                                    <option value="">Select Primary Type</option>
                                    <option value="FIRE">Fire</option>
                                    <option value="EMS">EMS</option>
                                    <option value="HAZMAT">HAZMAT</option>
                                    <option value="RESCUE">Rescue</option>
                                    <option value="SERVICE">Service Call</option>
                                    <option value="OTHER">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="incident-secondary-type">Secondary Type</label>
                                <select id="incident-secondary-type" name="incident-secondary-type">
                                    <option value="">Select Secondary Type</option>
                                    <!-- Dynamically populated based on primary type -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="incident-specific-type">Specific Type</label>
                                <select id="incident-specific-type" name="incident-specific-type">
                                    <option value="">Select Specific Type</option>
                                    <!-- Dynamically populated based on secondary type -->
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4>Caller Information</h4>
                            
                            <div class="form-group">
                                <label for="caller-name">Caller Name</label>
                                <input type="text" id="caller-name" name="caller-name">
                            </div>
                            
                            <div class="form-group">
                                <label for="caller-phone">Caller Phone</label>
                                <input type="tel" id="caller-phone" name="caller-phone" placeholder="555-123-4567">
                            </div>
                            
                            <div class="form-group">
                                <label for="caller-relationship">Relationship to Incident</label>
                                <select id="caller-relationship" name="caller-relationship">
                                    <option value="">Select Relationship</option>
                                    <option value="self">Self</option>
                                    <option value="witness">Witness</option>
                                    <option value="family">Family Member</option>
                                    <option value="bystander">Bystander</option>
                                    <option value="professional">Professional</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-navigation">
                            <button type="button" class="next-btn">Next <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                    
                    <!-- Step 2: Location -->
                    <div class="form-step" data-step="2" style="display:none;">
                        <h3>Incident Location</h3>
                        
                        <div class="form-group">
                            <label for="location-address">Address</label>
                            <input type="text" id="location-address" name="location-address" required>
                            <button type="button" id="geocode-btn" class="secondary-btn small-btn">
                                <i class="fas fa-map-marker-alt"></i> Geocode
                            </button>
                        </div>
                        
                        <div class="form-group coordinates">
                            <div>
                                <label for="location-latitude">Latitude</label>
                                <input type="number" id="location-latitude" name="location-latitude" step="0.000001">
                            </div>
                            <div>
                                <label for="location-longitude">Longitude</label>
                                <input type="number" id="location-longitude" name="location-longitude" step="0.000001">
                            </div>
                            <button type="button" id="current-location-btn" class="secondary-btn small-btn">
                                <i class="fas fa-location-arrow"></i> Current Location
                            </button>
                        </div>
                        
                        <div id="location-map" class="map-container"></div>
                        
                        <div class="form-group">
                            <label for="location-notes">Location Notes</label>
                            <textarea id="location-notes" name="location-notes" placeholder="Apartment number, access details, etc."></textarea>
                        </div>
                        
                        <div class="form-navigation">
                            <button type="button" class="prev-btn"><i class="fas fa-arrow-left"></i> Previous</button>
                            <button type="button" class="next-btn">Next <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Dispatch -->
                    <div class="form-step" data-step="3" style="display:none;">
                        <h3>Dispatch Information</h3>
                        
                        <div class="time-entry-grid">
                            <div class="form-group">
                                <label for="time-received">Time Received</label>
                                <input type="datetime-local" id="time-received" name="time-received" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="time-dispatched">Time Dispatched</label>
                                <input type="datetime-local" id="time-dispatched" name="time-dispatched">
                            </div>
                            
                            <div class="form-group">
                                <label for="time-enroute">Time Enroute</label>
                                <input type="datetime-local" id="time-enroute" name="time-enroute">
                            </div>
                            
                            <div class="form-group">
                                <label for="time-arrived">Time Arrived</label>
                                <input type="datetime-local" id="time-arrived" name="time-arrived">
                            </div>
                            
                            <div class="form-group">
                                <label for="time-transported">Time Transported</label>
                                <input type="datetime-local" id="time-transported" name="time-transported">
                            </div>
                            
                            <div class="form-group">
                                <label for="time-at-hospital">Time At Hospital</label>
                                <input type="datetime-local" id="time-at-hospital" name="time-at-hospital">
                            </div>
                            
                            <div class="form-group">
                                <label for="time-cleared">Time Cleared</label>
                                <input type="datetime-local" id="time-cleared" name="time-cleared">
                            </div>
                        </div>
                        
                        <div class="response-time-summary">
                            <h4>Response Time Summary</h4>
                            <div class="response-metrics">
                                <div class="metric">
                                    <span class="metric-label">Call to Dispatch:</span>
                                    <span id="call-to-dispatch" class="metric-value">--:--</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Dispatch to Enroute:</span>
                                    <span id="dispatch-to-enroute" class="metric-value">--:--</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Enroute to Arrived:</span>
                                    <span id="enroute-to-arrived" class="metric-value">--:--</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Total Response Time:</span>
                                    <span id="total-response-time" class="metric-value">--:--</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-navigation">
                            <button type="button" class="prev-btn"><i class="fas fa-arrow-left"></i> Previous</button>
                            <button type="button" class="next-btn">Next <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                    
                    <!-- Step 4: Units & Personnel -->
                    <div class="form-step" data-step="4" style="display:none;">
                        <h3>Units & Personnel</h3>
                        
                        <div id="units-container">
                            <div class="unit-entry">
                                <div class="form-section">
                                    <h4>Unit #1</h4>
                                    <button type="button" class="remove-unit-btn secondary-btn small-btn">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                
                                <div class="form-group">
                                    <label for="unit-id-1">Unit ID</label>
                                    <input type="text" id="unit-id-1" name="unit-id-1" placeholder="E12, M7, etc." required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="unit-type-1">Unit Type</label>
                                    <select id="unit-type-1" name="unit-type-1" required>
                                        <option value="">Select Type</option>
                                        <option value="Engine">Engine</option>
                                        <option value="Ladder">Ladder</option>
                                        <option value="Ambulance">Ambulance</option>
                                        <option value="Rescue">Rescue</option>
                                        <option value="Battalion">Battalion</option>
                                        <option value="Hazmat">Hazmat</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Personnel</label>
                                    <div class="personnel-list">
                                        <div class="personnel-entry">
                                            <input type="text" name="personnel-1-1" placeholder="Name/ID">
                                            <button type="button" class="remove-personnel-btn secondary-btn small-btn">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button type="button" class="add-personnel-btn secondary-btn small-btn">
                                        <i class="fas fa-plus"></i> Add Personnel
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" id="add-unit-btn" class="secondary-btn">
                            <i class="fas fa-plus"></i> Add Unit
                        </button>
                        
                        <div class="form-navigation">
                            <button type="button" class="prev-btn"><i class="fas fa-arrow-left"></i> Previous</button>
                            <button type="button" class="next-btn">Next <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                    
                    <!-- Step 5: Patient Info -->
                    <div class="form-step" data-step="5" style="display:none;">
                        <h3>Patient Information</h3>
                        
                        <div class="hipaa-privacy-banner">
                            <div class="privacy-icon"><i class="fas fa-shield-alt"></i></div>
                            <div class="privacy-message">
                                <strong>PHI Warning:</strong> This section contains Protected Health Information (PHI).
                                HIPAA compliance requires proper handling, consent, and access controls.
                            </div>
                        </div>
                        
                        <div class="hipaa-consent-form">
                            <h4>HIPAA Consent</h4>
                            <div class="form-group">
                                <label for="hipaa-consent-obtained">Consent Obtained</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="hipaa-consent-obtained" name="hipaa-consent-obtained">
                                    <label for="hipaa-consent-obtained" class="switch-label"></label>
                                </div>
                            </div>
                            
                            <div id="consent-details" style="display:none;">
                                <div class="form-group">
                                    <label for="hipaa-consent-type">Consent Type</label>
                                    <select id="hipaa-consent-type" name="hipaa-consent-type">
                                        <option value="">Select Type</option>
                                        <option value="verbal">Verbal</option>
                                        <option value="written">Written</option>
                                        <option value="implied">Implied</option>
                                        <option value="emergency">Emergency (no consent possible)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="hipaa-consent-obtained-by">Consent Obtained By</label>
                                    <input type="text" id="hipaa-consent-obtained-by" name="hipaa-consent-obtained-by">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="patient-count">Number of Patients</label>
                            <input type="number" id="patient-count" name="patient-count" min="0" value="1">
                        </div>
                        
                        <div id="patients-container">
                            <div class="patient-entry">
                                <div class="form-section">
                                    <h4>Patient #1</h4>
                                    <button type="button" class="remove-patient-btn secondary-btn small-btn">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                
                                <div class="form-group">
                                    <label for="patient-age-1">Age</label>
                                    <input type="number" id="patient-age-1" name="patient-age-1" min="0" max="120">
                                </div>
                                
                                <div class="form-group">
                                    <label for="patient-gender-1">Gender</label>
                                    <select id="patient-gender-1" name="patient-gender-1">
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                        <option value="unknown">Unknown</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="patient-complaint-1">Chief Complaint</label>
                                    <textarea id="patient-complaint-1" name="patient-complaint-1"></textarea>
                                </div>
                                
                                <!-- PHI fields - Personal Identifiers -->
                                <div class="form-section">
                                    <h5>Personal Information (PHI)</h5>
                                    
                                    <div class="form-group">
                                        <label for="patient-name-first-1" class="phi-label">First Name</label>
                                        <input type="text" id="patient-name-first-1" name="patient-name-first-1" class="phi-field">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="patient-name-last-1" class="phi-label">Last Name</label>
                                        <input type="text" id="patient-name-last-1" name="patient-name-last-1" class="phi-field">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="patient-dob-1" class="phi-label">Date of Birth</label>
                                        <input type="date" id="patient-dob-1" name="patient-dob-1" class="phi-field">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="patient-phone-1" class="phi-label">Phone</label>
                                        <input type="tel" id="patient-phone-1" name="patient-phone-1" class="phi-field">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="patient-address-1" class="phi-label">Address</label>
                                        <input type="text" id="patient-address-1" name="patient-address-1" class="phi-field">
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Vitals</h5>
                                    <div class="vitals-table">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Time</th>
                                                    <th>BP</th>
                                                    <th>Pulse</th>
                                                    <th>Resp</th>
                                                    <th>SpO2</th>
                                                    <th>GCS</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="vitals-rows-1">
                                                <tr class="vitals-row">
                                                    <td>
                                                        <input type="datetime-local" name="vital-time-1-1">
                                                    </td>
                                                    <td>
                                                        <input type="text" name="vital-bp-1-1" placeholder="120/80">
                                                    </td>
                                                    <td>
                                                        <input type="number" name="vital-pulse-1-1" min="20" max="250">
                                                    </td>
                                                    <td>
                                                        <input type="number" name="vital-resp-1-1" min="4" max="60">
                                                    </td>
                                                    <td>
                                                        <input type="number" name="vital-spo2-1-1" min="50" max="100">
                                                    </td>
                                                    <td>
                                                        <input type="number" name="vital-gcs-1-1" min="3" max="15">
                                                    </td>
                                                    <td>
                                                        <button type="button" class="remove-vital-btn secondary-btn small-btn">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <button type="button" class="add-vital-btn secondary-btn small-btn" data-patient="1">
                                        <i class="fas fa-plus"></i> Add Vital Signs
                                    </button>
                                </div>
                                
                                <div class="form-section">
                                    <h5>Treatments</h5>
                                    <div id="treatments-container-1">
                                        <div class="treatment-entry">
                                            <div class="form-group">
                                                <label for="treatment-time-1-1">Time</label>
                                                <input type="datetime-local" id="treatment-time-1-1" name="treatment-time-1-1">
                                            </div>
                                            <div class="form-group">
                                                <label for="treatment-procedure-1-1">Procedure</label>
                                                <input type="text" id="treatment-procedure-1-1" name="treatment-procedure-1-1">
                                            </div>
                                            <div class="form-group">
                                                <label for="treatment-notes-1-1">Notes</label>
                                                <textarea id="treatment-notes-1-1" name="treatment-notes-1-1"></textarea>
                                            </div>
                                            <button type="button" class="remove-treatment-btn secondary-btn small-btn">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button type="button" class="add-treatment-btn secondary-btn small-btn" data-patient="1">
                                        <i class="fas fa-plus"></i> Add Treatment
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" id="add-patient-btn" class="secondary-btn">
                            <i class="fas fa-plus"></i> Add Patient
                        </button>
                        
                        <div class="form-navigation">
                            <button type="button" class="prev-btn"><i class="fas fa-arrow-left"></i> Previous</button>
                            <button type="button" class="next-btn">Next <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                    
                    <!-- Step 6: Narrative -->
                    <div class="form-step" data-step="6" style="display:none;">
                        <h3>Narrative</h3>
                        
                        <div class="form-group">
                            <label for="incident-narrative">Incident Narrative</label>
                            <textarea id="incident-narrative" name="incident-narrative" rows="10" placeholder="Describe the incident in detail..." required minlength="20"></textarea>
                            <div class="narrative-tools">
                                <span id="narrative-char-count">0 characters</span>
                                <button type="button" id="spell-check-btn" class="secondary-btn small-btn">
                                    <i class="fas fa-spell-check"></i> Spell Check
                                </button>
                                <div class="common-phrases">
                                    <button type="button" class="phrase-btn secondary-btn small-btn">On arrival</button>
                                    <button type="button" class="phrase-btn secondary-btn small-btn">Patient presented with</button>
                                    <button type="button" class="phrase-btn secondary-btn small-btn">Upon assessment</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4>Attachments</h4>
                            <div class="attachment-container">
                                <div id="attachments-list">
                                    <!-- Attachments will be listed here -->
                                </div>
                                <div class="attachment-uploader">
                                    <label for="attachment-upload" class="upload-label">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <span>Upload File or Photo</span>
                                    </label>
                                    <input type="file" id="attachment-upload" name="attachment-upload" accept="image/*" multiple style="display:none;">
                                    <p class="file-info">Maximum file size: 5MB</p>
                                </div>
                                <div class="camera-capture">
                                    <button type="button" id="camera-btn" class="secondary-btn">
                                        <i class="fas fa-camera"></i> Capture Photo
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-navigation">
                            <button type="button" class="prev-btn"><i class="fas fa-arrow-left"></i> Previous</button>
                            <button type="button" class="next-btn">Next <i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                    
                    <!-- Step 7: Disposition -->
                    <div class="form-step" data-step="7" style="display:none;">
                        <h3>Disposition</h3>
                        
                        <div class="form-group">
                            <label for="transported">Patient Transported?</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="transported" name="transported">
                                <label for="transported" class="switch-label"></label>
                            </div>
                        </div>
                        
                        <div id="transport-details" style="display:none;">
                            <div class="form-group">
                                <label for="destination">Destination</label>
                                <select id="destination" name="destination">
                                    <option value="">Select Destination</option>
                                    <option value="Phoenix General Hospital">Phoenix General Hospital</option>
                                    <option value="Mercy Medical Center">Mercy Medical Center</option>
                                    <option value="County Hospital">County Hospital</option>
                                    <option value="Children's Hospital">Children's Hospital</option>
                                    <option value="Trauma Center">Trauma Center</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group" id="destination-other" style="display:none;">
                                <label for="destination-other-input">Other Destination</label>
                                <input type="text" id="destination-other-input" name="destination-other-input">
                            </div>
                            
                            <div class="form-group">
                                <label for="transport-reason">Reason for Transport</label>
                                <textarea id="transport-reason" name="transport-reason"></textarea>
                            </div>
                        </div>
                        
                        <div id="no-transport-details">
                            <div class="form-group">
                                <label for="no-transport-reason">Reason for No Transport</label>
                                <select id="no-transport-reason" name="no-transport-reason">
                                    <option value="">Select Reason</option>
                                    <option value="Patient Refusal">Patient Refusal</option>
                                    <option value="Canceled on Scene">Canceled on Scene</option>
                                    <option value="No Patient Found">No Patient Found</option>
                                    <option value="Treated and Released">Treated and Released</option>
                                    <option value="DOA">DOA</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group" id="no-transport-other" style="display:none;">
                                <label for="no-transport-other-input">Other Reason</label>
                                <input type="text" id="no-transport-other-input" name="no-transport-other-input">
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4>Incident Closure</h4>
                            
                            <div class="form-group">
                                <label for="created-by">Report Prepared By</label>
                                <input type="text" id="created-by" name="created-by" required>
                            </div>
                        </div>
                        
                        <div class="form-navigation">
                            <button type="button" class="prev-btn"><i class="fas fa-arrow-left"></i> Previous</button>
                            <div class="save-buttons">
                                <button type="button" id="save-draft-btn" class="secondary-btn">
                                    <i class="fas fa-save"></i> Save Draft
                                </button>
                                <button type="submit" id="submit-incident-btn" class="primary-btn">
                                    <i class="fas fa-check"></i> Submit Incident
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div id="incident-list-container" class="card" style="display:none;">
                <div class="list-header">
                    <h3>Incident List</h3>
                    <div class="list-controls">
                        <div class="search-container">
                            <input type="text" id="search-incidents" placeholder="Search incidents...">
                            <button type="button" id="search-btn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <div class="filter-container">
                            <select id="status-filter">
                                <option value="">All Statuses</option>
                                <option value="draft">Draft</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                            <select id="type-filter">
                                <option value="">All Types</option>
                                <option value="FIRE">Fire</option>
                                <option value="EMS">EMS</option>
                                <option value="HAZMAT">HAZMAT</option>
                                <option value="RESCUE">Rescue</option>
                                <option value="SERVICE">Service Call</option>
                                <option value="OTHER">Other</option>
                            </select>
                            <select id="date-filter">
                                <option value="">All Dates</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                            </select>
                            <button type="button" id="reset-filters-btn" class="secondary-btn small-btn">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                        </div>
                    </div>
                </div>
                <div class="incident-table-container">
                    <table id="incident-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Date/Time</th>
                                <th>Type</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="incident-list">
                            <!-- Incidents will be listed here -->
                        </tbody>
                    </table>
                </div>
                <div id="pagination-controls">
                    <button type="button" id="prev-page" class="secondary-btn small-btn" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <span id="page-info">Page 1 of 1</span>
                    <button type="button" id="next-page" class="secondary-btn small-btn" disabled>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <div id="export-container" class="card" style="display:none;">
                <h3>Export Incident Data</h3>
                
                <div class="export-options">
                    <div class="export-section">
                        <h4>Export Format</h4>
                        <div class="format-options">
                            <div class="form-group">
                                <input type="radio" id="format-csv" name="export-format" value="csv" checked>
                                <label for="format-csv">CSV</label>
                            </div>
                            <div class="form-group">
                                <input type="radio" id="format-pdf" name="export-format" value="pdf">
                                <label for="format-pdf">PDF</label>
                            </div>
                            <div class="form-group">
                                <input type="radio" id="format-json" name="export-format" value="json">
                                <label for="format-json">JSON</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="export-section">
                        <h4>Data Selection</h4>
                        <div class="form-group">
                            <input type="radio" id="export-all" name="export-selection" value="all" checked>
                            <label for="export-all">All Incidents</label>
                        </div>
                        <div class="form-group">
                            <input type="radio" id="export-filtered" name="export-selection" value="filtered">
                            <label for="export-filtered">Filtered Incidents</label>
                        </div>
                        <div class="form-group">
                            <input type="radio" id="export-selected" name="export-selection" value="selected">
                            <label for="export-selected">Selected Incidents</label>
                        </div>
                    </div>
                    
                    <div class="export-section">
                        <h4>Date Range</h4>
                        <div class="date-range-controls">
                            <div class="form-group">
                                <label for="export-date-from">From</label>
                                <input type="date" id="export-date-from" name="export-date-from">
                            </div>
                            <div class="form-group">
                                <label for="export-date-to">To</label>
                                <input type="date" id="export-date-to" name="export-date-to">
                            </div>
                        </div>
                    </div>
                    
                    <div class="export-section hipaa-section">
                        <h4>HIPAA Compliance</h4>
                        <div class="form-group">
                            <input type="checkbox" id="export-hipaa-compliant" name="export-hipaa-compliant">
                            <label for="export-hipaa-compliant">De-identify PHI (HIPAA Safe Harbor Method)</label>
                            <p class="hipaa-info">
                                <i class="fas fa-info-circle"></i> 
                                De-identified data will have Protected Health Information (PHI) removed according to 
                                HIPAA's Safe Harbor Method, which requires removal of 18 types of identifiers.
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="export-actions">
                    <button type="button" id="generate-export-btn" class="primary-btn">
                        <i class="fas fa-file-export"></i> Generate Export
                    </button>
                </div>
            </div>
            
            <div id="cad-import-container" class="card" style="display:none;">
                <h3>Import Data from CAD System</h3>
                
                <div class="cad-import-form">
                    <div class="form-group">
                        <label for="cad-file">CAD Export File</label>
                        <input type="file" id="cad-file" accept=".csv,.json,.xml">
                        <p class="file-hint">Supported formats: CSV, JSON, XML</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="cad-import-mode">Import Mode</label>
                        <select id="cad-import-mode">
                            <option value="new">Create New Incidents</option>
                            <option value="update">Update Existing Incident</option>
                        </select>
                    </div>
                    
                    <div id="cad-match-container" style="display:none;">
                        <div class="form-group">
                            <label for="cad-match-id">Incident ID to Update</label>
                            <input type="text" id="cad-match-id" placeholder="e.g., INC-20250322-001">
                        </div>
                    </div>
                    
                    <div class="cad-import-actions">
                        <button id="cad-import-run-btn" class="primary-btn">
                            <i class="fas fa-file-import"></i> Import CAD Data
                        </button>
                    </div>
                </div>
                
                <div id="cad-import-preview" style="display:none;">
                    <h4>Import Preview</h4>
                    <div id="cad-preview-content"></div>
                    
                    <div class="cad-import-actions">
                        <button id="cad-apply-btn" class="primary-btn">
                            <i class="fas fa-check"></i> Apply CAD Data
                        </button>
                        <button id="cad-cancel-btn" class="secondary-btn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="settings-container" class="card" style="display:none;">
                <h3>Settings</h3>
                
                <div class="settings-sections">
                    <div class="settings-section">
                        <h4>General Settings</h4>
                        
                        <div class="form-group">
                            <label for="default-status">Default Incident Status</label>
                            <select id="default-status" name="default-status">
                                <option value="draft">Draft</option>
                                <option value="active">Active</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="auto-save">Auto-save Interval (minutes)</label>
                            <input type="number" id="auto-save" name="auto-save" min="1" max="60" value="5">
                        </div>
                        
                        <div class="form-group">
                            <label for="default-location">Default Location</label>
                            <input type="text" id="default-location" name="default-location">
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>Display Settings</h4>
                        
                        <div class="form-group">
                            <label for="items-per-page">Items Per Page</label>
                            <select id="items-per-page" name="items-per-page">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="date-format">Date Format</label>
                            <select id="date-format" name="date-format">
                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="time-format">Time Format</label>
                            <select id="time-format" name="time-format">
                                <option value="12">12-hour (AM/PM)</option>
                                <option value="24">24-hour</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>Data Management</h4>
                        
                        <div class="form-group">
                            <label for="storage-mode">Storage Mode</label>
                            <select id="storage-mode" name="storage-mode">
                                <option value="local">Local Storage</option>
                                <option value="server">Server Storage</option>
                                <option value="both">Both (Sync)</option>
                            </select>
                        </div>
                        
                        <div class="data-management-actions">
                            <button type="button" id="export-settings-btn" class="secondary-btn">
                                <i class="fas fa-download"></i> Export Settings
                            </button>
                            <button type="button" id="import-settings-btn" class="secondary-btn">
                                <i class="fas fa-upload"></i> Import Settings
                            </button>
                            <button type="button" id="clear-data-btn" class="warning-btn">
                                <i class="fas fa-exclamation-triangle"></i> Clear All Data
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button type="button" id="save-settings-btn" class="primary-btn">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                    <button type="button" id="reset-settings-btn" class="secondary-btn">
                        <i class="fas fa-undo"></i> Reset to Default
                    </button>
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <div class="footer-container">
            <p>&copy; 2025 FireEMS.ai - Incident Logger v1.0</p>
        </div>
    </footer>

    <!-- Template for new patient entry (hidden) -->
    <template id="patient-template">
        <div class="patient-entry">
            <div class="form-section">
                <h4>Patient #{{index}}</h4>
                <button type="button" class="remove-patient-btn secondary-btn small-btn">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            
            <div class="form-group">
                <label for="patient-age-{{index}}">Age</label>
                <input type="number" id="patient-age-{{index}}" name="patient-age-{{index}}" min="0" max="120">
            </div>
            
            <div class="form-group">
                <label for="patient-gender-{{index}}">Gender</label>
                <select id="patient-gender-{{index}}" name="patient-gender-{{index}}">
                    <option value="">Select Gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                    <option value="unknown">Unknown</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="patient-complaint-{{index}}">Chief Complaint</label>
                <textarea id="patient-complaint-{{index}}" name="patient-complaint-{{index}}"></textarea>
            </div>
            
            <!-- PHI fields - Personal Identifiers -->
            <div class="form-section">
                <h5>Personal Information (PHI)</h5>
                
                <div class="form-group">
                    <label for="patient-name-first-{{index}}" class="phi-label">First Name</label>
                    <input type="text" id="patient-name-first-{{index}}" name="patient-name-first-{{index}}" class="phi-field">
                </div>
                
                <div class="form-group">
                    <label for="patient-name-last-{{index}}" class="phi-label">Last Name</label>
                    <input type="text" id="patient-name-last-{{index}}" name="patient-name-last-{{index}}" class="phi-field">
                </div>
                
                <div class="form-group">
                    <label for="patient-dob-{{index}}" class="phi-label">Date of Birth</label>
                    <input type="date" id="patient-dob-{{index}}" name="patient-dob-{{index}}" class="phi-field">
                </div>
                
                <div class="form-group">
                    <label for="patient-phone-{{index}}" class="phi-label">Phone</label>
                    <input type="tel" id="patient-phone-{{index}}" name="patient-phone-{{index}}" class="phi-field">
                </div>
                
                <div class="form-group">
                    <label for="patient-address-{{index}}" class="phi-label">Address</label>
                    <input type="text" id="patient-address-{{index}}" name="patient-address-{{index}}" class="phi-field">
                </div>
            </div>
            
            <div class="form-section">
                <h5>Vitals</h5>
                <div class="vitals-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>BP</th>
                                <th>Pulse</th>
                                <th>Resp</th>
                                <th>SpO2</th>
                                <th>GCS</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="vitals-rows-{{index}}">
                            <tr class="vitals-row">
                                <td>
                                    <input type="datetime-local" name="vital-time-{{index}}-1">
                                </td>
                                <td>
                                    <input type="text" name="vital-bp-{{index}}-1" placeholder="120/80">
                                </td>
                                <td>
                                    <input type="number" name="vital-pulse-{{index}}-1" min="20" max="250">
                                </td>
                                <td>
                                    <input type="number" name="vital-resp-{{index}}-1" min="4" max="60">
                                </td>
                                <td>
                                    <input type="number" name="vital-spo2-{{index}}-1" min="50" max="100">
                                </td>
                                <td>
                                    <input type="number" name="vital-gcs-{{index}}-1" min="3" max="15">
                                </td>
                                <td>
                                    <button type="button" class="remove-vital-btn secondary-btn small-btn">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button type="button" class="add-vital-btn secondary-btn small-btn" data-patient="{{index}}">
                    <i class="fas fa-plus"></i> Add Vital Signs
                </button>
            </div>
            
            <div class="form-section">
                <h5>Treatments</h5>
                <div id="treatments-container-{{index}}">
                    <div class="treatment-entry">
                        <div class="form-group">
                            <label for="treatment-time-{{index}}-1">Time</label>
                            <input type="datetime-local" id="treatment-time-{{index}}-1" name="treatment-time-{{index}}-1">
                        </div>
                        <div class="form-group">
                            <label for="treatment-procedure-{{index}}-1">Procedure</label>
                            <input type="text" id="treatment-procedure-{{index}}-1" name="treatment-procedure-{{index}}-1">
                        </div>
                        <div class="form-group">
                            <label for="treatment-notes-{{index}}-1">Notes</label>
                            <textarea id="treatment-notes-{{index}}-1" name="treatment-notes-{{index}}-1"></textarea>
                        </div>
                        <button type="button" class="remove-treatment-btn secondary-btn small-btn">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <button type="button" class="add-treatment-btn secondary-btn small-btn" data-patient="{{index}}">
                    <i class="fas fa-plus"></i> Add Treatment
                </button>
            </div>
        </div>
    </template>

    <!-- Modal templates -->
    <div id="modal-container" class="modal-container" style="display:none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title">Modal Title</h3>
                <button id="modal-close" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modal-content" class="modal-content">
                <!-- Modal content goes here -->
            </div>
            <div id="modal-footer" class="modal-footer">
                <button id="modal-cancel" class="secondary-btn">Cancel</button>
                <button id="modal-confirm" class="primary-btn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Toast notification template -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.9/dayjs.min.js"></script>
    
    <!-- Component scripts - changed from type="module" to normal scripts -->
    <script src="/static/js/components/incident-form.js"></script>
    <script src="/static/js/components/incident-validator.js"></script>
    <script src="/static/js/components/incident-list.js"></script>
    <script src="/static/js/components/incident-map.js"></script>
    <script src="/static/js/components/incident-export.js"></script>
    <script src="/static/js/components/hipaa-compliance.js"></script>
    <script src="/static/js/components/cad-integration.js"></script>
    
    <!-- Main script file -->
    <script src="/static/incident-logger.js"></script>
    <script>
    // Add console logging to debug module loading
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOMContentLoaded event fired');
        console.log('Document ready, trying to initialize page');
        setTimeout(() => {
            console.log('Checking if all elements loaded correctly');
            const containers = [
                'incident-form-container', 
                'cad-import-container', 
                'incident-list-container',
                'export-container', 
                'settings-container'
            ];
            containers.forEach(id => {
                const el = document.getElementById(id);
                console.log(`Container #${id}: ${el ? 'Found' : 'NOT FOUND'}`);
            });
        }, 1000);
    });
    </script>
</body>
</html>
