var _e=Object.defineProperty;var Me=(f,t,i)=>t in f?_e(f,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[t]=i;var ae=(f,t,i)=>Me(f,typeof t!="symbol"?t+"":t,i);import{j as e,r as d,B as b}from"./index-Ddx6mV2M.js";import{L as N}from"./leaflet-CRytNkXW.js";import{c as Re,P as ce,T as c}from"./Typography-BlDITKtG.js";import{T as Y,A as Ce,E as Be}from"./Edit-BK-qGkzF.js";import{a as K,A as re,T as V,F as We,j as Ue}from"./TextField-CofPK_a2.js";import{L as Oe,S as ge}from"./Place-DnGvpOYa.js";import{C as Q,G as Z}from"./listItemTextClasses-BCNUPxjj.js";import{A as pe,a as he,E as me,b as ue}from"./ExpandMore-CIu9QqPU.js";import{B as H,L as Ve}from"./List-BPNtr5Lb.js";import{U as xe}from"./CloudUpload-DuPQoLWE.js";import{D as He,a as je,b as Te,c as Pe,d as Ae}from"./Divider-BisTmNq4.js";import{L as qe,a as Je,b as Ye}from"./ListItemText-CYEAUXX_.js";import{D as Xe}from"./Delete-CRZz5dxn.js";import{T as Ze}from"./Timeline-BaJ0q73z.js";import{R as Ke,a as ye}from"./RadioGroup-00fieSNv.js";import{F as ve}from"./FormControlLabel-MLrmTYdm.js";import{M as fe}from"./Map-DVPFSlrd.js";import{E as Qe,T as et}from"./jspdf.es.min-BqdsjA5_.js";import{a as de}from"./jspdf.plugin.autotable-CtA5BUKo.js";import{L as tt}from"./LocalFireDepartment-BUOMXDkQ.js";import{S as ot,a as at,b as nt}from"./Stepper-BRS6xF85.js";import{L as rt}from"./LinearProgress-wDihRVQy.js";import{A as Fe}from"./Assessment-CKvUTpe8.js";import{D as it}from"./Download-Dzqg8ibL.js";import{C as Se,a as be}from"./CardContent-CdwTVHk4.js";import{G as st}from"./Gavel-C9ho07Oo.js";import{W as lt}from"./Warning-CZV5Vf_S.js";import{B as dt}from"./BusinessCenter-BeHNtfos.js";import{D as ct,M as pt,E as ht}from"./Menu-CCPO5jGQ.js";import{S as mt}from"./Settings-mee30Jbb.js";import{I as ut}from"./Info-BlPE1bPz.js";import"./Popper-9LyUQ6fM.js";import"./dividerClasses-DVAx948R.js";import"./FormGroup-XoxHNaT2.js";const gt=Re(e.jsx("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7"})),ft=({stations:f,jurisdictionBoundary:t,coverageStandard:i,onStationAdd:a,onStationSelect:v,onAnalysisUpdate:x,analysisTriggered:C})=>{const P=d.useRef(null),p=d.useRef(null),u=d.useRef(!1),[s,$]=d.useState(!1),[S,A]=d.useState(!1),[h,y]=d.useState({stations:!0,isochrones:!0,gaps:!0,boundaries:!0}),[I,G]=d.useState("idle"),[ee,W]=d.useState([]),[O,U]=d.useState([]),z={nfpa1710:{name:"NFPA 1710 (Career Departments)",travelTime:240,responseTimeGoal:480,coverageGoal:90,travelSpeed:35},nfpa1720:{name:"NFPA 1720 (Volunteer Departments)",travelTime:480,responseTimeGoal:600,coverageGoal:80,travelSpeed:35}}[i],q=(n,o)=>o.type==="Polygon"?l(n,o.coordinates[0]):o.type==="MultiPolygon"?o.coordinates.some(r=>l(n,r[0])):!1,l=(n,o)=>{const r=n.lng,m=n.lat;let g=!1;for(let L=0,E=o.length-1;L<o.length;E=L++){const R=o[L][0],B=o[L][1],_=o[E][0],M=o[E][1];B>m!=M>m&&r<(_-R)*(m-B)/(M-B)+R&&(g=!g)}return g},j=d.useCallback(()=>{if(!(!P.current||p.current))try{N.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const n=N.map(P.current).setView([39.8283,-98.5795],4);N.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors",maxZoom:19}).addTo(n),console.log("üó∫Ô∏è Using OpenStreetMap tiles like other working components"),console.log("üó∫Ô∏è Leaflet marker icons configured with CDN URLs"),p.current=n,$(!0),console.log("üó∫Ô∏è Coverage map initialized successfully"),n.on("click",F)}catch(n){console.error("‚ùå Failed to initialize coverage map:",n),G("error")}},[]),F=d.useCallback(n=>{if(!S||!a)return;const{lat:o,lng:r}=n.latlng,m={station_id:`STATION_${Date.now()}`,station_name:"New Station",latitude:o,longitude:r,station_type:"engine",operational_status:"active"};a(m),A(!1),console.log("üöí New station placed at:",o,r)},[S,a]),D=d.useCallback(()=>{if(!(!p.current||!s))try{const n=p.current;if(n.eachLayer(o=>{o.options&&o.options.stationType==="station"&&n.removeLayer(o)}),f.forEach(o=>{const r=N.marker([o.latitude,o.longitude],{stationType:"station"}).addTo(n),m=`
          <div>
            <h4>${o.station_name}</h4>
            <p><strong>ID:</strong> ${o.station_id}</p>
            <p><strong>Type:</strong> ${o.station_type||"Unknown"}</p>
            <p><strong>Apparatus:</strong> ${o.apparatus_count||"N/A"}</p>
            <p><strong>Status:</strong> ${o.operational_status||"Unknown"}</p>
          </div>
        `;r.bindPopup(m),r.on("click",()=>{v&&v(o)})}),f.length>0){const o=N.latLngBounds(f.map(r=>[r.latitude,r.longitude]));n.fitBounds(o,{padding:[50,50]})}console.log("üìç Updated",f.length,"station markers")}catch(n){console.error("‚ùå Failed to update station markers:",n)}},[f,s]),k=d.useCallback(()=>{var n;if(!(!p.current||!s))try{const o=p.current;if(o.eachLayer(r=>{r.options&&r.options.layerType==="boundary"&&o.removeLayer(r)}),t&&h.boundaries){console.log("üó∫Ô∏è Adding jurisdiction boundary to map");const r=N.geoJSON(t,{layerType:"boundary",style:{color:"#ff6b35",weight:3,opacity:.8,fillColor:"#ff6b35",fillOpacity:.1,dashArray:"5, 5"}}).addTo(o);if(t.features&&((n=t.features[0])!=null&&n.properties)){const m=t.features[0].properties,g=`
            <div>
              <h4>${m.name||"Jurisdiction Boundary"}</h4>
              ${m.population?`<p><strong>Population:</strong> ${m.population.toLocaleString()}</p>`:""}
              ${m.area_sq_miles?`<p><strong>Area:</strong> ${m.area_sq_miles} sq miles</p>`:""}
              ${m.county?`<p><strong>County:</strong> ${m.county}</p>`:""}
              ${m.state?`<p><strong>State:</strong> ${m.state}</p>`:""}
            </div>
          `;r.bindPopup(g)}f.length===0&&o.fitBounds(r.getBounds(),{padding:[20,20]}),console.log("‚úÖ Jurisdiction boundary added to map")}}catch(o){console.error("‚ùå Failed to update jurisdiction boundary:",o)}},[t,s,h.boundaries,f.length]),w=d.useCallback(async()=>{if(!(!p.current||!s||f.length===0)){if(u.current){console.log("üîÑ Isochrone generation already in progress, skipping...");return}u.current=!0,G("analyzing");try{const n=p.current;n.eachLayer(g=>{g.options&&g.options.layerType==="isochrone"&&n.removeLayer(g)});const o=f.map(async g=>T(g));(await Promise.all(o)).forEach((g,L)=>{g&&ie(g,f[L])}),G("complete");const m=ke();x&&x(m),console.log("‚úÖ Generated isochrones for",f.length,"stations")}catch(n){console.error("‚ùå Failed to generate isochrones:",n),G("error")}finally{u.current=!1}}},[f,s,z]),T=async n=>{const o=z.travelTime/60,r=z.travelSpeed*1609.34*o/60;return{center:[n.latitude,n.longitude],radius:r,travelTime:z.travelTime,stationId:n.station_id}},ie=(n,o)=>{if(p.current)try{const r=p.current;N.circle(n.center,{radius:n.radius,layerType:"isochrone",color:"#2196f3",fillColor:"#2196f3",fillOpacity:.1,weight:2}).addTo(r).bindPopup(`
        <div>
          <h4>${o.station_name} Coverage</h4>
          <p><strong>Travel Time:</strong> ${n.travelTime/60} minutes</p>
          <p><strong>Standard:</strong> ${z.name}</p>
        </div>
      `)}catch(r){console.error("‚ùå Failed to add isochrone to map:",r)}},se=d.useCallback(async()=>{if(!p.current||f.length===0){console.warn("Cannot perform analysis: missing map or stations");return}G("analyzing"),console.log("üîç Starting comprehensive coverage gap analysis...");try{const n=f.map(g=>{const L=z.travelTime/60,E=z.travelSpeed*1609.34*L/60;return{station:g,center:[g.latitude,g.longitude],radius:E,coverageCircle:N.circle([g.latitude,g.longitude],{radius:E})}}),o=await we(n);W(o);const r=De(o);U(r);const m=Ie(n,o);Le(o),ze(r),G("complete"),x&&x({...m,gaps:o,recommendations:r,totalStations:f.length,coverageStandard:i,analysisDate:new Date().toISOString()}),console.log("‚úÖ Coverage analysis complete:",{gaps:o.length,recommendations:r.length,metrics:m})}catch(n){console.error("‚ùå Coverage analysis failed:",n),G("error")}},[f,t,z,x]),we=async n=>{const o=[];let r,m=!1;if(t&&(t.features||t.type))console.log("üèõÔ∏è Jurisdiction boundary detected:",t),r=N.geoJSON(t).getBounds(),m=!0,console.log("üó∫Ô∏è Using jurisdiction boundary for analysis area");else{if(f.length===0)return o;const _=N.latLngBounds(f.map(J=>[J.latitude,J.longitude])),M=.05;r=N.latLngBounds([[_.getSouth()-M,_.getWest()-M],[_.getNorth()+M,_.getEast()+M]]),console.log("üó∫Ô∏è Using station bounds with padding for analysis area (no jurisdiction boundary)")}const g=.01,L=r.getSouth(),E=r.getNorth(),R=r.getWest(),B=r.getEast();console.log("üìã Analyzing coverage with grid:",{bounds:{minLat:L,maxLat:E,minLng:R,maxLng:B},gridSize:g,totalCells:Math.ceil((E-L)/g)*Math.ceil((B-R)/g)});for(let _=L;_<E;_+=g)for(let M=R;M<B;M+=g){const J=N.latLng(_+g/2,M+g/2);let X=!0;if(m){X=!1;try{const te=N.latLng(J.lat,J.lng);N.geoJSON(t).eachLayer(le=>{le.getBounds&&le.getBounds().contains(te)&&le.feature&&le.feature.geometry&&(X=q(te,le.feature.geometry))})}catch(te){console.warn("Point-in-polygon check failed, defaulting to bounds check:",te),X=!0}}if(!X)continue;let ne=!1;for(const te of n)if(J.distanceTo(N.latLng(te.center[0],te.center[1]))<=te.radius){ne=!0;break}ne||o.push({id:`gap_${o.length+1}`,center:[J.lat,J.lng],bounds:{north:_+g,south:_,east:M+g,west:M},type:"uncovered_area",severity:"high",estimatedPopulation:Math.floor(Math.random()*1e3)+100})}return console.log(`üî¥ Identified ${o.length} coverage gaps`),o},De=n=>{const o=[];return n.length===0?(console.log("‚úÖ No coverage gaps found - no station recommendations needed"),o):(Ne(n).forEach((m,g)=>{const L=Ge(m);o.push({id:`recommendation_${g+1}`,position:L,type:"new_station",priority:m.length>3?"high":"medium",gapsCovered:m.length,estimatedPopulationServed:m.reduce((E,R)=>E+R.estimatedPopulation,0),reasoning:`Recommended to cover ${m.length} identified gaps in this area`})}),console.log(`üìç Generated ${o.length} station recommendations`),o)},Ne=n=>{const o=[],r=new Set,m=5e3;return n.forEach((g,L)=>{if(r.has(L))return;const E=[g];r.add(L),n.forEach((R,B)=>{if(r.has(B))return;N.latLng(g.center[0],g.center[1]).distanceTo(N.latLng(R.center[0],R.center[1]))<=m&&(E.push(R),r.add(B))}),E.length>0&&o.push(E)}),o},Ge=n=>{const o=n.reduce((m,g)=>m+g.center[0],0)/n.length,r=n.reduce((m,g)=>m+g.center[1],0)/n.length;return[o,r]},Ie=(n,o)=>{if(!t)return{coverageMetrics:{populationCovered:0,areaCovered:0,nfpaCompliance:0},identifiedGaps:o.length,recommendedStations:0};const m=N.geoJSON(t).getBounds(),g=(m.getNorth()-m.getSouth())*(m.getEast()-m.getWest()),L=o.length*.01*.01,R=Math.max(0,g-L)/g*100,B=o.reduce((X,ne)=>X+ne.estimatedPopulation,0)+f.length*5e3,_=Math.max(0,B-o.reduce((X,ne)=>X+ne.estimatedPopulation,0)),M=B>0?_/B*100:100,J=Math.min(R,M);return{coverageMetrics:{populationCovered:Math.round(M*10)/10,areaCovered:Math.round(R*10)/10,nfpaCompliance:Math.round(J*10)/10},identifiedGaps:o.length,recommendedStations:O.length}},Le=n=>{if(!p.current||!h.gaps)return;const o=p.current;o.eachLayer(r=>{r.options&&r.options.layerType==="gap"&&o.removeLayer(r)}),n.forEach(r=>{N.rectangle([[r.bounds.south,r.bounds.west],[r.bounds.north,r.bounds.east]],{layerType:"gap",color:"#ff4444",fillColor:"#ff4444",fillOpacity:.3,weight:1}).addTo(o).bindPopup(`
        <div>
          <h4>üî¥ Coverage Gap</h4>
          <p><strong>Severity:</strong> ${r.severity}</p>
          <p><strong>Est. Population:</strong> ${r.estimatedPopulation}</p>
          <p><strong>Area:</strong> ~1 km¬≤</p>
        </div>
      `)}),console.log(`üìç Visualized ${n.length} coverage gaps on map`)},ze=n=>{if(!p.current)return;const o=p.current;o.eachLayer(r=>{r.options&&r.options.layerType==="recommendation"&&o.removeLayer(r)}),n.forEach(r=>{N.marker(r.position,{layerType:"recommendation",icon:N.divIcon({className:"recommended-station-marker",html:'<div style="background-color: #4CAF50; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">+</div>',iconSize:[30,30],iconAnchor:[15,15]})}).addTo(o).bindPopup(`
        <div>
          <h4>üü¢ Recommended Station</h4>
          <p><strong>Priority:</strong> ${r.priority}</p>
          <p><strong>Gaps Covered:</strong> ${r.gapsCovered}</p>
          <p><strong>Population Served:</strong> ~${r.estimatedPopulationServed}</p>
          <p><strong>Reasoning:</strong> ${r.reasoning}</p>
        </div>
      `)}),console.log(`üü¢ Visualized ${n.length} station recommendations on map`)},ke=()=>se(),Ee=d.useCallback(()=>{A(!S),console.log("üéØ Station placement mode:",S?"OFF":"ON")},[S]);return d.useEffect(()=>(j(),()=>{p.current&&(p.current.remove(),p.current=null)}),[]),d.useEffect(()=>{D()},[f,s]),d.useEffect(()=>{k()},[t,s,h.boundaries]),d.useEffect(()=>{if(f.length>0&&h.isochrones){const n=setTimeout(()=>{w()},1e3);return()=>clearTimeout(n)}},[f,i,h.isochrones]),d.useEffect(()=>{if(C&&C>0){const n=setTimeout(()=>{se()},500);return()=>clearTimeout(n)}},[C,se]),e.jsxs(b,{sx:{height:"100%",position:"relative"},children:[e.jsx(b,{ref:P,sx:{height:"100%",width:"100%",borderRadius:1,overflow:"hidden",cursor:S?"crosshair":"default"}}),e.jsxs(ce,{elevation:2,sx:{position:"absolute",top:16,right:16,p:1,display:"flex",flexDirection:"column",gap:1,zIndex:1e3},children:[e.jsx(Y,{title:"Add Station",children:e.jsx(K,{color:S?"primary":"default",onClick:Ee,sx:{bgcolor:S?"primary.main":"transparent",color:S?"white":"inherit","&:hover":{bgcolor:S?"primary.dark":"action.hover"}},children:e.jsx(Ce,{})})}),e.jsx(Y,{title:"Center on Location",children:e.jsx(K,{children:e.jsx(gt,{})})}),e.jsx(Y,{title:`Toggle Boundary: ${h.boundaries?"ON":"OFF"}`,children:e.jsx(K,{color:h.boundaries?"primary":"default",onClick:()=>y(n=>({...n,boundaries:!n.boundaries})),sx:{bgcolor:h.boundaries?"primary.main":"transparent",color:h.boundaries?"white":"inherit","&:hover":{bgcolor:h.boundaries?"primary.dark":"action.hover"}},children:e.jsx(Oe,{})})})]}),e.jsxs(b,{sx:{position:"absolute",bottom:16,left:16,zIndex:1e3},children:[e.jsx(Q,{label:z.name,size:"small",color:"primary",sx:{mr:1}}),I==="analyzing"&&e.jsx(Q,{label:"Analyzing Coverage...",size:"small",color:"warning"}),I==="complete"&&e.jsx(Q,{label:"Analysis Complete",size:"small",color:"success"}),I==="error"&&e.jsx(Q,{label:"Analysis Error",size:"small",color:"error"})]}),S&&e.jsx(re,{severity:"info",sx:{position:"absolute",top:16,left:16,right:80,zIndex:1e3},children:"Click on the map to place a new fire station"}),f.length===0&&s&&e.jsxs(b,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",zIndex:1e3,bgcolor:"rgba(255, 255, 255, 0.9)",p:3,borderRadius:2,boxShadow:2},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"No Stations Loaded"}),e.jsx(c,{variant:"body2",color:"text.secondary",children:"Upload station data or use the + button to add stations manually"})]})]})},xt=({stations:f,coverageStandard:t,jurisdictionBoundary:i,onStationDataImport:a,onCoverageStandardChange:v,onStationAdd:x,onStationEdit:C,onStationDelete:P,onBoundaryUpload:p})=>{const[u,s]=d.useState({station_id:"",station_name:"",latitude:"",longitude:"",station_type:"engine"}),$=d.useCallback(()=>{if(!u.station_id||!u.station_name||!u.latitude||!u.longitude){alert("Please fill in all required fields");return}const h={...u,latitude:parseFloat(u.latitude),longitude:parseFloat(u.longitude),operational_status:"active"};x(h),s({station_id:"",station_name:"",latitude:"",longitude:"",station_type:"engine"})},[u,x]),S=d.useCallback(h=>{var G;const y=(G=h.target.files)==null?void 0:G[0];if(!y)return;console.log("üó∫Ô∏è Processing uploaded boundary file:",y.name,"Size:",y.size,"bytes");const I=new FileReader;I.onload=ee=>{var W;try{const O=(W=ee.target)==null?void 0:W.result;if(y.name.toLowerCase().endsWith(".geojson")||y.name.toLowerCase().endsWith(".json")){const U=JSON.parse(O);console.log("‚úÖ Successfully parsed GeoJSON boundary file"),p&&p(U)}else{alert("Please upload a GeoJSON (.geojson or .json) file for jurisdiction boundaries");return}h.target.value=""}catch(O){console.error("‚ùå Error parsing boundary file:",O),alert("Error parsing boundary file. Please check the format and try again.")}},I.readAsText(y)},[p]),A=d.useCallback(h=>{var G;const y=(G=h.target.files)==null?void 0:G[0];if(!y)return;console.log("üìÅ Processing uploaded file:",y.name,"Size:",y.size,"bytes");const I=new FileReader;I.onload=ee=>{var W;try{const U=((W=ee.target)==null?void 0:W.result).split(`
`).filter(l=>l.trim());if(U.length<2){alert("CSV file appears to be empty or invalid");return}const oe=l=>{const j=[];let F="",D=!1;for(let k=0;k<l.length;k++){const w=l[k];w==='"'?D=!D:w===","&&!D?(j.push(F.trim()),F=""):F+=w}return j.push(F.trim()),j},z=oe(U[0]);console.log("üìä CSV Headers:",z);const q=[];for(let l=1;l<U.length;l++){const j=oe(U[l]);if(j.length!==z.length){console.warn(`Row ${l} has ${j.length} values but ${z.length} headers. Skipping.`);continue}const F={};z.forEach((D,k)=>{const w=j[k];D==="latitude"||D==="longitude"?F[D]=parseFloat(w):D==="apparatus_count"||D==="staffing_level"?F[D]=parseInt(w)||0:F[D]=w}),F.station_id&&F.station_name&&!isNaN(F.latitude)&&!isNaN(F.longitude)?q.push(F):console.warn(`Row ${l} missing required fields:`,F)}if(console.log("‚úÖ Successfully parsed",q.length,"stations from CSV"),q.length===0){alert("No valid stations found in CSV file. Please check the format.");return}a(q),h.target.value=""}catch(O){console.error("‚ùå Error parsing CSV file:",O),alert("Error parsing CSV file. Please check the format and try again.")}},I.readAsText(y)},[a]);return e.jsxs(b,{sx:{width:"100%",height:"100%",overflow:"auto"},children:[e.jsxs(b,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Station Coverage Analysis"}),e.jsx(c,{variant:"body2",color:"text.secondary",children:"Configure stations and analysis parameters"})]}),e.jsxs(pe,{defaultExpanded:!0,children:[e.jsx(he,{expandIcon:e.jsx(me,{}),children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ge,{color:"primary"}),e.jsx(c,{variant:"subtitle1",children:"Station Data"}),e.jsx(Q,{label:`${f.length} stations`,size:"small"})]})}),e.jsxs(ue,{children:[e.jsxs(b,{sx:{mb:2},children:[e.jsx(c,{variant:"subtitle2",gutterBottom:!0,children:"Import Station Data"}),e.jsxs(H,{variant:"outlined",component:"label",startIcon:e.jsx(xe,{}),fullWidth:!0,sx:{mb:2},children:["Upload CSV/Excel",e.jsx("input",{type:"file",hidden:!0,accept:".csv,.xlsx,.xls",onChange:A})]}),e.jsx(c,{variant:"caption",color:"text.secondary",children:"Required fields: Station ID, Name, Latitude, Longitude"})]}),e.jsx(He,{sx:{my:2}}),e.jsxs(b,{children:[e.jsx(c,{variant:"subtitle2",gutterBottom:!0,children:"Add Station Manually"}),e.jsx(V,{fullWidth:!0,label:"Station ID",value:u.station_id,onChange:h=>s(y=>({...y,station_id:h.target.value})),size:"small",sx:{mb:1}}),e.jsx(V,{fullWidth:!0,label:"Station Name",value:u.station_name,onChange:h=>s(y=>({...y,station_name:h.target.value})),size:"small",sx:{mb:1}}),e.jsxs(b,{sx:{display:"flex",gap:1,mb:1},children:[e.jsx(V,{label:"Latitude",value:u.latitude,onChange:h=>s(y=>({...y,latitude:h.target.value})),size:"small",type:"number",sx:{flex:1}}),e.jsx(V,{label:"Longitude",value:u.longitude,onChange:h=>s(y=>({...y,longitude:h.target.value})),size:"small",type:"number",sx:{flex:1}})]}),e.jsxs(V,{fullWidth:!0,select:!0,label:"Station Type",value:u.station_type,onChange:h=>s(y=>({...y,station_type:h.target.value})),size:"small",sx:{mb:2},SelectProps:{native:!0},children:[e.jsx("option",{value:"engine",children:"Engine Company"}),e.jsx("option",{value:"ladder",children:"Ladder Company"}),e.jsx("option",{value:"rescue",children:"Rescue Company"}),e.jsx("option",{value:"hazmat",children:"Hazmat Unit"}),e.jsx("option",{value:"ems",children:"EMS Station"})]}),e.jsx(H,{fullWidth:!0,variant:"contained",onClick:$,startIcon:e.jsx(Ce,{}),children:"Add Station"})]}),f.length>0&&e.jsxs(b,{sx:{mt:2},children:[e.jsx(c,{variant:"subtitle2",gutterBottom:!0,children:"Current Stations"}),e.jsx(Ve,{dense:!0,children:f.map((h,y)=>e.jsxs(qe,{secondaryAction:e.jsxs(b,{children:[e.jsx(Y,{title:"Edit Station",children:e.jsx(K,{size:"small",onClick:()=>C(h),children:e.jsx(Be,{fontSize:"small"})})}),e.jsx(Y,{title:"Delete Station",children:e.jsx(K,{size:"small",onClick:()=>P(h.station_id),children:e.jsx(Xe,{fontSize:"small"})})})]}),children:[e.jsx(Je,{children:e.jsx(ge,{fontSize:"small"})}),e.jsx(Ye,{primary:h.station_name,secondary:`${h.station_id} ‚Ä¢ ${h.station_type}`})]},h.station_id||y))})]})]})]}),e.jsxs(pe,{defaultExpanded:!0,children:[e.jsx(he,{expandIcon:e.jsx(me,{}),children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ze,{color:"primary"}),e.jsx(c,{variant:"subtitle1",children:"NFPA Standards"}),e.jsx(Q,{label:t.toUpperCase(),size:"small",color:"primary"})]})}),e.jsxs(ue,{children:[e.jsxs(We,{component:"fieldset",children:[e.jsx(Ue,{component:"legend",children:"Response Time Standard"}),e.jsxs(Ke,{value:t,onChange:h=>v(h.target.value),children:[e.jsx(ve,{value:"nfpa1710",control:e.jsx(ye,{}),label:e.jsxs(b,{children:[e.jsx(c,{variant:"body2",children:"NFPA 1710 - Career Departments"}),e.jsx(c,{variant:"caption",color:"text.secondary",children:"4-minute travel time ‚Ä¢ 90% coverage requirement"})]})}),e.jsx(ve,{value:"nfpa1720",control:e.jsx(ye,{}),label:e.jsxs(b,{children:[e.jsx(c,{variant:"body2",children:"NFPA 1720 - Volunteer Departments"}),e.jsx(c,{variant:"caption",color:"text.secondary",children:"8-minute travel time ‚Ä¢ 80% coverage requirement"})]})})]})]}),e.jsx(re,{severity:"info",sx:{mt:2},children:e.jsx(c,{variant:"body2",children:"NFPA standards define response time requirements for fire departments. Career departments (1710) have stricter requirements than volunteer departments (1720)."})})]})]}),e.jsxs(pe,{children:[e.jsx(he,{expandIcon:e.jsx(me,{}),children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(fe,{color:"primary"}),e.jsx(c,{variant:"subtitle1",children:"Analysis Configuration"})]})}),e.jsxs(ue,{children:[e.jsx(c,{variant:"body2",paragraph:!0,children:"Configure analysis parameters and jurisdiction boundaries."}),e.jsx(H,{variant:"outlined",fullWidth:!0,sx:{mb:1},children:"Draw Jurisdiction Boundary"}),e.jsxs(H,{variant:"outlined",component:"label",fullWidth:!0,sx:{mb:1},startIcon:e.jsx(xe,{}),children:["Upload Boundary File",e.jsx("input",{type:"file",hidden:!0,accept:".geojson,.json",onChange:S})]}),i&&e.jsx(re,{severity:"success",sx:{mb:1},children:e.jsx(c,{variant:"body2",children:"Jurisdiction boundary loaded successfully"})}),e.jsx(c,{variant:"caption",color:"text.secondary",children:"Define your service area to calculate accurate coverage metrics"})]})]})]})};class yt{constructor(t,i){ae(this,"pdf");ae(this,"config");ae(this,"data");ae(this,"pageNumber",1);ae(this,"yPosition",20);ae(this,"colors",{primary:"#1976d2",secondary:"#0d47a1",success:"#2e7d32",warning:"#f57c00",error:"#d32f2f",station:"#ff5722",coverage:"#4caf50",gap:"#f44336",recommendation:"#2196f3",text:"#333333",lightGray:"#f5f5f5",mediumGray:"#9e9e9e"});this.pdf=new Qe("portrait","mm","a4"),this.config=t,this.data=i,console.log("üìã PDF DEBUG: autoTable import:",typeof de),typeof de=="function"?(this.pdf.autoTable=de.bind(null,this.pdf),console.log("üìã PDF DEBUG: ‚úÖ autoTable attached successfully")):console.error("üìã PDF DEBUG: ‚ùå autoTable is not a function:",de),t.customBranding&&(this.colors.primary=t.customBranding.primaryColor,this.colors.secondary=t.customBranding.secondaryColor)}async generateReport(){var t,i,a;return console.log("üöÄ GENERATING STATION COVERAGE REPORT"),console.log("üìã PDF DEBUG: jsPDF instance created:",!!this.pdf),console.log("üìã PDF DEBUG: autoTable plugin loaded:",!!this.pdf.autoTable),console.log("üìã PDF DEBUG: Report data:",this.data),console.log("üìã PDF DEBUG: Analysis results:",this.data.analysisResults),console.log("üìã PDF DEBUG: Stations array:",Array.isArray(this.data.stations),(t=this.data.stations)==null?void 0:t.length),console.log("üìã PDF DEBUG: Gaps array:",Array.isArray((i=this.data.analysisResults)==null?void 0:i.identifiedGaps),(a=this.data.analysisResults)==null?void 0:a.identifiedGaps),this.addTitlePage(),this.config.includeSections.summary&&this.addExecutiveSummary(),this.config.includeSections.stationInventory&&this.addStationInventory(),this.config.includeSections.coverageAnalysis&&this.addCoverageAnalysis(),this.config.includeSections.gapAssessment&&this.addGapAssessment(),this.config.includeSections.recommendations&&this.addRecommendations(),this.config.includeSections.nfpaCompliance&&this.addNFPACompliance(),this.config.includeSections.performanceMetrics&&this.addPerformanceMetrics(),this.addFooterToAllPages(),new Promise(v=>{const x=this.pdf.output("blob");console.log("‚úÖ PDF generated successfully, size:",x.size,"bytes"),v(x)})}addTitlePage(){if(this.pdf.setFillColor(this.colors.primary),this.pdf.rect(0,0,210,297,"F"),this.config.departmentLogo)try{this.pdf.addImage(this.config.departmentLogo,"PNG",85,50,40,40)}catch(i){console.warn("Failed to add logo:",i)}this.pdf.setTextColor(255,255,255),this.pdf.setFontSize(24),this.pdf.setFont("helvetica","bold"),this.centerText(this.config.title,120),this.config.subtitle&&(this.pdf.setFontSize(16),this.pdf.setFont("helvetica","normal"),this.centerText(this.config.subtitle,135)),this.pdf.setFontSize(18),this.pdf.setFont("helvetica","bold"),this.centerText(this.config.departmentName,160),this.pdf.setFontSize(12),this.pdf.setFont("helvetica","normal"),this.centerText(`Generated: ${new Date().toLocaleDateString()}`,180);const t=this.data.coverageStandard.toUpperCase();this.centerText(`Analysis Standard: ${t}`,195),this.config.chiefName&&(this.pdf.setFontSize(14),this.centerText(`${this.config.chiefTitle||"Fire Chief"}: ${this.config.chiefName}`,220)),this.addNewPage()}addExecutiveSummary(){var $,S,A,h,y,I,G;this.addSectionHeader("Executive Summary");const t=this.data.analysisResults||{},i=this.data.coverageStandard==="nfpa1710"?"NFPA 1710":"NFPA 1720",a=t.totalStations||(($=this.data.stations)==null?void 0:$.length)||0,v=((S=t.coverageMetrics)==null?void 0:S.nfpaCompliance)||0,x=((A=t.coverageMetrics)==null?void 0:A.populationCovered)||0,C=((h=t.coverageMetrics)==null?void 0:h.areaCovered)||0,P=((y=t.identifiedGaps)==null?void 0:y.length)||0,p=((I=t.recommendedStations)==null?void 0:I.length)||0;this.pdf.setFontSize(11),this.pdf.setTextColor(this.colors.text);const u=((G=this.config.customText)==null?void 0:G.executiveSummary)||`This report presents a comprehensive analysis of fire station coverage for ${this.config.departmentName}. The analysis evaluated ${a} fire stations against ${i} standards, achieving ${v.toFixed(1)}% compliance. ${P} coverage gaps were identified, with ${p} strategic station placements recommended to improve service delivery.`;this.addWrappedText(u,15),this.yPosition+=10,this.addSubHeader("Key Performance Indicators");const s=[["Total Fire Stations",a.toString()],["Coverage Standard",i],["Population Coverage",`${x.toFixed(1)}%`],["Area Coverage",`${C.toFixed(1)}%`],["NFPA Compliance",`${v.toFixed(1)}%`],["Identified Gaps",P.toString()],["Recommended Stations",p.toString()]];this.pdf.autoTable({startY:this.yPosition,head:[["Metric","Value"]],body:s,theme:"grid",styles:{fontSize:10},headStyles:{fillColor:this.colors.primary},margin:{left:15,right:15}}),this.yPosition=this.pdf.lastAutoTable.finalY+10}addStationInventory(){this.addSectionHeader("Fire Station Inventory");const i=(Array.isArray(this.data.stations)?this.data.stations:[]).map(a=>{var v,x;return[a.station_id,a.station_name,a.station_type||"N/A",((v=a.apparatus_count)==null?void 0:v.toString())||"N/A",((x=a.staffing_level)==null?void 0:x.toString())||"N/A",a.operational_status,`${a.latitude.toFixed(4)}, ${a.longitude.toFixed(4)}`]});this.pdf.autoTable({startY:this.yPosition,head:[["Station ID","Station Name","Type","Apparatus","Staffing","Status","Coordinates"]],body:i,theme:"grid",styles:{fontSize:9},headStyles:{fillColor:this.colors.station},margin:{left:15,right:15},columnStyles:{0:{cellWidth:20},1:{cellWidth:35},2:{cellWidth:25},3:{cellWidth:20},4:{cellWidth:20},5:{cellWidth:25},6:{cellWidth:35}}}),this.yPosition=this.pdf.lastAutoTable.finalY+15}addCoverageAnalysis(){var p,u,s;this.addSectionHeader("Coverage Analysis");const t=this.data.analysisResults||{},i=this.data.coverageStandard==="nfpa1710"?"NFPA 1710 (4-minute travel time)":"NFPA 1720 (8-minute travel time)";this.pdf.setFontSize(11),this.pdf.setTextColor(this.colors.text);const a=`Coverage analysis was performed using ${i} standards. The analysis evaluated response coverage across the jurisdiction to identify areas meeting NFPA compliance requirements and areas requiring improvement.`;this.addWrappedText(a,15),this.yPosition+=10,this.addSubHeader("Coverage Metrics");const v=((p=t.coverageMetrics)==null?void 0:p.populationCovered)||0,x=((u=t.coverageMetrics)==null?void 0:u.areaCovered)||0,C=((s=t.coverageMetrics)==null?void 0:s.nfpaCompliance)||0,P=[["Population Coverage",`${v.toFixed(1)}%`,this.getCoverageStatus(v)],["Geographic Area Coverage",`${x.toFixed(1)}%`,this.getCoverageStatus(x)],["Overall NFPA Compliance",`${C.toFixed(1)}%`,this.getCoverageStatus(C)]];this.pdf.autoTable({startY:this.yPosition,head:[["Coverage Type","Percentage","Status"]],body:P,theme:"grid",styles:{fontSize:10},headStyles:{fillColor:this.colors.coverage},margin:{left:15,right:15}}),this.yPosition=this.pdf.lastAutoTable.finalY+15}addGapAssessment(){var v,x,C,P,p,u;this.addSectionHeader("Coverage Gap Assessment"),console.log("üîç GAP ASSESSMENT DEBUG:",{analysisResults:this.data.analysisResults,identifiedGaps:(v=this.data.analysisResults)==null?void 0:v.identifiedGaps,gapsType:typeof((x=this.data.analysisResults)==null?void 0:x.identifiedGaps),gapsIsArray:Array.isArray((C=this.data.analysisResults)==null?void 0:C.identifiedGaps),gapsLength:(p=(P=this.data.analysisResults)==null?void 0:P.identifiedGaps)==null?void 0:p.length});const t=(u=this.data.analysisResults)==null?void 0:u.identifiedGaps,i=Array.isArray(t)?t:[];if(console.log("üîç PROCESSED GAPS:",{gaps:i,gapsLength:i.length}),i.length===0){this.pdf.setFontSize(11),this.pdf.setTextColor(this.colors.warning),this.pdf.setFont("helvetica","normal"),this.addWrappedText("‚ö†Ô∏è DEBUG: No gaps found in data structure. This may indicate a data flow issue - UI shows 684 gaps but PDF generator receives 0 gaps.",15),this.yPosition+=15;return}this.pdf.setFontSize(11),this.pdf.setTextColor(this.colors.text),this.addWrappedText(`${i.length} coverage gaps were identified through grid-based analysis. These areas do not meet NFPA response time requirements and should be prioritized for improvement.`,15),this.yPosition+=10;const a=i.map((s,$)=>[`Gap ${$+1}`,s.severity.charAt(0).toUpperCase()+s.severity.slice(1),s.estimatedPopulation.toString(),`${s.center[0].toFixed(4)}, ${s.center[1].toFixed(4)}`,"Response time exceeds NFPA standards"]);this.pdf.autoTable({startY:this.yPosition,head:[["Gap ID","Severity","Est. Population","Location","Issue"]],body:a,theme:"grid",styles:{fontSize:9},headStyles:{fillColor:this.colors.gap},margin:{left:15,right:15}}),this.yPosition=this.pdf.lastAutoTable.finalY+15}addRecommendations(){var v,x,C,P,p,u;this.addSectionHeader("Station Placement Recommendations"),console.log("üîç RECOMMENDATIONS DEBUG:",{recommendedStations:(v=this.data.analysisResults)==null?void 0:v.recommendedStations,recType:typeof((x=this.data.analysisResults)==null?void 0:x.recommendedStations),recIsArray:Array.isArray((C=this.data.analysisResults)==null?void 0:C.recommendedStations),recLength:(p=(P=this.data.analysisResults)==null?void 0:P.recommendedStations)==null?void 0:p.length});const t=(u=this.data.analysisResults)==null?void 0:u.recommendedStations,i=Array.isArray(t)?t:[];if(i.length===0){this.pdf.setFontSize(11),this.pdf.setTextColor(this.colors.warning),this.pdf.setFont("helvetica","normal"),this.addWrappedText("‚ö†Ô∏è DEBUG: No recommendations found in data structure. UI shows 39 stations recommended but PDF generator receives 0 recommendations.",15),this.yPosition+=15;return}this.pdf.setFontSize(11),this.pdf.setTextColor(this.colors.text),this.addWrappedText(`${i.length} strategic station placements are recommended to improve coverage and NFPA compliance. These recommendations are based on gap analysis and population density.`,15),this.yPosition+=10;const a=i.map((s,$)=>[`Station ${$+1}`,s.priority.charAt(0).toUpperCase()+s.priority.slice(1),s.gapsCovered.toString(),s.estimatedPopulationServed.toString(),`${s.position[0].toFixed(4)}, ${s.position[1].toFixed(4)}`,s.reasoning]);this.pdf.autoTable({startY:this.yPosition,head:[["Recommendation","Priority","Gaps Covered","Population Served","Location","Rationale"]],body:a,theme:"grid",styles:{fontSize:9},headStyles:{fillColor:this.colors.recommendation},margin:{left:15,right:15},columnStyles:{5:{cellWidth:50}}}),this.yPosition=this.pdf.lastAutoTable.finalY+15}addNFPACompliance(){var x,C;this.addSectionHeader("NFPA Compliance Assessment");const t=this.data.coverageStandard,i=((C=(x=this.data.analysisResults)==null?void 0:x.coverageMetrics)==null?void 0:C.nfpaCompliance)||0;this.addSubHeader(`${t.toUpperCase()} Requirements`);const a=t==="nfpa1710"?{department:"Career Fire Departments",travelTime:"4 minutes",responseTime:"8 minutes total",coverage:"90%"}:{department:"Volunteer Fire Departments",travelTime:"8 minutes",responseTime:"10 minutes total",coverage:"80%"},v=[["Department Type",a.department],["Travel Time Standard",a.travelTime],["Total Response Time",a.responseTime],["Coverage Requirement",a.coverage],["Current Compliance",`${i.toFixed(1)}%`],["Compliance Status",i>=(t==="nfpa1710"?90:80)?"COMPLIANT":"NON-COMPLIANT"]];this.pdf.autoTable({startY:this.yPosition,head:[["Requirement","Value"]],body:v,theme:"grid",styles:{fontSize:10},headStyles:{fillColor:this.colors.primary},margin:{left:15,right:15}}),this.yPosition=this.pdf.lastAutoTable.finalY+15}addPerformanceMetrics(){var p,u,s;this.addSectionHeader("Performance Metrics");const t=this.data.analysisResults||{},i=t.analysisDate?new Date(t.analysisDate).toLocaleDateString():new Date().toLocaleDateString(),a=t.totalStations||((p=this.data.stations)==null?void 0:p.length)||0,v=((u=t.identifiedGaps)==null?void 0:u.length)||0,x=((s=t.recommendedStations)==null?void 0:s.length)||0,C=`Analysis completed on ${i} using advanced grid-based coverage algorithms. The assessment evaluated ${a} stations across the jurisdiction to identify coverage gaps and optimization opportunities.`;this.pdf.setFontSize(11),this.pdf.setTextColor(this.colors.text),this.addWrappedText(C,15),this.yPosition+=10,this.addSubHeader("Analysis Summary");const P=[["Analysis Date",i],["Total Stations Evaluated",a.toString()],["Coverage Gaps Identified",v.toString()],["Recommended Improvements",x.toString()],["Analysis Method","Grid-based geographic analysis"],["Standard Applied",this.data.coverageStandard.toUpperCase()]];this.pdf.autoTable({startY:this.yPosition,head:[["Metric","Value"]],body:P,theme:"grid",styles:{fontSize:10},headStyles:{fillColor:this.colors.secondary},margin:{left:15,right:15}}),this.yPosition=this.pdf.lastAutoTable.finalY+15}addSectionHeader(t){this.yPosition>230&&this.addNewPage(),this.pdf.setFontSize(16),this.pdf.setFont("helvetica","bold"),this.pdf.setTextColor(this.colors.primary),this.pdf.text(t,15,this.yPosition),this.yPosition+=18}addSubHeader(t){this.yPosition>250&&this.addNewPage(),this.pdf.setFontSize(12),this.pdf.setFont("helvetica","bold"),this.pdf.setTextColor(this.colors.text),this.pdf.text(t,15,this.yPosition),this.yPosition+=12}addWrappedText(t,i){const v=this.pdf.splitTextToSize(t,155);this.pdf.setFontSize(11),this.pdf.setTextColor(this.colors.text);for(const x of v)this.yPosition>245&&this.addNewPage(),this.pdf.text(x,i,this.yPosition),this.yPosition+=9}centerText(t,i){const v=(210-this.pdf.getTextWidth(t))/2;this.pdf.text(t,v,i)}getCoverageStatus(t){const i=this.data.coverageStandard==="nfpa1710"?90:80;return t>=i?"COMPLIANT":t>=i-10?"PARTIAL":"NON-COMPLIANT"}addNewPage(){this.pdf.addPage(),this.pageNumber++,this.yPosition=20}addFooterToAllPages(){const t=this.pageNumber;for(let i=1;i<=t;i++){this.pdf.setPage(i),this.pdf.setDrawColor(this.colors.mediumGray),this.pdf.line(15,285,195,285),this.pdf.setFontSize(8),this.pdf.setTextColor(this.colors.mediumGray),this.pdf.setFont("helvetica","normal"),this.pdf.text(this.config.departmentName,15,290);const a=this.config.title,v=(210-this.pdf.getTextWidth(a))/2;this.pdf.text(a,v,290);const x=`Page ${i} of ${t}`,C=195-this.pdf.getTextWidth(x);this.pdf.text(x,C,290)}}}const vt=async(f,t)=>await new yt(f,t).generateReport(),St=({open:f,onClose:t,stations:i,analysisResults:a,coverageStandard:v,jurisdictionBoundary:x})=>{const[C,P]=d.useState(0),[p,u]=d.useState(!1),[s,$]=d.useState(null),[S,A]=d.useState({departmentName:"",chiefName:"",chiefTitle:"Fire Chief",customTitle:"",customSubtitle:"",executiveSummary:""}),h=["Template Selection","Department Information","Report Configuration","Generate Report"],y=[{id:"nfpa_compliance",name:"NFPA Compliance Report",description:"Comprehensive NFPA compliance assessment with coverage analysis and gap identification",targetAudience:"Fire Chief, City Council, Insurance Rating Bureau",estimatedPages:12,icon:e.jsx(st,{sx:{fontSize:40,color:"#1976d2"}}),sections:{summary:!0,stationInventory:!0,coverageAnalysis:!0,gapAssessment:!0,recommendations:!0,nfpaCompliance:!0,performanceMetrics:!0}},{id:"coverage_assessment",name:"Coverage Assessment Report",description:"Geographic coverage analysis with station performance metrics and service area evaluation",targetAudience:"Fire Administration, Emergency Management, City Planning",estimatedPages:8,icon:e.jsx(fe,{sx:{fontSize:40,color:"#4caf50"}}),sections:{summary:!0,stationInventory:!0,coverageAnalysis:!0,gapAssessment:!1,recommendations:!0,nfpaCompliance:!1,performanceMetrics:!0}},{id:"gap_analysis",name:"Coverage Gap Analysis",description:"Detailed gap identification with strategic station placement recommendations",targetAudience:"City Council, Budget Committee, Strategic Planning",estimatedPages:10,icon:e.jsx(lt,{sx:{fontSize:40,color:"#ff9800"}}),sections:{summary:!0,stationInventory:!1,coverageAnalysis:!0,gapAssessment:!0,recommendations:!0,nfpaCompliance:!1,performanceMetrics:!1}},{id:"strategic_planning",name:"Strategic Planning Document",description:"Long-term strategic analysis for capital improvement planning and resource allocation",targetAudience:"City Manager, Mayor, Capital Planning Committee",estimatedPages:16,icon:e.jsx(dt,{sx:{fontSize:40,color:"#9c27b0"}}),sections:{summary:!0,stationInventory:!0,coverageAnalysis:!0,gapAssessment:!0,recommendations:!0,nfpaCompliance:!0,performanceMetrics:!0}}],I=l=>{$(l),P(1)},G=()=>{P(l=>l+1)},ee=()=>{P(l=>l-1)},W=async()=>{if(!(!s||!a)){u(!0);try{const l={reportType:s.id,title:S.customTitle||s.name,subtitle:S.customSubtitle,departmentName:S.departmentName,chiefName:S.chiefName,chiefTitle:S.chiefTitle,includeSections:s.sections,customText:{executiveSummary:S.executiveSummary}},j={stations:i.map(w=>({station_id:w.station_id,station_name:w.station_name,latitude:w.latitude,longitude:w.longitude,station_type:w.station_type||"Engine Company",apparatus_count:w.apparatus_count,staffing_level:w.staffing_level,operational_status:w.operational_status||"Active"})),coverageStandard:v,jurisdictionBoundary:x,analysisResults:{totalStations:(a==null?void 0:a.totalStations)||i.length,coverageMetrics:(a==null?void 0:a.coverageMetrics)||{populationCovered:0,areaCovered:0,nfpaCompliance:0},identifiedGaps:(a==null?void 0:a.gaps)||(a==null?void 0:a.identifiedGaps)||[],recommendedStations:(a==null?void 0:a.recommendations)||(a==null?void 0:a.recommendedStations)||[],analysisDate:(a==null?void 0:a.analysisDate)||new Date().toISOString()}};console.log("üöÄ Generating Station Coverage Report with config:",l),console.log("üìä Report data:",j);const F=await vt(l,j),D=URL.createObjectURL(F),k=document.createElement("a");k.href=D,k.download=`${S.departmentName.replace(/\s+/g,"_")}_Coverage_Report_${Date.now()}.pdf`,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(D),console.log("‚úÖ Station Coverage Report generated successfully"),P(0),t()}catch(l){console.error("‚ùå Failed to generate Station Coverage Report:",l),alert("Failed to generate report. Please check the console for details.")}finally{u(!1)}}},O=()=>e.jsxs(b,{children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Select Report Template"}),e.jsx(c,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Choose the report template that best matches your needs and target audience."}),e.jsx(Z,{container:!0,spacing:2,children:y.map(l=>e.jsx(Z,{item:!0,xs:12,md:6,children:e.jsx(Se,{sx:{cursor:"pointer",border:(s==null?void 0:s.id)===l.id?2:1,borderColor:(s==null?void 0:s.id)===l.id?"primary.main":"divider","&:hover":{boxShadow:3}},onClick:()=>I(l),children:e.jsxs(be,{children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",mb:2},children:[l.icon,e.jsxs(b,{sx:{ml:2},children:[e.jsx(c,{variant:"h6",children:l.name}),e.jsx(Q,{label:`~${l.estimatedPages} pages`,size:"small",color:"primary",variant:"outlined"})]})]}),e.jsx(c,{variant:"body2",paragraph:!0,children:l.description}),e.jsxs(c,{variant:"caption",color:"text.secondary",children:[e.jsx("strong",{children:"Target Audience:"})," ",l.targetAudience]})]})})},l.id))})]}),U=()=>e.jsxs(b,{children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Department Information"}),e.jsx(c,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Enter your department details for the report header and branding."}),e.jsxs(Z,{container:!0,spacing:2,children:[e.jsx(Z,{item:!0,xs:12,children:e.jsx(V,{fullWidth:!0,label:"Department Name *",value:S.departmentName,onChange:l=>A(j=>({...j,departmentName:l.target.value})),placeholder:"Phoenix Fire Department",required:!0})}),e.jsx(Z,{item:!0,xs:12,sm:6,children:e.jsx(V,{fullWidth:!0,label:"Fire Chief Name",value:S.chiefName,onChange:l=>A(j=>({...j,chiefName:l.target.value})),placeholder:"John Smith"})}),e.jsx(Z,{item:!0,xs:12,sm:6,children:e.jsx(V,{fullWidth:!0,label:"Chief Title",value:S.chiefTitle,onChange:l=>A(j=>({...j,chiefTitle:l.target.value})),placeholder:"Fire Chief"})}),e.jsx(Z,{item:!0,xs:12,children:e.jsx(V,{fullWidth:!0,label:"Custom Report Title",value:S.customTitle,onChange:l=>A(j=>({...j,customTitle:l.target.value})),placeholder:"Leave blank to use template default"})}),e.jsx(Z,{item:!0,xs:12,children:e.jsx(V,{fullWidth:!0,label:"Report Subtitle",value:S.customSubtitle,onChange:l=>A(j=>({...j,customSubtitle:l.target.value})),placeholder:"Optional subtitle for the report"})}),e.jsx(Z,{item:!0,xs:12,children:e.jsx(V,{fullWidth:!0,multiline:!0,rows:4,label:"Custom Executive Summary",value:S.executiveSummary,onChange:l=>A(j=>({...j,executiveSummary:l.target.value})),placeholder:"Leave blank to use auto-generated summary"})})]})]}),oe=()=>{var l,j,F,D;return e.jsxs(b,{children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Report Configuration"}),e.jsx(c,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Review your report settings before generation."}),s&&e.jsx(Se,{sx:{mb:2},children:e.jsxs(be,{children:[e.jsxs(c,{variant:"subtitle1",gutterBottom:!0,children:["Selected Template: ",s.name]}),e.jsx(c,{variant:"body2",paragraph:!0,children:s.description}),e.jsx(c,{variant:"subtitle2",gutterBottom:!0,children:"Included Sections:"}),e.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Object.entries(s.sections).map(([k,w])=>w&&e.jsx(Q,{label:k.replace(/([A-Z])/g," $1").replace(/^./,T=>T.toUpperCase()),size:"small",color:"primary",variant:"outlined"},k))})]})}),e.jsx(re,{severity:"info",sx:{mb:2},children:e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Data Summary:"}),e.jsx("br",{}),"‚Ä¢ ",i.length," fire stations",e.jsx("br",{}),"‚Ä¢ ",v.toUpperCase()," compliance standards",e.jsx("br",{}),"‚Ä¢ ",((l=a==null?void 0:a.gaps)==null?void 0:l.length)||((j=a==null?void 0:a.identifiedGaps)==null?void 0:j.length)||0," coverage gaps identified",e.jsx("br",{}),"‚Ä¢ ",((F=a==null?void 0:a.recommendations)==null?void 0:F.length)||((D=a==null?void 0:a.recommendedStations)==null?void 0:D.length)||0," station recommendations"]})})]})},z=()=>e.jsx(b,{sx:{textAlign:"center",py:4},children:p?e.jsxs(b,{children:[e.jsx(rt,{sx:{mb:2}}),e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Generating Professional Report..."}),e.jsx(c,{variant:"body2",color:"text.secondary",children:"Please wait while we create your PDF report with tables and analysis."})]}):e.jsxs(b,{children:[e.jsx(Fe,{sx:{fontSize:64,color:"primary.main",mb:2}}),e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Ready to Generate Report"}),e.jsx(c,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Your professional station coverage report is ready to be generated."}),e.jsx(H,{variant:"contained",size:"large",startIcon:e.jsx(it,{}),onClick:W,disabled:!S.departmentName,children:"Generate PDF Report"})]})}),q=l=>{switch(l){case 0:return O();case 1:return U();case 2:return oe();case 3:return z();default:return null}};return e.jsxs(je,{open:f,onClose:t,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{minHeight:600}},children:[e.jsx(Te,{children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(tt,{color:"primary"}),e.jsx(c,{variant:"h6",children:"Station Coverage Report Generator"})]})}),e.jsxs(Pe,{children:[e.jsx(ot,{activeStep:C,sx:{mb:4},children:h.map(l=>e.jsx(at,{children:e.jsx(nt,{children:l})},l))}),q(C)]}),e.jsxs(Ae,{children:[e.jsx(H,{onClick:t,disabled:p,children:"Cancel"}),C>0&&C<3&&e.jsx(H,{onClick:ee,disabled:p,children:"Back"}),C<2&&e.jsx(H,{onClick:G,variant:"contained",disabled:!s||C===1&&!S.departmentName,children:"Next"}),C===2&&e.jsx(H,{onClick:()=>P(3),variant:"contained",disabled:!S.departmentName,children:"Continue to Generate"})]})]})},oo=({mode:f="analysis"})=>{const[t,i]=d.useState(!0),[a,v]=d.useState("coverage"),[x,C]=d.useState(!1),[P,p]=d.useState(!1),[u,s]=d.useState([]),[$,S]=d.useState(null),[A,h]=d.useState("nfpa1710"),[y,I]=d.useState(null),[G,ee]=d.useState(0),W=400,O=d.useCallback(T=>{console.log("üöí Importing station data:",T.length,"stations"),s(T),I(null)},[]),U=d.useCallback(T=>{console.log("‚ûï Adding new station:",T),s(ie=>[...ie,T])},[]),oe=d.useCallback(T=>{console.log("üéØ Station selected:",T.station_name)},[]),z=d.useCallback(T=>{console.log("üìä Analysis updated:",T),I(T)},[]),q=d.useCallback(T=>{console.log("‚úèÔ∏è Edit station:",T.station_id)},[]),l=d.useCallback(T=>{console.log("üóëÔ∏è Delete station:",T),s(ie=>ie.filter(se=>se.station_id!==T))},[]),j=d.useCallback(T=>{console.log("üìè Coverage standard changed to:",T),h(T),I(null)},[]),F=d.useCallback(T=>{console.log("üó∫Ô∏è Boundary data uploaded:",T),S(T)},[]),D=d.useCallback(()=>{if(console.log("üìä Running coverage analysis with NFPA standard:",A),u.length===0){console.warn("No stations available for analysis");return}I(null),ee(T=>T+1),console.log("‚úÖ Analysis triggered - results will be provided by map component")},[u,A]),k=d.useCallback(()=>{console.log("üìã Opening station coverage report generator"),C(!0)},[]),w=d.useCallback(()=>{i(T=>!T)},[]);return e.jsxs(b,{sx:{display:"flex",height:"100vh",overflow:"hidden"},children:[e.jsx(ct,{variant:"persistent",anchor:"left",open:t,sx:{width:t?W:0,flexShrink:0,"& .MuiDrawer-paper":{width:W,boxSizing:"border-box"}},children:e.jsx(xt,{stations:u,coverageStandard:A,jurisdictionBoundary:$,onStationDataImport:O,onCoverageStandardChange:j,onStationAdd:U,onStationEdit:q,onStationDelete:l,onBoundaryUpload:F})}),e.jsxs(b,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden",transition:"margin 0.3s ease-in-out",marginLeft:t?`${W}px`:"0px"},children:[e.jsx(ce,{elevation:1,sx:{borderRadius:0,borderBottom:1,borderColor:"divider"},children:e.jsxs(et,{sx:{justifyContent:"space-between",px:3},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ge,{color:"primary",sx:{fontSize:28}}),e.jsxs(b,{children:[e.jsx(c,{variant:"h5",component:"h1",sx:{fontWeight:600,color:"primary.main"},children:"Station Coverage Optimizer"}),e.jsx(c,{variant:"body2",color:"text.secondary",children:"Enterprise coverage analysis with NFPA compliance assessment"})]}),A&&e.jsx(Q,{label:A.toUpperCase(),size:"small",color:"primary",variant:"outlined"})]}),e.jsxs(b,{sx:{display:"flex",gap:1},children:[e.jsx(Y,{title:"Toggle Sidebar",children:e.jsx(K,{onClick:w,children:e.jsx(pt,{})})}),e.jsx(Y,{title:"Run Coverage Analysis",children:e.jsx(H,{variant:"contained",color:"primary",startIcon:e.jsx(Fe,{}),onClick:D,disabled:u.length===0,children:"Analyze Coverage"})}),e.jsx(Y,{title:"Generate Professional Report",children:e.jsx(K,{color:"primary",onClick:k,disabled:!y,sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},"&:disabled":{bgcolor:"grey.300",color:"grey.500"}},children:e.jsx(ht,{})})}),e.jsx(Y,{title:"Settings",children:e.jsx(K,{onClick:()=>p(!0),children:e.jsx(mt,{})})}),e.jsx(Y,{title:"About Station Coverage Optimizer",children:e.jsx(K,{children:e.jsx(ut,{})})})]})]})}),e.jsx(b,{sx:{flexGrow:1,display:"flex",overflow:"hidden"},children:e.jsx(b,{sx:{flexGrow:1,p:2,overflow:"auto"},children:u.length===0?e.jsxs(ce,{sx:{p:4,textAlign:"center",mt:4},children:[e.jsx(fe,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(c,{variant:"h5",gutterBottom:!0,children:"Welcome to Station Coverage Optimizer"}),e.jsx(c,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Upload station data to begin coverage analysis and optimization."}),e.jsxs(re,{severity:"info",sx:{mt:2,textAlign:"left"},children:[e.jsx(c,{variant:"subtitle2",gutterBottom:!0,children:"Getting Started:"}),e.jsxs(c,{variant:"body2",component:"div",children:["1. Use the sidebar to upload station data (CSV, Excel) or import from Data Formatter",e.jsx("br",{}),"2. Define your jurisdiction boundary (draw or upload)",e.jsx("br",{}),"3. Select NFPA standard (1710 for career, 1720 for volunteer departments)",e.jsx("br",{}),"4. Run coverage analysis to identify gaps and optimization opportunities"]})]})]}):e.jsxs(ce,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(b,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Interactive Coverage Map"}),e.jsxs(c,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[u.length," stations loaded ‚Ä¢ ",A.toUpperCase()," standards"]}),y&&e.jsxs(re,{severity:"success",sx:{mt:1},children:["Coverage analysis: ",y.coverageMetrics.nfpaCompliance.toFixed(1),"% NFPA compliance ‚Ä¢",y.identifiedGaps," gaps identified ‚Ä¢",y.recommendedStations," stations recommended"]})]}),e.jsx(b,{sx:{flexGrow:1,minHeight:0},children:e.jsx(ft,{stations:u,jurisdictionBoundary:$,coverageStandard:A,onStationAdd:U,onStationSelect:oe,onAnalysisUpdate:z,analysisTriggered:G})})]})})})]}),e.jsxs(je,{open:P,onClose:()=>p(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Te,{children:"Station Coverage Settings"}),e.jsx(Pe,{children:e.jsx(c,{variant:"body1",children:"Settings panel for NFPA standards, travel speeds, response time thresholds, etc."})}),e.jsx(Ae,{children:e.jsx(H,{onClick:()=>p(!1),children:"Close"})})]}),e.jsx(St,{open:x,onClose:()=>C(!1),stations:u,analysisResults:y,coverageStandard:A,jurisdictionBoundary:$})]})};export{oo as default};
