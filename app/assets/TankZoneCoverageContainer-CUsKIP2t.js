import{j as e,k as X,l as o,aN as Y,aO as re,aP as ee,aQ as ae,aR as te,aS as ie,aT as se,B as i,aU as le,aV as D,aW as oe,aX as ce,aY as de,aZ as ue,a_ as U,a$ as xe,b0 as he,b1 as me,b2 as pe,b3 as ge,r as $,b4 as ve,R as J,b5 as be}from"./index-BYEmGTla.js";import{S as je,A as ye,a as fe,M as ke,E as Te,D as Ce,b as Ae}from"./A11yProvider-DdKcdaEV.js";import{c as ne,T as s,P as T,u as Se}from"./Typography-CeHez6px.js";import{L as H}from"./LocalFireDepartment-DXIYfWcU.js";import{h as Ie,i as y,T as E,M as p,L as V,l as N,m as Re,n as _,C as q,p as we,g as C,A,k as Fe,f,D as De,E as Ee,q as Me}from"./Settings-XmXYtI0v.js";import{B as b}from"./Button-_dq9F6Qn.js";import{A as ze,D as Be,S as k,a as Le}from"./Delete-BCxAQSAd.js";import{F as Pe,L as We}from"./FilterList-ClEal8hW.js";import{A as Ge}from"./Assessment-DJRplMm3.js";import{D as K}from"./Download-BxLlQpxX.js";import{u as Ze,F as Oe,a as Ue}from"./leaflet-Bg-G7drh.js";const $e=ne(e.jsx("path",{d:"M8 5v14l11-7z"})),Q=ne(e.jsx("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"})),Ve=({mode:g})=>{const n=X(),u=o(Y),S=o(re);o(ee);const c=o(ae),r=o(te),d=o(ie),h=o(se),I=(a,t)=>{n(le(t))},z=()=>{if(u.length===0){alert("Please add at least one tank before running analysis.");return}n(pe()),console.log("ðŸ”¬ Starting coverage analysis for",u.length,"tanks..."),setTimeout(()=>{var t;const a={totalTanks:u.length,coveragePercentage:75+Math.random()*20,gapAreas:[{id:"gap-1",area:160934,severity:"critical",geometry:[],nearestTank:{tankId:((t=u[0])==null?void 0:t.id)||"tank-1",distance:2100,accessTime:8},riskAssessment:"high"}],redundancyAreas:[],recommendations:[{id:"rec-1",type:"new-tank",priority:"high",title:"Add Tank in Northern Coverage Gap",description:"Critical coverage gap identified in northern sector requiring additional water supply.",estimatedCost:75e3,expectedBenefit:"Reduce response time by 4 minutes for 150 properties",implementation:"Install 25,000 gallon tank with road access"}],generatedAt:new Date,analysisParameters:d};n(ge(a)),console.log("âœ… Analysis complete:",a)},2e3)},m=a=>{r.selectedTanks.includes(a)?n(xe(a)):n(he(a))},B=a=>{n(me(a))},R=()=>{const a={name:`Tank ${u.length+1}`,location:{latitude:39.8283+(Math.random()-.5)*.1,longitude:-98.5795+(Math.random()-.5)*.1},capacity:1e4+Math.floor(Math.random()*5e4),type:["municipal","private","emergency"][Math.floor(Math.random()*3)],accessRating:["excellent","good","fair"][Math.floor(Math.random()*3)],operationalStatus:"active",owner:"Sample Owner",notes:"Added via Add Tank button"};n(ue(a)),console.log("ðŸŽ¯ Tank added:",a)},v=()=>{const a=document.createElement("input");a.type="file",a.accept=".csv",a.onchange=t=>{var j;const x=(j=t.target.files)==null?void 0:j[0];x&&(console.log("ðŸ“ CSV file selected:",x.name),alert(`CSV Import selected: ${x.name}

CSV parsing will be implemented in the next development phase.`))},a.click()},L=a=>{const t=a.target.value;n(U({tankTypes:t==="all"?[]:[t]})),console.log("ðŸ” Tank type filter changed:",t)},l=a=>{const t=a.target.value;n(U({operationalStatus:t==="all"?[]:[t]})),console.log("ðŸ” Status filter changed:",t)},P=(a,t)=>{const x=Array.isArray(t)?t:[0,t];n(U({capacityRange:x})),console.log("ðŸ” Capacity range changed:",x)},w=()=>e.jsxs(i,{sx:{p:2},children:[e.jsxs(i,{sx:{mb:2,display:"flex",gap:1},children:[e.jsx(b,{variant:"outlined",startIcon:e.jsx(ze,{}),size:"small",fullWidth:!0,onClick:R,children:"Add Tank"}),e.jsx(b,{variant:"outlined",startIcon:e.jsx(Q,{}),size:"small",fullWidth:!0,onClick:v,children:"Import CSV"})]}),e.jsxs(T,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(s,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(Pe,{sx:{mr:1,verticalAlign:"middle"}}),"Filters"]}),e.jsxs(E,{select:!0,size:"small",label:"Tank Type",fullWidth:!0,margin:"dense",value:r.filterCriteria.tankTypes[0]||"all",onChange:L,children:[e.jsx(p,{value:"all",children:"All Types"}),e.jsx(p,{value:"municipal",children:"Municipal"}),e.jsx(p,{value:"private",children:"Private"}),e.jsx(p,{value:"emergency",children:"Emergency"})]}),e.jsxs(E,{select:!0,size:"small",label:"Status",fullWidth:!0,margin:"dense",value:r.filterCriteria.operationalStatus[0]||"all",onChange:l,children:[e.jsx(p,{value:"all",children:"All Status"}),e.jsx(p,{value:"active",children:"Active"}),e.jsx(p,{value:"inactive",children:"Inactive"}),e.jsx(p,{value:"maintenance",children:"Maintenance"})]}),e.jsx(s,{variant:"caption",display:"block",sx:{mt:1,mb:1},children:"Capacity Range (gallons)"}),e.jsx(je,{size:"small",value:r.filterCriteria.capacityRange,onChange:P,min:0,max:1e5,step:5e3,valueLabelDisplay:"auto",marks:[{value:0,label:"0"},{value:5e4,label:"50K"},{value:1e5,label:"100K"}]})]}),e.jsxs(s,{variant:"subtitle2",gutterBottom:!0,children:["Water Tanks (",S.length,")"]}),e.jsx(V,{dense:!0,children:S.map(a=>e.jsxs(N,{button:!0,selected:r.selectedTanks.includes(a.id),onClick:()=>m(a.id),sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:[e.jsx(Re,{children:e.jsx(H,{color:a.operationalStatus==="active"?"primary":"disabled"})}),e.jsx(_,{primary:a.name,secondary:e.jsxs(i,{children:[e.jsxs(s,{variant:"caption",display:"block",children:[a.capacity.toLocaleString()," gal â€¢ ",a.type]}),e.jsx(q,{size:"small",label:a.accessRating,color:a.accessRating==="excellent"?"success":"default"})]})}),e.jsx(we,{children:e.jsx(C,{size:"small",onClick:t=>{t.stopPropagation(),B(a.id)},children:e.jsx(Be,{})})})]},a.id))}),S.length===0&&e.jsx(A,{severity:"info",sx:{mt:2},children:"No tanks found. Add tanks or adjust filters."})]}),W=()=>e.jsxs(i,{sx:{p:2},children:[e.jsxs(T,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(s,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(Fe,{sx:{mr:1,verticalAlign:"middle"}}),"Analysis Parameters"]}),e.jsx(E,{size:"small",label:"Max Effective Distance (ft)",fullWidth:!0,margin:"dense",type:"number",value:d.maxEffectiveDistance,onChange:a=>n(D({maxEffectiveDistance:parseInt(a.target.value)||1500}))}),e.jsx(E,{size:"small",label:"Min Flow Rate (GPM)",fullWidth:!0,margin:"dense",type:"number",value:d.minimumFlowRate,onChange:a=>n(D({minimumFlowRate:parseInt(a.target.value)||250}))}),e.jsx(f,{control:e.jsx(k,{checked:d.terrainFactor,onChange:a=>n(D({terrainFactor:a.target.checked}))}),label:"Consider Terrain"}),e.jsx(f,{control:e.jsx(k,{checked:d.seasonalFactors,onChange:a=>n(D({seasonalFactors:a.target.checked}))}),label:"Seasonal Factors"})]}),e.jsx(b,{variant:"contained",startIcon:e.jsx($e,{}),fullWidth:!0,size:"large",onClick:z,disabled:u.length===0||h,sx:{mb:2},children:h?"Analyzing...":"Analyze Coverage"}),h&&e.jsx(We,{sx:{mb:2}}),e.jsxs(T,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Display Options"}),e.jsx(f,{control:e.jsx(k,{checked:r.showCoverageZones,onChange:()=>n(oe())}),label:"Coverage Zones"}),e.jsx(f,{control:e.jsx(k,{checked:r.showGapAreas,onChange:()=>n(ce())}),label:"Gap Areas"}),e.jsx(f,{control:e.jsx(k,{checked:r.showRedundancyAreas,onChange:()=>n(de())}),label:"Redundancy Areas"})]}),c&&e.jsxs(T,{variant:"outlined",sx:{p:2},children:[e.jsxs(s,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(Ge,{sx:{mr:1,verticalAlign:"middle"}}),"Analysis Results"]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:["Coverage: ",c.coveragePercentage.toFixed(1),"%"]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:["Tanks: ",c.totalTanks]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:["Critical Gaps: ",c.gapAreas.filter(a=>a.severity==="critical").length]}),e.jsx(b,{variant:"outlined",size:"small",startIcon:e.jsx(K,{}),fullWidth:!0,sx:{mt:1},children:"Export Report"})]})]}),G=()=>e.jsxs(i,{sx:{p:2},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Coverage Gaps"}),c?e.jsx(V,{dense:!0,children:c.gapAreas.map(a=>e.jsx(N,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:e.jsx(_,{primary:`Gap ${a.id}`,secondary:e.jsxs(i,{children:[e.jsxs(s,{variant:"caption",display:"block",children:["Severity: ",e.jsx(q,{size:"small",label:a.severity,color:a.severity==="critical"?"error":a.severity==="high"?"warning":"default"})]}),e.jsxs(s,{variant:"caption",display:"block",children:["Area: ",(a.area/43560).toFixed(1)," acres"]})]})})},a.id))}):e.jsx(A,{severity:"info",children:"Run coverage analysis to identify gaps."})]}),Z=()=>e.jsxs(i,{sx:{p:2},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Recommendations"}),c?e.jsx(V,{dense:!0,children:c.recommendations.map(a=>e.jsx(N,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:e.jsx(_,{primary:a.title,secondary:e.jsxs(i,{children:[e.jsx(s,{variant:"body2",gutterBottom:!0,children:a.description}),e.jsx(q,{size:"small",label:a.priority,color:a.priority==="critical"?"error":a.priority==="high"?"warning":"default"}),a.estimatedCost&&e.jsxs(s,{variant:"caption",display:"block",sx:{mt:1},children:["Est. Cost: $",a.estimatedCost.toLocaleString()]})]})})},a.id))}):e.jsx(A,{severity:"info",children:"Run coverage analysis to see recommendations."})]}),F=()=>e.jsxs(i,{sx:{p:2},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Data Import"}),e.jsx(A,{severity:"info",sx:{mb:2},children:"Import tank locations from CSV or place manually on map."}),e.jsx(b,{variant:"outlined",startIcon:e.jsx(Q,{}),fullWidth:!0,sx:{mb:2},children:"Upload Tank Data (CSV)"}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"CSV should include: Name, Latitude, Longitude, Capacity, Type, Owner"}),e.jsx(De,{sx:{my:2}}),e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Export Data"}),e.jsx(b,{variant:"outlined",startIcon:e.jsx(K,{}),fullWidth:!0,disabled:u.length===0,children:"Export Tank Data"})]});return e.jsxs(i,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(i,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[e.jsxs(s,{variant:"h6",component:"div",sx:{display:"flex",alignItems:"center"},children:[e.jsx(H,{sx:{mr:1}}),"Tank Coverage"]}),g&&e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Mode: ",g]})]}),e.jsxs(Ie,{value:r.sidebarTab,onChange:I,variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(y,{label:"Tanks",value:"tanks"}),e.jsx(y,{label:"Analysis",value:"analysis"}),e.jsx(y,{label:"Gaps",value:"gaps"}),e.jsx(y,{label:"Recommendations",value:"recommendations"}),e.jsx(y,{label:"Import",value:"import"})]}),e.jsxs(i,{sx:{flexGrow:1,overflow:"auto"},children:[r.sidebarTab==="tanks"&&w(),r.sidebarTab==="analysis"&&W(),r.sidebarTab==="gaps"&&G(),r.sidebarTab==="recommendations"&&Z(),r.sidebarTab==="import"&&F()]})]})},M=320,ta=({initialTanks:g=[],initialAnalysisParams:n,onAnalysisComplete:u,onTankUpdate:S,mode:c="analysis"})=>{const r=X(),d=Se(),h=Ze(d.breakpoints.down("md"));$.useEffect(()=>{document.title="FireEMS Tank Zone Coverage"},[]);const I=o(Y),z=o(ee),m=o(ae);o(te);const B=o(se),R=o(ve),[v,L]=J.useState(!h),[l,P]=J.useState(!1);$.useEffect(()=>{g.length>0&&console.log("Loading initial tanks:",g),n&&console.log("Loading initial analysis parameters:",n)},[g,n]),$.useEffect(()=>{m&&u&&u(m)},[m,u]);const w=()=>{L(!v)},W=()=>{P(!l),l?document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()},G=()=>{const t={tanks:I,coverageZones:z,activeAnalysis:m,timestamp:new Date};localStorage.setItem("tankZoneCoverage_autosave",JSON.stringify(t)),console.log("Tank zone coverage data saved")},Z=()=>{if(m){const t={analysis:m,tanks:I,exportedAt:new Date},x=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),j=URL.createObjectURL(x),O=document.createElement("a");O.href=j,O.download=`tank-coverage-analysis-${new Date().toISOString().split("T")[0]}.json`,O.click(),URL.revokeObjectURL(j)}},F=()=>{r(be())},a={marginLeft:!h&&v?`${M}px`:0,width:!h&&v?`calc(100% - ${M}px)`:"100%",height:l?"100vh":"calc(100vh - 64px)",transition:d.transitions.create(["margin","width"],{easing:d.transitions.easing.sharp,duration:d.transitions.duration.leavingScreen})};return e.jsx(ye,{children:e.jsxs(i,{sx:{display:"flex",height:"100vh",overflow:"hidden",bgcolor:"background.default",position:l?"fixed":"relative",top:l?0:"auto",left:l?0:"auto",right:l?0:"auto",bottom:l?0:"auto",zIndex:l?1300:"auto"},role:"main","aria-label":"Tank Zone Coverage Analysis Tool",children:[!l&&e.jsx(fe,{position:"fixed",sx:{zIndex:d.zIndex.drawer+1,bgcolor:"primary.main"},children:e.jsxs(Ee,{children:[e.jsx(C,{color:"inherit","aria-label":"toggle sidebar",onClick:w,edge:"start",sx:{mr:2},children:e.jsx(ke,{})}),e.jsx(H,{sx:{mr:1}}),e.jsxs(s,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:["Tank Zone Coverage Analysis",c==="planning"&&" - Planning Mode",c==="presentation"&&" - Presentation Mode"]}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(C,{color:"inherit",onClick:G,title:"Save Analysis",children:e.jsx(Le,{})}),e.jsx(C,{color:"inherit",onClick:Z,title:"Export Results",disabled:!m,children:e.jsx(Te,{})}),e.jsx(C,{color:"inherit",onClick:W,title:"Toggle Fullscreen",children:l?e.jsx(Oe,{}):e.jsx(Ue,{})})]})]})}),e.jsx(Ce,{variant:h?"temporary":"persistent",anchor:"left",open:v,onClose:w,sx:{width:M,flexShrink:0,"& .MuiDrawer-paper":{width:M,boxSizing:"border-box",marginTop:l?0:"64px",height:l?"100vh":"calc(100vh - 64px)",borderRight:`1px solid ${d.palette.divider}`}},ModalProps:{keepMounted:!0,disablePortal:!1,hideBackdrop:!h,disableAutoFocus:!0,disableEnforceFocus:!0,disableRestoreFocus:!0},PaperProps:{"aria-hidden":!1,role:"complementary","aria-label":"Tank Zone Coverage Tools"},children:e.jsx(Ve,{mode:c})}),e.jsxs(i,{component:"main",sx:{flexGrow:1,position:"relative",...a},children:[e.jsx(T,{elevation:0,sx:{height:"100%",width:"100%",borderRadius:0,overflow:"hidden",position:"relative",minHeight:"500px",display:"flex",flexDirection:"column","& .leaflet-container":{background:"transparent !important",outline:"none"},"& .leaflet-tile-pane":{opacity:"1 !important",visibility:"visible !important"},"& .leaflet-tile":{opacity:"1 !important",visibility:"visible !important",display:"block !important",imageRendering:"auto",transform:"translateZ(0)",backfaceVisibility:"hidden"},"& .leaflet-layer":{opacity:"1 !important",visibility:"visible !important"}},children:e.jsx(Ae,{})}),B&&e.jsx(i,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsx(s,{variant:"h6",children:"Analyzing Tank Coverage..."})})]}),e.jsx(Me,{open:!!R,autoHideDuration:6e3,onClose:F,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(A,{onClose:F,severity:"error",sx:{width:"100%"},children:R})})]})})};export{ta as default};
