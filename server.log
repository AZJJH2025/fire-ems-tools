/Users/josephhester/fire-ems-tools/app.py:892: SyntaxWarning: invalid escape sequence '\/'
  template = """
2025-07-18 18:36:59,867 - fix_deployment - INFO - Applying emergency deployment fixes...
2025-07-18 18:37:00,015 - fix_deployment - INFO - Added get_json_field helper function to global namespace
2025-07-18 18:37:00,016 - fix_deployment - INFO - All fixes have been applied successfully!
2025-07-18 18:37:00,016 - __main__ - INFO - üîç RENDER DETECTION: RENDER=None, SERVICE_ID=None, CWD=/Users/josephhester/fire-ems-tools
2025-07-18 18:37:00,016 - __main__ - INFO - üîç FINAL DECISION: is_render=False
2025-07-18 18:37:00,020 - config - INFO - Using database URL: sqlite:///fire_ems.db
2025-07-18 18:37:00,020 - __main__ - INFO - Creating application with deployment fixes...
2025-07-18 18:37:00,021 - app_utils - WARNING - Using in-memory storage for rate limiting. This is not recommended for production.
2025-07-18 18:37:00,021 - app_utils - INFO - Initializing Flask-Limiter with storage type: MemoryStorage
2025-07-18 18:37:00,021 - app_utils - ERROR - Error initializing Limiter: property 'storage' of 'Limiter' object has no setter
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/flask_limiter/extension.py:324: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
  warnings.warn(
2025-07-18 18:37:00,022 - app_utils - INFO - Rate limiter initialized with storage type: MemoryStorage
2025-07-18 18:37:00,022 - asset_utils - INFO - Asset utilities initialized successfully
2025-07-18 18:37:00,030 - email_service - INFO - üìß Email service ENABLED - SMTP: smtp.gmail.com:587
2025-07-18 18:37:00,030 - email_service - INFO - üìß Email from: FireEMS.ai <noreply@fireems.ai>
2025-07-18 18:37:00,032 - static_middleware - INFO - Registered static file handler middleware
2025-07-18 18:37:00,032 - static_middleware - INFO - Static folder: /Users/josephhester/fire-ems-tools/static
2025-07-18 18:37:00,032 - static_middleware - INFO - JavaScript MIME type: application/javascript
2025-07-18 18:37:00,032 - static_middleware - INFO - Available fallback routes: /direct-static/, /app-static/
2025-07-18 18:37:00,032 - static_middleware - INFO - MIME type for .js: application/javascript
2025-07-18 18:37:00,032 - static_middleware - INFO - MIME type for .css: text/css
2025-07-18 18:37:00,032 - static_middleware - INFO - MIME type for .jsx: application/javascript
2025-07-18 18:37:00,032 - static_middleware - INFO - MIME type for .json: application/json
2025-07-18 18:37:00,032 - static_middleware - INFO - Sample static files: []
2025-07-18 18:37:00,764 - ai_service - INFO - ‚úÖ AI Service initialized successfully
2025-07-18 18:37:00,764 - routes.ai - INFO - ‚úÖ AI service imported successfully
2025-07-18 18:37:00,764 - __main__ - INFO - AI blueprint imported successfully
2025-07-18 18:37:00,808 - __main__ - INFO - AI blueprint registered successfully
2025-07-18 18:37:00,808 - __main__ - INFO - Successfully registered all route blueprints
2025-07-18 18:37:00,811 - react_data_formatter_route - INFO - Registered React Data Formatter blueprint
2025-07-18 18:37:00,811 - __main__ - INFO - Registered React Data Formatter routes
2025-07-18 18:37:00,812 - fix_deployment - INFO - Column preferences already exists in users
2025-07-18 18:37:00,812 - fix_deployment - INFO - Column has_temp_password already exists in users
2025-07-18 18:37:00,812 - fix_deployment - INFO - Column reset_token_hash already exists in users
2025-07-18 18:37:00,812 - fix_deployment - INFO - Column reset_token_expires already exists in users
2025-07-18 18:37:00,812 - fix_deployment - INFO - Column webhooks_enabled already exists in departments
2025-07-18 18:37:00,813 - fix_deployment - INFO - Column webhook_url already exists in departments
2025-07-18 18:37:00,813 - fix_deployment - INFO - Column webhook_secret already exists in departments
2025-07-18 18:37:00,813 - fix_deployment - INFO - Column webhook_events already exists in departments
2025-07-18 18:37:00,813 - fix_deployment - INFO - Column webhook_last_error already exists in departments
2025-07-18 18:37:00,813 - fix_deployment - INFO - Column webhook_last_success already exists in departments
2025-07-18 18:37:00,824 - fix_deployment - INFO - Updated webhook secrets for 3 departments
2025-07-18 18:37:00,824 - fix_deployment - INFO - Database tables fixed successfully
2025-07-18 18:37:00,827 - __main__ - INFO - Found 1 existing super_admin users
2025-07-18 18:37:00,827 - __main__ - INFO - Super admin user already exists, skipping creation
2025-07-18 18:37:00,827 - __main__ - INFO - Application created successfully with all fixes applied


--------------------------------------
Server is starting at http://127.0.0.1:5006
Access Data Formatter at: http://127.0.0.1:5006/data-formatter-react
Access Response Time Analyzer at: http://127.0.0.1:5006/response-time-analyzer
Try new analyzer route: http://127.0.0.1:5006/response-time-analyzer-new
--------------------------------------


 * Serving Flask app 'app'
 * Debug mode: on
2025-07-18 18:37:00,876 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5006
 * Running on http://192.168.0.24:5006
2025-07-18 18:37:00,876 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-18 18:37:00,877 - werkzeug - INFO -  * Restarting with stat
/Users/josephhester/fire-ems-tools/app.py:892: SyntaxWarning: invalid escape sequence '\/'
  template = """
2025-07-18 18:37:01,191 - fix_deployment - INFO - Applying emergency deployment fixes...
2025-07-18 18:37:01,294 - fix_deployment - INFO - Added get_json_field helper function to global namespace
2025-07-18 18:37:01,294 - fix_deployment - INFO - All fixes have been applied successfully!
2025-07-18 18:37:01,294 - __main__ - INFO - üîç RENDER DETECTION: RENDER=None, SERVICE_ID=None, CWD=/Users/josephhester/fire-ems-tools
2025-07-18 18:37:01,294 - __main__ - INFO - üîç FINAL DECISION: is_render=False
2025-07-18 18:37:01,297 - config - INFO - Using database URL: sqlite:///fire_ems.db
2025-07-18 18:37:01,297 - __main__ - INFO - Creating application with deployment fixes...
2025-07-18 18:37:01,297 - app_utils - WARNING - Using in-memory storage for rate limiting. This is not recommended for production.
2025-07-18 18:37:01,297 - app_utils - INFO - Initializing Flask-Limiter with storage type: MemoryStorage
2025-07-18 18:37:01,298 - app_utils - ERROR - Error initializing Limiter: property 'storage' of 'Limiter' object has no setter
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/flask_limiter/extension.py:324: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
  warnings.warn(
2025-07-18 18:37:01,298 - app_utils - INFO - Rate limiter initialized with storage type: MemoryStorage
2025-07-18 18:37:01,298 - asset_utils - INFO - Asset utilities initialized successfully
2025-07-18 18:37:01,303 - email_service - INFO - üìß Email service ENABLED - SMTP: smtp.gmail.com:587
2025-07-18 18:37:01,304 - email_service - INFO - üìß Email from: FireEMS.ai <noreply@fireems.ai>
2025-07-18 18:37:01,305 - static_middleware - INFO - Registered static file handler middleware
2025-07-18 18:37:01,305 - static_middleware - INFO - Static folder: /Users/josephhester/fire-ems-tools/static
2025-07-18 18:37:01,305 - static_middleware - INFO - JavaScript MIME type: application/javascript
2025-07-18 18:37:01,305 - static_middleware - INFO - Available fallback routes: /direct-static/, /app-static/
2025-07-18 18:37:01,305 - static_middleware - INFO - MIME type for .js: application/javascript
2025-07-18 18:37:01,306 - static_middleware - INFO - MIME type for .css: text/css
2025-07-18 18:37:01,306 - static_middleware - INFO - MIME type for .jsx: application/javascript
2025-07-18 18:37:01,306 - static_middleware - INFO - MIME type for .json: application/json
2025-07-18 18:37:01,306 - static_middleware - INFO - Sample static files: []
2025-07-18 18:37:01,801 - ai_service - INFO - ‚úÖ AI Service initialized successfully
2025-07-18 18:37:01,801 - routes.ai - INFO - ‚úÖ AI service imported successfully
2025-07-18 18:37:01,801 - __main__ - INFO - AI blueprint imported successfully
2025-07-18 18:37:01,843 - __main__ - INFO - AI blueprint registered successfully
2025-07-18 18:37:01,843 - __main__ - INFO - Successfully registered all route blueprints
2025-07-18 18:37:01,845 - react_data_formatter_route - INFO - Registered React Data Formatter blueprint
2025-07-18 18:37:01,845 - __main__ - INFO - Registered React Data Formatter routes
2025-07-18 18:37:01,846 - fix_deployment - INFO - Column preferences already exists in users
2025-07-18 18:37:01,846 - fix_deployment - INFO - Column has_temp_password already exists in users
2025-07-18 18:37:01,846 - fix_deployment - INFO - Column reset_token_hash already exists in users
2025-07-18 18:37:01,846 - fix_deployment - INFO - Column reset_token_expires already exists in users
2025-07-18 18:37:01,846 - fix_deployment - INFO - Column webhooks_enabled already exists in departments
2025-07-18 18:37:01,846 - fix_deployment - INFO - Column webhook_url already exists in departments
2025-07-18 18:37:01,846 - fix_deployment - INFO - Column webhook_secret already exists in departments
2025-07-18 18:37:01,846 - fix_deployment - INFO - Column webhook_events already exists in departments
2025-07-18 18:37:01,846 - fix_deployment - INFO - Column webhook_last_error already exists in departments
2025-07-18 18:37:01,846 - fix_deployment - INFO - Column webhook_last_success already exists in departments
2025-07-18 18:37:01,857 - fix_deployment - INFO - Updated webhook secrets for 3 departments
2025-07-18 18:37:01,857 - fix_deployment - INFO - Database tables fixed successfully
2025-07-18 18:37:01,859 - __main__ - INFO - Found 1 existing super_admin users
2025-07-18 18:37:01,859 - __main__ - INFO - Super admin user already exists, skipping creation
2025-07-18 18:37:01,859 - __main__ - INFO - Application created successfully with all fixes applied
2025-07-18 18:37:01,875 - werkzeug - WARNING -  * Debugger is active!
2025-07-18 18:37:01,882 - werkzeug - INFO -  * Debugger PIN: 110-174-263
2025-07-18 18:37:15,508 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:37:15,508 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:37:15,509 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:37:15] "[33mGET /ai/api/status HTTP/1.1[0m" 404 -
2025-07-18 18:37:21,846 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:37:21,846 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:37:21,846 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:37:21] "GET /ai/debug HTTP/1.1" 200 -
2025-07-18 18:37:33,270 - app - INFO - SECURITY_AUDIT: POST /ai/api/analyze from 127.0.0.1 User-Agent: curl/8.7.1
2025-07-18 18:37:33,271 - app - INFO - SECURITY_AUDIT: Response 302 for POST /ai/api/analyze
2025-07-18 18:37:33,271 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:37:33,271 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:37:33,271 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:37:33] "[32mPOST /ai/api/analyze HTTP/1.1[0m" 302 -
2025-07-18 18:38:22,562 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:38:22,563 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:38:22,564 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "GET / HTTP/1.1" 200 -
2025-07-18 18:38:22,589 - routes.react_app - INFO - Serving React asset: index-CsDlCSGK.js
2025-07-18 18:38:22,591 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "GET /app/assets/index-CsDlCSGK.js HTTP/1.1" 200 -
2025-07-18 18:38:22,825 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "GET /favicon.svg HTTP/1.1" 200 -
2025-07-18 18:38:22,828 - app - INFO - SECURITY_AUDIT: POST /api/csp-report from 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:140.0) Gecko/20100101 Firefox/140.0
2025-07-18 18:38:22,829 - app.csp_reports - WARNING - CSP Violation (raw data): {"csp-report":{"blocked-uri":"inline","column-number":5296,"disposition":"enforce","document-uri":"http://127.0.0.1:5006/","effective-directive":"style-src-elem","line-number":58,"original-policy":"default-src 'self'; script-src 'self' 'strict-dynamic' 'nonce-MDk8saT8sboN2gMcttz2eQ' 'unsafe-eval' https://unpkg.com https://cdn.jsdelivr.net; style-src 'self' 'nonce-NPaHwETW5bsrByecNA--Hw' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://api.github.com; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none'; upgrade-insecure-requests; report-uri http://127.0.0.1:5006/api/csp-report","referrer":"","source-file":"http://127.0.0.1:5006/app/assets/index-CsDlCSGK.js","status-code":200,"violated-directive":"style-src-elem"}}
2025-07-18 18:38:22,829 - app - INFO - SECURITY_AUDIT: Response 204 for POST /api/csp-report
2025-07-18 18:38:22,829 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:38:22,829 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:38:22,829 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "[35m[1mPOST /api/csp-report HTTP/1.1[0m" 204 -
2025-07-18 18:38:22,830 - app - INFO - SECURITY_AUDIT: POST /api/csp-report from 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:140.0) Gecko/20100101 Firefox/140.0
2025-07-18 18:38:22,830 - app.csp_reports - WARNING - CSP Violation (raw data): {"csp-report":{"blocked-uri":"inline","column-number":5296,"disposition":"enforce","document-uri":"http://127.0.0.1:5006/","effective-directive":"style-src-elem","line-number":58,"original-policy":"default-src 'self'; script-src 'self' 'strict-dynamic' 'nonce-MDk8saT8sboN2gMcttz2eQ' 'unsafe-eval' https://unpkg.com https://cdn.jsdelivr.net; style-src 'self' 'nonce-NPaHwETW5bsrByecNA--Hw' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://api.github.com; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none'; upgrade-insecure-requests; report-uri http://127.0.0.1:5006/api/csp-report","referrer":"","source-file":"http://127.0.0.1:5006/app/assets/index-CsDlCSGK.js","status-code":200,"violated-directive":"style-src-elem"}}
2025-07-18 18:38:22,830 - app - INFO - SECURITY_AUDIT: Response 204 for POST /api/csp-report
2025-07-18 18:38:22,830 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:38:22,830 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:38:22,831 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "[35m[1mPOST /api/csp-report HTTP/1.1[0m" 204 -
2025-07-18 18:38:22,831 - app - INFO - SECURITY_AUDIT: GET /auth/api/me from 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:140.0) Gecko/20100101 Firefox/140.0
2025-07-18 18:38:22,832 - app - INFO - SECURITY_AUDIT: Response 302 for GET /auth/api/me
2025-07-18 18:38:22,832 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:38:22,832 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:38:22,832 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "[32mGET /auth/api/me HTTP/1.1[0m" 302 -
2025-07-18 18:38:22,834 - app - INFO - SECURITY_AUDIT: GET /auth/login from 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:140.0) Gecko/20100101 Firefox/140.0
2025-07-18 18:38:22,834 - app - INFO - SECURITY_AUDIT: Response 302 for GET /auth/login
2025-07-18 18:38:22,834 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:38:22,834 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:38:22,834 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "[32mGET /auth/login?next=/auth/api/me HTTP/1.1[0m" 302 -
2025-07-18 18:38:22,835 - app - INFO - SECURITY_AUDIT: GET /app/login from 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:140.0) Gecko/20100101 Firefox/140.0
2025-07-18 18:38:22,836 - routes.react_app - INFO - Serving React app with asset: index-CsDlCSGK.js
2025-07-18 18:38:22,836 - app - INFO - SECURITY_AUDIT: Response 200 for GET /app/login
2025-07-18 18:38:22,836 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:38:22,836 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:38:22,836 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "GET /app/login HTTP/1.1" 200 -
2025-07-18 18:38:22,839 - __main__ - INFO - ASSETS_FALLBACK: Serving FireEMSHomepage-Dua4NQOi.js from deployment build
2025-07-18 18:38:22,840 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "GET /assets/FireEMSHomepage-Dua4NQOi.js HTTP/1.1" 200 -
2025-07-18 18:38:22,841 - __main__ - INFO - ASSETS_FALLBACK: Serving Dashboard-CQb-rdbx.js from deployment build
2025-07-18 18:38:22,841 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "GET /assets/Dashboard-CQb-rdbx.js HTTP/1.1" 200 -
2025-07-18 18:38:22,842 - __main__ - INFO - ASSETS_FALLBACK: Serving Person-BorgFEON.js from deployment build
2025-07-18 18:38:22,843 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "GET /assets/Person-BorgFEON.js HTTP/1.1" 200 -
2025-07-18 18:38:22,843 - routes.react_app - INFO - Serving React asset: FireEMSHomepage-Dua4NQOi.js
2025-07-18 18:38:22,844 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "GET /app/assets/FireEMSHomepage-Dua4NQOi.js HTTP/1.1" 200 -
2025-07-18 18:38:22,844 - __main__ - INFO - ASSETS_FALLBACK: Serving index-CsDlCSGK.js from deployment build
2025-07-18 18:38:22,844 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "GET /assets/index-CsDlCSGK.js HTTP/1.1" 200 -
2025-07-18 18:38:22,847 - routes.react_app - INFO - Serving React asset: Dashboard-CQb-rdbx.js
2025-07-18 18:38:22,847 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "GET /app/assets/Dashboard-CQb-rdbx.js HTTP/1.1" 200 -
2025-07-18 18:38:22,848 - routes.react_app - INFO - Serving React asset: Person-BorgFEON.js
2025-07-18 18:38:22,848 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:22] "GET /app/assets/Person-BorgFEON.js HTTP/1.1" 200 -
2025-07-18 18:38:23,175 - app - INFO - SECURITY_AUDIT: GET /auth/api/me from 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:140.0) Gecko/20100101 Firefox/140.0
2025-07-18 18:38:23,176 - app - INFO - SECURITY_AUDIT: Response 302 for GET /auth/api/me
2025-07-18 18:38:23,176 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:38:23,176 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:38:23,177 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:23] "[32mGET /auth/api/me HTTP/1.1[0m" 302 -
2025-07-18 18:38:23,181 - app - INFO - SECURITY_AUDIT: GET /auth/login from 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:140.0) Gecko/20100101 Firefox/140.0
2025-07-18 18:38:23,182 - app - INFO - SECURITY_AUDIT: Response 302 for GET /auth/login
2025-07-18 18:38:23,182 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:38:23,182 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:38:23,182 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:23] "[32mGET /auth/login?next=/auth/api/me HTTP/1.1[0m" 302 -
2025-07-18 18:38:23,187 - app - INFO - SECURITY_AUDIT: GET /app/login from 127.0.0.1 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:140.0) Gecko/20100101 Firefox/140.0
2025-07-18 18:38:23,188 - routes.react_app - INFO - Serving React app with asset: index-CsDlCSGK.js
2025-07-18 18:38:23,189 - app - INFO - SECURITY_AUDIT: Response 200 for GET /app/login
2025-07-18 18:38:23,189 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-18 18:38:23,190 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-18 18:38:23,191 - werkzeug - INFO - 127.0.0.1 - - [18/Jul/2025 18:38:23] "GET /app/login HTTP/1.1" 200 -
2025-07-18 19:23:45,653 - werkzeug - INFO -  * Detected change in '/Users/josephhester/fire-ems-tools/routes/ai.py', reloading


--------------------------------------
Server is starting at http://127.0.0.1:5006
Access Data Formatter at: http://127.0.0.1:5006/data-formatter-react
Access Response Time Analyzer at: http://127.0.0.1:5006/response-time-analyzer
Try new analyzer route: http://127.0.0.1:5006/response-time-analyzer-new
--------------------------------------


2025-07-18 19:23:45,818 - werkzeug - INFO -  * Restarting with stat
/Users/josephhester/fire-ems-tools/app.py:892: SyntaxWarning: invalid escape sequence '\/'
  template = """
2025-07-18 19:23:46,070 - fix_deployment - INFO - Applying emergency deployment fixes...
2025-07-18 19:23:46,230 - fix_deployment - INFO - Added get_json_field helper function to global namespace
2025-07-18 19:23:46,230 - fix_deployment - INFO - All fixes have been applied successfully!
2025-07-18 19:23:46,230 - __main__ - INFO - üîç RENDER DETECTION: RENDER=None, SERVICE_ID=None, CWD=/Users/josephhester/fire-ems-tools
2025-07-18 19:23:46,230 - __main__ - INFO - üîç FINAL DECISION: is_render=False
2025-07-18 19:23:46,236 - config - INFO - Using database URL: sqlite:///fire_ems.db
2025-07-18 19:23:46,236 - __main__ - INFO - Creating application with deployment fixes...
2025-07-18 19:23:46,237 - app_utils - WARNING - Using in-memory storage for rate limiting. This is not recommended for production.
2025-07-18 19:23:46,237 - app_utils - INFO - Initializing Flask-Limiter with storage type: MemoryStorage
2025-07-18 19:23:46,237 - app_utils - ERROR - Error initializing Limiter: property 'storage' of 'Limiter' object has no setter
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/flask_limiter/extension.py:324: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
  warnings.warn(
2025-07-18 19:23:46,238 - app_utils - INFO - Rate limiter initialized with storage type: MemoryStorage
2025-07-18 19:23:46,238 - asset_utils - INFO - Asset utilities initialized successfully
2025-07-18 19:23:46,248 - email_service - INFO - üìß Email service ENABLED - SMTP: smtp.gmail.com:587
2025-07-18 19:23:46,248 - email_service - INFO - üìß Email from: FireEMS.ai <noreply@fireems.ai>
2025-07-18 19:23:46,251 - static_middleware - INFO - Registered static file handler middleware
2025-07-18 19:23:46,252 - static_middleware - INFO - Static folder: /Users/josephhester/fire-ems-tools/static
2025-07-18 19:23:46,252 - static_middleware - INFO - JavaScript MIME type: application/javascript
2025-07-18 19:23:46,252 - static_middleware - INFO - Available fallback routes: /direct-static/, /app-static/
2025-07-18 19:23:46,252 - static_middleware - INFO - MIME type for .js: application/javascript
2025-07-18 19:23:46,252 - static_middleware - INFO - MIME type for .css: text/css
2025-07-18 19:23:46,252 - static_middleware - INFO - MIME type for .jsx: application/javascript
2025-07-18 19:23:46,252 - static_middleware - INFO - MIME type for .json: application/json
2025-07-18 19:23:46,252 - static_middleware - INFO - Sample static files: []
2025-07-18 19:23:47,167 - ai_service - INFO - ‚úÖ AI Service initialized successfully
2025-07-18 19:23:47,167 - routes.ai - INFO - ‚úÖ AI service imported successfully
2025-07-18 19:23:47,167 - __main__ - INFO - AI blueprint imported successfully
2025-07-18 19:23:47,217 - __main__ - INFO - AI blueprint registered successfully
2025-07-18 19:23:47,217 - __main__ - INFO - Successfully registered all route blueprints
2025-07-18 19:23:47,219 - react_data_formatter_route - INFO - Registered React Data Formatter blueprint
2025-07-18 19:23:47,219 - __main__ - INFO - Registered React Data Formatter routes
2025-07-18 19:23:47,220 - fix_deployment - INFO - Column preferences already exists in users
2025-07-18 19:23:47,220 - fix_deployment - INFO - Column has_temp_password already exists in users
2025-07-18 19:23:47,220 - fix_deployment - INFO - Column reset_token_hash already exists in users
2025-07-18 19:23:47,220 - fix_deployment - INFO - Column reset_token_expires already exists in users
2025-07-18 19:23:47,220 - fix_deployment - INFO - Column webhooks_enabled already exists in departments
2025-07-18 19:23:47,220 - fix_deployment - INFO - Column webhook_url already exists in departments
2025-07-18 19:23:47,221 - fix_deployment - INFO - Column webhook_secret already exists in departments
2025-07-18 19:23:47,221 - fix_deployment - INFO - Column webhook_events already exists in departments
2025-07-18 19:23:47,221 - fix_deployment - INFO - Column webhook_last_error already exists in departments
2025-07-18 19:23:47,221 - fix_deployment - INFO - Column webhook_last_success already exists in departments
2025-07-18 19:23:47,232 - fix_deployment - INFO - Updated webhook secrets for 3 departments
2025-07-18 19:23:47,232 - fix_deployment - INFO - Database tables fixed successfully
2025-07-18 19:23:47,235 - __main__ - INFO - Found 1 existing super_admin users
2025-07-18 19:23:47,235 - __main__ - INFO - Super admin user already exists, skipping creation
2025-07-18 19:23:47,235 - __main__ - INFO - Application created successfully with all fixes applied
2025-07-18 19:23:47,261 - werkzeug - WARNING -  * Debugger is active!
2025-07-18 19:23:47,467 - werkzeug - INFO -  * Debugger PIN: 110-174-263
2025-07-18 19:23:54,643 - werkzeug - INFO -  * Detected change in '/Users/josephhester/fire-ems-tools/services/ai_service.py', reloading


--------------------------------------
Server is starting at http://127.0.0.1:5006
Access Data Formatter at: http://127.0.0.1:5006/data-formatter-react
Access Response Time Analyzer at: http://127.0.0.1:5006/response-time-analyzer
Try new analyzer route: http://127.0.0.1:5006/response-time-analyzer-new
--------------------------------------


2025-07-18 19:23:54,822 - werkzeug - INFO -  * Restarting with stat
/Users/josephhester/fire-ems-tools/app.py:892: SyntaxWarning: invalid escape sequence '\/'
  template = """
2025-07-18 19:23:55,013 - fix_deployment - INFO - Applying emergency deployment fixes...
2025-07-18 19:23:55,140 - fix_deployment - INFO - Added get_json_field helper function to global namespace
2025-07-18 19:23:55,140 - fix_deployment - INFO - All fixes have been applied successfully!
2025-07-18 19:23:55,140 - __main__ - INFO - üîç RENDER DETECTION: RENDER=None, SERVICE_ID=None, CWD=/Users/josephhester/fire-ems-tools
2025-07-18 19:23:55,141 - __main__ - INFO - üîç FINAL DECISION: is_render=False
2025-07-18 19:23:55,144 - config - INFO - Using database URL: sqlite:///fire_ems.db
2025-07-18 19:23:55,144 - __main__ - INFO - Creating application with deployment fixes...
2025-07-18 19:23:55,145 - app_utils - WARNING - Using in-memory storage for rate limiting. This is not recommended for production.
2025-07-18 19:23:55,145 - app_utils - INFO - Initializing Flask-Limiter with storage type: MemoryStorage
2025-07-18 19:23:55,145 - app_utils - ERROR - Error initializing Limiter: property 'storage' of 'Limiter' object has no setter
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/flask_limiter/extension.py:324: UserWarning: Using the in-memory storage for tracking rate limits as no storage was explicitly specified. This is not recommended for production use. See: https://flask-limiter.readthedocs.io#configuring-a-storage-backend for documentation about configuring the storage backend.
  warnings.warn(
2025-07-18 19:23:55,146 - app_utils - INFO - Rate limiter initialized with storage type: MemoryStorage
2025-07-18 19:23:55,146 - asset_utils - INFO - Asset utilities initialized successfully
2025-07-18 19:23:55,153 - email_service - INFO - üìß Email service ENABLED - SMTP: smtp.gmail.com:587
2025-07-18 19:23:55,153 - email_service - INFO - üìß Email from: FireEMS.ai <noreply@fireems.ai>
2025-07-18 19:23:55,155 - static_middleware - INFO - Registered static file handler middleware
2025-07-18 19:23:55,155 - static_middleware - INFO - Static folder: /Users/josephhester/fire-ems-tools/static
2025-07-18 19:23:55,155 - static_middleware - INFO - JavaScript MIME type: application/javascript
2025-07-18 19:23:55,155 - static_middleware - INFO - Available fallback routes: /direct-static/, /app-static/
2025-07-18 19:23:55,155 - static_middleware - INFO - MIME type for .js: application/javascript
2025-07-18 19:23:55,155 - static_middleware - INFO - MIME type for .css: text/css
2025-07-18 19:23:55,155 - static_middleware - INFO - MIME type for .jsx: application/javascript
2025-07-18 19:23:55,155 - static_middleware - INFO - MIME type for .json: application/json
2025-07-18 19:23:55,155 - static_middleware - INFO - Sample static files: []
2025-07-18 19:23:55,935 - ai_service - INFO - ‚úÖ AI Service initialized successfully
2025-07-18 19:23:55,935 - routes.ai - INFO - ‚úÖ AI service imported successfully
2025-07-18 19:23:55,936 - __main__ - INFO - AI blueprint imported successfully
2025-07-18 19:23:55,986 - __main__ - INFO - AI blueprint registered successfully
2025-07-18 19:23:55,986 - __main__ - INFO - Successfully registered all route blueprints
2025-07-18 19:23:55,989 - react_data_formatter_route - INFO - Registered React Data Formatter blueprint
2025-07-18 19:23:55,989 - __main__ - INFO - Registered React Data Formatter routes
2025-07-18 19:23:55,990 - fix_deployment - INFO - Column preferences already exists in users
2025-07-18 19:23:55,990 - fix_deployment - INFO - Column has_temp_password already exists in users
2025-07-18 19:23:55,990 - fix_deployment - INFO - Column reset_token_hash already exists in users
2025-07-18 19:23:55,990 - fix_deployment - INFO - Column reset_token_expires already exists in users
2025-07-18 19:23:55,990 - fix_deployment - INFO - Column webhooks_enabled already exists in departments
2025-07-18 19:23:55,990 - fix_deployment - INFO - Column webhook_url already exists in departments
2025-07-18 19:23:55,991 - fix_deployment - INFO - Column webhook_secret already exists in departments
2025-07-18 19:23:55,991 - fix_deployment - INFO - Column webhook_events already exists in departments
2025-07-18 19:23:55,991 - fix_deployment - INFO - Column webhook_last_error already exists in departments
2025-07-18 19:23:55,991 - fix_deployment - INFO - Column webhook_last_success already exists in departments
2025-07-18 19:23:56,003 - fix_deployment - INFO - Updated webhook secrets for 3 departments
2025-07-18 19:23:56,003 - fix_deployment - INFO - Database tables fixed successfully
2025-07-18 19:23:56,006 - __main__ - INFO - Found 1 existing super_admin users
2025-07-18 19:23:56,006 - __main__ - INFO - Super admin user already exists, skipping creation
2025-07-18 19:23:56,006 - __main__ - INFO - Application created successfully with all fixes applied
2025-07-18 19:23:56,027 - werkzeug - WARNING -  * Debugger is active!
2025-07-18 19:23:56,035 - werkzeug - INFO -  * Debugger PIN: 110-174-263
2025-07-19 08:34:33,969 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-e751228c-79e6-4a56-8004-bf7b1c5ef578', 'json_data': {'messages': [{'role': 'system', 'content': 'You are a fire department compliance expert specializing in NFPA 1710 standards. \n                        Focus on:\n                        - Response time performance (dispatch <60s, turnout <80s, total <8min)\n                        - Staffing adequacy and deployment\n                        - Coverage gaps and improvement opportunities\n                        - ISO rating considerations\n                        \n                        Provide specific, actionable recommendations. Keep responses concise and professional.'}, {'role': 'user', 'content': 'CAD data summary: Test fire department with 100 incidents, average 5 minute response time\n\nSpecific query: Brief test analysis'}], 'model': 'gpt-4o-mini', 'max_tokens': 300, 'temperature': 0.7}}
2025-07-19 08:34:33,987 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-19 08:34:33,988 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-19 08:34:34,024 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x10fc43ad0>
2025-07-19 08:34:34,024 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x10a4b14d0> server_hostname='api.openai.com' timeout=5.0
2025-07-19 08:34:34,050 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x10fa2b140>
2025-07-19 08:34:34,050 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-19 08:34:34,051 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-19 08:34:34,051 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-19 08:34:34,051 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-19 08:34:34,051 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-19 08:34:34,168 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 401, b'Unauthorized', [(b'Date', b'Sat, 19 Jul 2025 15:34:34 GMT'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Content-Length', b'416'), (b'Connection', b'keep-alive'), (b'vary', b'Origin'), (b'x-request-id', b'req_a60480cd433f3dc4d0687ef6f5bcc6d5'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=IqEReKuhFqLOq6j.Uu1VuW3nYTF4NIKvhpfmZYog2rE-1752939274-1.0.1.1-8zPQbswPE8Q2wH4Do4bEJGbtiU_1FVjU5_7BkFJOc5AP_RnekbrhWOqMzFQ3YFPt46lJBuKjH76dvkNwNji2_JaNjrCHXAoG7xbxUmSNCtQ; path=/; expires=Sat, 19-Jul-25 16:04:34 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=pWUG_W8abFupkVEW1wl3NzakgtpJ2fD.BMvMVUAaQlY-1752939274209-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'961b489f3ca72a91-LAX'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-19 08:34:34,170 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-07-19 08:34:34,170 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-19 08:34:34,170 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-19 08:34:34,170 - httpcore.http11 - DEBUG - response_closed.started
2025-07-19 08:34:34,170 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-19 08:34:34,170 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "401 Unauthorized" Headers([('date', 'Sat, 19 Jul 2025 15:34:34 GMT'), ('content-type', 'application/json; charset=utf-8'), ('content-length', '416'), ('connection', 'keep-alive'), ('vary', 'Origin'), ('x-request-id', 'req_a60480cd433f3dc4d0687ef6f5bcc6d5'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=IqEReKuhFqLOq6j.Uu1VuW3nYTF4NIKvhpfmZYog2rE-1752939274-1.0.1.1-8zPQbswPE8Q2wH4Do4bEJGbtiU_1FVjU5_7BkFJOc5AP_RnekbrhWOqMzFQ3YFPt46lJBuKjH76dvkNwNji2_JaNjrCHXAoG7xbxUmSNCtQ; path=/; expires=Sat, 19-Jul-25 16:04:34 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=pWUG_W8abFupkVEW1wl3NzakgtpJ2fD.BMvMVUAaQlY-1752939274209-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '961b489f3ca72a91-LAX'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-19 08:34:34,170 - openai._base_client - DEBUG - request_id: req_a60480cd433f3dc4d0687ef6f5bcc6d5
2025-07-19 08:34:34,171 - openai._base_client - DEBUG - Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/openai/_base_client.py", line 1024, in request
    response.raise_for_status()
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '401 Unauthorized' for url 'https://api.openai.com/v1/chat/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
2025-07-19 08:34:34,174 - openai._base_client - DEBUG - Not retrying
2025-07-19 08:34:34,175 - openai._base_client - DEBUG - Re-raising status error
2025-07-19 08:34:34,176 - ai_service - ERROR - AI analysis failed: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-**********************************************************************************************************************************************************R3uM. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-07-19 08:34:34,176 - ai_service - INFO - Using fallback compliance analysis
2025-07-19 08:34:34,177 - app - INFO - CSP Environment Detection: RENDER=None, FLASK_ENV=development, CONFIG_ENV=None, DEBUG=True, is_production=False, is_dev=True
2025-07-19 08:34:34,177 - app - INFO - HSTS Header Always Set: max-age=31536000; includeSubDomains; preload
2025-07-19 08:34:34,178 - werkzeug - INFO - 127.0.0.1 - - [19/Jul/2025 08:34:34] "GET /ai/debug HTTP/1.1" 200 -
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/multiprocessing/resource_tracker.py:254: UserWarning: resource_tracker: There appear to be 1 leaked semaphore objects to clean up at shutdown
  warnings.warn('resource_tracker: There appear to be %d '
