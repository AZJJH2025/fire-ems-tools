import{bn as $,bq as D,r as n,j as e,y as g,B as x,C as J}from"./index-CN9EOvAt.js";import{C,a as k}from"./CardContent-T5_QRz29.js";import{E as Z}from"./Error-9qg556bc.js";import{T as r,P as H}from"./Typography-wSCgsJPr.js";import{B as h}from"./List-CMzE2e0K.js";import{A}from"./ArrowBack-CRxM6fNd.js";import{C as K}from"./CheckCircle-DFs60z8C.js";import{L as I}from"./LinearProgress-DtOxvm4r.js";import{L as B}from"./Lock-CMGSPcsB.js";import{T,a as L,A as M}from"./TextField-kSPrbdGc.js";import{I as W}from"./InputAdornment-DNrS9Vz9.js";import{a as R,V as E}from"./VisibilityOff-Bd581jq1.js";const le=()=>{const m=$(),[j]=D(),c=j.get("token"),l=j.get("email"),[t,N]=n.useState(""),[o,O]=n.useState(""),[p,z]=n.useState(!1),[f,q]=n.useState(!1),[d,b]=n.useState(!1),[P,i]=n.useState(null),[V,F]=n.useState(!1),w=[{test:s=>s.length>=8,label:"At least 8 characters"},{test:s=>/[A-Z]/.test(s),label:"One uppercase letter"},{test:s=>/[a-z]/.test(s),label:"One lowercase letter"},{test:s=>/\d/.test(s),label:"One number"},{test:s=>/[!@#$%^&*(),.?\":{}|<>]/.test(s),label:"One special character"}],a=w.filter(s=>s.test(t)).length,y=a>=3;n.useEffect(()=>{(!c||!l)&&i("Invalid reset link. Please request a new password reset.")},[c,l]);const Y=async s=>{if(s.preventDefault(),!c||!l){i("Invalid reset link. Please request a new password reset.");return}if(!y){i("Password does not meet security requirements");return}if(t!==o){i("Passwords do not match");return}b(!0),i(null);try{const S=await(await fetch("/auth/api/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:l,token:c,newPassword:t,confirmPassword:o})})).json();S.success?(F(!0),setTimeout(()=>{m("/login",{state:{message:"Password reset successfully. You can now log in."}})},3e3)):i(S.message||"Failed to reset password")}catch(u){console.error("Password reset error:",u),i("An error occurred while resetting your password")}finally{b(!1)}},v=()=>a<=1?"error":a<=2?"warning":a<=3?"info":"success",G=()=>a<=1?"Weak":a<=2?"Fair":a<=3?"Good":"Strong";return!c||!l?e.jsx(g,{maxWidth:"sm",sx:{mt:8},children:e.jsx(C,{children:e.jsxs(k,{sx:{textAlign:"center",py:4},children:[e.jsx(Z,{sx:{fontSize:64,color:"error.main",mb:2}}),e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Invalid Reset Link"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"This password reset link is invalid or has expired. Please request a new password reset."}),e.jsx(h,{variant:"contained",onClick:()=>m("/login"),startIcon:e.jsx(A,{}),children:"Back to Login"})]})})}):V?e.jsx(g,{maxWidth:"sm",sx:{mt:8},children:e.jsx(C,{children:e.jsxs(k,{sx:{textAlign:"center",py:4},children:[e.jsx(K,{sx:{fontSize:64,color:"success.main",mb:2}}),e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Password Reset Successfully"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Your password has been updated. You will be redirected to the login page shortly."}),e.jsx(I,{sx:{mb:2}}),e.jsx(h,{variant:"contained",onClick:()=>m("/login"),children:"Go to Login"})]})})}):e.jsx(g,{maxWidth:"sm",sx:{mt:8},children:e.jsxs(H,{elevation:3,sx:{p:4},children:[e.jsxs(x,{sx:{textAlign:"center",mb:4},children:[e.jsx(B,{sx:{fontSize:48,color:"primary.main",mb:2}}),e.jsx(r,{variant:"h4",gutterBottom:!0,children:"Reset Password"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Enter your new password for ",l]})]}),e.jsxs(x,{component:"form",onSubmit:Y,children:[e.jsx(T,{fullWidth:!0,label:"New Password",type:p?"text":"password",value:t,onChange:s=>N(s.target.value),disabled:d,sx:{mb:2},InputProps:{endAdornment:e.jsx(W,{position:"end",children:e.jsx(L,{onClick:()=>z(!p),edge:"end",children:p?e.jsx(R,{}):e.jsx(E,{})})})}}),t&&e.jsxs(x,{sx:{mb:2},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"body2",sx:{mr:1},children:"Password Strength:"}),e.jsx(r,{variant:"body2",color:`${v()}.main`,sx:{fontWeight:"bold"},children:G()})]}),e.jsx(I,{variant:"determinate",value:a/w.length*100,color:v(),sx:{mb:1}}),e.jsx(x,{children:w.map((s,u)=>e.jsxs(r,{variant:"caption",sx:{display:"block",color:s.test(t)?"success.main":"text.secondary"},children:[s.test(t)?"✓":"○"," ",s.label]},u))})]}),e.jsx(T,{fullWidth:!0,label:"Confirm New Password",type:f?"text":"password",value:o,onChange:s=>O(s.target.value),disabled:d,sx:{mb:3},error:o!==""&&t!==o,helperText:o!==""&&t!==o?"Passwords do not match":"",InputProps:{endAdornment:e.jsx(W,{position:"end",children:e.jsx(L,{onClick:()=>q(!f),edge:"end",children:f?e.jsx(R,{}):e.jsx(E,{})})})}}),P&&e.jsx(M,{severity:"error",sx:{mb:2},children:P}),e.jsx(h,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:d||!y||t!==o,startIcon:d?e.jsx(J,{size:20}):e.jsx(B,{}),sx:{mb:2},children:d?"Resetting Password...":"Reset Password"}),e.jsx(h,{fullWidth:!0,variant:"text",onClick:()=>m("/login"),disabled:d,startIcon:e.jsx(A,{}),children:"Back to Login"})]})]})})};export{le as default};
