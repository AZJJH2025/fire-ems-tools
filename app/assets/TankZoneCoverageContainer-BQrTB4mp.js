import{j as e,k as _,l,aN as q,aO as re,aP as J,aQ as K,aR as Q,aS as ne,aT as X,B as n,aU as ie,aV as I,aW as le,aX as oe,aY as ce,aZ as de,a_ as xe,a$ as ue,b0 as me,r as M,b1 as he,R as V,b2 as pe}from"./index-CRoewdOo.js";import{S as ve,A as be,a as ge,M as je,E as ye,D as fe,b as Te}from"./A11yProvider-BSDApoov.js";import{c as Y,T as t,P as f,u as ke}from"./Typography-2_i7RhMS.js";import{L as O}from"./LocalFireDepartment-BW7bCqH_.js";import{h as Ce,i as g,T as R,M as u,L as P,l as W,m as Se,n as Z,C as G,p as Ae,g as T,A as k,k as Ie,f as j,D as Re,E as we,q as De}from"./Settings-BORm6CAR.js";import{B as v}from"./Button-BrT39hkp.js";import{A as Fe,D as Ee,S as y,a as ze}from"./Delete-yvymnGh9.js";import{F as Le,L as Be}from"./FilterList-DAIc1j22.js";import{A as Me}from"./Assessment-DwCIO29l.js";import{D as N}from"./Download-CFJPJxTn.js";import{u as Pe,F as We,a as Ze}from"./leaflet-GlY6QC4t.js";const Ge=Y(e.jsx("path",{d:"M8 5v14l11-7z"})),H=Y(e.jsx("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"})),Oe=({mode:m})=>{const s=_(),h=l(q),C=l(re);l(J);const o=l(K),r=l(Q),c=l(ne),d=l(X),S=(a,b)=>{s(ie(b))},D=()=>{s(me())},x=a=>{r.selectedTanks.includes(a)?s(de(a)):s(xe(a))},F=a=>{s(ue(a))},A=()=>e.jsxs(n,{sx:{p:2},children:[e.jsxs(n,{sx:{mb:2,display:"flex",gap:1},children:[e.jsx(v,{variant:"outlined",startIcon:e.jsx(Fe,{}),size:"small",fullWidth:!0,children:"Add Tank"}),e.jsx(v,{variant:"outlined",startIcon:e.jsx(H,{}),size:"small",fullWidth:!0,children:"Import CSV"})]}),e.jsxs(f,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(t,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(Le,{sx:{mr:1,verticalAlign:"middle"}}),"Filters"]}),e.jsxs(R,{select:!0,size:"small",label:"Tank Type",fullWidth:!0,margin:"dense",value:r.filterCriteria.tankTypes[0]||"all",children:[e.jsx(u,{value:"all",children:"All Types"}),e.jsx(u,{value:"municipal",children:"Municipal"}),e.jsx(u,{value:"private",children:"Private"}),e.jsx(u,{value:"emergency",children:"Emergency"})]}),e.jsxs(R,{select:!0,size:"small",label:"Status",fullWidth:!0,margin:"dense",value:r.filterCriteria.operationalStatus[0]||"active",children:[e.jsx(u,{value:"active",children:"Active"}),e.jsx(u,{value:"inactive",children:"Inactive"}),e.jsx(u,{value:"maintenance",children:"Maintenance"})]}),e.jsx(t,{variant:"caption",display:"block",sx:{mt:1,mb:1},children:"Capacity Range (gallons)"}),e.jsx(ve,{size:"small",value:r.filterCriteria.capacityRange,min:0,max:1e5,step:5e3,valueLabelDisplay:"auto",marks:[{value:0,label:"0"},{value:5e4,label:"50K"},{value:1e5,label:"100K"}]})]}),e.jsxs(t,{variant:"subtitle2",gutterBottom:!0,children:["Water Tanks (",C.length,")"]}),e.jsx(P,{dense:!0,children:C.map(a=>e.jsxs(W,{button:!0,selected:r.selectedTanks.includes(a.id),onClick:()=>x(a.id),sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:[e.jsx(Se,{children:e.jsx(O,{color:a.operationalStatus==="active"?"primary":"disabled"})}),e.jsx(Z,{primary:a.name,secondary:e.jsxs(n,{children:[e.jsxs(t,{variant:"caption",display:"block",children:[a.capacity.toLocaleString()," gal â€¢ ",a.type]}),e.jsx(G,{size:"small",label:a.accessRating,color:a.accessRating==="excellent"?"success":"default"})]})}),e.jsx(Ae,{children:e.jsx(T,{size:"small",onClick:b=>{b.stopPropagation(),F(a.id)},children:e.jsx(Ee,{})})})]},a.id))}),C.length===0&&e.jsx(k,{severity:"info",sx:{mt:2},children:"No tanks found. Add tanks or adjust filters."})]}),p=()=>e.jsxs(n,{sx:{p:2},children:[e.jsxs(f,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(t,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(Ie,{sx:{mr:1,verticalAlign:"middle"}}),"Analysis Parameters"]}),e.jsx(R,{size:"small",label:"Max Effective Distance (ft)",fullWidth:!0,margin:"dense",type:"number",value:c.maxEffectiveDistance,onChange:a=>s(I({maxEffectiveDistance:parseInt(a.target.value)||1500}))}),e.jsx(R,{size:"small",label:"Min Flow Rate (GPM)",fullWidth:!0,margin:"dense",type:"number",value:c.minimumFlowRate,onChange:a=>s(I({minimumFlowRate:parseInt(a.target.value)||250}))}),e.jsx(j,{control:e.jsx(y,{checked:c.terrainFactor,onChange:a=>s(I({terrainFactor:a.target.checked}))}),label:"Consider Terrain"}),e.jsx(j,{control:e.jsx(y,{checked:c.seasonalFactors,onChange:a=>s(I({seasonalFactors:a.target.checked}))}),label:"Seasonal Factors"})]}),e.jsx(v,{variant:"contained",startIcon:e.jsx(Ge,{}),fullWidth:!0,size:"large",onClick:D,disabled:h.length===0||d,sx:{mb:2},children:d?"Analyzing...":"Analyze Coverage"}),d&&e.jsx(Be,{sx:{mb:2}}),e.jsxs(f,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Display Options"}),e.jsx(j,{control:e.jsx(y,{checked:r.showCoverageZones,onChange:()=>s(le())}),label:"Coverage Zones"}),e.jsx(j,{control:e.jsx(y,{checked:r.showGapAreas,onChange:()=>s(oe())}),label:"Gap Areas"}),e.jsx(j,{control:e.jsx(y,{checked:r.showRedundancyAreas,onChange:()=>s(ce())}),label:"Redundancy Areas"})]}),o&&e.jsxs(f,{variant:"outlined",sx:{p:2},children:[e.jsxs(t,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(Me,{sx:{mr:1,verticalAlign:"middle"}}),"Analysis Results"]}),e.jsxs(t,{variant:"body2",gutterBottom:!0,children:["Coverage: ",o.coveragePercentage.toFixed(1),"%"]}),e.jsxs(t,{variant:"body2",gutterBottom:!0,children:["Tanks: ",o.totalTanks]}),e.jsxs(t,{variant:"body2",gutterBottom:!0,children:["Critical Gaps: ",o.gapAreas.filter(a=>a.severity==="critical").length]}),e.jsx(v,{variant:"outlined",size:"small",startIcon:e.jsx(N,{}),fullWidth:!0,sx:{mt:1},children:"Export Report"})]})]}),E=()=>e.jsxs(n,{sx:{p:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Coverage Gaps"}),o?e.jsx(P,{dense:!0,children:o.gapAreas.map(a=>e.jsx(W,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:e.jsx(Z,{primary:`Gap ${a.id}`,secondary:e.jsxs(n,{children:[e.jsxs(t,{variant:"caption",display:"block",children:["Severity: ",e.jsx(G,{size:"small",label:a.severity,color:a.severity==="critical"?"error":a.severity==="high"?"warning":"default"})]}),e.jsxs(t,{variant:"caption",display:"block",children:["Area: ",(a.area/43560).toFixed(1)," acres"]})]})})},a.id))}):e.jsx(k,{severity:"info",children:"Run coverage analysis to identify gaps."})]}),i=()=>e.jsxs(n,{sx:{p:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Recommendations"}),o?e.jsx(P,{dense:!0,children:o.recommendations.map(a=>e.jsx(W,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:e.jsx(Z,{primary:a.title,secondary:e.jsxs(n,{children:[e.jsx(t,{variant:"body2",gutterBottom:!0,children:a.description}),e.jsx(G,{size:"small",label:a.priority,color:a.priority==="critical"?"error":a.priority==="high"?"warning":"default"}),a.estimatedCost&&e.jsxs(t,{variant:"caption",display:"block",sx:{mt:1},children:["Est. Cost: $",a.estimatedCost.toLocaleString()]})]})})},a.id))}):e.jsx(k,{severity:"info",children:"Run coverage analysis to see recommendations."})]}),z=()=>e.jsxs(n,{sx:{p:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Data Import"}),e.jsx(k,{severity:"info",sx:{mb:2},children:"Import tank locations from CSV or place manually on map."}),e.jsx(v,{variant:"outlined",startIcon:e.jsx(H,{}),fullWidth:!0,sx:{mb:2},children:"Upload Tank Data (CSV)"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"CSV should include: Name, Latitude, Longitude, Capacity, Type, Owner"}),e.jsx(Re,{sx:{my:2}}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Export Data"}),e.jsx(v,{variant:"outlined",startIcon:e.jsx(N,{}),fullWidth:!0,disabled:h.length===0,children:"Export Tank Data"})]});return e.jsxs(n,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(n,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[e.jsxs(t,{variant:"h6",component:"div",sx:{display:"flex",alignItems:"center"},children:[e.jsx(O,{sx:{mr:1}}),"Tank Coverage"]}),m&&e.jsxs(t,{variant:"caption",color:"text.secondary",children:["Mode: ",m]})]}),e.jsxs(Ce,{value:r.sidebarTab,onChange:S,variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(g,{label:"Tanks",value:"tanks"}),e.jsx(g,{label:"Analysis",value:"analysis"}),e.jsx(g,{label:"Gaps",value:"gaps"}),e.jsx(g,{label:"Recommendations",value:"recommendations"}),e.jsx(g,{label:"Import",value:"import"})]}),e.jsxs(n,{sx:{flexGrow:1,overflow:"auto"},children:[r.sidebarTab==="tanks"&&A(),r.sidebarTab==="analysis"&&p(),r.sidebarTab==="gaps"&&E(),r.sidebarTab==="recommendations"&&i(),r.sidebarTab==="import"&&z()]})]})},w=320,Ye=({initialTanks:m=[],initialAnalysisParams:s,onAnalysisComplete:h,onTankUpdate:C,mode:o="analysis"})=>{const r=_(),c=ke(),d=Pe(c.breakpoints.down("md"));M.useEffect(()=>{document.title="FireEMS Tank Zone Coverage"},[]);const S=l(q),D=l(J),x=l(K);l(Q);const F=l(X),A=l(he),[p,E]=V.useState(!d),[i,z]=V.useState(!1);M.useEffect(()=>{m.length>0&&console.log("Loading initial tanks:",m),s&&console.log("Loading initial analysis parameters:",s)},[m,s]),M.useEffect(()=>{x&&h&&h(x)},[x,h]);const a=()=>{E(!p)},b=()=>{z(!i),i?document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()},ee=()=>{const L={tanks:S,coverageZones:D,activeAnalysis:x,timestamp:new Date};localStorage.setItem("tankZoneCoverage_autosave",JSON.stringify(L)),console.log("Tank zone coverage data saved")},ae=()=>{if(x){const L={analysis:x,tanks:S,exportedAt:new Date},se=new Blob([JSON.stringify(L,null,2)],{type:"application/json"}),$=URL.createObjectURL(se),B=document.createElement("a");B.href=$,B.download=`tank-coverage-analysis-${new Date().toISOString().split("T")[0]}.json`,B.click(),URL.revokeObjectURL($)}},U=()=>{r(pe())},te={marginLeft:!d&&p?`${w}px`:0,width:!d&&p?`calc(100% - ${w}px)`:"100%",height:i?"100vh":"calc(100vh - 64px)",transition:c.transitions.create(["margin","width"],{easing:c.transitions.easing.sharp,duration:c.transitions.duration.leavingScreen})};return e.jsx(be,{children:e.jsxs(n,{sx:{display:"flex",height:"100vh",overflow:"hidden",bgcolor:"background.default",position:i?"fixed":"relative",top:i?0:"auto",left:i?0:"auto",right:i?0:"auto",bottom:i?0:"auto",zIndex:i?1300:"auto"},role:"main","aria-label":"Tank Zone Coverage Analysis Tool",children:[!i&&e.jsx(ge,{position:"fixed",sx:{zIndex:c.zIndex.drawer+1,bgcolor:"primary.main"},children:e.jsxs(we,{children:[e.jsx(T,{color:"inherit","aria-label":"toggle sidebar",onClick:a,edge:"start",sx:{mr:2},children:e.jsx(je,{})}),e.jsx(O,{sx:{mr:1}}),e.jsxs(t,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:["Tank Zone Coverage Analysis",o==="planning"&&" - Planning Mode",o==="presentation"&&" - Presentation Mode"]}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(T,{color:"inherit",onClick:ee,title:"Save Analysis",children:e.jsx(ze,{})}),e.jsx(T,{color:"inherit",onClick:ae,title:"Export Results",disabled:!x,children:e.jsx(ye,{})}),e.jsx(T,{color:"inherit",onClick:b,title:"Toggle Fullscreen",children:i?e.jsx(We,{}):e.jsx(Ze,{})})]})]})}),e.jsx(fe,{variant:d?"temporary":"persistent",anchor:"left",open:p,onClose:a,sx:{width:w,flexShrink:0,"& .MuiDrawer-paper":{width:w,boxSizing:"border-box",marginTop:i?0:"64px",height:i?"100vh":"calc(100vh - 64px)",borderRight:`1px solid ${c.palette.divider}`}},ModalProps:{keepMounted:!0,disablePortal:!1,hideBackdrop:!d,disableAutoFocus:!0,disableEnforceFocus:!0,disableRestoreFocus:!0},PaperProps:{"aria-hidden":!1,role:"complementary","aria-label":"Tank Zone Coverage Tools"},children:e.jsx(Oe,{mode:o})}),e.jsxs(n,{component:"main",sx:{flexGrow:1,position:"relative",...te},children:[e.jsx(f,{elevation:0,sx:{height:"100%",width:"100%",borderRadius:0,overflow:"hidden",position:"relative",minHeight:"500px",display:"flex",flexDirection:"column","& .leaflet-container":{background:"transparent !important",outline:"none"},"& .leaflet-tile-pane":{opacity:"1 !important",visibility:"visible !important"},"& .leaflet-tile":{opacity:"1 !important",visibility:"visible !important",display:"block !important",imageRendering:"auto",transform:"translateZ(0)",backfaceVisibility:"hidden"},"& .leaflet-layer":{opacity:"1 !important",visibility:"visible !important"}},children:e.jsx(Te,{})}),F&&e.jsx(n,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsx(t,{variant:"h6",children:"Analyzing Tank Coverage..."})})]}),e.jsx(De,{open:!!A,autoHideDuration:6e3,onClose:U,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(k,{onClose:U,severity:"error",sx:{width:"100%"},children:A})})]})})};export{Ye as default};
