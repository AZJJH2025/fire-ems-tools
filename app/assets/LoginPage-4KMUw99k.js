import{a as H,g as U,bo as W,p as F,r as u,u as _,j as e,s as J,c as G,E as B,b as K,m as Y,aK as Z,B as d,bn as Q,bp as X,y as T}from"./index-DCG67GAi.js";import{a as ee,b as se,c as re,d as oe,D as te}from"./Divider-1fTpPI-d.js";import{u as ne,T as h,c as q,P as ae}from"./Typography-tCZpHVOf.js";import{A as N,T as L,a as I}from"./TextField-BbcCw8hm.js";import{E as ie}from"./Error-B8V0n91h.js";import{C as le}from"./CheckCircle-BQKoZrOu.js";import{I as V}from"./InputAdornment-CdIxKcls.js";import{a as z,V as E}from"./VisibilityOff-B0K5U-y9.js";import{L as ce}from"./LinearProgress-CCMh7XpT.js";import{i as $,B as D}from"./List-DsxJCF4A.js";import{L as de}from"./LocalFireDepartment-D5AYp1dN.js";function ue(s){return U("MuiLink",s)}const pe=H("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]),he=({theme:s,ownerState:t})=>{const n=t.color,l=W(s,`palette.${n}.main`,!1)||W(s,`palette.${n}`,!1)||t.color,m=W(s,`palette.${n}.mainChannel`)||W(s,`palette.${n}Channel`);return"vars"in s&&m?`rgba(${m} / 0.4)`:F(l,.4)},M={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},xe=s=>{const{classes:t,component:n,focusVisible:l,underline:m}=s,o={root:["root",`underline${B(m)}`,n==="button"&&"button",l&&"focusVisible"]};return K(o,ue,t)},me=J(h,{name:"MuiLink",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:n}=s;return[t.root,t[`underline${B(n.underline)}`],n.component==="button"&&t.button]}})(Y(({theme:s})=>({variants:[{props:{underline:"none"},style:{textDecoration:"none"}},{props:{underline:"hover"},style:{textDecoration:"none","&:hover":{textDecoration:"underline"}}},{props:{underline:"always"},style:{textDecoration:"underline","&:hover":{textDecorationColor:"inherit"}}},{props:({underline:t,ownerState:n})=>t==="always"&&n.color!=="inherit",style:{textDecorationColor:"var(--Link-underlineColor)"}},...Object.entries(s.palette).filter(Z()).map(([t])=>({props:{underline:"always",color:t},style:{"--Link-underlineColor":s.vars?`rgba(${s.vars.palette[t].mainChannel} / 0.4)`:F(s.palette[t].main,.4)}})),{props:{underline:"always",color:"textPrimary"},style:{"--Link-underlineColor":s.vars?`rgba(${s.vars.palette.text.primaryChannel} / 0.4)`:F(s.palette.text.primary,.4)}},{props:{underline:"always",color:"textSecondary"},style:{"--Link-underlineColor":s.vars?`rgba(${s.vars.palette.text.secondaryChannel} / 0.4)`:F(s.palette.text.secondary,.4)}},{props:{underline:"always",color:"textDisabled"},style:{"--Link-underlineColor":(s.vars||s).palette.text.disabled}},{props:{component:"button"},style:{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${pe.focusVisible}`]:{outline:"auto"}}}]}))),R=u.forwardRef(function(t,n){const l=_({props:t,name:"MuiLink"}),m=ne(),{className:o,color:w="primary",component:f="a",onBlur:y,onFocus:g,TypographyClasses:b,underline:v="always",variant:i="inherit",sx:j,...C}=l,[S,P]=u.useState(!1),k=r=>{$(r.target)||P(!1),y&&y(r)},A=r=>{$(r.target)&&P(!0),g&&g(r)},a={...l,color:w,component:f,focusVisible:S,underline:v,variant:i},p=xe(a);return e.jsx(me,{color:w,className:G(p.root,o),classes:b,component:f,onBlur:k,onFocus:A,ref:n,ownerState:a,variant:i,...C,sx:[...M[w]===void 0?[{color:w}]:[],...Array.isArray(j)?j:[j]],style:{...C.style,...v==="always"&&w!=="inherit"&&!M[w]&&{"--Link-underlineColor":he({theme:m,ownerState:a})}}})}),fe=q(e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"})),O=q(e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1z"})),ge=({open:s,onClose:t,onSuccess:n,isTemporary:l=!1,userName:m=""})=>{const[o,w]=u.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[f,y]=u.useState({current:!1,new:!1,confirm:!1}),[g,b]=u.useState(!1),[v,i]=u.useState(""),[j,C]=u.useState(!1),S=r=>c=>{w(x=>({...x,[r]:c.target.value})),i("")},P=r=>{y(c=>({...c,[r]:!c[r]}))},k=r=>{const c=[];return r.length<8&&c.push("At least 8 characters long"),/[A-Z]/.test(r)||c.push("One uppercase letter"),/[a-z]/.test(r)||c.push("One lowercase letter"),/[0-9]/.test(r)||c.push("One number"),c},A=r=>{const x=(4-k(r).length)/4*100;return x===100?{score:x,label:"Strong",color:"success"}:x>=75?{score:x,label:"Good",color:"info"}:x>=50?{score:x,label:"Fair",color:"warning"}:{score:x,label:"Weak",color:"error"}},a=async()=>{if(i(""),b(!0),!o.currentPassword||!o.newPassword||!o.confirmPassword){i("All fields are required"),b(!1);return}if(o.newPassword!==o.confirmPassword){i("New password and confirmation do not match"),b(!1);return}const r=k(o.newPassword);if(r.length>0){i(`Password must have: ${r.join(", ")}`),b(!1);return}try{const c=await fetch("/auth/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:o.currentPassword,newPassword:o.newPassword,confirmPassword:o.confirmPassword})}),x=await c.json();c.ok&&x.success?(C(!0),setTimeout(()=>{n(),t()},1500)):i(x.message||"Failed to change password")}catch{i("Network error. Please try again.")}finally{b(!1)}},p=A(o.newPassword);return e.jsxs(ee,{open:s,onClose:l?void 0:t,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(se,{sx:{pb:1},children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(O,{color:"primary"}),e.jsx(h,{variant:"h6",children:l?"Set Your Password":"Change Password"})]}),l&&e.jsxs(h,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Welcome ",m,"! Please set a secure password to continue."]})]}),e.jsxs(re,{sx:{pt:2},children:[v&&e.jsx(N,{severity:"error",sx:{mb:2},icon:e.jsx(ie,{}),children:v}),j&&e.jsx(N,{severity:"success",sx:{mb:2},icon:e.jsx(le,{}),children:"Password changed successfully! Redirecting..."}),e.jsxs(d,{component:"form",sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(L,{label:l?"Current Temporary Password":"Current Password",type:f.current?"text":"password",value:o.currentPassword,onChange:S("currentPassword"),required:!0,fullWidth:!0,disabled:g,InputProps:{endAdornment:e.jsx(V,{position:"end",children:e.jsx(I,{onClick:()=>P("current"),edge:"end",children:f.current?e.jsx(z,{}):e.jsx(E,{})})})}}),e.jsx(L,{label:"New Password",type:f.new?"text":"password",value:o.newPassword,onChange:S("newPassword"),required:!0,fullWidth:!0,disabled:g,InputProps:{endAdornment:e.jsx(V,{position:"end",children:e.jsx(I,{onClick:()=>P("new"),edge:"end",children:f.new?e.jsx(z,{}):e.jsx(E,{})})})}}),o.newPassword&&e.jsxs(d,{children:[e.jsxs(d,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(h,{variant:"body2",children:"Password Strength"}),e.jsx(h,{variant:"body2",color:`${p.color}.main`,children:p.label})]}),e.jsx(ce,{variant:"determinate",value:p.score,color:p.color,sx:{height:8,borderRadius:4}})]}),e.jsx(L,{label:"Confirm New Password",type:f.confirm?"text":"password",value:o.confirmPassword,onChange:S("confirmPassword"),required:!0,fullWidth:!0,disabled:g,error:o.confirmPassword!==""&&o.newPassword!==o.confirmPassword,helperText:o.confirmPassword!==""&&o.newPassword!==o.confirmPassword?"Passwords do not match":"",InputProps:{endAdornment:e.jsx(V,{position:"end",children:e.jsx(I,{onClick:()=>P("confirm"),edge:"end",children:f.confirm?e.jsx(z,{}):e.jsx(E,{})})})}})]})]}),e.jsxs(oe,{sx:{px:3,pb:3},children:[!l&&e.jsx(D,{onClick:t,disabled:g,children:"Cancel"}),e.jsx(D,{onClick:a,variant:"contained",disabled:g||j,sx:{minWidth:120},children:g?"Changing...":l?"Set Password":"Change Password"})]})]})},De=()=>{const s=Q(),t=X(),[n,l]=u.useState({email:"",password:""}),[m,o]=u.useState([]),[w,f]=u.useState(!1),[y,g]=u.useState(!1),[b,v]=u.useState(!1),[i,j]=u.useState(null);u.useEffect(()=>{new URLSearchParams(t.search).get("signup")==="success"&&f(!0)},[t]);const C=(a,p)=>{l(r=>({...r,[a]:p}))},S=()=>{const a=[];return n.email.trim()?n.email.includes("@")||a.push("Valid email is required"):a.push("Email is required"),n.password||a.push("Password is required"),o(a),a.length===0},P=async a=>{if(a.preventDefault(),!!S())try{const r=await(await fetch("/auth/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n.email,password:n.password,remember:!1})})).json();if(r.success){if(console.log("Login successful:",r.user),r.user.has_temp_password){j(r.user),v(!0);return}r.user.role==="super_admin"||r.user.role==="admin"?s("/admin"):s("/")}else o([r.message||"Login failed"])}catch(p){console.error("Login error:",p),o(["An error occurred during login. Please try again."])}},k=()=>{alert("Forgot password functionality will be implemented soon. Please contact support for now.")},A=()=>{i.role==="super_admin"||i.role==="admin"?s("/admin"):s("/")};return e.jsxs(d,{sx:{minHeight:"100vh",bgcolor:"#f5f5f5"},children:[e.jsx(d,{sx:{background:"linear-gradient(135deg, #1565c0 0%, #1976d2 50%, #1e88e5 100%)",minHeight:"40vh",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:e.jsx(T,{maxWidth:"lg",children:e.jsxs(d,{sx:{textAlign:"center",color:"white"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:[e.jsx(de,{sx:{fontSize:60,mr:2}}),e.jsx(h,{variant:"h3",sx:{fontWeight:"bold"},children:"FireEMS.AI"})]}),e.jsx(h,{variant:"h5",sx:{opacity:.9},children:"Welcome back to your fire department analytics suite"})]})})}),e.jsx(T,{maxWidth:"sm",sx:{mt:-8,position:"relative",zIndex:1},children:e.jsxs(ae,{sx:{p:4,boxShadow:"0 8px 32px rgba(0,0,0,0.1)"},children:[e.jsxs(d,{sx:{textAlign:"center",mb:4},children:[e.jsx(h,{variant:"h4",gutterBottom:!0,sx:{fontWeight:"bold",color:"#1565c0"},children:"Sign In"}),e.jsx(h,{variant:"body1",color:"text.secondary",children:"Access your department's analytics and reporting tools"})]}),w&&e.jsx(N,{severity:"success",sx:{mb:3},children:"Account created successfully! Please sign in with your credentials."}),m.length>0&&e.jsx(N,{severity:"error",sx:{mb:3},children:e.jsx(d,{children:m.map((a,p)=>e.jsxs(h,{variant:"body2",children:["â€¢ ",a]},p))})}),e.jsxs("form",{onSubmit:P,children:[e.jsxs(d,{sx:{mb:3},children:[e.jsx(L,{fullWidth:!0,label:"Email Address",type:"email",value:n.email,onChange:a=>C("email",a.target.value),placeholder:"chief@department.gov",required:!0,InputProps:{startAdornment:e.jsx(fe,{sx:{color:"#757575",mr:1}})},sx:{mb:2}}),e.jsx(L,{fullWidth:!0,label:"Password",type:y?"text":"password",value:n.password,onChange:a=>C("password",a.target.value),required:!0,InputProps:{startAdornment:e.jsx(O,{sx:{color:"#757575",mr:1}}),endAdornment:e.jsx(V,{position:"end",children:e.jsx(I,{"aria-label":"toggle password visibility",onClick:()=>g(!y),edge:"end",size:"small",children:y?e.jsx(z,{}):e.jsx(E,{})})})}})]}),e.jsx(D,{type:"submit",fullWidth:!0,variant:"contained",size:"large",sx:{py:1.5,fontSize:"1.1rem",fontWeight:"bold",mb:2,bgcolor:"#1565c0","&:hover":{bgcolor:"#1976d2"}},children:"Sign In"}),e.jsx(d,{sx:{textAlign:"center",mb:3},children:e.jsx(R,{component:"button",type:"button",onClick:k,sx:{color:"#1565c0",textDecoration:"none",fontSize:"0.95rem"},children:"Forgot your password?"})}),e.jsx(te,{sx:{mb:3},children:e.jsx(h,{variant:"body2",color:"text.secondary",children:"New to FireEMS.AI?"})}),e.jsx(D,{fullWidth:!0,variant:"outlined",size:"large",onClick:()=>s("/signup"),sx:{py:1.5,fontSize:"1.1rem",fontWeight:"bold",borderColor:"#1565c0",color:"#1565c0","&:hover":{borderColor:"#1976d2",bgcolor:"rgba(21, 101, 192, 0.04)"}},children:"Create New Account"})]}),e.jsxs(d,{sx:{mt:4,p:3,bgcolor:"#f5f5f5",borderRadius:2},children:[e.jsxs(h,{variant:"body2",color:"text.secondary",align:"center",gutterBottom:!0,children:[e.jsx("strong",{children:"Demo Access:"})," While in development, you can access tools directly from the homepage."]}),e.jsx(D,{variant:"text",size:"small",onClick:()=>s("/"),sx:{display:"block",mx:"auto",color:"#1565c0"},children:"Return to Homepage"})]})]})}),e.jsx(d,{sx:{py:6,textAlign:"center"},children:e.jsxs(h,{variant:"body2",color:"text.secondary",children:["Need help? Contact our support team at"," ",e.jsx(R,{href:"mailto:support@fireems.ai",sx:{color:"#1565c0"},children:"support@fireems.ai"})]})}),e.jsx(ge,{open:b,onClose:()=>{},onSuccess:A,isTemporary:!0,userName:(i==null?void 0:i.name)||""})]})};export{De as default};
