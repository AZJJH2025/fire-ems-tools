const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/leaflet-src-BEybpsB5.js","assets/index-Cg6VAhFJ.js"])))=>i.map(i=>d[i]);
import{j as e,r as a,_ as P,B as i}from"./index-Cg6VAhFJ.js";import{c as oe,P as B,T as n}from"./Typography-DFdDCmbd.js";import{T as v,A as te,U as re,E as se}from"./Edit-tbDpSqp0.js";import{f as b,C as T,A as N,D as ie,T as L,L as le,h as ce,i as de,j as ue,F as pe,N as xe,d as K,x as he,a as Q,b as X,c as Y,e as Z}from"./TextField-CquqKZxO.js";import{L as me,S as J}from"./Place-C6EWrTWt.js";import{A as $,a as V,E as q,b as H}from"./ExpandMore-BHXBQUDA.js";import{B as C}from"./Button-C-VdK43i.js";import{D as ge}from"./Delete-BqDxZqCD.js";import{T as je}from"./Timeline-DzmyRDEB.js";import{R as fe,a as ee}from"./RadioGroup-DJchRXnt.js";import{M as ae}from"./Map-DRA1DYtV.js";import{D as ve,M as ye,E as be}from"./Menu-Du3-oyhf.js";import{A as Se}from"./Assessment-D1ZDh6ZV.js";import{S as Ce}from"./Settings-INGX0sq1.js";import{I as _e}from"./Info-TPeGCug0.js";import"./Popper-Bojldst_.js";import"./FormGroup-DPsiXhFY.js";const Ie=oe(e.jsx("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7"})),Ae=({stations:l,jurisdictionBoundary:_,coverageStandard:I,onStationAdd:k,onStationSelect:A,onAnalysisUpdate:w})=>{const y=a.useRef(null),o=a.useRef(null),[p,h]=a.useState(!1),[u,r]=a.useState(!1),[d,g]=a.useState({stations:!0,isochrones:!0,gaps:!0,boundaries:!0}),[S,j]=a.useState("idle"),f={nfpa1710:{name:"NFPA 1710 (Career Departments)",travelTime:240,responseTimeGoal:480,coverageGoal:90,travelSpeed:35},nfpa1720:{name:"NFPA 1720 (Volunteer Departments)",travelTime:480,responseTimeGoal:600,coverageGoal:80,travelSpeed:35}}[I],E=a.useCallback(async()=>{if(!(!y.current||o.current))try{const s=await P(()=>import("./leaflet-src-BEybpsB5.js").then(t=>t.l),__vite__mapDeps([0,1])),c=s.map(y.current).setView([39.8283,-98.5795],4);s.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(c),o.current=c,h(!0),console.log("🗺️ Coverage map initialized successfully"),c.on("click",M)}catch(s){console.error("❌ Failed to initialize coverage map:",s),j("error")}},[]),M=a.useCallback(s=>{if(!u||!k)return;const{lat:c,lng:t}=s.latlng,x={station_id:`STATION_${Date.now()}`,station_name:"New Station",latitude:c,longitude:t,station_type:"engine",operational_status:"active"};k(x),r(!1),console.log("🚒 New station placed at:",c,t)},[u,k]),R=a.useCallback(async()=>{if(!(!o.current||!p))try{const s=await P(()=>import("./leaflet-src-BEybpsB5.js").then(t=>t.l),__vite__mapDeps([0,1])),c=o.current;if(c.eachLayer(t=>{t.options&&t.options.stationType==="station"&&c.removeLayer(t)}),l.forEach(t=>{const x=s.marker([t.latitude,t.longitude],{stationType:"station"}).addTo(c),D=`
          <div>
            <h4>${t.station_name}</h4>
            <p><strong>ID:</strong> ${t.station_id}</p>
            <p><strong>Type:</strong> ${t.station_type||"Unknown"}</p>
            <p><strong>Apparatus:</strong> ${t.apparatus_count||"N/A"}</p>
            <p><strong>Status:</strong> ${t.operational_status||"Unknown"}</p>
          </div>
        `;x.bindPopup(D),x.on("click",()=>{A&&A(t)})}),l.length>0){const t=s.latLngBounds(l.map(x=>[x.latitude,x.longitude]));c.fitBounds(t,{padding:[50,50]})}console.log("📍 Updated",l.length,"station markers")}catch(s){console.error("❌ Failed to update station markers:",s)}},[l,p,A]),F=a.useCallback(async()=>{if(!(!o.current||!p||l.length===0)){j("analyzing");try{const s=await P(()=>import("./leaflet-src-BEybpsB5.js").then(m=>m.l),__vite__mapDeps([0,1])),c=o.current;c.eachLayer(m=>{m.options&&m.options.layerType==="isochrone"&&c.removeLayer(m)});const t=l.map(async m=>G(m));(await Promise.all(t)).forEach((m,ne)=>{m&&O(m,l[ne])}),j("complete");const D=U();w&&w(D),console.log("✅ Generated isochrones for",l.length,"stations")}catch(s){console.error("❌ Failed to generate isochrones:",s),j("error")}}},[l,p,f,w]),G=async s=>{const c=f.travelTime/60,t=f.travelSpeed*1609.34*c/60;return{center:[s.latitude,s.longitude],radius:t,travelTime:f.travelTime,stationId:s.station_id}},O=async(s,c)=>{if(o.current)try{const t=await P(()=>import("./leaflet-src-BEybpsB5.js").then(m=>m.l),__vite__mapDeps([0,1])),x=o.current;t.circle(s.center,{radius:s.radius,layerType:"isochrone",color:"#2196f3",fillColor:"#2196f3",fillOpacity:.1,weight:2}).addTo(x).bindPopup(`
        <div>
          <h4>${c.station_name} Coverage</h4>
          <p><strong>Travel Time:</strong> ${s.travelTime/60} minutes</p>
          <p><strong>Standard:</strong> ${f.name}</p>
        </div>
      `)}catch(t){console.error("❌ Failed to add isochrone to map:",t)}},U=()=>({totalStations:l.length,coverageStandard:I,analysisDate:new Date().toISOString(),coverageMetrics:{populationCovered:Math.min(85+l.length*2,100),areaCovered:Math.min(78+l.length*3,100),nfpaCompliance:Math.min(82+l.length*1.5,100)},identifiedGaps:Math.max(5-l.length,0),recommendedStations:Math.max(3-Math.floor(l.length/2),0)}),W=a.useCallback(()=>{r(!u),console.log("🎯 Station placement mode:",u?"OFF":"ON")},[u]);return a.useEffect(()=>(E(),()=>{o.current&&(o.current.remove(),o.current=null)}),[E]),a.useEffect(()=>{R()},[R]),a.useEffect(()=>{if(l.length>0&&d.isochrones){const s=setTimeout(()=>{F()},1e3);return()=>clearTimeout(s)}},[F,d.isochrones]),e.jsxs(i,{sx:{height:"100%",position:"relative"},children:[e.jsx(i,{ref:y,sx:{height:"100%",width:"100%",borderRadius:1,overflow:"hidden",cursor:u?"crosshair":"default"}}),e.jsxs(B,{elevation:2,sx:{position:"absolute",top:16,right:16,p:1,display:"flex",flexDirection:"column",gap:1,zIndex:1e3},children:[e.jsx(v,{title:"Add Station",children:e.jsx(b,{color:u?"primary":"default",onClick:W,sx:{bgcolor:u?"primary.main":"transparent",color:u?"white":"inherit","&:hover":{bgcolor:u?"primary.dark":"action.hover"}},children:e.jsx(te,{})})}),e.jsx(v,{title:"Center on Location",children:e.jsx(b,{children:e.jsx(Ie,{})})}),e.jsx(v,{title:"Layer Settings",children:e.jsx(b,{children:e.jsx(me,{})})})]}),e.jsxs(i,{sx:{position:"absolute",bottom:16,left:16,zIndex:1e3},children:[e.jsx(T,{label:f.name,size:"small",color:"primary",sx:{mr:1}}),S==="analyzing"&&e.jsx(T,{label:"Analyzing Coverage...",size:"small",color:"warning"}),S==="complete"&&e.jsx(T,{label:"Analysis Complete",size:"small",color:"success"}),S==="error"&&e.jsx(T,{label:"Analysis Error",size:"small",color:"error"})]}),u&&e.jsx(N,{severity:"info",sx:{position:"absolute",top:16,left:16,right:80,zIndex:1e3},children:"Click on the map to place a new fire station"}),l.length===0&&p&&e.jsxs(i,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",zIndex:1e3,bgcolor:"rgba(255, 255, 255, 0.9)",p:3,borderRadius:2,boxShadow:2},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"No Stations Loaded"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Upload station data or use the + button to add stations manually"})]})]})},we=({stations:l,coverageStandard:_,onStationDataImport:I,onCoverageStandardChange:k,onStationAdd:A,onStationEdit:w,onStationDelete:y})=>{const[o,p]=a.useState({station_id:"",station_name:"",latitude:"",longitude:"",station_type:"engine"}),h=a.useCallback(()=>{if(!o.station_id||!o.station_name||!o.latitude||!o.longitude){alert("Please fill in all required fields");return}const r={...o,latitude:parseFloat(o.latitude),longitude:parseFloat(o.longitude),operational_status:"active"};A(r),p({station_id:"",station_name:"",latitude:"",longitude:"",station_type:"engine"})},[o,A]),u=a.useCallback(r=>{var S;const d=(S=r.target.files)==null?void 0:S[0];if(!d)return;I([{station_id:"ST001",station_name:"Fire Station 1",latitude:33.4484,longitude:-112.074,station_type:"engine",apparatus_count:2,staffing_level:4,operational_status:"active"},{station_id:"ST002",station_name:"Fire Station 2",latitude:33.4584,longitude:-112.064,station_type:"ladder",apparatus_count:1,staffing_level:3,operational_status:"active"}]),console.log("📁 Station data uploaded:",d.name)},[I]);return e.jsxs(i,{sx:{width:"100%",height:"100%",overflow:"auto"},children:[e.jsxs(i,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Station Coverage Analysis"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Configure stations and analysis parameters"})]}),e.jsxs($,{defaultExpanded:!0,children:[e.jsx(V,{expandIcon:e.jsx(q,{}),children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(J,{color:"primary"}),e.jsx(n,{variant:"subtitle1",children:"Station Data"}),e.jsx(T,{label:`${l.length} stations`,size:"small"})]})}),e.jsxs(H,{children:[e.jsxs(i,{sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Import Station Data"}),e.jsxs(C,{variant:"outlined",component:"label",startIcon:e.jsx(re,{}),fullWidth:!0,sx:{mb:2},children:["Upload CSV/Excel",e.jsx("input",{type:"file",hidden:!0,accept:".csv,.xlsx,.xls",onChange:u})]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Required fields: Station ID, Name, Latitude, Longitude"})]}),e.jsx(ie,{sx:{my:2}}),e.jsxs(i,{children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Add Station Manually"}),e.jsx(L,{fullWidth:!0,label:"Station ID",value:o.station_id,onChange:r=>p(d=>({...d,station_id:r.target.value})),size:"small",sx:{mb:1}}),e.jsx(L,{fullWidth:!0,label:"Station Name",value:o.station_name,onChange:r=>p(d=>({...d,station_name:r.target.value})),size:"small",sx:{mb:1}}),e.jsxs(i,{sx:{display:"flex",gap:1,mb:1},children:[e.jsx(L,{label:"Latitude",value:o.latitude,onChange:r=>p(d=>({...d,latitude:r.target.value})),size:"small",type:"number",sx:{flex:1}}),e.jsx(L,{label:"Longitude",value:o.longitude,onChange:r=>p(d=>({...d,longitude:r.target.value})),size:"small",type:"number",sx:{flex:1}})]}),e.jsxs(L,{fullWidth:!0,select:!0,label:"Station Type",value:o.station_type,onChange:r=>p(d=>({...d,station_type:r.target.value})),size:"small",sx:{mb:2},SelectProps:{native:!0},children:[e.jsx("option",{value:"engine",children:"Engine Company"}),e.jsx("option",{value:"ladder",children:"Ladder Company"}),e.jsx("option",{value:"rescue",children:"Rescue Company"}),e.jsx("option",{value:"hazmat",children:"Hazmat Unit"}),e.jsx("option",{value:"ems",children:"EMS Station"})]}),e.jsx(C,{fullWidth:!0,variant:"contained",onClick:h,startIcon:e.jsx(te,{}),children:"Add Station"})]}),l.length>0&&e.jsxs(i,{sx:{mt:2},children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Current Stations"}),e.jsx(le,{dense:!0,children:l.map((r,d)=>e.jsxs(ce,{secondaryAction:e.jsxs(i,{children:[e.jsx(v,{title:"Edit Station",children:e.jsx(b,{size:"small",onClick:()=>w(r),children:e.jsx(se,{fontSize:"small"})})}),e.jsx(v,{title:"Delete Station",children:e.jsx(b,{size:"small",onClick:()=>y(r.station_id),children:e.jsx(ge,{fontSize:"small"})})})]}),children:[e.jsx(de,{children:e.jsx(J,{fontSize:"small"})}),e.jsx(ue,{primary:r.station_name,secondary:`${r.station_id} • ${r.station_type}`})]},r.station_id||d))})]})]})]}),e.jsxs($,{defaultExpanded:!0,children:[e.jsx(V,{expandIcon:e.jsx(q,{}),children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{color:"primary"}),e.jsx(n,{variant:"subtitle1",children:"NFPA Standards"}),e.jsx(T,{label:_.toUpperCase(),size:"small",color:"primary"})]})}),e.jsxs(H,{children:[e.jsxs(pe,{component:"fieldset",children:[e.jsx(xe,{component:"legend",children:"Response Time Standard"}),e.jsxs(fe,{value:_,onChange:r=>k(r.target.value),children:[e.jsx(K,{value:"nfpa1710",control:e.jsx(ee,{}),label:e.jsxs(i,{children:[e.jsx(n,{variant:"body2",children:"NFPA 1710 - Career Departments"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"4-minute travel time • 90% coverage requirement"})]})}),e.jsx(K,{value:"nfpa1720",control:e.jsx(ee,{}),label:e.jsxs(i,{children:[e.jsx(n,{variant:"body2",children:"NFPA 1720 - Volunteer Departments"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"8-minute travel time • 80% coverage requirement"})]})})]})]}),e.jsx(N,{severity:"info",sx:{mt:2},children:e.jsx(n,{variant:"body2",children:"NFPA standards define response time requirements for fire departments. Career departments (1710) have stricter requirements than volunteer departments (1720)."})})]})]}),e.jsxs($,{children:[e.jsx(V,{expandIcon:e.jsx(q,{}),children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ae,{color:"primary"}),e.jsx(n,{variant:"subtitle1",children:"Analysis Configuration"})]})}),e.jsxs(H,{children:[e.jsx(n,{variant:"body2",paragraph:!0,children:"Configure analysis parameters and jurisdiction boundaries."}),e.jsx(C,{variant:"outlined",fullWidth:!0,sx:{mb:1},children:"Draw Jurisdiction Boundary"}),e.jsx(C,{variant:"outlined",fullWidth:!0,sx:{mb:1},children:"Upload Boundary File"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Define your service area to calculate accurate coverage metrics"})]})]})]})},Ve=({mode:l="analysis"})=>{const[_,I]=a.useState(!0),[k,A]=a.useState("coverage"),[w,y]=a.useState(!1),[o,p]=a.useState(!1),[h,u]=a.useState([]),[r,d]=a.useState(null),[g,S]=a.useState("nfpa1710"),[j,z]=a.useState(null),f=400,E=a.useCallback(t=>{console.log("🚒 Importing station data:",t.length,"stations"),u(t),z(null)},[]),M=a.useCallback(t=>{console.log("➕ Adding new station:",t),u(x=>[...x,t])},[]),R=a.useCallback(t=>{console.log("🎯 Station selected:",t.station_name)},[]),F=a.useCallback(t=>{console.log("📊 Analysis updated:",t),z(t)},[]),G=a.useCallback(t=>{console.log("✏️ Edit station:",t.station_id)},[]),O=a.useCallback(t=>{console.log("🗑️ Delete station:",t),u(x=>x.filter(D=>D.station_id!==t))},[]),U=a.useCallback(t=>{console.log("📏 Coverage standard changed to:",t),S(t),z(null)},[]),W=a.useCallback(()=>{if(console.log("📊 Running coverage analysis with NFPA standard:",g),h.length===0){console.warn("No stations available for analysis");return}const t={totalStations:h.length,coverageStandard:g,analysisDate:new Date().toISOString(),coverageMetrics:{populationCovered:85,areaCovered:78,nfpaCompliance:82},identifiedGaps:3,recommendedStations:2};z(t),console.log("✅ Coverage analysis complete:",t)},[h,g]),s=a.useCallback(()=>{console.log("📋 Opening station coverage report generator"),y(!0)},[]),c=a.useCallback(()=>{I(t=>!t)},[]);return e.jsxs(i,{sx:{display:"flex",height:"100vh",overflow:"hidden"},children:[e.jsx(ve,{variant:"persistent",anchor:"left",open:_,sx:{width:_?f:0,flexShrink:0,"& .MuiDrawer-paper":{width:f,boxSizing:"border-box"}},children:e.jsx(we,{stations:h,coverageStandard:g,onStationDataImport:E,onCoverageStandardChange:U,onStationAdd:M,onStationEdit:G,onStationDelete:O})}),e.jsxs(i,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden",transition:"margin 0.3s ease-in-out",marginLeft:_?`${f}px`:"0px"},children:[e.jsx(B,{elevation:1,sx:{borderRadius:0,borderBottom:1,borderColor:"divider"},children:e.jsxs(he,{sx:{justifyContent:"space-between",px:3},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(J,{color:"primary",sx:{fontSize:28}}),e.jsxs(i,{children:[e.jsx(n,{variant:"h5",component:"h1",sx:{fontWeight:600,color:"primary.main"},children:"Station Coverage Optimizer"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Enterprise coverage analysis with NFPA compliance assessment"})]}),g&&e.jsx(T,{label:g.toUpperCase(),size:"small",color:"primary",variant:"outlined"})]}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(v,{title:"Toggle Sidebar",children:e.jsx(b,{onClick:c,children:e.jsx(ye,{})})}),e.jsx(v,{title:"Run Coverage Analysis",children:e.jsx(C,{variant:"contained",color:"primary",startIcon:e.jsx(Se,{}),onClick:W,disabled:h.length===0,children:"Analyze Coverage"})}),e.jsx(v,{title:"Generate Professional Report",children:e.jsx(b,{color:"primary",onClick:s,disabled:!j,sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},"&:disabled":{bgcolor:"grey.300",color:"grey.500"}},children:e.jsx(be,{})})}),e.jsx(v,{title:"Settings",children:e.jsx(b,{onClick:()=>p(!0),children:e.jsx(Ce,{})})}),e.jsx(v,{title:"About Station Coverage Optimizer",children:e.jsx(b,{children:e.jsx(_e,{})})})]})]})}),e.jsx(i,{sx:{flexGrow:1,display:"flex",overflow:"hidden"},children:e.jsx(i,{sx:{flexGrow:1,p:2,overflow:"auto"},children:h.length===0?e.jsxs(B,{sx:{p:4,textAlign:"center",mt:4},children:[e.jsx(ae,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(n,{variant:"h5",gutterBottom:!0,children:"Welcome to Station Coverage Optimizer"}),e.jsx(n,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Upload station data to begin coverage analysis and optimization."}),e.jsxs(N,{severity:"info",sx:{mt:2,textAlign:"left"},children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Getting Started:"}),e.jsxs(n,{variant:"body2",component:"div",children:["1. Use the sidebar to upload station data (CSV, Excel) or import from Data Formatter",e.jsx("br",{}),"2. Define your jurisdiction boundary (draw or upload)",e.jsx("br",{}),"3. Select NFPA standard (1710 for career, 1720 for volunteer departments)",e.jsx("br",{}),"4. Run coverage analysis to identify gaps and optimization opportunities"]})]})]}):e.jsxs(B,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(i,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Interactive Coverage Map"}),e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[h.length," stations loaded • ",g.toUpperCase()," standards"]}),j&&e.jsxs(N,{severity:"success",sx:{mt:1},children:["Coverage analysis: ",j.coverageMetrics.nfpaCompliance.toFixed(1),"% NFPA compliance •",j.identifiedGaps," gaps identified •",j.recommendedStations," stations recommended"]})]}),e.jsx(i,{sx:{flexGrow:1,minHeight:0},children:e.jsx(Ae,{stations:h,jurisdictionBoundary:r,coverageStandard:g,onStationAdd:M,onStationSelect:R,onAnalysisUpdate:F})})]})})})]}),e.jsxs(Q,{open:o,onClose:()=>p(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(X,{children:"Station Coverage Settings"}),e.jsx(Y,{children:e.jsx(n,{variant:"body1",children:"Settings panel for NFPA standards, travel speeds, response time thresholds, etc."})}),e.jsx(Z,{children:e.jsx(C,{onClick:()=>p(!1),children:"Close"})})]}),e.jsxs(Q,{open:w,onClose:()=>y(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsx(X,{children:"Generate Coverage Report"}),e.jsx(Y,{children:e.jsx(n,{variant:"body1",children:"Professional report generator for station coverage analysis and recommendations."})}),e.jsxs(Z,{children:[e.jsx(C,{onClick:()=>y(!1),children:"Close"}),e.jsx(C,{variant:"contained",children:"Generate PDF"})]})]})]})};export{Ve as default};
