var Mr=Object.defineProperty;var _r=(t,r,s)=>r in t?Mr(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var Wt=(t,r,s)=>_r(t,typeof r!="symbol"?r+"":r,s);import{r as T,g as Re,a as Ie,u as _e,j as e,s as ue,c as ve,b as ke,m as Ae,d as ge,e as Rt,f as ur,h as ce,i as Ar,_ as pr,k as ut,l as He,B as j,t as Yt,n as Lr,C as Ze,o as Me,p as Pr,q as zr,v as Nr,w as Be,R as Qe,x as rt,y as Vr,G as Br,z as Ur,A as Hr,D as Wr}from"./index-DZgJIN7B.js";import{U as qt,D as at,C as Yr,T as qr,A as Gr,S as Jr,a as mt,b as Gt,E as hr,c as fr,d as Kr,L as Xr,e as Zr,f as St}from"./dataTransformer-BiVdMdTW.js";import{T as b,u as Jt,c as ne,a as Qr,b as es,d as ht,S as ts,e as rs,f as ss,g as ns,h as os,G as le,F as Ue,I as We,i as Ye,M as oe,P as he,A as pe,B as ee,D as me,j as be,k as Oe,l as it,C as de,m as lt,n as ct,o as yt,p as Ee,q as dt,r as as,s as Pt,t as De,v as st,w as mr,x as gr,E as bt,y as xr,z as yr,H as br,J as vr,L as qe,K as Se,N as ze,O as Ce,Q as is,R as It,U as jr,V as Kt}from"./Map-C2uMdwzB.js";import{F as ls,C as nt,L as cs,T as kt,a as $t,b as Ot,c as Xe,d as Ne,e as Mt,S as ds,f as _t,g as us,h as zt,i as Nt,j as ps,P as Sr,A as hs,B as fs,D as ms}from"./AccessTime-Lm9CWyqg.js";const Cr=t=>{const r=T.useRef({});return T.useEffect(()=>{r.current=t}),r.current};function gs(t){return Re("MuiAlertTitle",t)}Ie("MuiAlertTitle",["root"]);const xs=t=>{const{classes:r}=t;return ke({root:["root"]},gs,r)},ys=ue(b,{name:"MuiAlertTitle",slot:"Root",overridesResolver:(t,r)=>r.root})(Ae(({theme:t})=>({fontWeight:t.typography.fontWeightMedium,marginTop:-2}))),bs=T.forwardRef(function(r,s){const n=_e({props:r,name:"MuiAlertTitle"}),{className:a,...l}=n,o=n,m=xs(o);return e.jsx(ys,{gutterBottom:!0,component:"div",ownerState:o,ref:s,className:ve(m.root,a),...l})});function vs(t){const{badgeContent:r,invisible:s=!1,max:n=99,showZero:a=!1}=t,l=Cr({badgeContent:r,max:n});let o=s;s===!1&&r===0&&!a&&(o=!0);const{badgeContent:m,max:u=n}=o?l:t,c=m&&Number(m)>u?`${u}+`:m;return{badgeContent:m,invisible:o,max:u,displayValue:c}}function js(t){return Re("MuiBadge",t)}const Pe=Ie("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),Ct=10,wt=4,Ss=t=>{const{color:r,anchorOrigin:s,invisible:n,overlap:a,variant:l,classes:o={}}=t,m={root:["root"],badge:["badge",l,n&&"invisible",`anchorOrigin${ge(s.vertical)}${ge(s.horizontal)}`,`anchorOrigin${ge(s.vertical)}${ge(s.horizontal)}${ge(a)}`,`overlap${ge(a)}`,r!=="default"&&`color${ge(r)}`]};return ke(m,js,o)},Cs=ue("span",{name:"MuiBadge",slot:"Root",overridesResolver:(t,r)=>r.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),ws=ue("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.badge,r[s.variant],r[`anchorOrigin${ge(s.anchorOrigin.vertical)}${ge(s.anchorOrigin.horizontal)}${ge(s.overlap)}`],s.color!=="default"&&r[`color${ge(s.color)}`],s.invisible&&r.invisible]}})(Ae(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:Ct*2,lineHeight:1,padding:"0 6px",height:Ct*2,borderRadius:Ct,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen}),variants:[...Object.entries(t.palette).filter(Rt(["contrastText"])).map(([r])=>({props:{color:r},style:{backgroundColor:(t.vars||t).palette[r].main,color:(t.vars||t).palette[r].contrastText}})),{props:{variant:"dot"},style:{borderRadius:wt,height:wt*2,minWidth:wt*2,padding:0}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Pe.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})}}]})));function Xt(t){return{vertical:(t==null?void 0:t.vertical)??"top",horizontal:(t==null?void 0:t.horizontal)??"right"}}const Ts=T.forwardRef(function(r,s){const n=_e({props:r,name:"MuiBadge"}),{anchorOrigin:a,className:l,classes:o,component:m,components:u={},componentsProps:c={},children:p,overlap:f="rectangular",color:S="default",invisible:k=!1,max:M=99,badgeContent:E,slots:z,slotProps:w,showZero:P=!1,variant:O="standard",...F}=n,{badgeContent:H,invisible:_,max:V,displayValue:d}=vs({max:M,invisible:k,badgeContent:E,showZero:P}),i=Cr({anchorOrigin:Xt(a),color:S,overlap:f,variant:O,badgeContent:E}),g=_||H==null&&O!=="dot",{color:C=S,overlap:A=f,anchorOrigin:W,variant:X=O}=g?i:n,ae=Xt(W),R=X!=="dot"?d:void 0,v={...n,badgeContent:H,invisible:g,max:V,displayValue:R,showZero:P,anchorOrigin:ae,color:C,overlap:A,variant:X},$=Ss(v),h=(z==null?void 0:z.root)??u.Root??Cs,D=(z==null?void 0:z.badge)??u.Badge??ws,y=(w==null?void 0:w.root)??c.root,I=(w==null?void 0:w.badge)??c.badge,x=Jt({elementType:h,externalSlotProps:y,externalForwardedProps:F,additionalProps:{ref:s,as:m},ownerState:v,className:ve(y==null?void 0:y.className,$.root,l)}),B=Jt({elementType:D,externalSlotProps:I,ownerState:v,className:ve($.badge,I==null?void 0:I.className)});return e.jsxs(h,{...x,children:[p,e.jsx(D,{...B,children:R})]})});function Fs(t){return Re("MuiCardActions",t)}Ie("MuiCardActions",["root","spacing"]);const Es=t=>{const{classes:r,disableSpacing:s}=t;return ke({root:["root",!s&&"spacing"]},Fs,r)},Ds=ue("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,!s.disableSpacing&&r.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),Rs=T.forwardRef(function(r,s){const n=_e({props:r,name:"MuiCardActions"}),{disableSpacing:a=!1,className:l,...o}=n,m={...n,disableSpacing:a},u=Es(m);return e.jsx(Ds,{className:ve(u.root,l),ownerState:m,ref:s,...o})}),Is=ne(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),ks=ne(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),$s=ue("span",{shouldForwardProp:ur})({position:"relative",display:"flex"}),Os=ue(Is)({transform:"scale(1)"}),Ms=ue(ks)(Ae(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function wr(t){const{checked:r=!1,classes:s={},fontSize:n}=t,a={...t,checked:r};return e.jsxs($s,{className:s.root,ownerState:a,children:[e.jsx(Os,{fontSize:n,className:s.background,ownerState:a}),e.jsx(Ms,{fontSize:n,className:s.dot,ownerState:a})]})}const Tr=T.createContext(void 0);function _s(){return T.useContext(Tr)}function As(t){return Re("MuiRadio",t)}const Zt=Ie("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Ls=t=>{const{classes:r,color:s,size:n}=t,a={root:["root",`color${ge(s)}`,n!=="medium"&&`size${ge(n)}`]};return{...r,...ke(a,As,r)}},Ps=ue(ts,{shouldForwardProp:t=>ur(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,s.size!=="medium"&&r[`size${ge(s.size)}`],r[`color${ge(s.color)}`]]}})(Ae(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${Zt.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:ce(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(Rt()).map(([r])=>({props:{color:r,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:ce(t.palette[r].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(Rt()).map(([r])=>({props:{color:r,disabled:!1},style:{[`&.${Zt.checked}`]:{color:(t.vars||t).palette[r].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function zs(t,r){return typeof r=="object"&&r!==null?t===r:String(t)===String(r)}const Ns=e.jsx(wr,{checked:!0}),Vs=e.jsx(wr,{}),pt=T.forwardRef(function(r,s){const n=_e({props:r,name:"MuiRadio"}),{checked:a,checkedIcon:l=Ns,color:o="primary",icon:m=Vs,name:u,onChange:c,size:p="medium",className:f,disabled:S,disableRipple:k=!1,slots:M={},slotProps:E={},inputProps:z,...w}=n,P=Qr();let O=S;P&&typeof O>"u"&&(O=P.disabled),O??(O=!1);const F={...n,disabled:O,disableRipple:k,color:o,size:p},H=Ls(F),_=_s();let V=a;const d=es(c,_&&_.onChange);let i=u;_&&(typeof V>"u"&&(V=zs(_.value,n.value)),typeof i>"u"&&(i=_.name));const g=E.input??z,[C,A]=ht("root",{ref:s,elementType:Ps,className:ve(H.root,f),shouldForwardComponentProp:!0,externalForwardedProps:{slots:M,slotProps:E,...w},getSlotProps:W=>({...W,onChange:(X,...ae)=>{var R;(R=W.onChange)==null||R.call(W,X,...ae),d(X,...ae)}}),ownerState:F,additionalProps:{type:"radio",icon:T.cloneElement(m,{fontSize:m.props.fontSize??p}),checkedIcon:T.cloneElement(l,{fontSize:l.props.fontSize??p}),disabled:O,name:i,checked:V,slots:M,slotProps:{input:typeof g=="function"?g(F):g}}});return e.jsx(C,{...A,classes:H})});function Bs(t){return Re("MuiRadioGroup",t)}Ie("MuiRadioGroup",["root","row","error"]);const Us=t=>{const{classes:r,row:s,error:n}=t;return ke({root:["root",s&&"row",n&&"error"]},Bs,r)},Hs=T.forwardRef(function(r,s){const{actions:n,children:a,className:l,defaultValue:o,name:m,onChange:u,value:c,...p}=r,f=T.useRef(null),S=Us(r),[k,M]=rs({controlled:c,default:o,name:"RadioGroup"});T.useImperativeHandle(n,()=>({focus:()=>{let P=f.current.querySelector("input:not(:disabled):checked");P||(P=f.current.querySelector("input:not(:disabled)")),P&&P.focus()}}),[]);const E=ss(s,f),z=ns(m),w=T.useMemo(()=>({name:z,onChange(P){M(P.target.value),u&&u(P,P.target.value)},value:k}),[z,u,M,k]);return e.jsx(Tr.Provider,{value:w,children:e.jsx(ls,{role:"radiogroup",ref:E,className:ve(S.root,l),...p,children:a})})}),vt=T.createContext({}),Vt=T.createContext({});function Ws(t){return Re("MuiStep",t)}Ie("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const Ys=t=>{const{classes:r,orientation:s,alternativeLabel:n,completed:a}=t;return ke({root:["root",s,n&&"alternativeLabel",a&&"completed"]},Ws,r)},qs=ue("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.completed&&r.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),Gs=T.forwardRef(function(r,s){const n=_e({props:r,name:"MuiStep"}),{active:a,children:l,className:o,component:m="div",completed:u,disabled:c,expanded:p=!1,index:f,last:S,...k}=n,{activeStep:M,connector:E,alternativeLabel:z,orientation:w,nonLinear:P}=T.useContext(vt);let[O=!1,F=!1,H=!1]=[a,u,c];M===f?O=a!==void 0?a:!0:!P&&M>f?F=u!==void 0?u:!0:!P&&M<f&&(H=c!==void 0?c:!0);const _=T.useMemo(()=>({index:f,last:S,expanded:p,icon:f+1,active:O,completed:F,disabled:H}),[f,S,p,O,F,H]),V={...n,active:O,orientation:w,alternativeLabel:z,completed:F,disabled:H,expanded:p,component:m},d=Ys(V),i=e.jsxs(qs,{as:m,className:ve(d.root,o),ref:s,ownerState:V,...k,children:[E&&z&&f!==0?E:null,l]});return e.jsx(Vt.Provider,{value:_,children:E&&!z&&f!==0?e.jsxs(T.Fragment,{children:[E,i]}):i})}),Js=ne(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"})),Ks=ne(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}));function Xs(t){return Re("MuiStepIcon",t)}const Tt=Ie("MuiStepIcon",["root","active","completed","error","text"]);var Qt;const Zs=t=>{const{classes:r,active:s,completed:n,error:a}=t;return ke({root:["root",s&&"active",n&&"completed",a&&"error"],text:["text"]},Xs,r)},Ft=ue(os,{name:"MuiStepIcon",slot:"Root",overridesResolver:(t,r)=>r.root})(Ae(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${Tt.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${Tt.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${Tt.error}`]:{color:(t.vars||t).palette.error.main}}))),Qs=ue("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(t,r)=>r.text})(Ae(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),en=T.forwardRef(function(r,s){const n=_e({props:r,name:"MuiStepIcon"}),{active:a=!1,className:l,completed:o=!1,error:m=!1,icon:u,...c}=n,p={...n,active:a,completed:o,error:m},f=Zs(p);if(typeof u=="number"||typeof u=="string"){const S=ve(l,f.root);return m?e.jsx(Ft,{as:Ks,className:S,ref:s,ownerState:p,...c}):o?e.jsx(Ft,{as:Js,className:S,ref:s,ownerState:p,...c}):e.jsxs(Ft,{className:S,ref:s,ownerState:p,...c,children:[Qt||(Qt=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(Qs,{className:f.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:p,children:u})]})}return u});function tn(t){return Re("MuiStepLabel",t)}const Ve=Ie("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),rn=t=>{const{classes:r,orientation:s,active:n,completed:a,error:l,disabled:o,alternativeLabel:m}=t;return ke({root:["root",s,l&&"error",o&&"disabled",m&&"alternativeLabel"],label:["label",n&&"active",a&&"completed",l&&"error",o&&"disabled",m&&"alternativeLabel"],iconContainer:["iconContainer",n&&"active",a&&"completed",l&&"error",o&&"disabled",m&&"alternativeLabel"],labelContainer:["labelContainer",m&&"alternativeLabel"]},tn,r)},sn=ue("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation]]}})({display:"flex",alignItems:"center",[`&.${Ve.alternativeLabel}`]:{flexDirection:"column"},[`&.${Ve.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),nn=ue("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(t,r)=>r.label})(Ae(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${Ve.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Ve.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${Ve.alternativeLabel}`]:{marginTop:16},[`&.${Ve.error}`]:{color:(t.vars||t).palette.error.main}}))),on=ue("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(t,r)=>r.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${Ve.alternativeLabel}`]:{paddingRight:0}}),an=ue("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(t,r)=>r.labelContainer})(Ae(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${Ve.alternativeLabel}`]:{textAlign:"center"}}))),Fr=T.forwardRef(function(r,s){const n=_e({props:r,name:"MuiStepLabel"}),{children:a,className:l,componentsProps:o={},error:m=!1,icon:u,optional:c,slots:p={},slotProps:f={},StepIconComponent:S,StepIconProps:k,...M}=n,{alternativeLabel:E,orientation:z}=T.useContext(vt),{active:w,disabled:P,completed:O,icon:F}=T.useContext(Vt),H=u||F;let _=S;H&&!_&&(_=en);const V={...n,active:w,alternativeLabel:E,completed:O,disabled:P,error:m,orientation:z},d=rn(V),i={slots:p,slotProps:{stepIcon:k,...o,...f}},[g,C]=ht("root",{elementType:sn,externalForwardedProps:{...i,...M},ownerState:V,ref:s,className:ve(d.root,l)}),[A,W]=ht("label",{elementType:nn,externalForwardedProps:i,ownerState:V}),[X,ae]=ht("stepIcon",{elementType:_,externalForwardedProps:i,ownerState:V});return e.jsxs(g,{...C,children:[H||X?e.jsx(on,{className:d.iconContainer,ownerState:V,children:e.jsx(X,{completed:O,active:w,error:m,icon:H,...ae})}):null,e.jsxs(an,{className:d.labelContainer,ownerState:V,children:[a?e.jsx(A,{...W,className:ve(d.label,W==null?void 0:W.className),children:a}):null,c]})]})});Fr.muiName="StepLabel";function ln(t){return Re("MuiStepConnector",t)}Ie("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const cn=t=>{const{classes:r,orientation:s,alternativeLabel:n,active:a,completed:l,disabled:o}=t,m={root:["root",s,n&&"alternativeLabel",a&&"active",l&&"completed",o&&"disabled"],line:["line",`line${ge(s)}`]};return ke(m,ln,r)},dn=ue("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.completed&&r.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),un=ue("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.line,r[`line${ge(s.orientation)}`]]}})(Ae(({theme:t})=>{const r=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:r,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),pn=T.forwardRef(function(r,s){const n=_e({props:r,name:"MuiStepConnector"}),{className:a,...l}=n,{alternativeLabel:o,orientation:m="horizontal"}=T.useContext(vt),{active:u,disabled:c,completed:p}=T.useContext(Vt),f={...n,alternativeLabel:o,orientation:m,active:u,completed:p,disabled:c},S=cn(f);return e.jsx(dn,{className:ve(S.root,a),ref:s,ownerState:f,...l,children:e.jsx(un,{className:S.line,ownerState:f})})});function hn(t){return Re("MuiStepper",t)}Ie("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const fn=t=>{const{orientation:r,nonLinear:s,alternativeLabel:n,classes:a}=t;return ke({root:["root",r,s&&"nonLinear",n&&"alternativeLabel"]},hn,a)},mn=ue("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:s}=t;return[r.root,r[s.orientation],s.alternativeLabel&&r.alternativeLabel,s.nonLinear&&r.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),gn=e.jsx(pn,{}),xn=T.forwardRef(function(r,s){const n=_e({props:r,name:"MuiStepper"}),{activeStep:a=0,alternativeLabel:l=!1,children:o,className:m,component:u="div",connector:c=gn,nonLinear:p=!1,orientation:f="horizontal",...S}=n,k={...n,nonLinear:p,alternativeLabel:l,orientation:f,component:u},M=fn(k),E=T.Children.toArray(o).filter(Boolean),z=E.map((P,O)=>T.cloneElement(P,{index:O,last:O+1===E.length,...P.props})),w=T.useMemo(()=>({activeStep:a,alternativeLabel:l,connector:c,nonLinear:p,orientation:f}),[a,l,c,p,f]);return e.jsx(vt.Provider,{value:w,children:e.jsx(mn,{as:u,ownerState:k,className:ve(M.root,m),ref:s,...S,children:z})})}),Bt=ne(e.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}));var ft={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/var yn=ft.exports,er;function bn(){return er||(er=1,function(t,r){((s,n)=>{t.exports=n()})(yn,function s(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},a,l=!n.document&&!!n.postMessage,o=n.IS_PAPA_WORKER||!1,m={},u=0,c={};function p(d){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(i){var g=H(i);g.chunkSize=parseInt(g.chunkSize),i.step||i.chunk||(g.chunkSize=null),this._handle=new E(g),(this._handle.streamer=this)._config=g}).call(this,d),this.parseChunk=function(i,g){var C=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<C){let W=this._config.newline;W||(A=this._config.quoteChar||'"',W=this._handle.guessLineEndings(i,A)),i=[...i.split(W).slice(C)].join(W)}this.isFirstChunk&&V(this._config.beforeFirstChunk)&&(A=this._config.beforeFirstChunk(i))!==void 0&&(i=A),this.isFirstChunk=!1,this._halted=!1;var C=this._partialLine+i,A=(this._partialLine="",this._handle.parse(C,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(i=A.meta.cursor,C=(this._finished||(this._partialLine=C.substring(i-this._baseIndex),this._baseIndex=i),A&&A.data&&(this._rowCount+=A.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)n.postMessage({results:A,workerId:c.WORKER_ID,finished:C});else if(V(this._config.chunk)&&!g){if(this._config.chunk(A,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=A=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(A.data),this._completeResults.errors=this._completeResults.errors.concat(A.errors),this._completeResults.meta=A.meta),this._completed||!C||!V(this._config.complete)||A&&A.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),C||A&&A.meta.paused||this._nextChunk(),A}this._halted=!0},this._sendError=function(i){V(this._config.error)?this._config.error(i):o&&this._config.error&&n.postMessage({workerId:c.WORKER_ID,error:i,finished:!1})}}function f(d){var i;(d=d||{}).chunkSize||(d.chunkSize=c.RemoteChunkSize),p.call(this,d),this._nextChunk=l?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(g){this._input=g,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(i=new XMLHttpRequest,this._config.withCredentials&&(i.withCredentials=this._config.withCredentials),l||(i.onload=_(this._chunkLoaded,this),i.onerror=_(this._chunkError,this)),i.open(this._config.downloadRequestBody?"POST":"GET",this._input,!l),this._config.downloadRequestHeaders){var g,C=this._config.downloadRequestHeaders;for(g in C)i.setRequestHeader(g,C[g])}var A;this._config.chunkSize&&(A=this._start+this._config.chunkSize-1,i.setRequestHeader("Range","bytes="+this._start+"-"+A));try{i.send(this._config.downloadRequestBody)}catch(W){this._chunkError(W.message)}l&&i.status===0&&this._chunkError()}},this._chunkLoaded=function(){i.readyState===4&&(i.status<200||400<=i.status?this._chunkError():(this._start+=this._config.chunkSize||i.responseText.length,this._finished=!this._config.chunkSize||this._start>=(g=>(g=g.getResponseHeader("Content-Range"))!==null?parseInt(g.substring(g.lastIndexOf("/")+1)):-1)(i),this.parseChunk(i.responseText)))},this._chunkError=function(g){g=i.statusText||g,this._sendError(new Error(g))}}function S(d){(d=d||{}).chunkSize||(d.chunkSize=c.LocalChunkSize),p.call(this,d);var i,g,C=typeof FileReader<"u";this.stream=function(A){this._input=A,g=A.slice||A.webkitSlice||A.mozSlice,C?((i=new FileReader).onload=_(this._chunkLoaded,this),i.onerror=_(this._chunkError,this)):i=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var A=this._input,W=(this._config.chunkSize&&(W=Math.min(this._start+this._config.chunkSize,this._input.size),A=g.call(A,this._start,W)),i.readAsText(A,this._config.encoding));C||this._chunkLoaded({target:{result:W}})},this._chunkLoaded=function(A){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(A.target.result)},this._chunkError=function(){this._sendError(i.error)}}function k(d){var i;p.call(this,d=d||{}),this.stream=function(g){return i=g,this._nextChunk()},this._nextChunk=function(){var g,C;if(!this._finished)return g=this._config.chunkSize,i=g?(C=i.substring(0,g),i.substring(g)):(C=i,""),this._finished=!i,this.parseChunk(C)}}function M(d){p.call(this,d=d||{});var i=[],g=!0,C=!1;this.pause=function(){p.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){p.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(A){this._input=A,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){C&&i.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),i.length?this.parseChunk(i.shift()):g=!0},this._streamData=_(function(A){try{i.push(typeof A=="string"?A:A.toString(this._config.encoding)),g&&(g=!1,this._checkIsFinished(),this.parseChunk(i.shift()))}catch(W){this._streamError(W)}},this),this._streamError=_(function(A){this._streamCleanUp(),this._sendError(A)},this),this._streamEnd=_(function(){this._streamCleanUp(),C=!0,this._streamData("")},this),this._streamCleanUp=_(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function E(d){var i,g,C,A,W=Math.pow(2,53),X=-W,ae=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,R=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,v=this,$=0,h=0,D=!1,y=!1,I=[],x={data:[],errors:[],meta:{}};function B(Y){return d.skipEmptyLines==="greedy"?Y.join("").trim()==="":Y.length===1&&Y[0].length===0}function q(){if(x&&C&&(Z("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+c.DefaultDelimiter+"'"),C=!1),d.skipEmptyLines&&(x.data=x.data.filter(function(N){return!B(N)})),K()){let N=function(re,G){V(d.transformHeader)&&(re=d.transformHeader(re,G)),I.push(re)};if(x)if(Array.isArray(x.data[0])){for(var Y=0;K()&&Y<x.data.length;Y++)x.data[Y].forEach(N);x.data.splice(0,1)}else x.data.forEach(N)}function L(N,re){for(var G=d.header?{}:[],te=0;te<N.length;te++){var se=te,Q=N[te],Q=((je,J)=>(ie=>(d.dynamicTypingFunction&&d.dynamicTyping[ie]===void 0&&(d.dynamicTyping[ie]=d.dynamicTypingFunction(ie)),(d.dynamicTyping[ie]||d.dynamicTyping)===!0))(je)?J==="true"||J==="TRUE"||J!=="false"&&J!=="FALSE"&&((ie=>{if(ae.test(ie)&&(ie=parseFloat(ie),X<ie&&ie<W))return 1})(J)?parseFloat(J):R.test(J)?new Date(J):J===""?null:J):J)(se=d.header?te>=I.length?"__parsed_extra":I[te]:se,Q=d.transform?d.transform(Q,se):Q);se==="__parsed_extra"?(G[se]=G[se]||[],G[se].push(Q)):G[se]=Q}return d.header&&(te>I.length?Z("FieldMismatch","TooManyFields","Too many fields: expected "+I.length+" fields but parsed "+te,h+re):te<I.length&&Z("FieldMismatch","TooFewFields","Too few fields: expected "+I.length+" fields but parsed "+te,h+re)),G}var U;x&&(d.header||d.dynamicTyping||d.transform)&&(U=1,!x.data.length||Array.isArray(x.data[0])?(x.data=x.data.map(L),U=x.data.length):x.data=L(x.data,0),d.header&&x.meta&&(x.meta.fields=I),h+=U)}function K(){return d.header&&I.length===0}function Z(Y,L,U,N){Y={type:Y,code:L,message:U},N!==void 0&&(Y.row=N),x.errors.push(Y)}V(d.step)&&(A=d.step,d.step=function(Y){x=Y,K()?q():(q(),x.data.length!==0&&($+=Y.data.length,d.preview&&$>d.preview?g.abort():(x.data=x.data[0],A(x,v))))}),this.parse=function(Y,L,U){var N=d.quoteChar||'"',N=(d.newline||(d.newline=this.guessLineEndings(Y,N)),C=!1,d.delimiter?V(d.delimiter)&&(d.delimiter=d.delimiter(Y),x.meta.delimiter=d.delimiter):((N=((re,G,te,se,Q)=>{var je,J,ie,Le;Q=Q||[",","	","|",";",c.RECORD_SEP,c.UNIT_SEP];for(var Ge=0;Ge<Q.length;Ge++){for(var we,et=Q[Ge],xe=0,Te=0,fe=0,ye=(ie=void 0,new w({comments:se,delimiter:et,newline:G,preview:10}).parse(re)),$e=0;$e<ye.data.length;$e++)te&&B(ye.data[$e])?fe++:(we=ye.data[$e].length,Te+=we,ie===void 0?ie=we:0<we&&(xe+=Math.abs(we-ie),ie=we));0<ye.data.length&&(Te/=ye.data.length-fe),(J===void 0||xe<=J)&&(Le===void 0||Le<Te)&&1.99<Te&&(J=xe,je=et,Le=Te)}return{successful:!!(d.delimiter=je),bestDelimiter:je}})(Y,d.newline,d.skipEmptyLines,d.comments,d.delimitersToGuess)).successful?d.delimiter=N.bestDelimiter:(C=!0,d.delimiter=c.DefaultDelimiter),x.meta.delimiter=d.delimiter),H(d));return d.preview&&d.header&&N.preview++,i=Y,g=new w(N),x=g.parse(i,L,U),q(),D?{meta:{paused:!0}}:x||{meta:{paused:!1}}},this.paused=function(){return D},this.pause=function(){D=!0,g.abort(),i=V(d.chunk)?"":i.substring(g.getCharIndex())},this.resume=function(){v.streamer._halted?(D=!1,v.streamer.parseChunk(i,!0)):setTimeout(v.resume,3)},this.aborted=function(){return y},this.abort=function(){y=!0,g.abort(),x.meta.aborted=!0,V(d.complete)&&d.complete(x),i=""},this.guessLineEndings=function(re,N){re=re.substring(0,1048576);var N=new RegExp(z(N)+"([^]*?)"+z(N),"gm"),U=(re=re.replace(N,"")).split("\r"),N=re.split(`
`),re=1<N.length&&N[0].length<U[0].length;if(U.length===1||re)return`
`;for(var G=0,te=0;te<U.length;te++)U[te][0]===`
`&&G++;return G>=U.length/2?`\r
`:"\r"}}function z(d){return d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function w(d){var i=(d=d||{}).delimiter,g=d.newline,C=d.comments,A=d.step,W=d.preview,X=d.fastMode,ae=null,R=!1,v=d.quoteChar==null?'"':d.quoteChar,$=v;if(d.escapeChar!==void 0&&($=d.escapeChar),(typeof i!="string"||-1<c.BAD_DELIMITERS.indexOf(i))&&(i=","),C===i)throw new Error("Comment character same as delimiter");C===!0?C="#":(typeof C!="string"||-1<c.BAD_DELIMITERS.indexOf(C))&&(C=!1),g!==`
`&&g!=="\r"&&g!==`\r
`&&(g=`
`);var h=0,D=!1;this.parse=function(y,I,x){if(typeof y!="string")throw new Error("Input must be a string");var B=y.length,q=i.length,K=g.length,Z=C.length,Y=V(A),L=[],U=[],N=[],re=h=0;if(!y)return xe();if(X||X!==!1&&y.indexOf(v)===-1){for(var G=y.split(g),te=0;te<G.length;te++){if(N=G[te],h+=N.length,te!==G.length-1)h+=g.length;else if(x)return xe();if(!C||N.substring(0,Z)!==C){if(Y){if(L=[],Le(N.split(i)),Te(),D)return xe()}else Le(N.split(i));if(W&&W<=te)return L=L.slice(0,W),xe(!0)}}return xe()}for(var se=y.indexOf(i,h),Q=y.indexOf(g,h),je=new RegExp(z($)+z(v),"g"),J=y.indexOf(v,h);;)if(y[h]===v)for(J=h,h++;;){if((J=y.indexOf(v,J+1))===-1)return x||U.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:L.length,index:h}),we();if(J===B-1)return we(y.substring(h,J).replace(je,v));if(v===$&&y[J+1]===$)J++;else if(v===$||J===0||y[J-1]!==$){se!==-1&&se<J+1&&(se=y.indexOf(i,J+1));var ie=Ge((Q=Q!==-1&&Q<J+1?y.indexOf(g,J+1):Q)===-1?se:Math.min(se,Q));if(y.substr(J+1+ie,q)===i){N.push(y.substring(h,J).replace(je,v)),y[h=J+1+ie+q]!==v&&(J=y.indexOf(v,h)),se=y.indexOf(i,h),Q=y.indexOf(g,h);break}if(ie=Ge(Q),y.substring(J+1+ie,J+1+ie+K)===g){if(N.push(y.substring(h,J).replace(je,v)),et(J+1+ie+K),se=y.indexOf(i,h),J=y.indexOf(v,h),Y&&(Te(),D))return xe();if(W&&L.length>=W)return xe(!0);break}U.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:L.length,index:h}),J++}}else if(C&&N.length===0&&y.substring(h,h+Z)===C){if(Q===-1)return xe();h=Q+K,Q=y.indexOf(g,h),se=y.indexOf(i,h)}else if(se!==-1&&(se<Q||Q===-1))N.push(y.substring(h,se)),h=se+q,se=y.indexOf(i,h);else{if(Q===-1)break;if(N.push(y.substring(h,Q)),et(Q+K),Y&&(Te(),D))return xe();if(W&&L.length>=W)return xe(!0)}return we();function Le(fe){L.push(fe),re=h}function Ge(fe){var ye=0;return ye=fe!==-1&&(fe=y.substring(J+1,fe))&&fe.trim()===""?fe.length:ye}function we(fe){return x||(fe===void 0&&(fe=y.substring(h)),N.push(fe),h=B,Le(N),Y&&Te()),xe()}function et(fe){h=fe,Le(N),N=[],Q=y.indexOf(g,h)}function xe(fe){if(d.header&&!I&&L.length&&!R){var ye=L[0],$e={},jt=new Set(ye);let Ut=!1;for(let Je=0;Je<ye.length;Je++){let Fe=ye[Je];if($e[Fe=V(d.transformHeader)?d.transformHeader(Fe,Je):Fe]){let tt,Ht=$e[Fe];for(;tt=Fe+"_"+Ht,Ht++,jt.has(tt););jt.add(tt),ye[Je]=tt,$e[Fe]++,Ut=!0,(ae=ae===null?{}:ae)[tt]=Fe}else $e[Fe]=1,ye[Je]=Fe;jt.add(Fe)}Ut&&console.warn("Duplicate headers found and renamed."),R=!0}return{data:L,errors:U,meta:{delimiter:i,linebreak:g,aborted:D,truncated:!!fe,cursor:re+(I||0),renamedHeaders:ae}}}function Te(){A(xe()),L=[],U=[]}},this.abort=function(){D=!0},this.getCharIndex=function(){return h}}function P(d){var i=d.data,g=m[i.workerId],C=!1;if(i.error)g.userError(i.error,i.file);else if(i.results&&i.results.data){var A={abort:function(){C=!0,O(i.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:F,resume:F};if(V(g.userStep)){for(var W=0;W<i.results.data.length&&(g.userStep({data:i.results.data[W],errors:i.results.errors,meta:i.results.meta},A),!C);W++);delete i.results}else V(g.userChunk)&&(g.userChunk(i.results,A,i.file),delete i.results)}i.finished&&!C&&O(i.workerId,i.results)}function O(d,i){var g=m[d];V(g.userComplete)&&g.userComplete(i),g.terminate(),delete m[d]}function F(){throw new Error("Not implemented.")}function H(d){if(typeof d!="object"||d===null)return d;var i,g=Array.isArray(d)?[]:{};for(i in d)g[i]=H(d[i]);return g}function _(d,i){return function(){d.apply(i,arguments)}}function V(d){return typeof d=="function"}return c.parse=function(d,i){var g=(i=i||{}).dynamicTyping||!1;if(V(g)&&(i.dynamicTypingFunction=g,g={}),i.dynamicTyping=g,i.transform=!!V(i.transform)&&i.transform,!i.worker||!c.WORKERS_SUPPORTED)return g=null,c.NODE_STREAM_INPUT,typeof d=="string"?(d=(C=>C.charCodeAt(0)!==65279?C:C.slice(1))(d),g=new(i.download?f:k)(i)):d.readable===!0&&V(d.read)&&V(d.on)?g=new M(i):(n.File&&d instanceof File||d instanceof Object)&&(g=new S(i)),g.stream(d);(g=(()=>{var C;return!!c.WORKERS_SUPPORTED&&(C=(()=>{var A=n.URL||n.webkitURL||null,W=s.toString();return c.BLOB_URL||(c.BLOB_URL=A.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",W,")();"],{type:"text/javascript"})))})(),(C=new n.Worker(C)).onmessage=P,C.id=u++,m[C.id]=C)})()).userStep=i.step,g.userChunk=i.chunk,g.userComplete=i.complete,g.userError=i.error,i.step=V(i.step),i.chunk=V(i.chunk),i.complete=V(i.complete),i.error=V(i.error),delete i.worker,g.postMessage({input:d,config:i,workerId:g.id})},c.unparse=function(d,i){var g=!1,C=!0,A=",",W=`\r
`,X='"',ae=X+X,R=!1,v=null,$=!1,h=((()=>{if(typeof i=="object"){if(typeof i.delimiter!="string"||c.BAD_DELIMITERS.filter(function(I){return i.delimiter.indexOf(I)!==-1}).length||(A=i.delimiter),typeof i.quotes!="boolean"&&typeof i.quotes!="function"&&!Array.isArray(i.quotes)||(g=i.quotes),typeof i.skipEmptyLines!="boolean"&&typeof i.skipEmptyLines!="string"||(R=i.skipEmptyLines),typeof i.newline=="string"&&(W=i.newline),typeof i.quoteChar=="string"&&(X=i.quoteChar),typeof i.header=="boolean"&&(C=i.header),Array.isArray(i.columns)){if(i.columns.length===0)throw new Error("Option columns is empty");v=i.columns}i.escapeChar!==void 0&&(ae=i.escapeChar+X),i.escapeFormulae instanceof RegExp?$=i.escapeFormulae:typeof i.escapeFormulae=="boolean"&&i.escapeFormulae&&($=/^[=+\-@\t\r].*$/)}})(),new RegExp(z(X),"g"));if(typeof d=="string"&&(d=JSON.parse(d)),Array.isArray(d)){if(!d.length||Array.isArray(d[0]))return D(null,d,R);if(typeof d[0]=="object")return D(v||Object.keys(d[0]),d,R)}else if(typeof d=="object")return typeof d.data=="string"&&(d.data=JSON.parse(d.data)),Array.isArray(d.data)&&(d.fields||(d.fields=d.meta&&d.meta.fields||v),d.fields||(d.fields=Array.isArray(d.data[0])?d.fields:typeof d.data[0]=="object"?Object.keys(d.data[0]):[]),Array.isArray(d.data[0])||typeof d.data[0]=="object"||(d.data=[d.data])),D(d.fields||[],d.data||[],R);throw new Error("Unable to serialize unrecognized input");function D(I,x,B){var q="",K=(typeof I=="string"&&(I=JSON.parse(I)),typeof x=="string"&&(x=JSON.parse(x)),Array.isArray(I)&&0<I.length),Z=!Array.isArray(x[0]);if(K&&C){for(var Y=0;Y<I.length;Y++)0<Y&&(q+=A),q+=y(I[Y],Y);0<x.length&&(q+=W)}for(var L=0;L<x.length;L++){var U=(K?I:x[L]).length,N=!1,re=K?Object.keys(x[L]).length===0:x[L].length===0;if(B&&!K&&(N=B==="greedy"?x[L].join("").trim()==="":x[L].length===1&&x[L][0].length===0),B==="greedy"&&K){for(var G=[],te=0;te<U;te++){var se=Z?I[te]:te;G.push(x[L][se])}N=G.join("").trim()===""}if(!N){for(var Q=0;Q<U;Q++){0<Q&&!re&&(q+=A);var je=K&&Z?I[Q]:Q;q+=y(x[L][je],Q)}L<x.length-1&&(!B||0<U&&!re)&&(q+=W)}}return q}function y(I,x){var B,q;return I==null?"":I.constructor===Date?JSON.stringify(I).slice(1,25):(q=!1,$&&typeof I=="string"&&$.test(I)&&(I="'"+I,q=!0),B=I.toString().replace(h,ae),(q=q||g===!0||typeof g=="function"&&g(I,x)||Array.isArray(g)&&g[x]||((K,Z)=>{for(var Y=0;Y<Z.length;Y++)if(-1<K.indexOf(Z[Y]))return!0;return!1})(B,c.BAD_DELIMITERS)||-1<B.indexOf(A)||B.charAt(0)===" "||B.charAt(B.length-1)===" ")?X+B+X:B)}},c.RECORD_SEP="",c.UNIT_SEP="",c.BYTE_ORDER_MARK="\uFEFF",c.BAD_DELIMITERS=["\r",`
`,'"',c.BYTE_ORDER_MARK],c.WORKERS_SUPPORTED=!l&&!!n.Worker,c.NODE_STREAM_INPUT=1,c.LocalChunkSize=10485760,c.RemoteChunkSize=5242880,c.DefaultDelimiter=",",c.Parser=w,c.ParserHandle=E,c.NetworkStreamer=f,c.FileStreamer=S,c.StringStreamer=k,c.ReadableStreamStreamer=M,n.jQuery&&((a=n.jQuery).fn.parse=function(d){var i=d.config||{},g=[];return this.each(function(W){if(!(a(this).prop("tagName").toUpperCase()==="INPUT"&&a(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var X=0;X<this.files.length;X++)g.push({file:this.files[X],inputElem:this,instanceConfig:a.extend({},i)})}),C(),this;function C(){if(g.length===0)V(d.complete)&&d.complete();else{var W,X,ae,R,v=g[0];if(V(d.before)){var $=d.before(v.file,v.inputElem);if(typeof $=="object"){if($.action==="abort")return W="AbortError",X=v.file,ae=v.inputElem,R=$.reason,void(V(d.error)&&d.error({name:W},X,ae,R));if($.action==="skip")return void A();typeof $.config=="object"&&(v.instanceConfig=a.extend(v.instanceConfig,$.config))}else if($==="skip")return void A()}var h=v.instanceConfig.complete;v.instanceConfig.complete=function(D){V(h)&&h(D,v.file,v.inputElem),A()},c.parse(v.file,v.instanceConfig)}}function A(){g.splice(0,1),C()}}),o&&(n.onmessage=function(d){d=d.data,c.WORKER_ID===void 0&&d&&(c.WORKER_ID=d.workerId),typeof d.input=="string"?n.postMessage({workerId:c.WORKER_ID,results:c.parse(d.input,d.config),finished:!0}):(n.File&&d.input instanceof File||d.input instanceof Object)&&(d=c.parse(d.input,d.config))&&n.postMessage({workerId:c.WORKER_ID,results:d,finished:!0})}),(f.prototype=Object.create(p.prototype)).constructor=f,(S.prototype=Object.create(p.prototype)).constructor=S,(k.prototype=Object.create(k.prototype)).constructor=k,(M.prototype=Object.create(p.prototype)).constructor=M,c})}(ft)),ft.exports}var vn=bn();const jn=Ar(vn),Sn=async(t,r)=>{switch(r){case"csv":return Cn(t);case"excel":return wn(t);case"json":return Tn(t);case"xml":return Fn(t);case"pdf":return En(t);case"txt":return Dn(t);default:throw new Error(`Unsupported file type: ${r}`)}},Cn=t=>new Promise((r,s)=>{jn.parse(t,{header:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:n=>{const a=n.meta.fields||[],l=n.data;r({columns:a,data:l.slice(0,100)})},error:n=>{s(new Error(`Error parsing CSV: ${n.message}`))}})}),wn=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=async a=>{var l;try{const o=(l=a.target)==null?void 0:l.result;if(!o){s(new Error("Failed to read Excel file"));return}const m=await pr(()=>import("./xlsx-DkH2s96g.js"),[]),u=m.read(o,{type:"array"}),c=u.SheetNames[0],p=u.Sheets[c],f=m.utils.sheet_to_json(p,{header:1});if(f.length===0){s(new Error("Excel file is empty"));return}const S=f[0].map(String),k=f.slice(1).map(M=>{const E={};return M.forEach((z,w)=>{w<S.length&&(E[S[w]]=z)}),E});r({columns:S,data:k.slice(0,100)})}catch(o){s(new Error(`Error parsing Excel file: ${o instanceof Error?o.message:"Unknown error"}`))}},n.onerror=()=>{s(new Error("Error reading Excel file"))},n.readAsArrayBuffer(t)}),Tn=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=a=>{var l;try{const o=(l=a.target)==null?void 0:l.result,m=JSON.parse(o);if(Array.isArray(m)){if(m.length===0){s(new Error("JSON file contains an empty array"));return}const u=Array.from(new Set(m.flatMap(c=>Object.keys(c))));r({columns:u,data:m.slice(0,100)})}else if(m&&typeof m=="object"){const u=Object.keys(m).find(c=>Array.isArray(m[c]));if(u&&m[u].length>0){const c=m[u],p=Array.from(new Set(c.flatMap(f=>Object.keys(f))));r({columns:p,data:c.slice(0,100)})}else{const c=Object.keys(m);r({columns:c,data:[m]})}}else s(new Error("JSON file format not recognized"))}catch(o){s(new Error(`Error parsing JSON file: ${o instanceof Error?o.message:"Invalid JSON"}`))}},n.onerror=()=>{s(new Error("Error reading JSON file"))},n.readAsText(t)}),Fn=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=a=>{var l,o;try{const m=(l=a.target)==null?void 0:l.result,c=new DOMParser().parseFromString(m,"text/xml"),p=c.getElementsByTagName("*"),f=new Map;for(let O=0;O<p.length;O++){const F=p[O].tagName;f.set(F,(f.get(F)||0)+1)}const S=Array.from(f.entries()).filter(([O,F])=>F>1).map(([O])=>O).sort((O,F)=>(f.get(F)||0)-(f.get(O)||0));if(S.length===0){s(new Error("Could not identify repeating elements in XML"));return}const k=S[0],M=c.getElementsByTagName(k);if(M.length===0){s(new Error(`No elements found with tag ${k}`));return}const E=M[0],w=Array.from(E.children).map(O=>O.tagName),P=[];for(let O=0;O<Math.min(M.length,100);O++){const F=M[O],H={};for(const _ of w){const V=((o=F.getElementsByTagName(_)[0])==null?void 0:o.textContent)||"";H[_]=V}P.push(H)}r({columns:w,data:P})}catch(m){s(new Error(`Error parsing XML file: ${m instanceof Error?m.message:"Invalid XML"}`))}},n.onerror=()=>{s(new Error("Error reading XML file"))},n.readAsText(t)}),En=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=async a=>{var l;try{if(!((l=a.target)==null?void 0:l.result)){s(new Error("Failed to read PDF file"));return}r({columns:["Information"],data:[{Information:"PDF files are not currently supported for direct parsing in the browser."},{Information:"Please convert your PDF to CSV, Excel, or JSON format for processing."},{Information:"Alternatively, copy and paste the data from your PDF into a text file."},{Information:`File name: ${t.name}`},{Information:`File size: ${(t.size/1024).toFixed(2)} KB`},{Information:"Supported formats: CSV, Excel (.xlsx, .xls), JSON, XML, TXT"}]})}catch(o){s(new Error(`Error processing PDF: ${o instanceof Error?o.message:"Unknown error"}`))}},n.onerror=()=>{s(new Error("Error reading PDF file"))},n.readAsArrayBuffer(t)}),Dn=t=>new Promise((r,s)=>{const n=new FileReader;n.onload=a=>{var l;try{const o=(l=a.target)==null?void 0:l.result;if(!o){s(new Error("Failed to read text file"));return}const m=o.split(`
`).map(f=>f.trim()).filter(f=>f.length>0);if(m.length===0){s(new Error("Text file is empty"));return}const u=[",","	","|",";"];let c="",p=0;for(const f of u){const S=m.slice(0,10).map(E=>E.split(f).length),k=S.reduce((E,z)=>E+z,0)/S.length;S.every(E=>Math.abs(E-k)<=1&&E>1)&&k>p&&(p=k,c=f)}if(c&&p>1){const f=m[0].split(c).map(k=>k.trim()),S=[];for(let k=1;k<Math.min(m.length,100);k++){const M=m[k].split(c).map(z=>z.trim()),E={};for(let z=0;z<f.length;z++)E[f[z]]=M[z]||"";S.push(E)}r({columns:f,data:S})}else{const f=m.slice(0,100).map((S,k)=>({LineNumber:k+1,Text:S}));r({columns:["LineNumber","Text"],data:f})}}catch(o){s(new Error(`Error parsing text file: ${o instanceof Error?o.message:"Unknown error"}`))}},n.onerror=()=>{s(new Error("Error reading text file"))},n.readAsText(t)}),Rn=()=>{const t=ut(),r=He(n=>n.formatter.selectedTool),s=n=>{const a=n.target.value,l=Yt.find(o=>o.id===a);l&&t(Lr(l))};return e.jsxs(j,{sx:{my:3},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"Select Target Tool"}),e.jsxs(le,{container:!0,spacing:2,children:[e.jsx(le,{size:{xs:12,md:6},children:e.jsxs(Ue,{fullWidth:!0,children:[e.jsx(We,{id:"tool-select-label",children:"Tool"}),e.jsx(Ye,{labelId:"tool-select-label",id:"tool-select",value:(r==null?void 0:r.id)||"",label:"Tool",onChange:s,children:Yt.map(n=>e.jsx(oe,{value:n.id,children:n.name},n.id))})]})}),e.jsx(le,{size:12,children:r&&e.jsxs(he,{variant:"outlined",sx:{p:2,mt:2,borderColor:"primary.light"},children:[e.jsx(b,{variant:"subtitle1",gutterBottom:!0,children:r.name}),e.jsx(b,{variant:"body2",paragraph:!0,children:r.description}),e.jsxs(b,{variant:"body2",color:"text.secondary",children:["Required fields: ",r.requiredFields.map(n=>n.name).join(", ")]})]})})]})]})},In=()=>{const t=ut(),r=T.useRef(null),{sourceColumns:s,selectedTool:n}=He(O=>O.formatter),[a,l]=T.useState("csv"),[o,m]=T.useState(!1),[u,c]=T.useState(null),[p,f]=T.useState(null),S=O=>{l(O.target.value)},k=async O=>{var H;const F=(H=O.target.files)==null?void 0:H[0];if(F){f(F.name),m(!0),c(null);try{t(Me("uploading"));const _={id:`file-${Date.now()}`,name:F.name,type:a,size:F.size,lastModified:F.lastModified},{columns:V,data:d}=await Sn(F,a);t(Pr(_)),t(zr(V)),t(Nr(d)),t(Me("idle")),setTimeout(()=>{t(Be(1))},500)}catch(_){c(_ instanceof Error?_.message:"Failed to parse file"),t(Me("error"))}finally{m(!1)}}},M=()=>{var O;(O=r.current)==null||O.click()},E=O=>{var H;O.preventDefault(),O.stopPropagation();const F=(H=O.dataTransfer.files)==null?void 0:H[0];if(F&&r.current){const _=new DataTransfer;_.items.add(F),r.current.files=_.files,k({target:{files:_.files}})}},z=O=>{O.preventDefault(),O.stopPropagation()},w=()=>{t(Be(1))},P=s.length>0&&n!==null;return e.jsxs(j,{sx:{width:"100%"},children:[e.jsx(b,{variant:"h5",gutterBottom:!0,children:"Upload Data File"}),e.jsx(b,{variant:"body1",paragraph:!0,children:"Select a file to upload. The formatter supports CSV, Excel (.xlsx, .xls, .xlsm), PDF, JSON, XML, and plain text files."}),e.jsxs(le,{container:!0,spacing:3,children:[e.jsx(le,{size:{xs:12,md:4},children:e.jsxs(Ue,{fullWidth:!0,children:[e.jsx(We,{id:"file-type-select-label",children:"File Type"}),e.jsxs(Ye,{labelId:"file-type-select-label",id:"file-type-select",value:a,label:"File Type",onChange:S,children:[e.jsx(oe,{value:"csv",children:"CSV"}),e.jsx(oe,{value:"excel",children:"Excel (.xlsx/.xls/.xlsm)"}),e.jsx(oe,{value:"json",children:"JSON"}),e.jsx(oe,{value:"xml",children:"XML"}),e.jsx(oe,{value:"pdf",children:"PDF"}),e.jsx(oe,{value:"txt",children:"Text File"})]})]})}),e.jsxs(le,{size:12,children:[e.jsx("input",{type:"file",ref:r,onChange:k,style:{display:"none"},accept:a==="csv"?".csv":a==="excel"?".xlsx,.xls,.xlsm":a==="json"?".json":a==="xml"?".xml":a==="pdf"?".pdf":a==="txt"?".txt":void 0}),e.jsx(he,{elevation:0,onDrop:E,onDragOver:z,sx:{border:"2px dashed #ccc",borderRadius:2,p:3,textAlign:"center",cursor:"pointer",bgcolor:"#f8f9fa","&:hover":{borderColor:"primary.main"}},onClick:M,children:o?e.jsxs(j,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(Ze,{}),e.jsx(b,{variant:"body1",sx:{mt:2},children:"Processing file..."})]}):e.jsxs(j,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(qt,{fontSize:"large",color:"primary"}),e.jsx(b,{variant:"h6",sx:{mt:2},children:p?`Selected: ${p}`:"Drag & drop file here or click to browse"}),e.jsxs(b,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Supports ",a==="csv"?"CSV":a==="excel"?"Excel (.xlsx, .xls, .xlsm)":a==="json"?"JSON":a==="xml"?"XML":a==="pdf"?"PDF":"Text"," files"]})]})}),u&&e.jsx(pe,{severity:"error",sx:{mt:2},children:u}),p&&!o&&!u&&e.jsxs(pe,{severity:"success",sx:{mt:2},children:["File selected: ",p]})]}),e.jsx(le,{size:12,sx:{mt:2,display:"flex",justifyContent:"center"},children:e.jsx(ee,{variant:"contained",size:"large",onClick:M,startIcon:e.jsx(qt,{}),disabled:o,children:"Browse Files"})})]}),e.jsx(me,{sx:{my:4}}),e.jsx(Rn,{}),e.jsx(j,{sx:{display:"flex",justifyContent:"flex-end",mt:4},children:e.jsx(ee,{variant:"contained",size:"large",endIcon:e.jsx(Bt,{}),onClick:w,disabled:!P,children:"Continue to Field Mapping"})}),!P&&e.jsx(b,{variant:"body2",color:"text.secondary",sx:{mt:2,textAlign:"right"},children:s.length?"Select a target tool to continue":"Upload a file to continue"})]})},ot=ne(e.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"})),tr=t=>["dispatch_time","enroute_time","arrival_time","clear_time"].includes(t),rr=t=>["incident_date"].includes(t),kn=t=>{if(!t||typeof t!="string")return t;const r=[/^\d{1,2}\/\d{1,2}\/\d{4}\s+(\d{1,2}:\d{2}:\d{2})$/,/^\d{4}-\d{2}-\d{2}\s+(\d{1,2}:\d{2}:\d{2})$/,/^\d{1,2}\/\d{1,2}\/\d{4}\s+(\d{1,2}:\d{2})$/,/^\d{4}-\d{2}-\d{2}\s+(\d{1,2}:\d{2})$/,/^.+\s+(\d{1,2}:\d{2}(?::\d{2})?)$/];for(const n of r){const a=t.match(n);if(a&&a[1])return a[1]}return/^\d{1,2}:\d{2}(?::\d{2})?$/.test(t.trim())?t.trim():t},$n=t=>{if(!t||typeof t!="string")return t;const r=[/^(\d{1,2}\/\d{1,2}\/\d{4})\s+\d{1,2}:\d{2}(?::\d{2})?$/,/^(\d{4}-\d{2}-\d{2})\s+\d{1,2}:\d{2}(?::\d{2})?$/,/^([^\\s]+)\s+\d{1,2}:\d{2}(?::\d{2})?$/];for(const n of r){const a=t.match(n);if(a&&a[1])return a[1]}const s=[/^\d{1,2}\/\d{1,2}\/\d{4}$/,/^\d{4}-\d{2}-\d{2}$/];for(const n of s)if(n.test(t.trim()))return t.trim();return t},Er=(t,r)=>!t||!t.length||!r||!r.length?[]:t.map(s=>{const n={};return r.forEach(a=>{const{sourceField:l,targetField:o,transformations:m}=a;let u;if(l==="__default__"&&m&&m.length>0){const c=m.find(p=>p.type==="convert"&&p.params.defaultValue);c?(console.log(`Using default value for ${o}:`,c.params.defaultValue),u=c.params.defaultValue):(console.log(`No default value found for ${o}, using null`),u=null)}else u=s[l],console.log(`Using source value for ${o} from ${l}:`,u);if(m&&m.length>0){console.log(`Applying ${m.length} transformations to ${o}:`,m);const c=u;u=On(u,m,o),console.log(`Transformation result for ${o}:`,c,"→",u)}if(console.log(`🔧 CHECKING FIELD: ${o}, isTimeOnly: ${tr(o)}, isDateOnly: ${rr(o)}, value type: ${typeof u}`),u&&typeof u=="string")if(tr(o)){const c=kn(u);c!==u?(console.log(`🕒 Auto-extracted time for ${o}: "${u}" → "${c}"`),u=c):console.log(`🕒 No time extraction needed for ${o}: "${u}"`)}else if(rr(o)){const c=$n(u);c!==u?(console.log(`📅 Auto-extracted date for ${o}: "${u}" → "${c}"`),u=c):console.log(`📅 No date extraction needed for ${o}: "${u}"`)}else o==="incident_time"&&console.log(`🕒 Keeping full datetime for ${o}: "${u}"`);n[o]=u}),n}),On=(t,r,s)=>r.reduce((n,a)=>Dr(n,a,s),t),Dr=(t,r,s)=>{const{type:n,params:a}=r,l=s?{...a,fieldName:s}:a;switch(n){case"split":return An(t,l);case"join":return Ln(t,l);case"format":return Pn(t,l);case"convert":return zn(t,l);case"extract":return Mn(t,l);case"replace":return _n(t,l);default:return t}},Mn=(t,r)=>{if(typeof t!="string")return t;const{pattern:s}=r;try{const n=new RegExp(s),a=t.match(n);if(a&&a.length>0)return a[1]||a[0]}catch{console.error("Invalid regex pattern:",s)}return t},_n=(t,r)=>{if(typeof t!="string")return t;const{from:s,to:n="",useRegex:a=!1}=r;if(!s)return t;try{if(a){const l=new RegExp(s,"g");return t.replace(l,n)}else return t.replace(new RegExp(s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n)}catch(l){return console.error("Error in replace transformation:",l),t}},An=(t,r)=>{if(typeof t!="string")return t;const{delimiter:s,index:n}=r,a=t.split(s);return n!==void 0?a[n]||"":a},Ln=(t,r)=>{if(!Array.isArray(t))return t;const{delimiter:s=", "}=r;return t.join(s)},Pn=(t,r)=>{const{format:s,type:n,fieldName:a}=r;if(console.log("applyFormatTransformation called with:",{value:t,format:s,type:n,fieldName:a}),n==="date"&&t)try{const l=new Date(t);if(isNaN(l.getTime()))return t;switch(s){case"MM/DD/YYYY":return`${l.getMonth()+1}/${l.getDate()}/${l.getFullYear()}`;case"YYYY-MM-DD":return`${l.getFullYear()}-${(l.getMonth()+1).toString().padStart(2,"0")}-${l.getDate().toString().padStart(2,"0")}`;case"DD/MM/YYYY":return`${l.getDate()}/${l.getMonth()+1}/${l.getFullYear()}`;case"date-only":return l.toLocaleDateString();case"custom":return(r.customFormat||"YYYY-MM-DD").replace("YYYY",l.getFullYear().toString()).replace("MM",(l.getMonth()+1).toString().padStart(2,"0")).replace("DD",l.getDate().toString().padStart(2,"0")).replace("HH",l.getHours().toString().padStart(2,"0")).replace("mm",l.getMinutes().toString().padStart(2,"0")).replace("ss",l.getSeconds().toString().padStart(2,"0"));case"ISO":return l.toISOString();default:return t}}catch{return t}if(n==="number"&&t!==void 0&&t!==null)try{const l=Number(t);if(isNaN(l))return t;switch(s){case"integer":return Math.round(l);case"fixed2":return l.toFixed(2);case"currency":return`$${l.toFixed(2)}`;case"percent":return`${(l*100).toFixed(1)}%`;default:return t}}catch{return t}return t},zn=(t,r)=>{const{targetType:s}=r;switch(s){case"string":return t!=null?String(t):"";case"number":if(t==null||t==="")return null;const n=Number(t);return isNaN(n)?t:n;case"boolean":return typeof t=="string"?["true","yes","1","y"].includes(t.toLowerCase()):!!t;case"date":if(!t)return null;try{const a=new Date(t);return isNaN(a.getTime())?t:a}catch{return t}default:return t}},Nn=ne(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"})),Vn=({id:t,isMapped:r,targetFields:s,sampleValue:n,dataType:a})=>{const l={backgroundColor:r?"#f0f7ff":void 0,border:r?"1px solid #90caf9":"1px solid #e0e0e0",cursor:"grab",padding:"8px 12px",borderRadius:"4px",marginBottom:"8px",position:"relative"},o=u=>{console.log("DRAG START on source field:",t),u.dataTransfer.setData("text/plain",t),u.dataTransfer.effectAllowed="move",console.log("Verifying dataTransfer was set:",u.dataTransfer.types);const c=document.createElement("div");c.className="drag-ghost",c.innerHTML=`<div style="padding: 10px; background: #1976d2; color: white; border-radius: 4px;">Dragging: ${t}</div>`,document.body.appendChild(c),u.dataTransfer.setDragImage(c,20,20);const p=u.currentTarget;p.style.opacity="0.6",p.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.2)",setTimeout(()=>{document.body.removeChild(c)},0),console.log("Drag started with field:",t)},m=u=>{const c=u.currentTarget;c.style.opacity="",c.style.boxShadow="",console.log("Drag ended for field:",t)};return e.jsx("div",{style:l,"data-field-id":t,className:"draggable-source-field",draggable:!0,onDragStart:o,onDragEnd:m,children:e.jsxs(j,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsxs(j,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(b,{variant:"body2",fontWeight:"medium",children:t}),r&&e.jsx(de,{size:"small",icon:e.jsx(Nn,{fontSize:"small"}),label:s.length===1?s[0]:`${s.length} fields`,color:"primary",variant:"outlined"})]}),n!==void 0&&e.jsxs(j,{sx:{mt:.5,display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"0.75rem"},children:[e.jsx(b,{variant:"caption",sx:{color:"text.secondary",fontFamily:"monospace",bgcolor:"grey.100",px:.5,borderRadius:.5,maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:typeof n=="object"?JSON.stringify(n):String(n)}),a&&e.jsx(de,{label:a,size:"small",variant:"outlined",sx:{height:"16px",fontSize:"0.65rem","& .MuiChip-label":{px:.5,py:0}}})]})]})})},Bn=({sourceColumns:t,filter:r,setFilter:s,mappings:n,sampleData:a=[]})=>{const l=T.useMemo(()=>{if(!r)return t;const p=r.toLowerCase();return t.filter(f=>f.toLowerCase().includes(p))},[t,r]),o=T.useMemo(()=>{const p={};return n.forEach(f=>{p[f.sourceField]||(p[f.sourceField]=[]),p[f.sourceField].push(f.targetField)}),p},[n]),m=T.useMemo(()=>Object.keys(o).length,[o]),u=T.useMemo(()=>{if(!a||a.length===0)return{};const p=a[0],f={};return t.forEach(S=>{f[S]=p[S]}),f},[a,t]),c=T.useMemo(()=>{const p={};return Object.entries(u).forEach(([f,S])=>{if(S==null){p[f]="Unknown";return}if(typeof S=="string"){if([/^\d{4}-\d{2}-\d{2}$/,/^\d{1,2}\/\d{1,2}\/\d{2,4}$/,/^\d{4}\/\d{2}\/\d{2}$/].some(E=>E.test(S))){p[f]="Date";return}if([/^\d{1,2}:\d{2}(:\d{2})?$/,/^\d{1,2}:\d{2}(:\d{2})?\s*(AM|PM)$/i].some(E=>E.test(S))){p[f]="Time";return}if(!isNaN(Number(S))){p[f]="Number";return}p[f]="Text";return}typeof S=="number"?p[f]="Number":typeof S=="boolean"?p[f]="Boolean":Array.isArray(S)?p[f]="Array":typeof S=="object"?p[f]="Object":p[f]=typeof S}),p},[u]);return e.jsxs(he,{sx:{height:"100%",p:2,display:"flex",flexDirection:"column",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",border:"2px solid #e0e0e0",borderRadius:"8px",overflow:"hidden"},children:[e.jsx(be,{size:"small",placeholder:"Search source fields...",value:r,onChange:p=>s(p.target.value),fullWidth:!0,sx:{mb:2},InputProps:{startAdornment:e.jsx(Oe,{position:"start",children:e.jsx(it,{fontSize:"small"})})}}),e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(b,{variant:"body2",color:"text.secondary",children:[l.length," fields"]}),e.jsxs(b,{variant:"body2",color:"text.secondary",children:[m," mapped"]})]}),e.jsx(j,{sx:{mb:2,p:1,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1,border:"1px dashed",borderColor:"primary.main"},children:e.jsx(b,{variant:"body2",color:"primary",sx:{fontWeight:"bold"},children:"Drag fields from here to the Target Fields panel"})}),e.jsx(me,{sx:{mb:2}}),e.jsxs(j,{sx:{flexGrow:1,overflow:"auto",maxHeight:"calc(100% - 180px)",scrollbarWidth:"thin",border:"1px solid #e0e0e0",borderRadius:"4px",padding:"8px",backgroundColor:"#fafafa","&::-webkit-scrollbar":{width:"10px"},"&::-webkit-scrollbar-track":{background:"#f1f1f1",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{background:"#2196f3",borderRadius:"4px","&:hover":{background:"#1976d2"}}},children:[l.map(p=>e.jsx(Vn,{id:p,isMapped:!!o[p],targetFields:o[p]||[],sampleValue:u[p],dataType:c[p]},p)),l.length===0&&e.jsx(j,{sx:{textAlign:"center",py:4},children:e.jsx(b,{variant:"body2",color:"text.secondary",children:"No fields match your search"})})]})]})},Rr=ne(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"})),Un=ne(e.jsx("path",{d:"m20.5 10 .5-2h-4l1-4h-2l-1 4h-4l1-4h-2L9 8H5l-.5 2h4l-1 4h-4L3 16h4l-1 4h2l1-4h4l-1 4h2l1-4h4l.5-2h-4l1-4zm-7 4h-4l1-4h4z"})),Hn=ne(e.jsx("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"})),Wn=ne(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2m-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"})),Yn=({open:t,onClose:r,fieldName:s,mapping:n,sampleData:a,onSave:l})=>{const[o,m]=T.useState(0),[u,c]=T.useState([]),[p,f]=T.useState("auto"),[S,k]=T.useState(""),[M,E]=T.useState(","),[z,w]=T.useState(0),[P,O]=T.useState("string");T.useEffect(()=>{if(n){if(n.sourceField&&a.length>0){const i=a.map(g=>g[n.sourceField]).filter(g=>g!=null).slice(0,5);c(i)}n.transformations&&n.transformations.length>0&&n.transformations.forEach(i=>{switch(i.type){case"format":const g=i.params.format||i.params.dateFormat;g&&(g==="custom"?(f("custom"),k(i.params.customFormat||"")):f(g));break;case"split":E(i.params.delimiter||","),w(i.params.index||0);break;case"convert":O(i.params.toType||"string");break}})}},[n,a]);const F=(i,g)=>{m(g)},H=()=>{const i=[];o===0&&p!=="auto"&&i.push({type:"format",params:{type:"date",format:p,fieldName:s,...p==="custom"?{customFormat:S}:{}}}),o===1&&i.push({type:"split",params:{delimiter:M,index:z}}),o===2&&i.push({type:"convert",params:{toType:P}}),l(s,i)},_=u.length>0,d=(()=>{if(!_)return[];switch(o){case 0:return u.map(i=>{if(!i)return"N/A";try{const g=new Date(i);if(isNaN(g.getTime()))return"Invalid date";switch(p){case"auto":return g.toLocaleString();case"MM/DD/YYYY":return`${g.getMonth()+1}/${g.getDate()}/${g.getFullYear()}`;case"YYYY-MM-DD":return`${g.getFullYear()}-${(g.getMonth()+1).toString().padStart(2,"0")}-${g.getDate().toString().padStart(2,"0")}`;case"DD/MM/YYYY":return`${g.getDate()}/${g.getMonth()+1}/${g.getFullYear()}`;case"date-only":return new Date(i).toLocaleDateString();case"custom":return S.replace("YYYY",g.getFullYear().toString()).replace("MM",(g.getMonth()+1).toString().padStart(2,"0")).replace("DD",g.getDate().toString().padStart(2,"0")).replace("HH",g.getHours().toString().padStart(2,"0")).replace("mm",g.getMinutes().toString().padStart(2,"0")).replace("ss",g.getSeconds().toString().padStart(2,"0"));default:return g.toLocaleString()}}catch{return"Error formatting date"}});case 1:return u.map(i=>{if(!i)return"N/A";try{return i.toString().split(M)[z]||`Index ${z} not found`}catch{return"Error splitting value"}});case 2:return u.map(i=>{if(i==null)return"N/A";try{switch(P){case"string":return String(i);case"number":return Number(i);case"boolean":return(!!i).toString();default:return String(i)}}catch{return"Error converting value"}})}return[]})();return e.jsxs(lt,{open:t,onClose:r,maxWidth:"md",fullWidth:!0,children:[e.jsxs(at,{children:["Transform Field: ",s]}),e.jsx(ct,{dividers:!0,children:e.jsxs(j,{sx:{width:"100%"},children:[e.jsx(j,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(yt,{value:o,onChange:F,"aria-label":"transformation tabs",children:[e.jsx(Ee,{label:"Date/Time Format"}),e.jsx(Ee,{label:"Split/Extract"}),e.jsx(Ee,{label:"Type Conversion"})]})}),e.jsxs(j,{role:"tabpanel",hidden:o!==0,sx:{p:2},children:[e.jsx(b,{variant:"subtitle1",gutterBottom:!0,children:"Date Format Settings"}),e.jsx(b,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Choose how date and time values should be formatted. Date-only formats automatically strip time components."}),e.jsxs(Ue,{fullWidth:!0,sx:{mb:2},children:[e.jsx(We,{id:"date-format-label",children:"Date Format"}),e.jsxs(Ye,{labelId:"date-format-label",id:"date-format-select",value:p,label:"Date Format",onChange:i=>f(i.target.value),children:[e.jsx(oe,{value:"auto",children:"Auto-detect"}),e.jsx(oe,{value:"MM/DD/YYYY",children:"MM/DD/YYYY (date only)"}),e.jsx(oe,{value:"DD/MM/YYYY",children:"DD/MM/YYYY (date only)"}),e.jsx(oe,{value:"YYYY-MM-DD",children:"YYYY-MM-DD (date only)"}),e.jsx(oe,{value:"date-only",children:"Date Only (strip time)"}),e.jsx(oe,{value:"custom",children:"Custom Format"})]})]}),p==="custom"&&e.jsx(be,{fullWidth:!0,label:"Custom Format",value:S,onChange:i=>k(i.target.value),helperText:"Use YYYY for year, MM for month, DD for day, HH for hour, mm for minute, ss for second",sx:{mb:2}})]}),e.jsxs(j,{role:"tabpanel",hidden:o!==1,sx:{p:2},children:[e.jsx(b,{variant:"subtitle1",gutterBottom:!0,children:"Split or Extract Value"}),e.jsx(b,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Split a field by a delimiter and extract a specific part."}),e.jsx(be,{fullWidth:!0,label:"Delimiter",value:M,onChange:i=>E(i.target.value),helperText:"Character or text that separates the parts",sx:{mb:2}}),e.jsx(be,{fullWidth:!0,label:"Index",type:"number",value:z,onChange:i=>w(parseInt(i.target.value)||0),helperText:"Position of the part to extract (0 = first part)",sx:{mb:2}})]}),e.jsxs(j,{role:"tabpanel",hidden:o!==2,sx:{p:2},children:[e.jsx(b,{variant:"subtitle1",gutterBottom:!0,children:"Type Conversion"}),e.jsx(b,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Convert the value to a different data type."}),e.jsxs(Ue,{fullWidth:!0,sx:{mb:2},children:[e.jsx(We,{id:"convert-type-label",children:"Convert To"}),e.jsxs(Ye,{labelId:"convert-type-label",id:"convert-type-select",value:P,label:"Convert To",onChange:i=>O(i.target.value),children:[e.jsx(oe,{value:"string",children:"Text (String)"}),e.jsx(oe,{value:"number",children:"Number"}),e.jsx(oe,{value:"boolean",children:"True/False (Boolean)"})]})]})]}),e.jsx(me,{sx:{my:2}}),e.jsx(b,{variant:"subtitle1",gutterBottom:!0,children:"Preview"}),_?e.jsxs(j,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(j,{sx:{display:"flex",borderBottom:1,borderColor:"divider",pb:1},children:[e.jsx(b,{variant:"body2",fontWeight:"bold",sx:{width:"50%"},children:"Original Value"}),e.jsx(b,{variant:"body2",fontWeight:"bold",sx:{width:"50%"},children:"Transformed Value"})]}),u.map((i,g)=>e.jsxs(j,{sx:{display:"flex",py:1,borderBottom:"1px solid #eee"},children:[e.jsx(b,{variant:"body2",sx:{width:"50%"},children:i==null?"Null/Empty":String(i)}),e.jsx(b,{variant:"body2",sx:{width:"50%"},children:d[g]})]},g))]}):e.jsx(pe,{severity:"info",children:"No sample data available for preview."})]})}),e.jsxs(dt,{children:[e.jsx(ee,{onClick:r,children:"Cancel"}),e.jsx(ee,{onClick:H,variant:"contained",children:"Apply Transformation"})]})]})},qn=t=>{switch(t.dataType){case"string":return`DEFAULT-${t.name}`;case"number":return"0";case"boolean":return"false";case"date":return new Date().toISOString().split("T")[0];case"location":return"0.0,0.0";default:return""}},Gn=({open:t,onClose:r,unmappedRequiredFields:s,onAddDefaultMappings:n})=>{const[a,l]=T.useState(()=>{const c={};return s.forEach(p=>{c[p.name]=qn(p)}),c}),o=(c,p)=>{l(f=>({...f,[c]:p}))},m=()=>{console.log("Creating default mappings for fields:",s),console.log("Default values:",a);const c=s.map(p=>{const f={sourceField:"__default__",targetField:p.name,transformations:[{type:"convert",params:{defaultValue:a[p.name],targetType:p.dataType}}]};return console.log(`Created default mapping for ${p.name}:`,f),f});console.log("All default mappings:",c),n(c),r()},u=c=>{switch(c){case"number":return"number";case"date":return"date";default:return"text"}};return e.jsxs(lt,{open:t,onClose:r,"aria-labelledby":"default-value-dialog-title",maxWidth:"md",fullWidth:!0,children:[e.jsx(at,{id:"default-value-dialog-title",children:"Set Default Values for Required Fields"}),e.jsxs(ct,{children:[e.jsx(b,{variant:"body1",sx:{mb:3},children:"The following required fields don't have mappings. Please provide default values for them."}),e.jsx(le,{container:!0,spacing:3,children:s.map(c=>e.jsxs(le,{size:{xs:12,sm:6},children:[e.jsxs(j,{sx:{mb:1},children:[e.jsxs(b,{variant:"subtitle2",children:[c.name,e.jsx(de,{size:"small",label:c.dataType,color:"primary",variant:"outlined",sx:{ml:1}})]}),e.jsx(b,{variant:"caption",color:"text.secondary",children:c.description})]}),c.dataType==="boolean"?e.jsxs(be,{select:!0,fullWidth:!0,value:a[c.name]||"false",onChange:p=>o(c.name,p.target.value),variant:"outlined",size:"small",children:[e.jsx(oe,{value:"true",children:"True"}),e.jsx(oe,{value:"false",children:"False"})]}):e.jsx(be,{fullWidth:!0,value:a[c.name]||"",onChange:p=>o(c.name,p.target.value),type:u(c.dataType),variant:"outlined",size:"small",placeholder:`Enter default value for ${c.name}`,InputLabelProps:{shrink:!0}}),e.jsx(as,{children:"Default value for all records"})]},c.name))})]}),e.jsxs(dt,{children:[e.jsx(ee,{onClick:r,color:"primary",children:"Cancel"}),e.jsx(ee,{onClick:m,color:"primary",variant:"contained",children:"Apply Default Values"})]})]})},Jn=ne(e.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"})),At=ne(e.jsx("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.996.996 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"})),gt=ne(e.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"})),Ir=ne(e.jsx("path",{d:"M16.59 7.58 10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"})),Kn=({mapping:t,sampleData:r,onClose:s})=>{const n=Pt(),a=T.useMemo(()=>!t||!r.length?[]:r.slice(0,5).map(o=>({sourceValue:o[t.sourceField],transformedValue:(t.transformations||[]).reduce((m,u)=>Dr(m,u,t.targetField),o[t.sourceField])})),[t,r]);if(!t)return e.jsx(he,{sx:{p:2,mt:2,backgroundColor:ce(n.palette.info.light,.1),border:`1px dashed ${n.palette.info.main}`,borderRadius:1},children:e.jsx(b,{variant:"body2",color:"text.secondary",align:"center",children:"Select a field mapping to see transformation preview"})});if(!a.length||!t.sourceField)return e.jsx(he,{sx:{p:2,mt:2,backgroundColor:ce(n.palette.warning.light,.1),border:`1px dashed ${n.palette.warning.main}`,borderRadius:1},children:e.jsxs(b,{variant:"body2",color:"text.secondary",children:["No sample data available for ",t.sourceField||"this field"]})});const l=t.transformations||[];return e.jsxs(he,{sx:{p:2,mt:2,borderRadius:1,border:`1px solid ${n.palette.divider}`,boxShadow:n.shadows[1],position:"relative"},children:[s&&e.jsx(De,{size:"small",onClick:s,sx:{position:"absolute",top:8,right:8,color:n.palette.grey[500],"&:hover":{backgroundColor:ce(n.palette.grey[100],.9),color:n.palette.grey[800]}},"aria-label":"close preview",children:e.jsx(Yr,{fontSize:"small"})}),e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,pr:4},children:[e.jsxs(b,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:["Field Transformation Preview: ",t.targetField]}),e.jsx(de,{size:"small",label:`${l.length} transformation${l.length!==1?"s":""}`,color:l.length>0?"primary":"default",icon:l.length>0?e.jsx(At,{}):void 0})]}),e.jsx(me,{sx:{mb:2}}),e.jsx(j,{sx:{maxHeight:200,overflow:"auto"},children:a.map((o,m)=>{const u=o.sourceValue!==void 0&&o.sourceValue!==null,c=l.length>0,p=typeof o.sourceValue,f=typeof o.transformedValue,S=p!==f;return e.jsxs(j,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:m%2===0?ce(n.palette.background.default,.5):"transparent",display:"flex",alignItems:"center"},children:[e.jsxs(j,{sx:{flexBasis:"45%"},children:[e.jsxs(b,{variant:"caption",color:"text.secondary",children:["Source (",t.sourceField,")"]}),e.jsx(b,{variant:"body2",sx:{fontFamily:"monospace",backgroundColor:u?ce(n.palette.success.light,.1):ce(n.palette.error.light,.1),p:.5,borderRadius:.5,wordBreak:"break-all"},children:u?String(o.sourceValue):"(empty)"}),e.jsx(b,{variant:"caption",color:"text.secondary",children:p})]}),e.jsx(j,{sx:{flexBasis:"10%",textAlign:"center"},children:e.jsx(Jn,{color:c?"primary":"action"})}),e.jsxs(j,{sx:{flexBasis:"45%"},children:[e.jsxs(b,{variant:"caption",color:"text.secondary",children:["Result (",t.targetField,")"]}),e.jsx(b,{variant:"body2",sx:{fontFamily:"monospace",backgroundColor:o.transformedValue!==void 0?ce(n.palette.success.light,.1):ce(n.palette.error.light,.1),p:.5,borderRadius:.5,wordBreak:"break-all"},children:o.transformedValue!==void 0?String(o.transformedValue):"(empty)"}),e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsx(b,{variant:"caption",color:"text.secondary",children:f}),S&&e.jsx(de,{size:"small",label:`Type: ${p} → ${f}`,color:"warning",variant:"outlined",sx:{height:16,fontSize:"0.6rem"}})]})]})]},m)})}),l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(me,{sx:{my:2}}),e.jsx(b,{variant:"subtitle2",gutterBottom:!0,children:"Transformation Steps Applied:"}),e.jsx(j,{sx:{display:"flex",flexDirection:"column",gap:1},children:l.map((o,m)=>{var u,c,p,f,S,k,M,E,z;return e.jsxs(j,{sx:{display:"flex",alignItems:"center",p:1,borderRadius:1,backgroundColor:ce(n.palette.primary.light,.05),border:`1px solid ${ce(n.palette.primary.light,.2)}`},children:[e.jsxs(j,{sx:{mr:1,color:n.palette.primary.main},children:[m+1,"."]}),e.jsxs(b,{variant:"body2",children:[e.jsxs("strong",{children:[o.type,":"]})," "," ",o.type==="convert"&&((u=o.params)==null?void 0:u.dataType)&&`Convert to ${o.params.dataType}`,o.type==="convert"&&((c=o.params)==null?void 0:c.defaultValue)!==void 0&&`Set default value to "${o.params.defaultValue}"`,o.type==="format"&&((p=o.params)==null?void 0:p.type)==="date"&&(((f=o.params)==null?void 0:f.format)||((S=o.params)==null?void 0:S.dateFormat))&&`Format date as "${o.params.format||o.params.dateFormat}"${o.params.customFormat?` (${o.params.customFormat})`:""}`,o.type==="format"&&((k=o.params)==null?void 0:k.pattern)&&`Format using pattern "${o.params.pattern}"`,o.type==="extract"&&((M=o.params)==null?void 0:M.pattern)&&`Extract using pattern "${o.params.pattern}"`,o.type==="replace"&&((E=o.params)==null?void 0:E.from)&&((z=o.params)==null?void 0:z.to)&&`Replace "${o.params.from}" with "${o.params.to}"`]})]},m)})})]}),t.targetField&&e.jsxs(j,{sx:{mt:2,p:1,borderRadius:1,display:"flex",alignItems:"center",backgroundColor:a.some(o=>o.transformedValue===void 0||o.transformedValue===null)?ce(n.palette.warning.light,.1):ce(n.palette.success.light,.1)},children:[a.some(o=>o.transformedValue===void 0||o.transformedValue===null)?e.jsx(gt,{color:"warning",sx:{mr:1}}):e.jsx(Ir,{color:"success",sx:{mr:1}}),e.jsx(b,{variant:"body2",children:a.some(o=>o.transformedValue===void 0||o.transformedValue===null)?"Some values could not be transformed. Consider adding a default value.":"All sample values were successfully transformed."})]})]})},Xn=ne(e.jsx("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"})),Zn=ue(({className:t,...r})=>e.jsx(qr,{...r,classes:{popper:t}}))(()=>({"& .MuiTooltip-tooltip":{backgroundColor:"transparent",padding:0,maxWidth:320}})),Qn=ue(he)(({theme:t})=>({padding:t.spacing(2),backgroundColor:t.palette.background.paper,boxShadow:t.shadows[3],borderRadius:t.shape.borderRadius,border:`1px solid ${t.palette.divider}`,minWidth:200,maxWidth:320})),eo=ue(b)(({theme:t})=>({fontWeight:600,marginBottom:t.spacing(1),borderBottom:`1px solid ${t.palette.divider}`,paddingBottom:t.spacing(.5),color:t.palette.primary.main})),Ke=({title:t,children:r,content:s,icon:n=!1,placement:a="top",enterDelay:l=100,leaveDelay:o=100})=>{console.log(`EnhancedTooltip rendering: ${t} with icon=${n}`);const m=n?e.jsxs(j,{sx:{display:"inline-flex",alignItems:"center"},children:[r,e.jsx(Xn,{color:"action",fontSize:"small",sx:{ml:.5,opacity:.7}})]}):r;return e.jsx(Zn,{title:e.jsxs(Qn,{children:[e.jsx(eo,{variant:"subtitle2",children:t}),s]}),placement:a,arrow:!0,enterDelay:l,leaveDelay:o,children:m})},to=({toolConfig:t,showAllFields:r,setShowAllFields:s,filter:n,setFilter:a,mappings:l,onMappingChange:o,onRemoveMapping:m,validationErrors:u,sampleData:c,sourceColumns:p=[]})=>{const f=Pt();console.log("TargetFieldsPanel received sourceColumns:",p),console.log("TargetFieldsPanel received toolConfig:",t),console.log("TargetFieldsPanel received mappings:",l);const[S,k]=T.useState(null),[M,E]=T.useState(null),[z,w]=T.useState({Timing:!0,Location:!0,"Incident Details":!0}),P=T.useMemo(()=>{const h={};return u.forEach(D=>{h[D.field]={message:D.message,severity:D.severity}}),h},[u]),O=T.useMemo(()=>{const h={};return l.forEach(D=>{h[D.targetField]=D.sourceField}),h},[l]),F=T.useMemo(()=>{const h={};return[...t.requiredFields,...t.optionalFields].forEach(y=>{let I;y.dataType==="date"||y.name.toLowerCase().includes("time")||y.name.toLowerCase().includes("date")?I="Timing":y.dataType==="location"||y.name.toLowerCase().includes("lat")||y.name.toLowerCase().includes("lon")||y.name.toLowerCase().includes("address")?I="Location":I="Incident Details",h[I]||(h[I]=[]),h[I].push(y)}),h},[t]),H=T.useMemo(()=>{if(!n)return r?[...t.requiredFields,...t.optionalFields]:F;const h=n.toLowerCase(),y=[...t.requiredFields,...t.optionalFields].filter(x=>{var B;return x.name.toLowerCase().includes(h)||((B=x.description)==null?void 0:B.toLowerCase().includes(h))});if(r)return y;const I={};return y.forEach(x=>{let B;for(const[q,K]of Object.entries(F))if(K.some(Z=>Z.id===x.id)){B=q;break}B||(B="Other"),I[B]||(I[B]=[]),I[B].push(x)}),I},[t,n,r,F]),_=h=>{w({...z,[h]:!z[h]})},V=(h,D)=>{console.log("Dropdown selection - mapping",D,"to",h);try{if(!D){m(h);return}o({sourceField:D,targetField:h}),console.log("Mapping updated via dropdown successfully")}catch(y){console.error("Error updating mapping via dropdown:",y)}},d=h=>{k(h)},i=()=>{k(null)},g=h=>{E(D=>D===h?null:h)},C=(h,D)=>{const y=l.find(I=>I.targetField===h);y&&o({...y,transformations:D}),k(null)},A=h=>{switch(h){case"string":return{icon:e.jsx(Gt,{fontSize:"small"}),color:"info"};case"number":return{icon:e.jsx(Un,{fontSize:"small"}),color:"secondary"};case"date":return{icon:e.jsx(Hn,{fontSize:"small"}),color:"warning"};case"boolean":return{icon:e.jsx(Wn,{fontSize:"small"}),color:"success"};case"location":return{icon:e.jsx(cs,{fontSize:"small"}),color:"error"};default:return{icon:e.jsx(Gt,{fontSize:"small"}),color:"default"}}},W=h=>{const D=O[h.name],y=P[h.name],I=M===h.name;console.log(`Rendering field ${h.name}, mapped to: ${D||"none"}`);const x=L=>{L.preventDefault(),L.stopPropagation(),L.dataTransfer.dropEffect="move";const U=L.currentTarget;U.style.boxShadow="0 0 0 2px #1976d2",U.style.borderColor="#1976d2",U.style.backgroundColor="#f0f7ff",U.style.transform="scale(1.01)",U.style.transition="all 0.2s ease",console.log("DRAG OVER on target field:",h.name)},B=L=>{L.preventDefault(),L.stopPropagation();const U=L.currentTarget;U.style.boxShadow="",U.style.borderColor=y?y.severity==="error"?"#f44336":"#ff9800":D?"#4caf50":"#e0e0e0",U.style.backgroundColor=y?y.severity==="error"?"#fff5f5":"#fffbf0":D?"#f4fbf4":"#ffffff",U.style.transform="",console.log("DRAG LEAVE from field:",h.name)},q=L=>{L.preventDefault(),L.stopPropagation(),console.log("DROP EVENT TRIGGERED on field:",h.name);try{const U=L.dataTransfer.getData("text/plain");if(console.log("Dropped source field data:",U),!U){console.error("No source field data found in the drop event");return}const N=L.currentTarget;N.style.boxShadow="",N.style.borderColor="",N.style.backgroundColor="",N.style.transform="",o({sourceField:U,targetField:h.name}),E(h.name),N.style.boxShadow="0 0 0 2px #4caf50",N.style.borderColor="#4caf50",N.style.backgroundColor="#f4fbf4",N.style.transform="scale(1.02)";const re=U;setTimeout(()=>{try{re?(N.style.borderColor="#4caf50",N.style.backgroundColor="#f4fbf4"):(N.style.borderColor=y?y.severity==="error"?"#f44336":"#ff9800":"#e0e0e0",N.style.backgroundColor=y?y.severity==="error"?"#fff5f5":"#fffbf0":"#ffffff"),N.style.boxShadow="",N.style.transform=""}catch(G){console.error("Error in animation cleanup:",G)}},1e3),console.log(`Successfully dropped ${U} onto ${h.name}`)}catch(U){console.error("Error in drop handler:",U)}},K=()=>{D&&g(h.name)},Z=()=>e.jsxs(j,{children:[e.jsxs(b,{variant:"body2",children:[e.jsx("strong",{children:"Required Format:"})," ",h.format||"No specific format required"]}),h.examples&&e.jsxs(j,{sx:{mt:1},children:[e.jsx(b,{variant:"body2",children:e.jsx("strong",{children:"Examples:"})}),e.jsx(j,{component:"ul",sx:{mt:.5,pl:2},children:h.examples.map((L,U)=>e.jsx(j,{component:"li",children:e.jsx(b,{variant:"body2",fontFamily:"monospace",children:L})},U))})]}),h.validation&&e.jsxs(b,{variant:"body2",sx:{mt:1},children:[e.jsx("strong",{children:"Validation:"})," ",String(h.validation)]})]}),Y=()=>{let L="";switch(h.dataType){case"string":L="Text value. Can contain any characters.";break;case"number":L="Numeric value. Can be integer or decimal.";break;case"date":L="Date value. Should be in a standard format.";break;case"boolean":L="True/False value.";break;case"location":L="Geographic coordinates or address.";break;default:L=`${h.dataType} data type.`}return e.jsxs(j,{children:[e.jsx(b,{variant:"body2",children:L}),h.dataType==="date"&&e.jsx(b,{variant:"body2",sx:{mt:1},children:"Common formats: YYYY-MM-DD, MM/DD/YYYY"})]})};return e.jsxs(j,{sx:{p:2,mb:2,border:"1px solid",borderColor:y?y.severity==="error"?"error.main":"warning.main":D?"success.light":"divider",borderRadius:1,bgcolor:y?y.severity==="error"?ce(f.palette.error.light,.1):ce(f.palette.warning.light,.1):D?ce(f.palette.success.light,.1):"background.paper",position:"relative",transition:"all 0.3s ease",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",cursor:D?"pointer":"default",...I&&{boxShadow:"0 0 0 2px #1976d2",border:"1px solid #1976d2"},"&:hover":D?{boxShadow:"0 2px 4px rgba(0,0,0,0.1)",transform:"translateY(-2px)"}:{}},draggable:!1,id:`target-field-${h.name}`,"data-target-field":h.name,onDragOver:x,onDragLeave:B,onDrop:q,onClick:K,children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(j,{children:[e.jsx(Ke,{title:`${h.name} Field`,content:Z(),placement:"top-start",icon:!0,children:e.jsxs(b,{variant:"subtitle2",component:"div",sx:{display:"inline-flex",alignItems:"center",cursor:"help"},children:[h.name,h.isRequired&&e.jsx(de,{size:"small",label:"Required",color:"primary",sx:{ml:1,height:20}}),D&&e.jsx(de,{size:"small",label:"Click to preview",color:"info",variant:"outlined",sx:{ml:1,height:20,display:{xs:"none",sm:"flex"},animation:I?"none":"pulse 1.5s infinite","@keyframes pulse":{"0%":{boxShadow:"0 0 0 0 rgba(33, 150, 243, 0.4)"},"70%":{boxShadow:"0 0 0 6px rgba(33, 150, 243, 0)"},"100%":{boxShadow:"0 0 0 0 rgba(33, 150, 243, 0)"}}}})]})}),h.dataType&&e.jsx(Ke,{title:`${h.dataType} Data Type`,content:Y(),children:e.jsx(de,{size:"small",label:h.dataType,color:A(h.dataType).color,variant:"outlined",icon:A(h.dataType).icon,sx:{mt:1,mr:1,height:20}})}),e.jsx(b,{variant:"body2",color:"text.secondary",children:h.description})]}),e.jsxs(j,{sx:{display:"flex",alignItems:"flex-start"},children:[y&&e.jsx(Ke,{title:"Validation Issue",content:e.jsx(b,{variant:"body2",children:y.message}),type:y.severity==="error"?"warning":"info",children:e.jsx(j,{sx:{display:"flex",alignItems:"center",mr:1},children:y.severity==="error"?e.jsx(Rr,{color:"error",fontSize:"small"}):e.jsx(yr,{color:"warning",fontSize:"small"})})}),D&&e.jsxs(e.Fragment,{children:[e.jsx(Ke,{title:"Edit Transformations",content:e.jsx(b,{variant:"body2",children:"Configure data transformations for this field mapping. Apply operations like splitting, joining, formatting and type conversion."}),children:e.jsx(De,{size:"small",onClick:L=>{L.stopPropagation(),d(h.name)},sx:{mr:1},children:e.jsx(br,{fontSize:"small"})})}),e.jsx(Ke,{title:"Remove Mapping",content:e.jsx(b,{variant:"body2",children:"Remove the current mapping between source and target fields."}),type:"warning",children:e.jsx(De,{size:"small",onClick:L=>{L.stopPropagation(),m(h.name)},children:e.jsx(mt,{fontSize:"small"})})})]})]})]}),e.jsxs(Ue,{fullWidth:!0,size:"small",children:[e.jsx(We,{id:`${h.id}-source-label`,children:"Select source field"}),e.jsxs(Ye,{labelId:`${h.id}-source-label`,id:`${h.id}-source-select`,value:D||"",label:"Select source field",onChange:L=>{try{V(h.name,L.target.value),L.target.value?E(h.name):M===h.name&&E(null)}catch(U){console.error("Error in dropdown change handler:",U)}},MenuProps:{anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{elevation:4,style:{maxHeight:300}}}},renderValue:L=>L||e.jsx("em",{style:{color:"rgba(0, 0, 0, 0.54)"},children:"Select field or drag from left"}),endAdornment:D&&e.jsx(Oe,{position:"end",children:e.jsx(Ke,{title:"Field is Mapped",content:e.jsxs(b,{variant:"body2",children:['This field is mapped to source field "',D,'". Click the field to preview the mapping.']}),children:e.jsx(nt,{color:"success",fontSize:"small"})})}),onClick:L=>L.stopPropagation(),children:[e.jsx(oe,{value:"",children:e.jsx("em",{style:{color:"rgba(0, 0, 0, 0.54)"},children:"Select field or drag from left"})}),Array.isArray(p)&&p.length>0?p.map(L=>{const U=c&&c.length>0?c[0][L]:void 0;let N="Unknown";U!=null&&(typeof U=="string"?[/^\d{4}-\d{2}-\d{2}$/,/^\d{1,2}\/\d{1,2}\/\d{2,4}$/].some(te=>te.test(U))?N="Date":/^\d{1,2}:\d{2}(:\d{2})?(\s*(AM|PM))?$/i.test(U)?N="Time":isNaN(Number(U))?N="Text":N="Number":N=typeof U);const re=G=>G==null?"":typeof G=="object"?JSON.stringify(G).substring(0,30):String(G).substring(0,30);return e.jsx(oe,{value:L,children:e.jsxs(j,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsx(b,{variant:"body2",children:L}),U!==void 0&&e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsx(b,{variant:"caption",sx:{fontFamily:"monospace",bgcolor:"grey.100",px:.5,borderRadius:.5,maxWidth:"120px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"text.secondary"},children:re(U)}),e.jsx(de,{label:N,size:"small",sx:{height:16,fontSize:"0.65rem","& .MuiChip-label":{px:.5,py:0}}})]})]})},L)}):e.jsx(oe,{disabled:!0,children:e.jsx("em",{children:"No source fields available"})})]})]})]},h.id)},X=()=>{if(r){const h=Array.isArray(H)?H:Object.values(H).flat();return e.jsx(j,{children:h.map(W)})}else return Object.entries(H).map(([h,D])=>e.jsxs(mr,{expanded:z[h]||!1,onChange:()=>_(h),sx:{mb:2},children:[e.jsxs(gr,{expandIcon:e.jsx(bt,{}),children:[e.jsx(b,{variant:"subtitle1",children:h}),e.jsxs(b,{variant:"body2",color:"text.secondary",sx:{ml:2},children:[D.length," fields"]})]}),e.jsx(xr,{children:D.map(W)})]},h))},[ae,R]=T.useState(!1),v=T.useMemo(()=>t.requiredFields.filter(D=>!l.some(y=>y.targetField===D.name)),[t.requiredFields,l]),$=h=>{console.log("Received default mappings:",h),h.forEach(D=>{console.log("Adding default mapping for:",D.targetField,D),o(D)}),console.log("Current mappings after adding defaults:",l)};return e.jsxs(he,{sx:{p:2,height:"100%",display:"flex",flexDirection:"column",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",border:"2px solid #e0e0e0",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[v.length>0&&e.jsxs(ee,{variant:"outlined",size:"small",startIcon:e.jsx(Gr,{}),onClick:()=>R(!0),color:"primary",children:["Set Default Values (",v.length,")"]}),e.jsx(st,{control:e.jsx(Jr,{checked:r,onChange:h=>s(h.target.checked),size:"small"}),label:"Show all fields A-Z"})]}),v.length>0&&e.jsxs(pe,{severity:"warning",sx:{mb:2},action:e.jsx(ee,{color:"inherit",size:"small",onClick:()=>R(!0),children:"Set Defaults"}),children:[v.length," required ",v.length===1?"field":"fields"," not mapped. Please map or set default values to continue."]}),e.jsx(be,{size:"small",placeholder:"Search target fields...",value:n,onChange:h=>a(h.target.value),fullWidth:!0,sx:{mb:2},InputProps:{startAdornment:e.jsx(Oe,{position:"start",children:e.jsx(it,{fontSize:"small"})})}}),e.jsx(me,{sx:{mb:2}}),e.jsx(j,{sx:{mb:2,p:1,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1,border:"1px dashed",borderColor:"primary.main"},children:e.jsx(b,{variant:"body2",color:"primary",sx:{fontWeight:"bold"},children:"Drop source fields onto target fields or use the drop-down menus below"})}),M&&e.jsx(Kn,{mapping:l.find(h=>h.targetField===M)||null,sampleData:c,onClose:()=>E(null)}),e.jsx(j,{sx:{flexGrow:1,maxHeight:"calc(100% - 220px)",overflow:"auto",scrollbarWidth:"thin",border:"1px solid #e0e0e0",borderRadius:"4px",padding:"8px",backgroundColor:"#fafafa","&::-webkit-scrollbar":{width:"10px"},"&::-webkit-scrollbar-track":{background:"#f1f1f1",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{background:"#2196f3",borderRadius:"4px","&:hover":{background:"#1976d2"}}},children:X()}),S&&e.jsx(Yn,{open:!!S,onClose:i,fieldName:S,mapping:l.find(h=>h.targetField===S),sampleData:c,onSave:C}),e.jsx(Gn,{open:ae,onClose:()=>R(!1),unmappedRequiredFields:v,onAddDefaultMappings:$})]})},ro=({validationErrors:t,jumpToField:r})=>{const[s,n]=Qe.useState(!1),a=t.filter(m=>m.severity==="error").length,l=t.filter(m=>m.severity==="warning").length,o=()=>{n(!s)};return e.jsxs(he,{sx:{p:2,position:"sticky",top:16},children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:o,children:[e.jsxs(b,{variant:"h6",color:a>0?"error":"warning",children:["Validation Issues ",a>0?`(${a} errors, ${l} warnings)`:`(${l} warnings)`]}),e.jsx(ee,{size:"small",endIcon:s?e.jsx(hr,{}):e.jsx(bt,{}),children:s?"Collapse":"Expand"})]}),e.jsxs(vr,{in:s,children:[e.jsx(me,{sx:{my:1}}),e.jsx(j,{sx:{maxHeight:"200px",overflow:"auto"},children:e.jsx(qe,{dense:!0,children:t.map((m,u)=>e.jsxs(Se,{sx:{bgcolor:m.severity==="error"?"error.lightest":"warning.lightest",mb:.5,borderRadius:1},children:[e.jsx(ze,{children:m.severity==="error"?e.jsx(Rr,{color:"error"}):e.jsx(yr,{color:"warning"})}),e.jsx(Ce,{primary:m.field,secondary:m.message}),e.jsx(ee,{size:"small",variant:"outlined",color:m.severity==="error"?"error":"warning",onClick:()=>r(m.field),children:"Go to Field"})]},u))})})]})]})},so=ne(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"})),no=({sampleData:t,mappings:r})=>{const s=T.useMemo(()=>t.length>0?t[0]:null,[t]),n=T.useMemo(()=>{if(!s||!r.length)return null;const o=Er([s],r);return o.length>0?o[0]:null},[s,r]);if(!s||!n)return e.jsx(j,{sx:{p:2,textAlign:"center"},children:e.jsx(b,{variant:"body2",color:"text.secondary",children:"No data available for preview. Upload a file and map fields to see a live preview."})});const a=Object.keys(s),l=Object.keys(n);return e.jsxs(j,{children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(b,{variant:"subtitle1",children:"Live Preview"}),e.jsx(b,{variant:"body2",color:"text.secondary",children:"Showing all mapped fields • Scroll horizontally to see more →"})]}),e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:2,overflowX:"auto"},children:[e.jsx(kt,{component:he,variant:"outlined",sx:{flex:1,minWidth:"400px",maxHeight:"200px",overflowX:"auto"},children:e.jsxs($t,{size:"small",stickyHeader:!0,children:[e.jsx(Ot,{children:e.jsx(Xe,{children:a.map(o=>e.jsx(Ne,{sx:{minWidth:"120px",whiteSpace:"nowrap"},children:e.jsx(b,{variant:"caption",fontWeight:"bold",children:o})},o))})}),e.jsx(Mt,{children:e.jsx(Xe,{children:a.map(o=>e.jsx(Ne,{sx:{minWidth:"120px"},children:e.jsx(b,{variant:"caption",sx:{wordBreak:"break-word"},children:s[o]!==null&&s[o]!==void 0?String(s[o]):"null"})},o))})})]})}),e.jsx(j,{sx:{display:"flex",justifyContent:"center",alignItems:"center",px:2,flexShrink:0},children:e.jsx(so,{color:"primary"})}),e.jsx(kt,{component:he,variant:"outlined",sx:{flex:1,minWidth:"400px",maxHeight:"200px",overflowX:"auto"},children:e.jsxs($t,{size:"small",stickyHeader:!0,children:[e.jsx(Ot,{children:e.jsx(Xe,{children:l.map(o=>e.jsx(Ne,{sx:{minWidth:"120px",whiteSpace:"nowrap"},children:e.jsx(b,{variant:"caption",fontWeight:"bold",children:o})},o))})}),e.jsx(Mt,{children:e.jsx(Xe,{children:l.map(o=>e.jsx(Ne,{sx:{minWidth:"120px"},children:e.jsx(b,{variant:"caption",sx:{wordBreak:"break-word"},children:n[o]!==null&&n[o]!==void 0?String(n[o]):"null"})},o))})})]})})]})]})},sr=ne(e.jsx("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 12H4V8h16z"})),oo=ne(e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"})),kr=(t,r)=>{T.useEffect(()=>{if(r)try{localStorage.setItem(`tmpl:${t.id}`,JSON.stringify(t)),console.log(`Template "${t.name}" saved to localStorage`)}catch(o){console.error("Failed to save template to localStorage:",o)}},[t,r]);const s=()=>{try{return Object.keys(localStorage).filter(c=>c.startsWith("tmpl:")).map(c=>{const p=localStorage.getItem(c);return p?JSON.parse(p):null}).filter(Boolean).sort((c,p)=>p.lastModified-c.lastModified)}catch(o){return console.error("Failed to load templates from localStorage:",o),[]}};return{loadTemplates:s,deleteTemplate:o=>{try{return localStorage.removeItem(`tmpl:${o}`),!0}catch(m){return console.error("Failed to delete template:",m),!1}},saveToServer:async()=>(console.log("Saving template to server:",t),new Promise(o=>{setTimeout(()=>{console.log("Template saved to server successfully"),o()},500)})),loadFromServer:async()=>s()}},ao=({currentTemplate:t,setCurrentTemplate:r,setTemplateDirty:s})=>{const[n,a]=T.useState(null),[l,o]=T.useState(!1),[m,u]=T.useState(!1),[c,p]=T.useState(t.name),[f,S]=T.useState(t.description||""),[k,M]=T.useState([]),{loadTemplates:E,deleteTemplate:z,saveToServer:w}=kr(t,!1);T.useEffect(()=>{const C=E();M(C)},[]);const P=C=>{a(C.currentTarget)},O=()=>{a(null)},F=()=>{p(t.name),S(t.description||""),o(!0),O()},H=()=>{const C=E();M(C),u(!0),O()},_=()=>{const C={...t,name:c,description:f,lastModified:Date.now()};r(C),w(),s(!1),o(!1)},V=C=>{r(C),s(!1),u(!1)},d=C=>{z(C);const A=E();M(A)},i=C=>{const A={...C,id:`template-${Date.now()}`,name:`${C.name} (Copy)`,lastModified:Date.now()};localStorage.setItem(`tmpl:${A.id}`,JSON.stringify(A));const W=E();M(W)},g=C=>new Date(C).toLocaleString();return e.jsxs(e.Fragment,{children:[e.jsx(ee,{variant:"outlined",size:"small",onClick:P,startIcon:e.jsx(sr,{}),children:"Templates"}),e.jsxs(is,{anchorEl:n,open:!!n,onClose:O,children:[e.jsxs(oe,{onClick:F,children:[e.jsx(fr,{fontSize:"small",sx:{mr:1}}),"Save Template As..."]}),e.jsxs(oe,{onClick:H,children:[e.jsx(sr,{fontSize:"small",sx:{mr:1}}),"Load Template"]})]}),e.jsxs(lt,{open:l,onClose:()=>o(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(at,{children:"Save Mapping Template"}),e.jsxs(ct,{children:[e.jsx(be,{autoFocus:!0,margin:"dense",label:"Template Name",fullWidth:!0,value:c,onChange:C=>p(C.target.value),sx:{mb:2}}),e.jsx(be,{margin:"dense",label:"Description (optional)",fullWidth:!0,multiline:!0,rows:2,value:f,onChange:C=>S(C.target.value)})]}),e.jsxs(dt,{children:[e.jsx(ee,{onClick:()=>o(!1),children:"Cancel"}),e.jsx(ee,{onClick:_,variant:"contained",children:"Save Template"})]})]}),e.jsxs(lt,{open:m,onClose:()=>u(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(at,{children:"Load Mapping Template"}),e.jsx(ct,{children:k.length===0?e.jsxs(j,{sx:{textAlign:"center",py:4},children:[e.jsx(b,{variant:"body1",children:"No saved templates found."}),e.jsx(b,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Create and save a template to see it here."})]}):e.jsx(qe,{children:k.map(C=>e.jsxs(Qe.Fragment,{children:[e.jsxs(Se,{component:"button",onClick:()=>V(C),sx:{py:2},children:[e.jsx(Ce,{primary:e.jsxs(b,{variant:"subtitle1",children:[C.name,C.toolId&&e.jsxs(b,{component:"span",variant:"body2",color:"text.secondary",sx:{ml:1},children:["(",C.toolId,")"]})]}),secondary:e.jsxs(j,{children:[C.description&&e.jsx(b,{variant:"body2",children:C.description}),e.jsxs(b,{variant:"caption",color:"text.secondary",children:["Last modified: ",g(C.lastModified),C.mappings&&` • ${C.mappings.length} mappings`]})]})}),e.jsxs(It,{children:[e.jsx(De,{edge:"end",onClick:()=>i(C),sx:{mr:1},children:e.jsx(oo,{fontSize:"small"})}),e.jsx(De,{edge:"end",onClick:()=>d(C.id),children:e.jsx(mt,{fontSize:"small"})})]})]}),e.jsx(me,{})]},C.id))})}),e.jsx(dt,{children:e.jsx(ee,{onClick:()=>u(!1),children:"Cancel"})})]})]})},io=(t,r)=>{if(!r)return t;const s=[...r.requiredFields,...r.optionalFields];if(s.find(l=>l.id===t))return console.log(`✅ Field ID already correct: "${t}"`),t;const a=s.find(l=>l.name===t);return a?(console.log(`🔄 Converting display name "${t}" to field ID "${a.id}"`),a.id):(console.warn(`⚠️ Unknown target field: "${t}" - keeping as-is`),t)},nr=(t,r)=>{if(!r||!t)return t;console.log("🔄 Starting field mapping migration...");const s=t.map(n=>{const a=n.targetField,l=io(n.targetField,r);return a!==l&&console.log(`📋 Migrating: "${n.sourceField}" → "${a}" becomes "${n.sourceField}" → "${l}"`),{...n,targetField:l}});return console.log("✅ Field mapping migration complete"),s},or=(t,r)=>{if(!r||!t)return{isConsistent:!0,issues:[]};const s=[...r.requiredFields,...r.optionalFields],n=[];return t.forEach(a=>{const l=s.some(m=>m.id===a.targetField),o=s.some(m=>m.name===a.targetField);o&&!l?n.push(`Mapping "${a.sourceField}" → "${a.targetField}" uses display name instead of field ID`):!l&&!o&&n.push(`Mapping "${a.sourceField}" → "${a.targetField}" targets unknown field`)}),{isConsistent:n.length===0,issues:n}},lo=t=>({incident_id:["incident_number","incidentnumber","incident_num","case_number","call_number","event_id","event_number","report_number"],incident_time:["call_received_time","callreceivedtime","received_time","call_time","incident_datetime","receive_time","time_received","incident_date"],arrival_time:["arrive_time","arrivetime","on_scene_time","onscenetime","scene_time","arrival_datetime","on_scene_datetime"],dispatch_time:["dispatched_time","dispatchedtime","dispatch_datetime","notification_time","notified_time"],enroute_time:["en_route_time","enroutetime","turnout_time","turnouttime","responding_time","travel_start_time"],clear_time:["cleared_time","clearedtime","clear_datetime","back_in_service_time","available_time","service_time","unit_clear_time"],latitude:["lat","y_coord","y_coordinate","gps_lat","coord_y"],longitude:["lng","lon","long","x_coord","x_coordinate","gps_lng","gps_lon","coord_x"],address:["incident_address","location","street_address","full_address","addr"],responding_unit:["unit","primary_unit","first_unit","apparatus","resource"]})[t]||[],co=()=>{const t=ut(),{sourceColumns:r,sampleData:s,selectedTool:n,mappings:a,processingStatus:l}=He(v=>v.formatter),[o,m]=T.useState({id:`template-${Date.now()}`,name:"Untitled Mapping",toolId:(n==null?void 0:n.id)||"",mappings:a||[],lastModified:Date.now()}),[u,c]=T.useState(!1),[p,f]=T.useState(!1),[S,k]=T.useState([]),[M,E]=T.useState({message:"",severity:"info",open:!1}),[z,w]=T.useState(""),[P,O]=T.useState(""),[F,H]=T.useState(!1),_=n||void 0,{saveToServer:V}=kr(o,u);T.useEffect(()=>{console.log("Redux mappings changed:",a),m(v=>{const $={...v,mappings:[...a],lastModified:Date.now()};return console.log("Updated template with Redux mappings:",$),$}),a.length>0&&c(!0)},[a]),T.useEffect(()=>{if(!_||!a||a.length===0)return;console.log("🔄 Checking for legacy mappings that need migration...");const v=or(a,_);if(v.isConsistent)console.log("✅ All mappings already use field IDs - no migration needed");else{console.log("🔄 Legacy mappings detected - auto-migrating to field IDs"),console.log("Issues found:",v.issues);const $=nr(a,_);JSON.stringify(a)!==JSON.stringify($)&&(console.log("✅ Auto-migration complete - updating mappings"),t(rt($)))}},[_,a==null?void 0:a.length]),T.useEffect(()=>{g()},[a,_]);const d=v=>{console.log("handleMappingChange called with:",v);try{const $=[...a],h=$.findIndex(D=>D.targetField===v.targetField);h>=0?(console.log(`Updating existing mapping for ${v.targetField}`),$[h]=v):(console.log(`Adding new mapping for ${v.targetField}`),$.push(v)),t(rt($)),console.log("Mapping updated successfully:",v),E({message:`Mapped ${v.sourceField} to ${v.targetField}`,severity:"success",open:!0})}catch($){console.error("Error updating mapping:",$)}},i=v=>{console.log("handleRemoveMapping called for:",v);try{const $=a.filter(h=>h.targetField!==v);t(rt($)),console.log(`Mapping for ${v} removed successfully`)}catch($){console.error("Error removing mapping:",$)}},g=()=>{if(!_)return;console.log("🔍 FIELD MAPPING AUDIT - Current State Analysis:"),console.log("=========================================="),console.log("📋 Tool Configuration:"),console.log("  Required Fields:",_.requiredFields.map(y=>({id:y.id,name:y.name}))),console.log("  Optional Fields:",_.optionalFields.map(y=>({id:y.id,name:y.name}))),console.log("🗺️ Current Mappings:"),console.log("  Mappings Array:",a.map(y=>({source:y.sourceField,target:y.targetField})));const v=[..._.requiredFields,..._.optionalFields],$=a.map(y=>{const I=v.find(B=>B.id===y.targetField),x=v.find(B=>B.name===y.targetField);return{source:y.sourceField,target:y.targetField,isFieldId:!!I,isDisplayName:!!x,shouldBeFieldId:x?x.id:y.targetField}});console.log("🔍 Mapping Analysis:"),$.forEach(y=>{console.log(`  "${y.source}" → "${y.target}"`),console.log(`    - Is Field ID: ${y.isFieldId}`),console.log(`    - Is Display Name: ${y.isDisplayName}`),y.isDisplayName&&!y.isFieldId&&console.log(`    - ⚠️ PROBLEM: Should be "${y.shouldBeFieldId}" instead`)});const h=a.find(y=>y.targetField==="Call Received Date/Time");h&&(console.log("🚨 SPECIFIC ISSUE DETECTED:"),console.log(`  Mapping: "${h.sourceField}" → "${h.targetField}"`),console.log(`  Should be: "${h.sourceField}" → "incident_time"`)),console.log("==========================================");const D=[];_.requiredFields.forEach(y=>{const I=a.find(B=>B.targetField===y.id),x=a.find(B=>B.targetField===y.name);if(console.log(`Checking required field ${y.id} (display: ${y.name})`),console.log(`  - Mapping by ID: ${I?`"${I.sourceField}" → ${I.targetField}`:"none"}`),console.log(`  - Mapping by Name: ${x?`"${x.sourceField}" → ${x.targetField}`:"none"}`),I)console.log(`  ✅ Correct mapping found for ${y.id}`);else if(x){console.log(`  🔄 Legacy mapping detected for ${y.id} - migrating from display name to field ID`);const B=a.findIndex(q=>q.targetField===y.name);if(B>=0){const q=[...a];q[B]={...q[B],targetField:y.id},console.log(`  📋 Auto-migrated: "${y.name}" → "${y.id}"`),t(rt(q))}}else console.log(`  ❌ No mapping found for required field ${y.id}`),D.push({field:y.id,message:`Required field ${y.name} is not mapped`,severity:"error"})}),k(D)},C=async()=>{if(!(!r||!_)){f(!0);try{console.log("🔧 AUTO-MAPPING - Starting with systematic fix approach");const $=[...nr(o.mappings,_)],h=x=>$.some(B=>B.targetField===x),D=x=>x.toLowerCase().replace(/[\s_-]/g,""),y=[..._.requiredFields,..._.optionalFields];console.log("🔧 AUTO-MAPPING - Available target fields:",y.map(x=>({id:x.id,name:x.name}))),console.log("🔧 AUTO-MAPPING - Source columns:",r),y.forEach(x=>{if(h(x.id)){console.log(`⏭️ Skipping ${x.id} - already mapped`);return}console.log(`🔍 Attempting to map target field: ${x.id} (display: ${x.name})`);const B=r.find(G=>G.toLowerCase()===x.name.toLowerCase());if(B){console.log(`✅ Exact match found: "${B}" → ${x.id}`),$.push({sourceField:B,targetField:x.id});return}const q=D(x.name),K=r.find(G=>D(G)===q);if(K){console.log(`✅ Normalized match found: "${K}" → ${x.id}`),$.push({sourceField:K,targetField:x.id});return}const Z=D(x.id),Y=r.find(G=>D(G)===Z);if(Y){console.log(`✅ Field ID match found: "${Y}" → ${x.id}`),$.push({sourceField:Y,targetField:x.id});return}const L=lo(x.id);let U=null;for(const G of L)if(U=r.find(te=>D(te)===D(G)),U){console.log(`✅ Field variation match found: "${U}" → ${x.id} (via variation "${G}")`),$.push({sourceField:U,targetField:x.id});return}const re=r.map(D).findIndex(G=>G.includes(q)||q.includes(G));if(re>=0){console.log(`✅ Partial match found: "${r[re]}" → ${x.id}`),$.push({sourceField:r[re],targetField:x.id});return}console.log(`❌ No match found for target field: ${x.id}`)}),console.log("🔧 AUTO-MAPPING - Final mappings:",$.map(x=>({source:x.sourceField,target:x.targetField})));const I=or($,_);I.isConsistent||console.warn("⚠️ AUTO-MAPPING - Consistency issues detected:",I.issues),t(rt($))}finally{f(!1)}}},A=async()=>{try{await V(),c(!1)}catch(v){console.error("Failed to save template:",v)}},W=()=>{t(Be(0))},X=()=>{try{t(Me("transforming")),console.log("🔧 TRANSFORMATION DEBUG: Using Redux mappings directly for transformation"),console.log("Redux mappings:",a),console.log("currentTemplate.mappings:",o.mappings),console.log("Sample data:",s);const v=Er(s,a);console.log("✅ Transformed data with latest mappings:",v),t(Vr(v)),t(Me("mapping")),t(Be(2))}catch(v){console.error("Error transforming data:",v),t(Me("error")),E({message:`Error transforming data: ${v instanceof Error?v.message:"Unknown error"}`,severity:"error",open:!0})}},ae=T.useMemo(()=>{if(console.log("Checking if can proceed with validationErrors:",S),console.log("Current mappings:",a),_){const v=_.requiredFields.filter($=>!a.some(h=>h.targetField===$.id));return console.log("Unmapped required fields:",v),v.length===0}return S.every(v=>v.severity!=="error")},[S,a,_]),R=v=>{var y;v.preventDefault();const $=v.dataTransfer.getData("text/plain");if(!$){E({message:"Drag and drop error: No source field data found",severity:"error",open:!0});return}const D=(y=v.target.closest("[data-target-field]"))==null?void 0:y.getAttribute("data-target-field");if(!D){E({message:"Drag and drop error: No target field found. Try dropping directly on a target field.",severity:"warning",open:!0});return}d({sourceField:$,targetField:D}),E({message:`Mapped ${$} to ${D}`,severity:"success",open:!0})};return r.length?_?l==="uploading"?e.jsxs(j,{sx:{p:3,textAlign:"center"},children:[e.jsx(Ze,{}),e.jsx(b,{sx:{mt:2},children:"Processing file data..."})]}):e.jsxs(j,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(b,{variant:"h5",children:["Map Fields for ",_.name]}),e.jsxs(ds,{direction:"row",spacing:1,children:[e.jsx(ee,{variant:"outlined",size:"small",startIcon:e.jsx(fr,{}),onClick:A,disabled:!u,children:"Save Template"}),e.jsx(ao,{currentTemplate:o,setCurrentTemplate:m,setTemplateDirty:c})]})]}),e.jsxs(j,{sx:{display:"flex",gap:2,height:"700px",minHeight:"700px",border:"1px solid #eaeaea",borderRadius:"4px",padding:"4px"},children:[e.jsxs(j,{sx:{width:"35%",height:"100%",display:"flex",flexDirection:"column",position:"relative",borderRight:"1px solid #eaeaea",paddingRight:"8px"},children:[e.jsx(b,{variant:"h6",sx:{position:"sticky",top:0,zIndex:10,backgroundColor:"#fff",paddingBottom:"8px",borderBottom:"2px solid #1976d2",marginBottom:"8px",color:"#1976d2",fontWeight:"bold",textAlign:"center"},children:"Source Fields Panel ↕️ (Scrollable)"}),e.jsx(Bn,{sourceColumns:r,filter:z,setFilter:w,mappings:o.mappings,sampleData:s})]}),e.jsxs(j,{sx:{width:"65%",height:"100%",display:"flex",flexDirection:"column",gap:2,overflow:"hidden",position:"relative"},onDragOver:v=>{v.target===v.currentTarget&&(v.preventDefault(),console.log("Parent container dragOver"))},onDrop:v=>{v.target===v.currentTarget&&(v.preventDefault(),R(v),console.log("Parent container drop"))},children:[e.jsx(b,{variant:"h6",sx:{position:"sticky",top:0,zIndex:10,backgroundColor:"#fff",paddingBottom:"8px",borderBottom:"2px solid #1976d2",marginBottom:"8px",color:"#1976d2",fontWeight:"bold",textAlign:"center"},children:"Target Fields Panel ↕️ (Scrollable)"}),e.jsx(to,{toolConfig:_,showAllFields:F,setShowAllFields:H,filter:P,setFilter:O,mappings:o.mappings,onMappingChange:d,onRemoveMapping:i,validationErrors:S,sampleData:s,sourceColumns:r}),S.length>0&&e.jsx(j,{sx:{flexShrink:0,marginTop:"auto",borderTop:"1px solid #eaeaea",paddingTop:"8px"},children:e.jsx(ro,{validationErrors:S,jumpToField:v=>{const $=document.getElementById(`target-field-${v}`);$&&($.scrollIntoView({behavior:"smooth",block:"center"}),$.classList.add("highlight-field"),setTimeout(()=>{$.classList.remove("highlight-field")},2e3))}})})]})]}),e.jsx(he,{sx:{p:2,mt:2},children:e.jsx(no,{sampleData:s,mappings:o.mappings})}),e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mt:2},children:[e.jsx(ee,{variant:"outlined",startIcon:e.jsx(ot,{}),onClick:W,children:"Back"}),e.jsxs(j,{children:[e.jsx(ee,{variant:"outlined",onClick:C,disabled:p||!r.length,sx:{mr:1},children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{size:20,sx:{mr:1}}),"Auto-mapping..."]}):"Auto-Map Fields"}),e.jsx(ee,{variant:"contained",endIcon:e.jsx(Bt,{}),onClick:X,disabled:!ae,children:"Continue"})]})]}),e.jsx(jr,{open:M.open,autoHideDuration:6e3,onClose:()=>E({...M,open:!1}),children:e.jsx(pe,{onClose:()=>E({...M,open:!1}),severity:M.severity,children:M.message})})]}):e.jsxs(j,{sx:{p:3,textAlign:"center"},children:[e.jsx(pe,{severity:"error",children:"No tool selected. Please select a tool first."}),e.jsx(ee,{sx:{mt:2},variant:"outlined",startIcon:e.jsx(ot,{}),onClick:W,children:"Go Back to Upload"})]}):e.jsxs(j,{sx:{p:3,textAlign:"center"},children:[e.jsx(pe,{severity:"error",children:"No source columns available. Please upload a file first."}),e.jsx(ee,{sx:{mt:2},variant:"outlined",startIcon:e.jsx(ot,{}),onClick:W,children:"Go Back to Upload"})]})},ar=ne(e.jsx("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),uo=ne([e.jsx("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),e.jsx("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")]),po=({data:t,validationErrors:r,highlightedCell:s})=>{const[n,a]=T.useState(0),[l,o]=T.useState(10),[m,u]=T.useState(""),[c,p]=T.useState("");T.useEffect(()=>{if(s){const F=Math.floor(s.rowIndex/l);F!==n&&a(F)}},[s,l,n]);const f=t.length>0?Object.keys(t[0]):[],S={};r.forEach(F=>{F.rowIndex!==void 0&&(S[F.rowIndex]||(S[F.rowIndex]={}),S[F.rowIndex][F.field]||(S[F.rowIndex][F.field]=[]),S[F.rowIndex][F.field].push(F))});const k=(F,H)=>{a(H)},M=F=>{o(parseInt(F.target.value,10)),a(0)},E=F=>{u(F.target.value),a(0)},z=F=>{p(F.target.value),a(0)},w=()=>{p(""),a(0)},P=t.filter(F=>{if(!c)return!0;if(m){const H=F[m];return H!==void 0&&String(H).toLowerCase().includes(c.toLowerCase())}return Object.values(F).some(H=>H!==void 0&&String(H).toLowerCase().includes(c.toLowerCase()))}),O=P.slice(n*l,n*l+l);return t.length===0?e.jsx(j,{children:e.jsx(b,{variant:"h6",gutterBottom:!0,children:"No data available for preview"})}):e.jsxs(j,{children:[e.jsx(Br,{styles:{"@keyframes pulse":{"0%":{opacity:.7},"100%":{opacity:1}}}}),e.jsxs(j,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(be,{label:"Search",value:c,onChange:z,sx:{flexGrow:1},InputProps:{startAdornment:e.jsx(Oe,{position:"start",children:e.jsx(it,{})}),endAdornment:c&&e.jsx(Oe,{position:"end",children:e.jsx(De,{onClick:w,edge:"end",size:"small",children:e.jsx(_t,{})})})}}),e.jsxs(Ue,{sx:{minWidth:200},children:[e.jsx(We,{id:"filter-field-label",children:"Filter Field"}),e.jsxs(Ye,{labelId:"filter-field-label",id:"filter-field",value:m,label:"Filter Field",onChange:E,children:[e.jsx(oe,{value:"",children:"All Fields"}),f.map(F=>e.jsx(oe,{value:F,children:F},F))]})]})]}),e.jsxs(he,{sx:{width:"100%",mb:2},children:[e.jsx(kt,{sx:{maxHeight:500},children:e.jsxs($t,{stickyHeader:!0,"aria-label":"data preview table",children:[e.jsx(Ot,{children:e.jsxs(Xe,{children:[e.jsx(Ne,{children:"#"}),f.map(F=>e.jsx(Ne,{children:F},F))]})}),e.jsx(Mt,{children:O.map((F,H)=>{const _=n*l+H,V=S[_];return e.jsxs(Xe,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0},backgroundColor:V?"#fff8f8":"inherit"},children:[e.jsx(Ne,{children:_+1}),f.map(d=>{const i=(V==null?void 0:V[d])||[],g=i.length>0,C=s&&s.rowIndex===_&&s.field===d;return e.jsxs(Ne,{sx:{backgroundColor:C?"#fff3e0":g?"#ffebee":"inherit",position:"relative",border:C?"2px solid #ff9800":"inherit",transition:"all 0.3s ease"},children:[F[d]!==void 0?String(F[d]):"",g&&e.jsx(j,{sx:{position:"absolute",top:0,right:0},children:e.jsx(de,{color:"error",size:"small",label:i.length,sx:{height:16,fontSize:"0.6rem"}})}),C&&e.jsx(j,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"2px solid #ff9800",borderRadius:"4px",pointerEvents:"none",animation:"pulse 1s ease-in-out infinite alternate"}})]},d)})]},H)})})]})}),e.jsx(us,{rowsPerPageOptions:[5,10,25,50,100],component:"div",count:P.length,rowsPerPage:l,page:n,onPageChange:k,onRowsPerPageChange:M})]})]})};class ho{constructor(){Wt(this,"defaultFields",{})}registerField(r,s){console.log(`Registering default value for ${r}:`,s),this.defaultFields[r]=s}hasDefaultValue(r){return this.defaultFields[r]!==void 0}getDefaultValue(r){return this.defaultFields[r]}registerMappings(r){this.defaultFields={},r.forEach(s=>{if(s.sourceField==="__default__"&&s.transformations){const n=s.transformations.find(a=>a.type==="convert"&&a.params&&a.params.defaultValue!==void 0);n&&n.params.defaultValue!==void 0&&this.registerField(s.targetField,n.params.defaultValue)}}),console.log("Registered default values:",this.defaultFields)}clear(){this.defaultFields={}}}const ir=new ho,fo=(t,r)=>{const s=[];return t.forEach((n,a)=>{r.forEach(l=>{let o=n[l.name];const m=ir.hasDefaultValue(l.name);if((o==null||o==="")&&m&&(o=ir.getDefaultValue(l.name),console.log(`Using default value for validation of ${l.name}:`,o)),l.name==="Incident ID"){l.isRequired&&!m&&(o==null||o==="")&&s.push({rowIndex:a,field:l.name,message:`${l.name} is required`,type:"required"});return}if(l.name.includes("Time")&&typeof o=="string"){l.isRequired&&!m&&(o==null||o==="")&&s.push({rowIndex:a,field:l.name,message:`${l.name} is required`,type:"required"});return}if(l.isRequired&&!m&&(o==null||o==="")){s.push({rowIndex:a,field:l.name,message:`${l.name} is required`,type:"required"});return}if(o==null||o==="")return;const u=mo(o,l.dataType,l.name,a);if(u){s.push(u);return}l.validationRules&&l.validationRules.forEach(c=>{const p=go(o,c,l.name,a);p&&s.push(p)})})}),console.log("Validation completed with errors:",s),s},mo=(t,r,s,n)=>{switch(r){case"string":if(typeof t!="string")return{rowIndex:n,field:s,message:`${s} must be a string`,type:"custom"};break;case"number":if(typeof t!="number"&&(typeof t!="string"||isNaN(Number(t))))return{rowIndex:n,field:s,message:`${s} must be a number`,type:"custom"};break;case"date":if(!(typeof t=="string"||t instanceof Date))return{rowIndex:n,field:s,message:`${s} must be a date`,type:"custom"};const a=new Date(t);if(isNaN(a.getTime()))return{rowIndex:n,field:s,message:`${s} contains an invalid date format`,type:"custom"};break;case"boolean":if(typeof t!="boolean"&&t!=="true"&&t!=="false"&&t!=="0"&&t!=="1")return{rowIndex:n,field:s,message:`${s} must be a boolean value`,type:"custom"};break;case"location":if(typeof t=="string"){if(!/^-?\d+(\.\d+)?,\s*-?\d+(\.\d+)?$/.test(t))return{rowIndex:n,field:s,message:`${s} must be a valid location format (latitude,longitude)`,type:"custom"}}else if(!t.lat||!t.lng)return{rowIndex:n,field:s,message:`${s} must be a valid location object or string`,type:"custom"};break}return null},go=(t,r,s,n)=>{switch(r.type){case"required":break;case"min":if(typeof t=="number"||!isNaN(Number(t))){if(Number(t)<r.params.value)return{rowIndex:n,field:s,message:`${s} must be at least ${r.params.value}`,type:"min"}}else if(typeof t=="string"&&t.length<r.params.value)return{rowIndex:n,field:s,message:`${s} must be at least ${r.params.value} characters`,type:"min"};break;case"max":if(typeof t=="number"||!isNaN(Number(t))){if(Number(t)>r.params.value)return{rowIndex:n,field:s,message:`${s} must be at most ${r.params.value}`,type:"max"}}else if(typeof t=="string"&&t.length>r.params.value)return{rowIndex:n,field:s,message:`${s} must be at most ${r.params.value} characters`,type:"max"};break;case"pattern":if(typeof t=="string"&&!new RegExp(r.params.regex).test(t))return{rowIndex:n,field:s,message:r.params.message||`${s} does not match the required pattern`,type:"pattern"};break;case"oneOf":const a=r.params.values;if(!a.includes(t))return{rowIndex:n,field:s,message:`${s} must be one of: ${a.join(", ")}`,type:"oneOf"};break;case"custom":if(r.params.validateFn&&typeof r.params.validateFn=="function"&&!r.params.validateFn(t))return{rowIndex:n,field:s,message:r.params.message||`${s} is invalid`,type:"custom"};break}return null},xo=t=>{const r={total:t.length,byType:{},byField:{}};return t.forEach(s=>{r.byType[s.type]||(r.byType[s.type]=0),r.byType[s.type]++,r.byField[s.field]||(r.byField[s.field]=0),r.byField[s.field]++}),r},Et=t=>{const{children:r,value:s,index:n,...a}=t;return e.jsx("div",{role:"tabpanel",hidden:s!==n,id:`validation-tabpanel-${n}`,"aria-labelledby":`validation-tab-${n}`,...a,children:s===n&&e.jsx(j,{sx:{p:2},children:r})})},yo=({errors:t,onJumpToError:r})=>{const[s,n]=T.useState(0),[a,l]=T.useState(""),o=xo(t),m=(f,S)=>{n(S)},u=t.filter(f=>f.field.toLowerCase().includes(a.toLowerCase())||f.message.toLowerCase().includes(a.toLowerCase())),c={};u.forEach(f=>{c[f.field]||(c[f.field]=[]),c[f.field].push(f)});const p=f=>{let S="default";switch(f){case"required":S="error";break;case"pattern":case"min":case"max":S="warning";break;case"oneOf":case"custom":S="info";break}return e.jsx(de,{size:"small",label:f,color:S})};return e.jsxs(he,{sx:{p:0,mb:3},children:[e.jsx(j,{sx:{p:2,bgcolor:t.length>0?"#ffebee":"#e8f5e9",borderRadius:"4px 4px 0 0"},children:e.jsxs(b,{variant:"h6",component:"h3",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(gt,{}),"Validation Results",e.jsx(de,{label:`${t.length} ${t.length===1?"error":"errors"}`,color:t.length>0?"error":"success",sx:{ml:2}})]})}),e.jsx(me,{}),e.jsx(j,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(yt,{value:s,onChange:m,"aria-label":"validation tabs",children:[e.jsx(Ee,{label:"Summary",id:"validation-tab-0","aria-controls":"validation-tabpanel-0"}),e.jsx(Ee,{label:"By Field",id:"validation-tab-1","aria-controls":"validation-tabpanel-1"}),e.jsx(Ee,{label:"All Errors",id:"validation-tab-2","aria-controls":"validation-tabpanel-2"})]})}),e.jsx(Et,{value:s,index:0,children:t.length===0?e.jsx(pe,{severity:"success",children:"No validation errors found. Your data is ready for export!"}):e.jsxs(e.Fragment,{children:[e.jsxs(pe,{severity:"warning",children:["Found ",t.length," validation ",t.length===1?"error":"errors"," that need to be addressed before export."]}),e.jsxs(j,{sx:{mt:2},children:[e.jsx(b,{variant:"subtitle1",gutterBottom:!0,children:"Error Distribution by Field"}),e.jsx(j,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:Object.entries(o.byField).map(([f,S])=>e.jsx(de,{label:`${f}: ${S}`,color:"error",variant:"outlined",onClick:()=>n(1)},f))}),e.jsx(b,{variant:"subtitle1",gutterBottom:!0,children:"Error Types"}),e.jsx(j,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Object.entries(o.byType).map(([f,S])=>e.jsx(de,{label:`${f}: ${S}`,color:"primary",variant:"outlined"},f))})]})]})}),e.jsxs(Et,{value:s,index:1,children:[e.jsx(be,{fullWidth:!0,placeholder:"Search errors by field or message",value:a,onChange:f=>l(f.target.value),sx:{mb:2},InputProps:{startAdornment:e.jsx(Oe,{position:"start",children:e.jsx(it,{})}),endAdornment:a&&e.jsx(Oe,{position:"end",children:e.jsx(De,{onClick:()=>l(""),edge:"end",size:"small",children:e.jsx(_t,{})})})}}),Object.keys(c).length===0?e.jsx(pe,{severity:"info",children:"No errors match your search criteria."}):Object.entries(c).map(([f,S])=>e.jsxs(mr,{defaultExpanded:Object.keys(c).length===1,children:[e.jsx(gr,{expandIcon:e.jsx(bt,{}),children:e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(b,{children:f}),e.jsx(de,{size:"small",label:S.length,color:"error",sx:{ml:"auto"}})]})}),e.jsx(xr,{children:e.jsx(qe,{dense:!0,disablePadding:!0,children:S.map((k,M)=>e.jsxs(Qe.Fragment,{children:[M>0&&e.jsx(me,{component:"li"}),e.jsx(Se,{secondaryAction:k.rowIndex!==void 0&&r&&e.jsx(ee,{size:"small",variant:"outlined",onClick:()=>k.rowIndex!==void 0&&r(k.rowIndex,k.field),children:"Jump to Row"}),children:e.jsx(Ce,{primary:e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[k.message,p(k.type)]}),secondary:k.rowIndex!==void 0?`Row ${k.rowIndex+1}`:"Global error"})})]},M))})})]},f))]}),e.jsxs(Et,{value:s,index:2,children:[e.jsx(be,{fullWidth:!0,placeholder:"Search errors by field or message",value:a,onChange:f=>l(f.target.value),sx:{mb:2},InputProps:{startAdornment:e.jsx(Oe,{position:"start",children:e.jsx(it,{})}),endAdornment:a&&e.jsx(Oe,{position:"end",children:e.jsx(De,{onClick:()=>l(""),edge:"end",size:"small",children:e.jsx(_t,{})})})}}),e.jsx(qe,{dense:!0,children:u.length===0?e.jsx(pe,{severity:"info",children:"No errors match your search criteria."}):u.map((f,S)=>e.jsxs(Qe.Fragment,{children:[S>0&&e.jsx(me,{component:"li"}),e.jsx(Se,{secondaryAction:f.rowIndex!==void 0&&r&&e.jsx(ee,{size:"small",variant:"outlined",onClick:()=>f.rowIndex!==void 0&&r(f.rowIndex,f.field),children:"Jump to Row"}),children:e.jsx(Ce,{primary:e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(b,{component:"span",sx:{fontWeight:500},children:[f.field,":"]}),f.message,p(f.type)]}),secondary:f.rowIndex!==void 0?`Row ${f.rowIndex+1}`:"Global error"})})]},S))})]})]})},bo=ne(e.jsx("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"})),lr=ne(e.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})),vo=t=>{switch(t){case"string":return"Default Value";case"number":return"0";case"date":return new Date().toISOString().split("T")[0];case"boolean":return"false";case"location":return"0.0,0.0";default:return""}},jo=({errors:t,targetFields:r,mappings:s,onAddDefaultValue:n,onJumpToMapping:a})=>{const l=Pt(),[o,m]=T.useState(!1),[u,c]=T.useState(null),[p,f]=T.useState(""),S=T.useMemo(()=>{const w={};return t.forEach(P=>{w[P.field]||(w[P.field]={errors:[],count:0}),w[P.field].errors.push(P),w[P.field].count++}),w},[t]),k=T.useMemo(()=>Object.entries(S).sort((w,P)=>P[1].count-w[1].count).map(([w,P])=>{const O=r.find(d=>d.name===w);if(!O)return null;const F=s.some(d=>d.targetField===w),H=s.some(d=>d.targetField===w&&d.sourceField==="__default__"),_=P.errors.some(d=>d.type==="required");let V="unknown";return _&&!F?V="map_field":_&&!H?V="add_default":!_&&F&&(V="fix_transformation"),{fieldName:w,fieldDef:O,errorCount:P.count,errors:P.errors,hasMapping:F,hasDefaultMapping:H,actionType:V}}).filter(Boolean),[S,r,s]),M=T.useMemo(()=>k.filter(w=>(w==null?void 0:w.actionType)==="add_default").length,[k]),E=w=>{c(w),f(vo(w.dataType)),m(!0)},z=()=>{if(!u)return;const w={sourceField:"__default__",targetField:u.name,transformations:[{type:"convert",params:{defaultValue:p,targetType:u.dataType}}]};n(w),m(!1)};return t.length===0?e.jsx(pe,{severity:"success",sx:{my:2},children:"No validation errors detected. Your data is ready for export!"}):e.jsxs(he,{sx:{p:0,my:2,borderRadius:1,border:`1px solid ${l.palette.divider}`,overflow:"hidden"},elevation:2,children:[e.jsxs(j,{sx:{p:2,bgcolor:l.palette.mode==="dark"?ce(l.palette.error.dark,.2):ce(l.palette.error.light,.1),borderBottom:`1px solid ${l.palette.divider}`},children:[e.jsxs(b,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(gt,{color:"error"}),"Validation Solutions",e.jsx(de,{label:`${t.length} ${t.length===1?"issue":"issues"}`,color:"error",size:"small",sx:{ml:1}})]}),e.jsx(b,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:M>0?`${M} ${M===1?"issue":"issues"} can be fixed with default values.`:"Review the suggested actions to resolve validation issues."})]}),e.jsxs(qe,{sx:{py:0},children:[M>0&&e.jsxs(Se,{sx:{bgcolor:ce(l.palette.success.light,.1),borderBottom:`1px solid ${l.palette.divider}`,"&:hover":{bgcolor:ce(l.palette.success.light,.2)}},children:[e.jsx(ze,{children:e.jsx(At,{color:"success"})}),e.jsx(Ce,{primary:"Fix Required Fields with Default Values",secondary:`Add default values to ${M} unmapped required ${M===1?"field":"fields"}`}),e.jsx(It,{children:e.jsx(ee,{variant:"outlined",color:"success",size:"small",onClick:()=>{const w=k.find(P=>(P==null?void 0:P.actionType)==="add_default");w!=null&&w.fieldDef&&E(w.fieldDef)},children:"Set Default Values"})})]}),k.map((w,P)=>{var _;if(!w)return null;let O=e.jsx(gt,{color:"error"}),F="error",H="";switch(w.actionType){case"map_field":O=e.jsx(bo,{color:"info"}),F="info",H="Field requires mapping to source data";break;case"add_default":O=e.jsx(lr,{color:"success"}),F="success",H="Field requires a value, add a default";break;case"fix_transformation":O=e.jsx(br,{color:"warning"}),F="warning",H="Field has validation issues with current mapping";break}return e.jsxs(Qe.Fragment,{children:[P>0&&e.jsx(me,{}),e.jsxs(Se,{sx:{py:1.5,"&:hover":{bgcolor:ce(l.palette.primary.light,.05)}},children:[e.jsx(ze,{children:O}),e.jsx(Ce,{primary:e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(b,{variant:"subtitle2",children:w.fieldName}),e.jsx(de,{size:"small",label:`${w.errorCount} ${w.errorCount===1?"error":"errors"}`,color:"error",variant:"outlined"}),w.fieldDef&&e.jsx(de,{size:"small",label:w.fieldDef.dataType,color:"default",variant:"outlined"})]}),secondary:e.jsxs(j,{sx:{mt:.5},children:[e.jsx(b,{variant:"body2",color:"text.secondary",children:H}),e.jsxs(b,{variant:"caption",color:"error",sx:{display:"block",mt:.5},children:[(_=w.errors[0])==null?void 0:_.message,w.errors.length>1&&` (+ ${w.errors.length-1} more)`]})]})}),e.jsxs(It,{children:[w.actionType==="add_default"&&w.fieldDef&&e.jsx(ee,{variant:"outlined",color:F,size:"small",startIcon:e.jsx(lr,{}),onClick:()=>E(w.fieldDef),children:"Add Default"}),(w.actionType==="map_field"||w.actionType==="fix_transformation")&&e.jsx(ee,{variant:"outlined",color:F,size:"small",startIcon:e.jsx(Kr,{}),onClick:()=>a(w.fieldName),children:w.actionType==="map_field"?"Map Field":"Fix Mapping"})]})]})]},w.fieldName)})]}),e.jsxs(lt,{open:o,onClose:()=>m(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(at,{children:["Set Default Value for ",u==null?void 0:u.name]}),e.jsx(ct,{children:e.jsxs(j,{sx:{mt:1},children:[e.jsx(b,{variant:"body2",gutterBottom:!0,children:u==null?void 0:u.description}),e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(b,{variant:"caption",children:"Data Type:"}),e.jsx(de,{size:"small",label:u==null?void 0:u.dataType,color:"primary",variant:"outlined"})]}),(u==null?void 0:u.dataType)==="boolean"?e.jsxs(be,{select:!0,fullWidth:!0,value:p,onChange:w=>f(w.target.value),label:"Default Value",variant:"outlined",margin:"normal",children:[e.jsx(oe,{value:"true",children:"True"}),e.jsx(oe,{value:"false",children:"False"})]}):e.jsx(be,{fullWidth:!0,value:p,onChange:w=>f(w.target.value),label:"Default Value",variant:"outlined",margin:"normal",type:(u==null?void 0:u.dataType)==="number"?"number":"text",helperText:`This value will be used for all records where ${u==null?void 0:u.name} is not mapped or empty`})]})}),e.jsxs(dt,{children:[e.jsx(ee,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(ee,{onClick:z,variant:"contained",color:"primary",startIcon:e.jsx(At,{}),children:"Apply Default Value"})]})]})]})},cr=t=>{const{children:r,value:s,index:n,...a}=t;return e.jsx("div",{role:"tabpanel",hidden:s!==n,id:`preview-tabpanel-${n}`,"aria-labelledby":`preview-tab-${n}`,...a,children:s===n&&e.jsx(j,{sx:{p:2},children:r})})},So=()=>{const t=ut(),{sourceFile:r,transformedData:s,validationErrors:n,selectedTool:a,mappings:l}=He(F=>F.formatter),[o,m]=T.useState(0),[u,c]=T.useState(!1),[p,f]=T.useState(null),S=T.useRef(null),k=(F,H)=>{m(H)},M=()=>{t(Be(1))},E=()=>{t(Be(3))},z=()=>{if(!(!s||!a)){c(!0);try{const F=[...a.requiredFields,...a.optionalFields],H=He(i=>i.formatter.mappings),_={};H&&H.forEach(i=>{if(i.sourceField==="__default__"&&i.transformations){const g=i.transformations.find(C=>C.type==="convert"&&C.params&&C.params.defaultValue!==void 0);g&&(_[i.targetField]=!0,console.log(`Field ${i.targetField} has default value: ${g.params.defaultValue}`))}});const V=s.map(i=>{const g={...i};return Object.keys(_).forEach(C=>{typeof window<"u"&&window.defaultValueRegistry&&window.defaultValueRegistry.register(C,!0)}),g}),d=fo(V,F);t(Ur(d)),d.length===0?t(Me("complete")):t(Me("error"))}catch(F){console.error("Validation error:",F),t(Me("error"))}finally{c(!1)}}},w=(F,H)=>{m(0),f({rowIndex:F,field:H}),setTimeout(()=>{S.current&&S.current.scrollIntoView({behavior:"smooth"})},100),setTimeout(()=>{f(null)},3e3)},P=F=>{console.log("Adding default value mapping:",F),t(Hr(F)),setTimeout(()=>{z()},100)},O=F=>{t(Be(1))};return T.useEffect(()=>{s&&s.length>0&&z()},[s]),!s||s.length===0?e.jsxs(he,{sx:{p:3,textAlign:"center"},children:[e.jsxs(pe,{severity:"warning",sx:{mb:2},children:[e.jsx(bs,{children:"No Data Available"}),"There is no transformed data to preview. Please go back to the field mapping step."]}),e.jsx(ee,{variant:"contained",startIcon:e.jsx(ar,{}),onClick:M,children:"Back to Field Mapping"})]}):e.jsxs(j,{children:[e.jsx(b,{variant:"h5",gutterBottom:!0,sx:{mb:3},children:"Preview & Validate Data"}),e.jsx(he,{sx:{p:2,mb:3},children:e.jsxs(le,{container:!0,spacing:2,children:[e.jsx(le,{size:{xs:12,md:6},children:e.jsxs(j,{children:[e.jsx(b,{variant:"subtitle2",color:"text.secondary",children:"Source File"}),e.jsxs(b,{variant:"body1",children:[(r==null?void 0:r.name)||"No file"," (",r==null?void 0:r.type,")"]})]})}),e.jsx(le,{size:{xs:12,md:6},children:e.jsxs(j,{children:[e.jsx(b,{variant:"subtitle2",color:"text.secondary",children:"Records"}),e.jsxs(b,{variant:"body1",children:[s.length," records processed"]})]})}),e.jsx(le,{size:12,children:e.jsxs(j,{children:[e.jsx(b,{variant:"subtitle2",color:"text.secondary",children:"Validation Status"}),e.jsx(j,{sx:{display:"flex",alignItems:"center",gap:1},children:u?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{size:20}),e.jsx(b,{children:"Validating data..."})]}):n.length===0?e.jsxs(e.Fragment,{children:[e.jsx(Ir,{color:"success"}),e.jsx(b,{color:"success.main",children:"Data validation passed! Ready for export."})]}):e.jsxs(e.Fragment,{children:[e.jsx(uo,{color:"error"}),e.jsxs(b,{color:"error",children:[n.length," validation ",n.length===1?"error":"errors"," found"]})]})})]})})]})}),e.jsx(j,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(yt,{value:o,onChange:k,"aria-label":"preview and validation tabs",children:[e.jsx(Ee,{label:"Data Preview",id:"preview-tab-0","aria-controls":"preview-tabpanel-0"}),e.jsx(Ee,{label:`Validation & Solutions ${n.length>0?`(${n.length})`:""}`,id:"preview-tab-1","aria-controls":"preview-tabpanel-1",sx:{color:n.length>0?"error.main":"inherit"}})]})}),e.jsx(cr,{value:o,index:0,children:e.jsx(j,{ref:S,children:e.jsx(po,{data:s,validationErrors:n,highlightedCell:p})})}),e.jsxs(cr,{value:o,index:1,children:[n.length>0&&a&&e.jsx(jo,{errors:n,targetFields:[...a.requiredFields,...a.optionalFields],mappings:l,onAddDefaultValue:P,onJumpToMapping:O}),e.jsx(yo,{errors:n,onJumpToError:w})]}),e.jsx(me,{sx:{my:3}}),e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(ee,{variant:"outlined",startIcon:e.jsx(ar,{}),onClick:M,children:"Back to Field Mapping"}),e.jsx(ee,{variant:"contained",endIcon:e.jsx(Bt,{}),onClick:E,disabled:n.length>0,children:"Continue to Export"})]})]})},$r=ne(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"})),Co=ne(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"})),xt=ne(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"})),Lt=ne(e.jsx("path",{d:"M15 4v2h3v12h-3v2h5V4zM4 20h5v-2H6V6h3V4H4z"})),Or=ne(e.jsx("path",{d:"M4 7v2c0 .55-.45 1-1 1H2v4h1c.55 0 1 .45 1 1v2c0 1.65 1.35 3 3 3h3v-2H7c-.55 0-1-.45-1-1v-2c0-1.3-.84-2.42-2-2.83v-.34C5.16 11.42 6 10.3 6 9V7c0-.55.45-1 1-1h3V4H7C5.35 4 4 5.35 4 7m17 3c-.55 0-1-.45-1-1V7c0-1.65-1.35-3-3-3h-3v2h3c.55 0 1 .45 1 1v2c0 1.3.84 2.42 2 2.83v.34c-1.16.41-2 1.52-2 2.83v2c0 .55-.45 1-1 1h-3v2h3c1.65 0 3-1.35 3-3v-2c0-.55.45-1 1-1h1v-4z"})),wo=ne(e.jsx("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"})),To=({selectedFormat:t,onFormatChange:r})=>{const s=n=>{r(n.target.value)};return e.jsx(zt,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(Nt,{children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"Select Export Format"}),e.jsx(Ue,{component:"fieldset",children:e.jsxs(Hs,{"aria-label":"export-format",name:"export-format",value:t,onChange:s,children:[e.jsxs(j,{sx:{mb:2,p:1,border:"1px solid",borderColor:t==="csv"?"primary.main":"divider",borderRadius:1,bgcolor:t==="csv"?"action.hover":"transparent"},children:[e.jsx(st,{value:"csv",control:e.jsx(pt,{}),label:e.jsxs(j,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:1},children:[e.jsx(ps,{color:"primary"}),e.jsx(b,{variant:"body1",children:"CSV"}),e.jsx(de,{size:"small",label:"Most Compatible",color:"success"})]})}),e.jsx(b,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"Comma-separated values format, widely supported by spreadsheet applications like Excel and Google Sheets."})]}),e.jsxs(j,{sx:{mb:2,p:1,border:"1px solid",borderColor:t==="json"?"primary.main":"divider",borderRadius:1,bgcolor:t==="json"?"action.hover":"transparent"},children:[e.jsx(st,{value:"json",control:e.jsx(pt,{}),label:e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(wo,{color:"info"}),e.jsx(b,{variant:"body1",children:"JSON"})]})}),e.jsx(b,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"JavaScript Object Notation, ideal for programmatic use or importing into other applications."})]}),e.jsxs(j,{sx:{p:1,border:"1px solid",borderColor:t==="excel"?"primary.main":"divider",borderRadius:1,bgcolor:t==="excel"?"action.hover":"transparent"},children:[e.jsx(st,{value:"excel",control:e.jsx(pt,{}),label:e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xt,{color:"success"}),e.jsx(b,{variant:"body1",children:"Excel"})]})}),e.jsx(b,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"Export directly to native Excel format (.xlsx) with proper formatting and column sizing."})]}),e.jsxs(j,{sx:{p:1,border:"1px solid",borderColor:t==="pdf"?"primary.main":"divider",borderRadius:1,bgcolor:t==="pdf"?"action.hover":"transparent"},children:[e.jsx(st,{value:"pdf",control:e.jsx(pt,{}),label:e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Sr,{color:"error"}),e.jsx(b,{variant:"body1",children:"PDF"}),e.jsx(de,{size:"small",label:"Professional",color:"secondary"})]})}),e.jsx(b,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"Create a professional PDF document with formatted data table, ideal for reports and presentations."})]})]})})]})})},Fo=ne(e.jsx("path",{d:"M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27zM12 17.3c-.72 0-1.3-.58-1.3-1.3s.58-1.3 1.3-1.3 1.3.58 1.3 1.3-.58 1.3-1.3 1.3m1-4.3h-2V7h2z"})),Dt=[{id:"fire-map-pro",name:"Fire Map Pro",description:"Professional mapping and visualization for incident locations and analysis",icon:e.jsx(Kt,{fontSize:"large",sx:{color:"#dc2626"}}),requiredFields:["incidentId","latitude","longitude"],optionalFields:["incidentType","incidentDate","incidentTime","address","city","state","priority","respondingUnit","responseCategory"]},{id:"response-time-analyzer",name:"Response Time Analyzer",description:"Analyze incident response times and visualize performance metrics",icon:e.jsx(hs,{fontSize:"large",sx:{color:"#2196f3"}}),requiredFields:["incidentId","incidentDate"],optionalFields:["dispatchTime","enRouteTime","arrivalTime","latitude","longitude"]},{id:"call-density-heatmap",name:"Call Density Heatmap",description:"Visualize incident density across geographic areas",icon:e.jsx(Kt,{fontSize:"large",sx:{color:"#ff9800"}}),requiredFields:["incidentId","latitude","longitude"]},{id:"incident-dashboard",name:"Incident Dashboard",description:"Interactive dashboard for incident analysis and reporting",icon:e.jsx(fs,{fontSize:"large",sx:{color:"#4caf50"}}),requiredFields:["incidentId","incidentType","incidentDate"]},{id:"trend-analyzer",name:"Trend Analyzer",description:"Identify incident trends and patterns over time",icon:e.jsx(Xr,{fontSize:"large",sx:{color:"#9c27b0"}}),requiredFields:["incidentId","incidentDate","incidentType"]}],Eo=({selectedTool:t,onToolSelect:r,transformedData:s,onSendToTool:n,isSending:a,preTransformedData:l})=>{console.log("📡📡📡 SEND TO TOOL PANEL RENDER - FRESH BUILD JUN 13 2025 16:48 - selectedTool:",t),console.log("📡📡📡 SEND TO TOOL PANEL RENDER - onSendToTool function:",!!n),console.log("📡📡📡 SEND TO TOOL PANEL RENDER - transformedData length:",s==null?void 0:s.length),console.log("📡📡📡 SEND TO TOOL PANEL RENDER - preTransformedData exists:",!!l),console.log("📡📡📡 SEND TO TOOL PANEL RENDER - preTransformedData length:",l==null?void 0:l.length),l&&l.length>0&&console.log("📡📡📡 SEND TO TOOL PANEL RENDER - preTransformedData sample:",l[0]);const o=c=>{r(c.target.value)},u=t?(c=>{const p=Dt.find(E=>E.id===c);if(!p)return{compatible:!1,missingFields:[]};if(c==="fire-map-pro")return console.log("🔍 FIRE MAP PRO COMPATIBILITY CHECK"),console.log("preTransformedData exists:",!!l),console.log("preTransformedData length:",l==null?void 0:l.length),l&&l.length>0?(console.log("✅ Fire Map Pro data is compatible - features exist"),{compatible:!0,missingFields:[],hasOptionalFields:["incidentType","incidentDate","incidentTime","address"],missingOptionalFields:[]}):(console.log("❌ Fire Map Pro data not compatible - no features"),{compatible:!1,missingFields:["incidentId","latitude","longitude"],hasOptionalFields:[],missingOptionalFields:p.optionalFields||[]});if(c==="response-time-analyzer"){console.log("🔍 RESPONSE TIME ANALYZER COMPATIBILITY CHECK - FLEXIBLE FIELD MATCHING");const E=Object.keys(s[0]);console.log("🔍 Available data fields:",E),console.log("🔍 Required fields (camelCase):",p.requiredFields);const z=p.requiredFields.filter(w=>{if(E.includes(w))return console.log(`✅ Found exact match for ${w}`),!1;const P=w.replace(/[A-Z]/g,O=>`_${O.toLowerCase()}`);return E.includes(P)?(console.log(`✅ Found snake_case match for ${w} -> ${P}`),!1):(console.log(`❌ No match found for ${w} (tried ${w} and ${P})`),!0)});return{compatible:z.length===0,missingFields:z,hasOptionalFields:p.optionalFields?p.optionalFields.filter(w=>E.includes(w)||E.includes(w.replace(/[A-Z]/g,P=>`_${P.toLowerCase()}`))):[],missingOptionalFields:p.optionalFields?p.optionalFields.filter(w=>!E.includes(w)&&!E.includes(w.replace(/[A-Z]/g,P=>`_${P.toLowerCase()}`))):[]}}const f=Object.keys(s[0]);console.log(`🔍 ${c.toUpperCase()} COMPATIBILITY CHECK`),console.log("Available fields:",f),console.log("Required fields:",p.requiredFields);const S=p.requiredFields.filter(E=>!f.includes(E)),k=p.optionalFields?p.optionalFields.filter(E=>f.includes(E)):[],M=p.optionalFields?p.optionalFields.filter(E=>!f.includes(E)):[];return{compatible:S.length===0,missingFields:S,hasOptionalFields:k,missingOptionalFields:M}})(t):{compatible:!1,missingFields:[]};return e.jsxs(j,{children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"Send to FireEMS Tool"}),e.jsx(pe,{severity:"info",sx:{mb:3},children:"Send your formatted data directly to another FireEMS tool for analysis and visualization."}),e.jsxs(Ue,{fullWidth:!0,sx:{mb:3},children:[e.jsx(We,{id:"tool-select-label",children:"Select Tool"}),e.jsxs(Ye,{labelId:"tool-select-label",id:"tool-select",value:t||"",label:"Select Tool",onChange:o,children:[e.jsx(oe,{value:"",children:e.jsx("em",{children:"Select a tool..."})}),Dt.map(c=>e.jsx(oe,{value:c.id,children:c.name},c.id))]})]}),t&&e.jsx(le,{container:!0,spacing:3,children:Dt.filter(c=>c.id===t).map(c=>e.jsx(le,{size:12,children:e.jsxs(zt,{variant:"outlined",children:[e.jsxs(Nt,{children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",mb:2},children:[c.icon,e.jsxs(j,{sx:{ml:2},children:[e.jsx(b,{variant:"h6",children:c.name}),e.jsx(b,{variant:"body2",color:"text.secondary",children:c.description})]})]}),e.jsx(me,{sx:{mb:2}}),e.jsx(b,{variant:"subtitle2",gutterBottom:!0,children:"Required Fields:"}),e.jsx(j,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:c.requiredFields.map((p,f)=>e.jsx(b,{variant:"body2",sx:{backgroundColor:u.missingFields.includes(p)?"error.light":"success.light",color:u.missingFields.includes(p)?"error.contrastText":"success.contrastText",borderRadius:1,px:1,py:.5},children:p},f))}),c.optionalFields&&e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"subtitle2",gutterBottom:!0,children:"Optional Fields:"}),e.jsx(j,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:c.optionalFields.map((p,f)=>{var S,k;return e.jsx(b,{variant:"body2",sx:{backgroundColor:(S=u.hasOptionalFields)!=null&&S.includes(p)?"info.light":"action.disabledBackground",color:(k=u.hasOptionalFields)!=null&&k.includes(p)?"info.contrastText":"text.secondary",borderRadius:1,px:1,py:.5},children:p},f)})})]}),!u.compatible&&e.jsxs(pe,{severity:"warning",icon:e.jsx(Fo,{}),sx:{mb:2},children:[e.jsx(b,{variant:"body2",gutterBottom:!0,children:"Your data is missing required fields for this tool:"}),e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:u.missingFields.map((p,f)=>e.jsx("li",{children:p},f))})]}),u.compatible&&e.jsxs(pe,{severity:"success",sx:{mb:2},children:[e.jsx(b,{variant:"body2",gutterBottom:!0,children:"Your data is compatible with this tool. All required fields are present."}),c.optionalFields&&u.hasOptionalFields&&u.hasOptionalFields.length>0&&e.jsxs(b,{variant:"body2",children:[u.hasOptionalFields.length," of ",c.optionalFields.length," optional fields are available for enhanced analysis."]})]})]}),e.jsx(Rs,{children:e.jsx(ee,{type:"button",variant:"contained",color:"primary",fullWidth:!0,disabled:!u.compatible||a,startIcon:a?e.jsx(Ze,{size:20}):e.jsx($r,{}),onClick:p=>{p.preventDefault(),p.stopPropagation(),console.log("🚀🚀🚀 SEND TO TOOL BUTTON CLICKED - FRESH BUILD JUN 13 2025 16:49 - tool.id:",c.id),console.log("🚀🚀🚀 SEND TO TOOL BUTTON - onSendToTool function:",n),n()},children:a?"Sending...":`Send to ${c.name}`})})]})},c.id))})]})},Do=({dataCount:t,fields:r,format:s})=>{const n=()=>{let l=15;s==="json"?l=25:s==="excel"?l=30:s==="pdf"&&(l=40);const o=t*r.length*l;let m=0;s==="excel"?m=5120:s==="pdf"&&(m=15360);const u=o+m;return u<1048576?`${Math.round(u/1024)} KB`:`${(u/1048576).toFixed(2)} MB`},a=()=>{switch(s){case"csv":return e.jsx(Lt,{color:"primary"});case"json":return e.jsx(Or,{color:"info"});case"excel":return e.jsx(xt,{color:"success"});case"pdf":return e.jsx(Sr,{color:"error"});default:return e.jsx(Lt,{})}};return e.jsx(zt,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(Nt,{children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"Export Summary"}),e.jsxs(qe,{disablePadding:!0,children:[e.jsxs(Se,{children:[e.jsx(ze,{sx:{minWidth:"40px"},children:a()}),e.jsx(Ce,{primary:"Format",secondary:s.toUpperCase()})]}),e.jsx(me,{component:"li"}),e.jsxs(Se,{children:[e.jsx(ze,{sx:{minWidth:"40px"},children:e.jsx(nt,{color:"success"})}),e.jsx(Ce,{primary:"Records",secondary:`${t} records will be exported`})]}),e.jsx(me,{component:"li"}),e.jsxs(Se,{children:[e.jsx(ze,{sx:{minWidth:"40px"},children:e.jsx(nt,{color:"success"})}),e.jsx(Ce,{primary:"Fields",secondary:`${r.length} fields per record`})]}),e.jsx(me,{component:"li"}),e.jsxs(Se,{children:[e.jsx(ze,{sx:{minWidth:"40px"},children:e.jsx(nt,{color:"success"})}),e.jsx(Ce,{primary:"Estimated Size",secondary:n()})]})]}),e.jsx(b,{variant:"subtitle2",sx:{mt:2},children:"Fields included:"}),e.jsx(j,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:r.map((l,o)=>e.jsx(de,{label:l,size:"small"},o))})]})})};console.log("🚨🚨🚨 EXPORT CONTAINER LOADED - NEW VERSION WITH UPFRONT TRANSFORMATION AT",new Date().toISOString());const Ro=t=>!t||t.length===0?t:JSON.parse(JSON.stringify(t)).map(s=>{const n={...s};return["Incident Date"].forEach(o=>{if(n[o]&&typeof n[o]=="string")try{const m=new Date(n[o]);if(isNaN(m.getTime()))n[o].includes(" ")&&(n[o]=n[o].split(" ")[0]);else{const u=(m.getMonth()+1).toString().padStart(2,"0"),c=m.getDate().toString().padStart(2,"0"),p=m.getFullYear();n[o]=`${u}/${c}/${p}`}}catch{n[o].includes(" ")&&(n[o]=n[o].split(" ")[0])}}),["Dispatch Time","En Route Time","Arrival Time","Incident Time"].forEach(o=>{if(n[o]&&typeof n[o]=="string")try{const m=new Date(n[o]);if(isNaN(m.getTime())){if(n[o].includes(" ")){const u=n[o].split(" ");u.length>1&&(n[o]=u[1])}}else{const u=m.getHours().toString().padStart(2,"0"),c=m.getMinutes().toString().padStart(2,"0"),p=m.getSeconds().toString().padStart(2,"0");n[o]=`${u}:${c}:${p}`}}catch{if(n[o].includes(" ")){const u=n[o].split(" ");u.length>1&&(n[o]=u[1])}}}),n}),dr=t=>{const{children:r,value:s,index:n,...a}=t;return e.jsx("div",{role:"tabpanel",hidden:s!==n,id:`export-tabpanel-${n}`,"aria-labelledby":`export-tab-${n}`,...a,children:s===n&&e.jsx(j,{sx:{p:2},children:r})})},Io=()=>{const t=ut(),{sourceFile:r,transformedData:s,validationErrors:n}=He(R=>R.formatter),[a,l]=T.useState(0),[o,m]=T.useState("csv"),[u,c]=T.useState(null),[p,f]=T.useState(null),[S,k]=T.useState(!1),[M,E]=T.useState({success:!1,message:"",open:!1}),[z,w]=T.useState([]),[P,O]=T.useState(!1);T.useEffect(()=>{try{const R=localStorage.getItem("fireEmsExportHistory");R&&w(JSON.parse(R))}catch(R){console.error("Error loading export history:",R)}},[]),T.useEffect(()=>{try{localStorage.setItem("fireEmsExportHistory",JSON.stringify(z))}catch(R){console.error("Error saving export history:",R)}},[z]);const F=(R,v)=>{l(v)},H=R=>{m(R)},_=R=>{var v,$;if(console.log("🚨🚨🚨 CRITICAL DEBUG: handleToolChange CALLED AT",new Date().toISOString()),console.log("🔧 TOOL SELECTION CHANGED - TRANSFORMING DATA UPFRONT:",R),console.log("🔧 transformedData exists:",!!s),console.log("🔧 transformedData length:",s==null?void 0:s.length),console.log('🔧 toolId === "response-time-analyzer":',R==="response-time-analyzer"),c(R),R==="response-time-analyzer"&&s&&s.length>0){console.log("🔧 APPLYING RESPONSE TIME ANALYZER TRANSFORMATION - UPFRONT METHOD"),console.log("Original data sample (first record):",s[0]),console.log("Original field names:",Object.keys(s[0]));try{const h=St.transformToResponseTimeAnalyzer(s);if(!h.success){console.error("❌ Data transformation failed:",h.errors),f(null);return}const D=h.data||[];console.log("✅ UPFRONT TRANSFORMATION SUCCESS"),console.log("Transformed data sample (first record):",D[0]),console.log("Transformed field names:",Object.keys(D[0])),console.log("incidentTime value:",(v=D[0])==null?void 0:v.incidentTime),f(D)}catch(h){console.error("❌ Error during upfront transformation:",h),f(null)}}else if(R==="fire-map-pro"&&s&&s.length>0){console.log("🔧 APPLYING FIRE MAP PRO TRANSFORMATION - UPFRONT METHOD"),console.log("Original data sample (first record):",s[0]),console.log("Original field names:",Object.keys(s[0]));try{const h=St.transformToFireMapPro(s);if(!h.success){console.error("❌ Fire Map Pro transformation failed:",h.errors),f(null);return}const D=(($=h.data)==null?void 0:$.features)||[];console.log("✅ FIRE MAP PRO UPFRONT TRANSFORMATION SUCCESS"),console.log("Transformed features count:",D.length),console.log("Sample feature:",D[0]),f(D)}catch(h){console.error("❌ Error during Fire Map Pro upfront transformation:",h),f(null)}}else f(null)},V=(R,v,$,h,D)=>{const y={id:`export-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,timestamp:Date.now(),format:R,recordCount:v,success:$,destination:h,fileName:D};w(I=>[y,...I].slice(0,20))},d=()=>{w([])},i=()=>{const R=new Date;return R.toLocaleDateString()+" "+R.toLocaleTimeString()},g=async()=>{if(!s||s.length===0){E({success:!1,message:"No data to export",open:!0});return}k(!0);try{const R=Ro(s);let v=`formatted_data_${Date.now()}`;if(o==="excel"){const x=await pr(()=>import("./xlsx-DkH2s96g.js"),[]),B=x.utils.json_to_sheet(R),q={},K=Object.keys(s[0]);K.forEach(Y=>{q[Y]=Math.max(10,Y.length+2)}),s.forEach(Y=>{K.forEach(L=>{const U=String(Y[L]||"");q[L]=Math.min(50,Math.max(q[L],U.length+2))})}),B["!cols"]=K.map(Y=>({wch:q[Y]}));const Z=x.utils.book_new();Z.Props={Title:"FireEMS Formatted Data",Subject:"Incident Data",Author:"FireEMS Data Formatter",CreatedDate:new Date},x.utils.book_append_sheet(Z,B,"Formatted Data"),v=`formatted_data_${Date.now()}.xlsx`,x.writeFile(Z,v),V("Excel",R.length,!0,"File Download",v),E({success:!0,message:"Data exported successfully as EXCEL",open:!0}),k(!1);return}if(o==="pdf"){const x=new Zr;x.setFontSize(18),x.text("FireEMS Formatted Data",14,22),x.setFontSize(11),x.text(`Export Date: ${i()}`,14,30),x.text(`Records: ${R.length}`,14,36);const B=Object.keys(R[0]);R.length>500&&x.text("Note: Export limited to 500 records for PDF format.",14,42);const q=R.length>500?48:42,K=30,Z=10,Y=10;x.setFontSize(10),x.setTextColor(0,0,0),x.setFillColor(220,220,220),B.forEach((U,N)=>{x.rect(Y+N*K,q,K,Z,"FD"),x.text(U,Y+N*K+2,q+7)});const L=Math.min(R.length,20);for(let U=0;U<L;U++){const N=q+(U+1)*Z;B.forEach((re,G)=>{x.rect(Y+G*K,N,K,Z,"S");const te=R[U][re]||"";let se=String(te);se.length>10&&(se=se.substring(0,8)+"..."),x.text(se,Y+G*K+2,N+7)})}x.setFontSize(8),x.text(`Generated by FireEMS Tools - ${new Date().toLocaleString()}`,x.internal.pageSize.width/2,x.internal.pageSize.height-10,{align:"center"}),v=`formatted_data_${Date.now()}.pdf`,x.save(v),V("PDF",R.length,!0,"File Download",v),E({success:!0,message:"Data exported successfully as PDF",open:!0}),k(!1);return}let $="",h="";if(o==="csv"){const x=Object.keys(R[0]);$=x.join(",")+`
`,R.forEach(B=>{const q=x.map(K=>{const Z=B[K];return Z==null?"":typeof Z=="string"&&(Z.includes(",")||Z.includes('"')||Z.includes(`
`))?`"${Z.replace(/"/g,'""')}"`:Z});$+=q.join(",")+`
`}),v=`formatted_data_${Date.now()}.csv`,h="text/csv"}else o==="json"&&($=JSON.stringify(R,null,2),v=`formatted_data_${Date.now()}.json`,h="application/json");const D=new Blob([$],{type:h}),y=URL.createObjectURL(D),I=document.createElement("a");I.href=y,I.download=v,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(y),V(o.toUpperCase(),R.length,!0,"File Download",v),E({success:!0,message:`Data exported successfully as ${o.toUpperCase()}`,open:!0})}catch(R){console.error("Export error:",R),E({success:!1,message:`Error exporting data: ${R instanceof Error?R.message:"Unknown error"}`,open:!0}),V(o.toUpperCase(),s.length,!1,"File Download")}finally{k(!1)}},C=R=>({"response-time-analyzer":"Response Time Analyzer","call-density-heatmap":"Call Density Heatmap","incident-dashboard":"Incident Dashboard","trend-analyzer":"Trend Analyzer"})[R]||R,A=async()=>{var v,$;if(console.log("🚨🚨🚨 CRITICAL DEBUG: handleSendToTool FUNCTION CALLED AT",new Date().toISOString()),console.log("🚀🚀🚀 selectedExportTool:",u),console.log("🚀🚀🚀 transformedData length:",s==null?void 0:s.length),console.log("🚀🚀🚀 preTransformedData length:",p==null?void 0:p.length),console.log("🚀🚀🚀 transformedData sample:",s==null?void 0:s[0]),!s||s.length===0||!u){console.log("❌ SEND TO TOOL FAILED - Missing data or tool selection"),console.log("❌ transformedData:",!!s),console.log("❌ transformedData.length:",s==null?void 0:s.length),console.log("❌ selectedExportTool:",u),E({success:!1,message:"No data or tool selected",open:!0});return}k(!0);const R=C(u);console.log("🚀 Tool name resolved:",R);try{let h;if(console.log('🔧 CHECKING TOOL TYPE - selectedExportTool === "response-time-analyzer":',u==="response-time-analyzer"),console.log("🔧 CHECKING PRE-TRANSFORMED DATA AVAILABILITY:",!!p),u==="response-time-analyzer"&&p&&p.length>0)console.log("✅ USING PRE-TRANSFORMED DATA FROM TOOL SELECTION - NO REDUNDANT TRANSFORMATION"),console.log("Pre-transformed data sample (first record):",p[0]),console.log("Pre-transformed field names:",Object.keys(p[0])),console.log("incidentTime value:",(v=p[0])==null?void 0:v.incidentTime),h=p;else if(u==="fire-map-pro"){console.log("🔧 APPLYING FIRE MAP PRO TRANSFORMATION");const y=St.transformToFireMapPro(s);if(!y.success)throw console.error("❌ Data transformation failed:",y.errors),new Error(`Data transformation failed: ${y.errors.join(", ")}`);h=(($=y.data)==null?void 0:$.features)||[]}else console.log("🔧 USING STANDARD DATA FORMATTING"),console.log("DEBUG - USING ALREADY TRANSFORMED DATA: Sample data fields:",s.length>0?Object.keys(s[0]):"No data"),h=s.map(y=>{const I={...y};return console.log("DEBUG - USING MAPPED DATA: Record fields:",Object.keys(y)),Object.keys(I).forEach(x=>{if(I[x]&&typeof I[x]=="string"&&I[x].includes(" ")){const[B,q]=I[x].split(" ");console.log(`DATETIME SPLIT: Field "${x}" = "${I[x]}" -> Date: "${B}", Time: "${q}"`),x.toLowerCase().includes("date")?(console.log(`SETTING DATE FIELD "${x}" to "${B}"`),I[x]=B):x.toLowerCase().includes("time")&&(console.log(`SETTING TIME FIELD "${x}" to "${q}"`),I[x]=q)}}),I});const D={toolId:u,toolName:R,data:h,sourceFile:r==null?void 0:r.name,timestamp:Date.now(),fields:Object.keys(h[0]),recordCount:h.length,exportVersion:"2.0"};if(h.length>0){console.log("Sample record being sent (using user-mapped fields):",h[0]);const y=h[0],I=Object.keys(y);console.log("All field names (as mapped by user):",I),console.log("Field values:",y)}sessionStorage.removeItem("fireEmsExportedData"),console.log("VERIFY: Field names being stored in sessionStorage:",D.data&&D.data.length>0?Object.keys(D.data[0]):"No data"),sessionStorage.setItem("fireEmsExportedData",JSON.stringify(D)),console.log(`Data prepared for ${u}. Data size: ${h.length} records`),h.length>0&&(console.log("FIELD NAMES CHECK - Sample record being sent to session storage:"),console.log(JSON.stringify(h[0]))),V("Data Transfer",h.length,!0,R),E({success:!0,message:`Data sent to ${R} successfully!`,open:!0}),setTimeout(()=>{const x=`http://${window.location.hostname}:5006`;let B="";if(u==="fire-map-pro")B=`${window.location.origin}/app/fire-map-pro`;else if(u==="response-time-analyzer")B=`${window.location.origin}/app/response-time-analyzer`;else if(u==="call-density-heatmap")B=`${x}/call-density-heatmap`;else if(u==="incident-dashboard")B=`${x}/incident-dashboard`;else if(u==="trend-analyzer")B=`${x}/trend-analyzer`;else{console.log(`Tool ID not recognized: ${u}`);return}console.log(`Redirecting to: ${B}`),window.location.href=B},500)}catch(h){console.error("Send to tool error:",h),E({success:!1,message:`Error sending data to tool: ${h instanceof Error?h.message:"Unknown error"}`,open:!0}),V("Data Transfer",s.length,!1,R)}finally{k(!1)}},W=()=>{t(Be(2))};if(!s||s.length===0)return e.jsxs(j,{children:[e.jsx(pe,{severity:"warning",sx:{mb:2},children:"No data available to export. Please go back and ensure your data is processed correctly."}),e.jsx(ee,{variant:"outlined",startIcon:e.jsx(ot,{}),onClick:W,children:"Back to Validation"})]});const X=R=>new Date(R).toLocaleString(),ae=()=>z.length===0?e.jsx(j,{sx:{p:2,textAlign:"center"},children:e.jsx(b,{color:"text.secondary",children:"No export history available"})}):e.jsx(qe,{sx:{width:"100%",bgcolor:"background.paper"},dense:!0,children:z.map(R=>e.jsxs(Se,{secondaryAction:e.jsx(De,{edge:"end","aria-label":"delete",onClick:()=>{w(v=>v.filter($=>$.id!==R.id))},children:e.jsx(mt,{fontSize:"small"})}),sx:{borderLeft:"4px solid",borderColor:R.success?"success.main":"error.main",mb:1,bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},children:[e.jsxs(ze,{children:[R.format==="Excel"&&e.jsx(xt,{color:"success"}),R.format==="CSV"&&e.jsx(Lt,{color:"primary"}),R.format==="JSON"&&e.jsx(Or,{color:"info"}),R.format==="PDF"&&e.jsx(xt,{color:"error"}),R.format==="Data Transfer"&&e.jsx($r,{color:"secondary"})]}),e.jsx(Ce,{primary:e.jsx(b,{variant:"body2",fontWeight:"medium",children:R.format==="Data Transfer"?`Sent to ${R.destination}`:`${R.format} Export${R.fileName?` - ${R.fileName}`:""}`}),secondary:e.jsxs(b,{variant:"caption",display:"block",children:[X(R.timestamp)," • ",R.recordCount," records",!R.success&&" • Failed"]})})]},R.id))});return console.log("🔥🔥🔥 EXPORT CONTAINER RENDER - FRESH BUILD JUN 13 2025 16:47 - transformedData length:",s==null?void 0:s.length),console.log("🔥🔥🔥 EXPORT CONTAINER RENDER - selectedExportTool:",u),console.log("🔥🔥🔥 EXPORT CONTAINER RENDER - tabValue:",a),e.jsxs(j,{children:[e.jsx(b,{variant:"h5",gutterBottom:!0,sx:{mb:3},children:"Export Formatted Data"}),e.jsxs(he,{sx:{p:2,mb:3},children:[e.jsxs(le,{container:!0,spacing:2,children:[e.jsx(le,{size:{xs:12,md:4},children:e.jsxs(j,{children:[e.jsx(b,{variant:"subtitle2",color:"text.secondary",children:"Source File"}),e.jsxs(b,{variant:"body1",children:[(r==null?void 0:r.name)||"No file"," (",r==null?void 0:r.type,")"]})]})}),e.jsx(le,{size:{xs:12,md:4},children:e.jsxs(j,{children:[e.jsx(b,{variant:"subtitle2",color:"text.secondary",children:"Records"}),e.jsxs(b,{variant:"body1",children:[s.length," records processed"]})]})}),e.jsx(le,{size:{xs:12,md:4},children:e.jsxs(j,{children:[e.jsx(b,{variant:"subtitle2",color:"text.secondary",children:"Validation Status"}),e.jsx(j,{sx:{display:"flex",alignItems:"center",gap:1},children:n.length===0?e.jsxs(e.Fragment,{children:[e.jsx(nt,{color:"success"}),e.jsx(b,{color:"success.main",children:"All data is valid"})]}):e.jsx(e.Fragment,{children:e.jsxs(pe,{severity:"warning",sx:{mt:1},children:[n.length," validation issues found. Consider reviewing before export."]})})})]})})]}),e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2,pt:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Co,{color:"action",fontSize:"small"}),e.jsx(b,{variant:"subtitle2",color:"text.secondary",children:"Export History"}),z.length>0&&e.jsx(Ts,{badgeContent:z.length,color:"primary",sx:{ml:1}})]}),e.jsxs(j,{children:[e.jsx(De,{size:"small",onClick:()=>O(!P),"aria-label":P?"Hide history":"Show history",children:P?e.jsx(hr,{}):e.jsx(bt,{})}),z.length>0&&P&&e.jsx(ee,{size:"small",startIcon:e.jsx(mt,{}),onClick:d,sx:{ml:1},children:"Clear"})]})]}),e.jsx(vr,{in:P,children:e.jsx(j,{sx:{mt:2},children:ae()})})]}),e.jsx(j,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(yt,{value:a,onChange:F,"aria-label":"export options tabs",children:[e.jsx(Ee,{label:"Download File",id:"export-tab-0","aria-controls":"export-tabpanel-0"}),e.jsx(Ee,{label:"Send to Tool",id:"export-tab-1","aria-controls":"export-tabpanel-1"})]})}),e.jsx(dr,{value:a,index:0,children:e.jsxs(le,{container:!0,spacing:3,children:[e.jsx(le,{size:{xs:12,md:6},children:e.jsx(To,{selectedFormat:o,onFormatChange:H})}),e.jsx(le,{size:{xs:12,md:6},children:e.jsx(Do,{dataCount:s.length,fields:Object.keys(s[0]),format:o})}),e.jsx(le,{size:12,children:e.jsx(ee,{variant:"contained",color:"primary",fullWidth:!0,size:"large",onClick:g,disabled:S,startIcon:S?e.jsx(Ze,{size:20}):e.jsx(ms,{}),sx:{mt:2},children:S?"Exporting...":`Download as ${o.toUpperCase()}`})})]})}),e.jsx(dr,{value:a,index:1,children:e.jsx(Eo,{selectedTool:u,onToolSelect:_,transformedData:s,onSendToTool:A,isSending:S,preTransformedData:p})}),e.jsx(me,{sx:{my:3}}),e.jsx(j,{sx:{display:"flex",justifyContent:"space-between"},children:e.jsx(ee,{variant:"outlined",startIcon:e.jsx(ot,{}),onClick:W,children:"Back to Validation"})}),e.jsx(jr,{open:M.open,autoHideDuration:6e3,onClose:()=>E({...M,open:!1}),children:e.jsx(pe,{onClose:()=>E({...M,open:!1}),severity:M.success?"success":"error",children:M.message})})]})},ko=["Upload File","Map Fields","Preview & Validate","Export"],Lo=()=>{const{currentStep:t}=He(n=>n.formatter),r=()=>{const n=window.location.pathname;return n.includes("fire-map-pro")?"FireEMS Fire Map Pro":n.includes("response-time-analyzer")?"FireEMS Response Time Analyzer":"FireEMS Data Formatter"};Qe.useEffect(()=>{const n=r();document.title=n},[]);const s=n=>{switch(n){case 0:return e.jsx(In,{});case 1:return e.jsx(co,{});case 2:return e.jsx(So,{});case 3:return e.jsx(Io,{});default:return e.jsx(b,{children:"Unknown step"})}};return e.jsx(Wr,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsxs(he,{elevation:3,sx:{p:3},children:[e.jsx(b,{variant:"h4",component:"h1",gutterBottom:!0,children:r()}),e.jsx(xn,{activeStep:t,sx:{mb:4},children:ko.map(n=>e.jsx(Gs,{children:e.jsx(Fr,{children:n})},n))}),e.jsx(j,{sx:{mt:2},children:s(t)})]})})};export{Lo as default};
