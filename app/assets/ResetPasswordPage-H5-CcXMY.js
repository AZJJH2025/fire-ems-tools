import{cP as J,cT as U,r as o,j as e,cO as f,F as C,H as k,b_ as Z,v as r,ag as m,cU as A,X as $,P as D,t as x,U as I,V as L,Z as B,J as H,aL as X}from"./index-DyApsJUv.js";import{L as T}from"./LinearProgress-C56RvgFz.js";import{L as W}from"./Lock-D39BdUd5.js";import{a as O,V as R}from"./VisibilityOff-CHGs3UaY.js";const ee=()=>{const u=J(),[j]=U(),c=j.get("token"),l=j.get("email"),[t,N]=o.useState(""),[a,z]=o.useState(""),[w,E]=o.useState(!1),[p,V]=o.useState(!1),[d,b]=o.useState(!1),[P,i]=o.useState(null),[F,q]=o.useState(!1),g=[{test:s=>s.length>=8,label:"At least 8 characters"},{test:s=>/[A-Z]/.test(s),label:"One uppercase letter"},{test:s=>/[a-z]/.test(s),label:"One lowercase letter"},{test:s=>/\d/.test(s),label:"One number"},{test:s=>/[!@#$%^&*(),.?\":{}|<>]/.test(s),label:"One special character"}],n=g.filter(s=>s.test(t)).length,y=n>=3;o.useEffect(()=>{(!c||!l)&&i("Invalid reset link. Please request a new password reset.")},[c,l]);const Y=async s=>{if(s.preventDefault(),!c||!l){i("Invalid reset link. Please request a new password reset.");return}if(!y){i("Password does not meet security requirements");return}if(t!==a){i("Passwords do not match");return}b(!0),i(null);try{const S=await(await fetch("/auth/api/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:l,token:c,newPassword:t,confirmPassword:a})})).json();S.success?(q(!0),setTimeout(()=>{u("/login",{state:{message:"Password reset successfully. You can now log in."}})},3e3)):i(S.message||"Failed to reset password")}catch(h){console.error("Password reset error:",h),i("An error occurred while resetting your password")}finally{b(!1)}},v=()=>n<=1?"error":n<=2?"warning":n<=3?"info":"success",G=()=>n<=1?"Weak":n<=2?"Fair":n<=3?"Good":"Strong";return!c||!l?e.jsx(f,{maxWidth:"sm",sx:{mt:8},children:e.jsx(C,{children:e.jsxs(k,{sx:{textAlign:"center",py:4},children:[e.jsx(Z,{sx:{fontSize:64,color:"error.main",mb:2}}),e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Invalid Reset Link"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"This password reset link is invalid or has expired. Please request a new password reset."}),e.jsx(m,{variant:"contained",onClick:()=>u("/login"),startIcon:e.jsx(A,{}),children:"Back to Login"})]})})}):F?e.jsx(f,{maxWidth:"sm",sx:{mt:8},children:e.jsx(C,{children:e.jsxs(k,{sx:{textAlign:"center",py:4},children:[e.jsx($,{sx:{fontSize:64,color:"success.main",mb:2}}),e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Password Reset Successfully"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Your password has been updated. You will be redirected to the login page shortly."}),e.jsx(T,{sx:{mb:2}}),e.jsx(m,{variant:"contained",onClick:()=>u("/login"),children:"Go to Login"})]})})}):e.jsx(f,{maxWidth:"sm",sx:{mt:8},children:e.jsxs(D,{elevation:3,sx:{p:4},children:[e.jsxs(x,{sx:{textAlign:"center",mb:4},children:[e.jsx(W,{sx:{fontSize:48,color:"primary.main",mb:2}}),e.jsx(r,{variant:"h4",gutterBottom:!0,children:"Reset Password"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Enter your new password for ",l]})]}),e.jsxs(x,{component:"form",onSubmit:Y,children:[e.jsx(I,{fullWidth:!0,label:"New Password",type:w?"text":"password",value:t,onChange:s=>N(s.target.value),disabled:d,sx:{mb:2},InputProps:{endAdornment:e.jsx(L,{position:"end",children:e.jsx(B,{onClick:()=>E(!w),edge:"end",children:w?e.jsx(O,{}):e.jsx(R,{})})})}}),t&&e.jsxs(x,{sx:{mb:2},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"body2",sx:{mr:1},children:"Password Strength:"}),e.jsx(r,{variant:"body2",color:`${v()}.main`,sx:{fontWeight:"bold"},children:G()})]}),e.jsx(T,{variant:"determinate",value:n/g.length*100,color:v(),sx:{mb:1}}),e.jsx(x,{children:g.map((s,h)=>e.jsxs(r,{variant:"caption",sx:{display:"block",color:s.test(t)?"success.main":"text.secondary"},children:[s.test(t)?"✓":"○"," ",s.label]},h))})]}),e.jsx(I,{fullWidth:!0,label:"Confirm New Password",type:p?"text":"password",value:a,onChange:s=>z(s.target.value),disabled:d,sx:{mb:3},error:a!==""&&t!==a,helperText:a!==""&&t!==a?"Passwords do not match":"",InputProps:{endAdornment:e.jsx(L,{position:"end",children:e.jsx(B,{onClick:()=>V(!p),edge:"end",children:p?e.jsx(O,{}):e.jsx(R,{})})})}}),P&&e.jsx(H,{severity:"error",sx:{mb:2},children:P}),e.jsx(m,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:d||!y||t!==a,startIcon:d?e.jsx(X,{size:20}):e.jsx(W,{}),sx:{mb:2},children:d?"Resetting Password...":"Reset Password"}),e.jsx(m,{fullWidth:!0,variant:"text",onClick:()=>u("/login"),disabled:d,startIcon:e.jsx(A,{}),children:"Back to Login"})]})]})})};export{ee as default};
