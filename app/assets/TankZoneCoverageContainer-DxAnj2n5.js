import{j as e,k as Z,l as T,aP as ee,aQ as oe,aR as ie,aS as le,aT as V,aU as ce,aV as de,B as v,aW as ge,aX as N,aY as ve,aZ as fe,a_ as ye,a$ as ue,b0 as _,b1 as pe,b2 as he,b3 as be,b4 as je,b5 as Te,r as f,b6 as me,b7 as ke,R as ae,b8 as Ce}from"./index-CKoWj7hq.js";import{S as Se,P as we,C as Ie,A as Ae,a as Re,M as Ee,E as Le,D as ze}from"./A11yProvider-CjiWYF0p.js";import{c as te,T as c,P as $,u as De}from"./Typography-uTeN5rPM.js";import{L as U}from"./LocalFireDepartment-DRA6AM7L.js";import{m as Fe,n as P,T as R,M as h,L as Q,q as J,r as Me,s as K,C as X,v as Pe,k as O,A as F,p as Be,i as B,D as Y,f as We,g as $e,h as Oe,G as w,l as ne,j as Ze,R as Ge,w as Ne}from"./Settings-QgWeglKc.js";import{B as D}from"./Button-CPwSjRTz.js";import{A as qe,D as Ue,S as W,a as xe}from"./Delete-nc689hCl.js";import{F as Ve,L as He}from"./FilterList-vf_l0-LY.js";import{A as _e}from"./Assessment-D4zCJ9tr.js";import{D as se}from"./Download-CELzst2M.js";import{l as z,u as Qe,F as Je,a as Ke}from"./leaflet-BxRVlnE9.js";const Xe=te(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"})),Ye=te(e.jsx("path",{d:"M8 5v14l11-7z"})),re=te(e.jsx("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"})),et=({mode:n})=>{const o=Z(),x=T(ee),k=T(oe);T(ie);const u=T(le),a=T(V),d=T(ce),i=T(de),I=(t,p)=>{o(ge(p))},b=()=>{if(x.length===0){alert("Please add at least one tank before running analysis.");return}o(je()),console.log("🔬 Starting coverage analysis for",x.length,"tanks..."),setTimeout(()=>{var p;const t={totalTanks:x.length,coveragePercentage:75+Math.random()*20,gapAreas:[{id:"gap-1",area:160934,severity:"critical",geometry:[],nearestTank:{tankId:((p=x[0])==null?void 0:p.id)||"tank-1",distance:2100,accessTime:8},riskAssessment:"high"}],redundancyAreas:[],recommendations:[{id:"rec-1",type:"new-tank",priority:"high",title:"Add Tank in Northern Coverage Gap",description:"Critical coverage gap identified in northern sector requiring additional water supply.",estimatedCost:75e3,expectedBenefit:"Reduce response time by 4 minutes for 150 properties",implementation:"Install 25,000 gallon tank with road access"}],generatedAt:new Date,analysisParameters:d};o(Te(t)),console.log("✅ Analysis complete:",t)},2e3)},C=t=>{a.selectedTanks.includes(t)?o(pe(t)):o(he(t))},E=t=>{o(be(t))},s=()=>{const t={name:`Tank ${x.length+1}`,location:{latitude:39.8283+(Math.random()-.5)*.1,longitude:-98.5795+(Math.random()-.5)*.1},capacity:25e3,type:"municipal",accessRating:"good",operationalStatus:"active",owner:"Fire Department",contactInfo:"",notes:"Added via Add Tank button"};o(ue(t)),console.log("🎯 Tank added:",t)},m=()=>{const t=document.createElement("input");t.type="file",t.accept=".csv",t.onchange=p=>{var M;const L=(M=p.target.files)==null?void 0:M[0];L&&(console.log("📁 CSV file selected:",L.name),alert(`CSV Import selected: ${L.name}

CSV parsing will be implemented in the next development phase.`))},t.click()},r=t=>{const p=t.target.value;o(_({tankTypes:p==="all"?[]:[p]})),console.log("🔍 Tank type filter changed:",p)},l=t=>{const p=t.target.value;o(_({operationalStatus:p==="all"?[]:[p]})),console.log("🔍 Status filter changed:",p)},S=(t,p)=>{const L=Array.isArray(p)?p:[0,p];o(_({capacityRange:L})),console.log("🔍 Capacity range changed:",L)},g=()=>e.jsxs(v,{sx:{p:2},children:[e.jsxs(v,{sx:{mb:2,display:"flex",gap:1},children:[e.jsx(D,{variant:"outlined",startIcon:e.jsx(qe,{}),size:"small",fullWidth:!0,onClick:s,children:"Add Tank"}),e.jsx(D,{variant:"outlined",startIcon:e.jsx(re,{}),size:"small",fullWidth:!0,onClick:m,children:"Import CSV"})]}),e.jsxs($,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(c,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(Ve,{sx:{mr:1,verticalAlign:"middle"}}),"Filters"]}),e.jsxs(R,{select:!0,size:"small",label:"Tank Type",fullWidth:!0,margin:"dense",value:a.filterCriteria.tankTypes[0]||"all",onChange:r,children:[e.jsx(h,{value:"all",children:"All Types"}),e.jsx(h,{value:"municipal",children:"Municipal"}),e.jsx(h,{value:"private",children:"Private"}),e.jsx(h,{value:"emergency",children:"Emergency"})]}),e.jsxs(R,{select:!0,size:"small",label:"Status",fullWidth:!0,margin:"dense",value:a.filterCriteria.operationalStatus[0]||"all",onChange:l,children:[e.jsx(h,{value:"all",children:"All Status"}),e.jsx(h,{value:"active",children:"Active"}),e.jsx(h,{value:"inactive",children:"Inactive"}),e.jsx(h,{value:"maintenance",children:"Maintenance"})]}),e.jsx(c,{variant:"caption",display:"block",sx:{mt:1,mb:1},children:"Capacity Range (gallons)"}),e.jsx(Se,{size:"small",value:a.filterCriteria.capacityRange,onChange:S,min:0,max:1e5,step:5e3,valueLabelDisplay:"auto",marks:[{value:0,label:"0"},{value:5e4,label:"50K"},{value:1e5,label:"100K"}]})]}),e.jsxs(c,{variant:"subtitle2",gutterBottom:!0,children:["Water Tanks (",k.length,")"]}),e.jsx(Q,{dense:!0,children:k.map(t=>e.jsxs(J,{button:!0,selected:a.selectedTanks.includes(t.id),onClick:()=>C(t.id),sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:[e.jsx(Me,{children:e.jsx(U,{color:t.operationalStatus==="active"?"primary":"disabled"})}),e.jsx(K,{primary:t.name,secondary:e.jsxs(v,{children:[e.jsxs(c,{variant:"caption",display:"block",children:[t.capacity.toLocaleString()," gal • ",t.type]}),e.jsx(X,{size:"small",label:t.accessRating,color:t.accessRating==="excellent"?"success":"default"})]})}),e.jsx(Pe,{children:e.jsx(O,{size:"small",onClick:p=>{p.stopPropagation(),E(t.id)},children:e.jsx(Ue,{})})})]},t.id))}),k.length===0&&e.jsx(F,{severity:"info",sx:{mt:2},children:"No tanks found. Add tanks or adjust filters."})]}),y=()=>e.jsxs(v,{sx:{p:2},children:[e.jsxs($,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(c,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(Be,{sx:{mr:1,verticalAlign:"middle"}}),"Analysis Parameters"]}),e.jsx(R,{size:"small",label:"Max Effective Distance (ft)",fullWidth:!0,margin:"dense",type:"number",value:d.maxEffectiveDistance,onChange:t=>o(N({maxEffectiveDistance:parseInt(t.target.value)||1500}))}),e.jsx(R,{size:"small",label:"Min Flow Rate (GPM)",fullWidth:!0,margin:"dense",type:"number",value:d.minimumFlowRate,onChange:t=>o(N({minimumFlowRate:parseInt(t.target.value)||250}))}),e.jsx(B,{control:e.jsx(W,{checked:d.terrainFactor,onChange:t=>o(N({terrainFactor:t.target.checked}))}),label:"Consider Terrain"}),e.jsx(B,{control:e.jsx(W,{checked:d.seasonalFactors,onChange:t=>o(N({seasonalFactors:t.target.checked}))}),label:"Seasonal Factors"})]}),e.jsx(D,{variant:"contained",startIcon:e.jsx(Ye,{}),fullWidth:!0,size:"large",onClick:b,disabled:x.length===0||i,sx:{mb:2},children:i?"Analyzing...":"Analyze Coverage"}),i&&e.jsx(He,{sx:{mb:2}}),e.jsxs($,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(c,{variant:"subtitle2",gutterBottom:!0,children:"Display Options"}),e.jsx(B,{control:e.jsx(W,{checked:a.showCoverageZones,onChange:()=>o(ve())}),label:"Coverage Zones"}),e.jsx(B,{control:e.jsx(W,{checked:a.showGapAreas,onChange:()=>o(fe())}),label:"Gap Areas"}),e.jsx(B,{control:e.jsx(W,{checked:a.showRedundancyAreas,onChange:()=>o(ye())}),label:"Redundancy Areas"})]}),u&&e.jsxs($,{variant:"outlined",sx:{p:2},children:[e.jsxs(c,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(_e,{sx:{mr:1,verticalAlign:"middle"}}),"Analysis Results"]}),e.jsxs(c,{variant:"body2",gutterBottom:!0,children:["Coverage: ",u.coveragePercentage.toFixed(1),"%"]}),e.jsxs(c,{variant:"body2",gutterBottom:!0,children:["Tanks: ",u.totalTanks]}),e.jsxs(c,{variant:"body2",gutterBottom:!0,children:["Critical Gaps: ",u.gapAreas.filter(t=>t.severity==="critical").length]}),e.jsx(D,{variant:"outlined",size:"small",startIcon:e.jsx(se,{}),fullWidth:!0,sx:{mt:1},children:"Export Report"})]})]}),j=()=>e.jsxs(v,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle2",gutterBottom:!0,children:"Coverage Gaps"}),u?e.jsx(Q,{dense:!0,children:u.gapAreas.map(t=>e.jsx(J,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:e.jsx(K,{primary:`Gap ${t.id}`,secondary:e.jsxs(v,{children:[e.jsxs(c,{variant:"caption",display:"block",children:["Severity: ",e.jsx(X,{size:"small",label:t.severity,color:t.severity==="critical"?"error":t.severity==="high"?"warning":"default"})]}),e.jsxs(c,{variant:"caption",display:"block",children:["Area: ",(t.area/43560).toFixed(1)," acres"]})]})})},t.id))}):e.jsx(F,{severity:"info",children:"Run coverage analysis to identify gaps."})]}),A=()=>e.jsxs(v,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle2",gutterBottom:!0,children:"Recommendations"}),u?e.jsx(Q,{dense:!0,children:u.recommendations.map(t=>e.jsx(J,{sx:{border:1,borderColor:"divider",mb:1,borderRadius:1},children:e.jsx(K,{primary:t.title,secondary:e.jsxs(v,{children:[e.jsx(c,{variant:"body2",gutterBottom:!0,children:t.description}),e.jsx(X,{size:"small",label:t.priority,color:t.priority==="critical"?"error":t.priority==="high"?"warning":"default"}),t.estimatedCost&&e.jsxs(c,{variant:"caption",display:"block",sx:{mt:1},children:["Est. Cost: $",t.estimatedCost.toLocaleString()]})]})})},t.id))}):e.jsx(F,{severity:"info",children:"Run coverage analysis to see recommendations."})]}),G=()=>e.jsxs(v,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle2",gutterBottom:!0,children:"Data Import"}),e.jsx(F,{severity:"info",sx:{mb:2},children:"Import tank locations from CSV or place manually on map."}),e.jsx(D,{variant:"outlined",startIcon:e.jsx(re,{}),fullWidth:!0,sx:{mb:2},children:"Upload Tank Data (CSV)"}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"CSV should include: Name, Latitude, Longitude, Capacity, Type, Owner"}),e.jsx(Y,{sx:{my:2}}),e.jsx(c,{variant:"subtitle2",gutterBottom:!0,children:"Export Data"}),e.jsx(D,{variant:"outlined",startIcon:e.jsx(se,{}),fullWidth:!0,disabled:x.length===0,children:"Export Tank Data"})]});return e.jsxs(v,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(v,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[e.jsxs(c,{variant:"h6",component:"div",sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{sx:{mr:1}}),"Tank Coverage"]}),n&&e.jsxs(c,{variant:"caption",color:"text.secondary",children:["Mode: ",n]})]}),e.jsxs(Fe,{value:a.sidebarTab,onChange:I,variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(P,{label:"Tanks",value:"tanks"}),e.jsx(P,{label:"Analysis",value:"analysis"}),e.jsx(P,{label:"Gaps",value:"gaps"}),e.jsx(P,{label:"Recommendations",value:"recommendations"}),e.jsx(P,{label:"Import",value:"import"})]}),e.jsxs(v,{sx:{flexGrow:1,overflow:"auto"},children:[a.sidebarTab==="tanks"&&g(),a.sidebarTab==="analysis"&&y(),a.sidebarTab==="gaps"&&j(),a.sidebarTab==="recommendations"&&A(),a.sidebarTab==="import"&&G()]})]})},tt=({map:n,onTankEdit:o})=>{const x=Z(),k=T(oe),u=T(V),a=T(ce),d=f.useRef(null),i=f.useRef(null),I=f.useRef(new Map);f.useEffect(()=>{if(n)return d.current=z.layerGroup().addTo(n),i.current=z.layerGroup().addTo(n),()=>{d.current&&n.removeLayer(d.current),i.current&&n.removeLayer(i.current)}},[n]);const b=s=>{const m=()=>{switch(s.operationalStatus){case"active":return"#2196f3";case"inactive":return"#9e9e9e";case"maintenance":return"#ff9800";default:return"#2196f3"}},l=(()=>{const j=Math.min(Math.max(s.capacity/25e3,.7),2);return Math.round(24*j)})(),S=m(),g=`
      <svg width="${l}" height="${l}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" fill="${S}" stroke="#ffffff" stroke-width="2"/>
        <path d="M8 10h8v6a2 2 0 01-2 2h-4a2 2 0 01-2-2v-6z" fill="#ffffff"/>
        <path d="M7 8h10v2H7z" fill="#ffffff"/>
        <circle cx="12" cy="6" r="1" fill="#ffffff"/>
      </svg>
    `;return z.divIcon({html:g,className:"tank-marker",iconSize:[l,l],iconAnchor:[l/2,l/2],popupAnchor:[0,-l/2]})},C=s=>{const m=s.capacity.toLocaleString();return`
      <div style="min-width: 200px;">
        <h4 style="margin: 0 0 8px 0; color: #1976d2;">${s.name}</h4>
        <p style="margin: 4px 0;"><strong>Capacity:</strong> ${m} gallons</p>
        <p style="margin: 4px 0;"><strong>Type:</strong> ${s.type}</p>
        <p style="margin: 4px 0;"><strong>Access:</strong> ${s.accessRating}</p>
        <p style="margin: 4px 0;"><strong>Status:</strong> ${s.operationalStatus}</p>
        <p style="margin: 4px 0;"><strong>Owner:</strong> ${s.owner}</p>
        ${s.notes?`<p style="margin: 4px 0;"><strong>Notes:</strong> ${s.notes}</p>`:""}
        <div style="margin-top: 8px; font-size: 12px; color: #666;">
          Lat: ${s.location.latitude.toFixed(6)}, Lng: ${s.location.longitude.toFixed(6)}
        </div>
      </div>
    `},E=s=>{if(!u.showCoverageZones)return null;const m=a.maxEffectiveDistance*.3048;return z.circle([s.location.latitude,s.location.longitude],{radius:m,fillColor:"#2196f3",fillOpacity:.1,color:"#1976d2",weight:2,opacity:.6})};return f.useEffect(()=>{if(!(!n||!d.current||!i.current)){if(d.current.clearLayers(),i.current.clearLayers(),I.current.clear(),k.forEach(s=>{const m=b(s),r=z.marker([s.location.latitude,s.location.longitude],{icon:m,draggable:!0,riseOnHover:!0});r.bindPopup(C(s)),r.on("click",S=>{var g;(g=S.originalEvent)==null||g.stopPropagation(),u.selectedTanks.includes(s.id)?x(pe(s.id)):x(he(s.id)),console.log("🎯 Tank selected:",s.name)}),r.on("dblclick",S=>{var g;(g=S.originalEvent)==null||g.stopPropagation(),o&&(o(s),console.log("✏️ Tank edit requested:",s.name))}),r.on("dragend",S=>{const g=S.target.getLatLng(),y={...s,location:{latitude:g.lat,longitude:g.lng},modified:new Date};x(me(y)),console.log("🚛 Tank moved:",s.name,"to",g)}),u.selectedTanks.includes(s.id)&&r.setZIndexOffset(1e3),d.current.addLayer(r),I.current.set(s.id,r);const l=E(s);l&&i.current.addLayer(l)}),k.length>0){const m=new z.FeatureGroup(Array.from(I.current.values())).getBounds();m.isValid()&&n.fitBounds(m,{padding:[20,20],maxZoom:16})}console.log("🗺️ Tank markers updated:",k.length,"tanks displayed")}},[k,u.selectedTanks,u.showCoverageZones,a.maxEffectiveDistance,x,n]),f.useEffect(()=>{!i.current||!n||(u.showCoverageZones?n.hasLayer(i.current)||n.addLayer(i.current):n.hasLayer(i.current)&&n.removeLayer(i.current))},[u.showCoverageZones,n]),null},at=({tank:n,open:o,onClose:x,isNewTank:k=!1})=>{const u=Z(),[a,d]=f.useState({name:"",capacity:25e3,type:"municipal",accessRating:"good",operationalStatus:"active",owner:"Fire Department",contactInfo:"",notes:"",elevation:""}),[i,I]=f.useState({});f.useEffect(()=>{n&&d({name:n.name||"",capacity:n.capacity||25e3,type:n.type||"municipal",accessRating:n.accessRating||"good",operationalStatus:n.operationalStatus||"active",owner:n.owner||"Fire Department",contactInfo:n.contactInfo||"",notes:n.notes||"",elevation:n.elevation?n.elevation.toString():""}),I({})},[n]);const b=r=>l=>{const S=l.target.value;d(g=>({...g,[r]:S})),i[r]&&I(g=>({...g,[r]:""}))},C=()=>{const r={};return a.name.trim()||(r.name="Tank name is required"),a.capacity<=0&&(r.capacity="Capacity must be greater than 0"),a.capacity>1e6&&(r.capacity="Capacity seems unreasonably large (>1M gallons)"),a.owner.trim()||(r.owner="Owner information is required"),a.elevation&&isNaN(Number(a.elevation))&&(r.elevation="Elevation must be a number"),I(r),Object.keys(r).length===0},E=()=>{if(!(!n||!C())){if(k){const r={name:a.name.trim(),location:n.location,capacity:Number(a.capacity),type:a.type,accessRating:a.accessRating,operationalStatus:a.operationalStatus,owner:a.owner.trim(),contactInfo:a.contactInfo.trim(),notes:a.notes.trim(),elevation:a.elevation?Number(a.elevation):void 0};u(ue(r)),console.log("🆕 New tank created:",r.name,"capacity:",r.capacity)}else{const r={...n,name:a.name.trim(),capacity:Number(a.capacity),type:a.type,accessRating:a.accessRating,operationalStatus:a.operationalStatus,owner:a.owner.trim(),contactInfo:a.contactInfo.trim(),notes:a.notes.trim(),elevation:a.elevation?Number(a.elevation):void 0,modified:new Date};u(me(r)),console.log("💾 Tank updated:",r.name,"capacity:",r.capacity)}x()}},s=()=>{x()};if(!n)return null;const m=[{value:5e3,label:"5,000 gallons (Small)"},{value:1e4,label:"10,000 gallons"},{value:25e3,label:"25,000 gallons (Standard)"},{value:5e4,label:"50,000 gallons"},{value:1e5,label:"100,000 gallons (Large)"},{value:25e4,label:"250,000 gallons (Very Large)"}];return e.jsxs(We,{open:o,onClose:s,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsxs($e,{sx:{pb:1},children:[e.jsxs(v,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(U,{color:"primary"}),e.jsx(c,{variant:"h6",children:k?"New Tank Properties":`Edit Tank: ${n.name}`})]}),e.jsxs(c,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Location: ",n.location.latitude.toFixed(6),", ",n.location.longitude.toFixed(6)]})]}),e.jsx(Oe,{dividers:!0,children:e.jsxs(w,{container:!0,spacing:3,children:[e.jsx(w,{item:!0,xs:12,children:e.jsx(c,{variant:"subtitle1",gutterBottom:!0,color:"primary",children:"Basic Information"})}),e.jsx(w,{item:!0,xs:12,sm:6,children:e.jsx(R,{fullWidth:!0,label:"Tank Name",value:a.name,onChange:b("name"),error:!!i.name,helperText:i.name||'e.g., "Main Street Tank", "Station 5 Tank"',required:!0})}),e.jsx(w,{item:!0,xs:12,sm:6,children:e.jsx(R,{fullWidth:!0,label:"Owner",value:a.owner,onChange:b("owner"),error:!!i.owner,helperText:i.owner||"Who owns/maintains this tank",required:!0})}),e.jsxs(w,{item:!0,xs:12,children:[e.jsx(Y,{sx:{my:1}}),e.jsx(c,{variant:"subtitle1",gutterBottom:!0,color:"primary",children:"Tank Specifications"})]}),e.jsx(w,{item:!0,xs:12,sm:6,children:e.jsx(R,{fullWidth:!0,label:"Capacity",type:"number",value:a.capacity,onChange:b("capacity"),error:!!i.capacity,helperText:i.capacity||"Tank capacity in gallons",InputProps:{endAdornment:e.jsx(ne,{position:"end",children:"gallons"})},required:!0})}),e.jsx(w,{item:!0,xs:12,sm:6,children:e.jsxs(R,{select:!0,fullWidth:!0,label:"Tank Type",value:a.type,onChange:b("type"),helperText:"Primary use classification",children:[e.jsx(h,{value:"municipal",children:"Municipal"}),e.jsx(h,{value:"private",children:"Private"}),e.jsx(h,{value:"emergency",children:"Emergency"}),e.jsx(h,{value:"industrial",children:"Industrial"}),e.jsx(h,{value:"agricultural",children:"Agricultural"}),e.jsx(h,{value:"portable",children:"Portable"})]})}),e.jsx(w,{item:!0,xs:12,sm:6,children:e.jsxs(R,{select:!0,fullWidth:!0,label:"Access Rating",value:a.accessRating,onChange:b("accessRating"),helperText:"How easily can fire apparatus access this tank",children:[e.jsx(h,{value:"excellent",children:"Excellent - Easy access, good road conditions"}),e.jsx(h,{value:"good",children:"Good - Accessible but may require coordination"}),e.jsx(h,{value:"fair",children:"Fair - Limited access, rough terrain"}),e.jsx(h,{value:"poor",children:"Poor - Difficult access, special equipment needed"}),e.jsx(h,{value:"restricted",children:"Restricted - Permission required"})]})}),e.jsx(w,{item:!0,xs:12,sm:6,children:e.jsxs(R,{select:!0,fullWidth:!0,label:"Operational Status",value:a.operationalStatus,onChange:b("operationalStatus"),helperText:"Current operational state",children:[e.jsx(h,{value:"active",children:"Active - Ready for use"}),e.jsx(h,{value:"inactive",children:"Inactive - Not currently available"}),e.jsx(h,{value:"maintenance",children:"Maintenance - Temporarily out of service"}),e.jsx(h,{value:"seasonal",children:"Seasonal - Weather dependent"}),e.jsx(h,{value:"unknown",children:"Unknown - Status needs verification"})]})}),e.jsxs(w,{item:!0,xs:12,children:[e.jsx(c,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Quick Capacity Selection:"}),e.jsx(v,{display:"flex",flexWrap:"wrap",gap:1,children:m.map(r=>e.jsx(D,{size:"small",variant:a.capacity===r.value?"contained":"outlined",onClick:()=>d(l=>({...l,capacity:r.value})),sx:{fontSize:"0.75rem"},children:r.label},r.value))})]}),e.jsxs(w,{item:!0,xs:12,children:[e.jsx(Y,{sx:{my:1}}),e.jsx(c,{variant:"subtitle1",gutterBottom:!0,color:"primary",children:"Additional Information"})]}),e.jsx(w,{item:!0,xs:12,sm:6,children:e.jsx(R,{fullWidth:!0,label:"Contact Information",value:a.contactInfo,onChange:b("contactInfo"),helperText:"Phone number or contact for access",placeholder:"(555) 123-4567"})}),e.jsx(w,{item:!0,xs:12,sm:6,children:e.jsx(R,{fullWidth:!0,label:"Elevation (feet)",type:"number",value:a.elevation,onChange:b("elevation"),error:!!i.elevation,helperText:i.elevation||"Elevation above sea level (optional)",InputProps:{endAdornment:e.jsx(ne,{position:"end",children:"ft"})}})}),e.jsx(w,{item:!0,xs:12,children:e.jsx(R,{fullWidth:!0,multiline:!0,rows:3,label:"Notes",value:a.notes,onChange:b("notes"),helperText:"Additional notes about this tank (access instructions, restrictions, etc.)",placeholder:"e.g., 'Requires key from station office', 'Dry hydrant connection available'"})}),Object.keys(i).length>0&&e.jsx(w,{item:!0,xs:12,children:e.jsx(F,{severity:"error",children:"Please correct the errors above before saving."})})]})}),e.jsxs(Ze,{sx:{p:2},children:[e.jsx(D,{onClick:s,startIcon:e.jsx(Xe,{}),color:"inherit",children:"Cancel"}),e.jsx(D,{onClick:E,variant:"contained",startIcon:e.jsx(xe,{}),disabled:Object.keys(i).length>0,children:"Save Tank"})]})]})},nt=z.icon({iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});z.Marker.prototype.options.icon=nt;const st=()=>{const n=Z(),o=T(ee),x=T(V),k=f.useRef(null),[u,a]=f.useState(!1),[d,i]=f.useState({latitude:39.8283,longitude:-98.5795,zoom:4}),[I,b]=f.useState(!1),[C,E]=f.useState(null),[s,m]=f.useState(null),r=f.useCallback(y=>{if(k.current=y,a(!0),y.on("click",j=>{if(x.selectedTanks.length===0){m({lat:j.latlng.lat,lng:j.latlng.lng});const A={id:`temp-${Date.now()}`,name:`Tank ${o.length+1}`,location:{latitude:j.latlng.lat,longitude:j.latlng.lng},capacity:25e3,type:"municipal",accessRating:"good",operationalStatus:"active",owner:"Fire Department",contactInfo:"",notes:"",created:new Date,modified:new Date};E(A),b(!0),console.log("🎯 Opening tank editor for new tank at:",j.latlng)}}),y.on("move",()=>{const j=y.getCenter(),A=y.getZoom();i({latitude:j.lat,longitude:j.lng,zoom:A})}),o.length>0){const j=z.latLngBounds(o.map(A=>[A.location.latitude,A.location.longitude]));y.fitBounds(j,{padding:[20,20],maxZoom:16})}else y.setView([39.8283,-98.5795],4);console.log("🗺️ Tank map initialized with",o.length,"tanks")},[o,x.selectedTanks.length,n]),l=f.useCallback(y=>{console.error("Tank map error:",y)},[]);f.useEffect(()=>{if(!k.current||o.length===0)return;const y=k.current,j=z.latLngBounds(o.map(A=>[A.location.latitude,A.location.longitude]));j.isValid()&&y.fitBounds(j,{padding:[50,50],maxZoom:16,animate:!0,duration:.5})},[o.length]);const S=()=>{b(!1),E(null),m(null)},g=y=>{E(y),b(!0),m(null)};return e.jsxs(v,{sx:{height:"100%",width:"100%",position:"relative",overflow:"hidden"},children:[e.jsx(we,{onMapReady:r,onError:l,center:[d.latitude,d.longitude],zoom:d.zoom}),u&&e.jsx(tt,{map:k.current,onTankEdit:g}),e.jsx(Ie,{latitude:d.latitude,longitude:d.longitude,zoom:d.zoom,sx:{position:"absolute",bottom:8,left:8,zIndex:1e3,bgcolor:"rgba(255, 255, 255, 0.9)",p:1,borderRadius:1,fontSize:"0.75rem"}}),e.jsxs(v,{sx:{position:"absolute",top:8,left:8,zIndex:1e3,bgcolor:"rgba(33, 150, 243, 0.9)",color:"white",p:1,borderRadius:1,fontSize:"0.875rem",fontWeight:"medium"},children:[o.length," ",o.length===1?"Tank":"Tanks"]}),o.length===0&&e.jsxs(v,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3,bgcolor:"rgba(255, 255, 255, 0.95)",p:3,borderRadius:2,textAlign:"center",maxWidth:300,boxShadow:2},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,color:"primary",children:"Welcome to Tank Zone Coverage"}),e.jsx(c,{variant:"body2",color:"text.secondary",children:'Click anywhere on the map to place a water tank, or use the "Add Tank" button in the sidebar.'})]}),e.jsx(at,{tank:C,open:I,onClose:S,isNewTank:!!s})]})},q=320,gt=({initialTanks:n=[],initialAnalysisParams:o,onAnalysisComplete:x,onTankUpdate:k,mode:u="analysis"})=>{const a=Z(),d=De(),i=Qe(d.breakpoints.down("md"));f.useEffect(()=>{document.title="FireEMS Tank Zone Coverage"},[]);const I=T(ee),b=T(ie),C=T(le);T(V);const E=T(de),s=T(ke),[m,r]=ae.useState(!i),[l,S]=ae.useState(!1);f.useEffect(()=>{n.length>0&&console.log("Loading initial tanks:",n),o&&console.log("Loading initial analysis parameters:",o)},[n,o]),f.useEffect(()=>{C&&x&&x(C)},[C,x]);const g=()=>{r(!m)},y=()=>{S(!l),l?document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()},j=()=>{const p={tanks:I,coverageZones:b,activeAnalysis:C,timestamp:new Date};localStorage.setItem("tankZoneCoverage_autosave",JSON.stringify(p)),console.log("Tank zone coverage data saved")},A=()=>{if(C){const p={analysis:C,tanks:I,exportedAt:new Date},L=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),M=URL.createObjectURL(L),H=document.createElement("a");H.href=M,H.download=`tank-coverage-analysis-${new Date().toISOString().split("T")[0]}.json`,H.click(),URL.revokeObjectURL(M)}},G=()=>{a(Ce())},t={marginLeft:!i&&m?`${q}px`:0,width:!i&&m?`calc(100% - ${q}px)`:"100%",height:l?"100vh":"calc(100vh - 64px)",transition:d.transitions.create(["margin","width"],{easing:d.transitions.easing.sharp,duration:d.transitions.duration.leavingScreen})};return e.jsx(Ae,{children:e.jsxs(v,{sx:{display:"flex",height:"100vh",overflow:"hidden",bgcolor:"background.default",position:l?"fixed":"relative",top:l?0:"auto",left:l?0:"auto",right:l?0:"auto",bottom:l?0:"auto",zIndex:l?1300:"auto"},role:"main","aria-label":"Tank Zone Coverage Analysis Tool",children:[!l&&e.jsx(Re,{position:"fixed",sx:{zIndex:d.zIndex.drawer+1,bgcolor:"primary.main"},children:e.jsxs(Ge,{children:[e.jsx(O,{color:"inherit","aria-label":"toggle sidebar",onClick:g,edge:"start",sx:{mr:2},children:e.jsx(Ee,{})}),e.jsx(U,{sx:{mr:1}}),e.jsxs(c,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:["Tank Zone Coverage Analysis",u==="planning"&&" - Planning Mode",u==="presentation"&&" - Presentation Mode"]}),e.jsxs(v,{sx:{display:"flex",gap:1},children:[e.jsx(O,{color:"inherit",onClick:j,title:"Save Analysis",children:e.jsx(xe,{})}),e.jsx(O,{color:"inherit",onClick:A,title:"Export Results",disabled:!C,children:e.jsx(Le,{})}),e.jsx(O,{color:"inherit",onClick:y,title:"Toggle Fullscreen",children:l?e.jsx(Je,{}):e.jsx(Ke,{})})]})]})}),e.jsx(ze,{variant:i?"temporary":"persistent",anchor:"left",open:m,onClose:g,sx:{width:q,flexShrink:0,"& .MuiDrawer-paper":{width:q,boxSizing:"border-box",marginTop:l?0:"64px",height:l?"100vh":"calc(100vh - 64px)",borderRight:`1px solid ${d.palette.divider}`}},ModalProps:{keepMounted:!0,disablePortal:!1,hideBackdrop:!i,disableAutoFocus:!0,disableEnforceFocus:!0,disableRestoreFocus:!0},PaperProps:{"aria-hidden":!1,role:"complementary","aria-label":"Tank Zone Coverage Tools"},children:e.jsx(et,{mode:u})}),e.jsxs(v,{component:"main",sx:{flexGrow:1,position:"relative",...t},children:[e.jsx($,{elevation:0,sx:{height:"100%",width:"100%",borderRadius:0,overflow:"hidden",position:"relative",minHeight:"500px",display:"flex",flexDirection:"column","& .leaflet-container":{background:"transparent !important",outline:"none"},"& .leaflet-tile-pane":{opacity:"1 !important",visibility:"visible !important"},"& .leaflet-tile":{opacity:"1 !important",visibility:"visible !important",display:"block !important",imageRendering:"auto",transform:"translateZ(0)",backfaceVisibility:"hidden"},"& .leaflet-layer":{opacity:"1 !important",visibility:"visible !important"}},children:e.jsx(st,{})}),E&&e.jsx(v,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsx(c,{variant:"h6",children:"Analyzing Tank Coverage..."})})]}),e.jsx(Ne,{open:!!s,autoHideDuration:6e3,onClose:G,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(F,{onClose:G,severity:"error",sx:{width:"100%"},children:s})})]})})};export{gt as default};
