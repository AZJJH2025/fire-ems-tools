import{a as G,g as Y,bo as E,p as I,r as l,u as K,j as e,s as Z,c as Q,E as O,b as X,m as ee,aK as se,B as x,C as re,bn as te,bp as oe,y as V}from"./index-DIxm5UxC.js";import{a as q,b as H,c as U,d as _,D as ne}from"./Divider-B6WexYtJ.js";import{L as J}from"./Lock-BvZQJfGE.js";import{u as ae,T as p,c as ie,P as le}from"./Typography-B0YDethp.js";import{A as D,T as L,a as F}from"./TextField-DHEDdkew.js";import{E as ce}from"./Error-BVW3IPRn.js";import{C as de}from"./CheckCircle-DedHYT75.js";import{I as z}from"./InputAdornment-p-QF2FIA.js";import{a as R,V as T}from"./VisibilityOff-B9DuoxQR.js";import{L as ue}from"./LinearProgress-C6mpWK0m.js";import{i as M,B as k}from"./List-CeknlX3j.js";import{C as pe}from"./Close-f3zwya9T.js";import{L as xe}from"./LocalFireDepartment-BGQpmkVF.js";import"./dividerClasses-BOzpvkur.js";function he(r){return Y("MuiLink",r)}const me=G("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]),fe=({theme:r,ownerState:n})=>{const t=n.color,d=E(r,`palette.${t}.main`,!1)||E(r,`palette.${t}`,!1)||n.color,c=E(r,`palette.${t}.mainChannel`)||E(r,`palette.${t}Channel`);return"vars"in r&&c?`rgba(${c} / 0.4)`:I(d,.4)},$={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},ge=r=>{const{classes:n,component:t,focusVisible:d,underline:c}=r,o={root:["root",`underline${O(c)}`,t==="button"&&"button",d&&"focusVisible"]};return X(o,he,n)},we=Z(p,{name:"MuiLink",slot:"Root",overridesResolver:(r,n)=>{const{ownerState:t}=r;return[n.root,n[`underline${O(t.underline)}`],t.component==="button"&&n.button]}})(ee(({theme:r})=>({variants:[{props:{underline:"none"},style:{textDecoration:"none"}},{props:{underline:"hover"},style:{textDecoration:"none","&:hover":{textDecoration:"underline"}}},{props:{underline:"always"},style:{textDecoration:"underline","&:hover":{textDecorationColor:"inherit"}}},{props:({underline:n,ownerState:t})=>n==="always"&&t.color!=="inherit",style:{textDecorationColor:"var(--Link-underlineColor)"}},...Object.entries(r.palette).filter(se()).map(([n])=>({props:{underline:"always",color:n},style:{"--Link-underlineColor":r.vars?`rgba(${r.vars.palette[n].mainChannel} / 0.4)`:I(r.palette[n].main,.4)}})),{props:{underline:"always",color:"textPrimary"},style:{"--Link-underlineColor":r.vars?`rgba(${r.vars.palette.text.primaryChannel} / 0.4)`:I(r.palette.text.primary,.4)}},{props:{underline:"always",color:"textSecondary"},style:{"--Link-underlineColor":r.vars?`rgba(${r.vars.palette.text.secondaryChannel} / 0.4)`:I(r.palette.text.secondary,.4)}},{props:{underline:"always",color:"textDisabled"},style:{"--Link-underlineColor":(r.vars||r).palette.text.disabled}},{props:{component:"button"},style:{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${me.focusVisible}`]:{outline:"auto"}}}]}))),B=l.forwardRef(function(n,t){const d=K({props:n,name:"MuiLink"}),c=ae(),{className:o,color:g="primary",component:h="a",onBlur:j,onFocus:u,TypographyClasses:w,underline:C="always",variant:m="inherit",sx:f,...y}=d,[P,b]=l.useState(!1),v=s=>{M(s.target)||b(!1),j&&j(s)},W=s=>{M(s.target)&&b(!0),u&&u(s)},A={...d,color:g,component:h,focusVisible:P,underline:C,variant:m},S=ge(A);return e.jsx(we,{color:g,className:Q(S.root,o),classes:w,component:h,onBlur:v,onFocus:W,ref:t,ownerState:A,variant:m,...y,sx:[...$[g]===void 0?[{color:g}]:[],...Array.isArray(f)?f:[f]],style:{...y.style,...C==="always"&&g!=="inherit"&&!$[g]&&{"--Link-underlineColor":fe({theme:c,ownerState:A})}}})}),N=ie(e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"})),ye=({open:r,onClose:n,onSuccess:t,isTemporary:d=!1,userName:c=""})=>{const[o,g]=l.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[h,j]=l.useState({current:!1,new:!1,confirm:!1}),[u,w]=l.useState(!1),[C,m]=l.useState(""),[f,y]=l.useState(!1),P=s=>a=>{g(i=>({...i,[s]:a.target.value})),m("")},b=s=>{j(a=>({...a,[s]:!a[s]}))},v=s=>{const a=[];return s.length<8&&a.push("At least 8 characters long"),/[A-Z]/.test(s)||a.push("One uppercase letter"),/[a-z]/.test(s)||a.push("One lowercase letter"),/[0-9]/.test(s)||a.push("One number"),a},W=s=>{const i=(4-v(s).length)/4*100;return i===100?{score:i,label:"Strong",color:"success"}:i>=75?{score:i,label:"Good",color:"info"}:i>=50?{score:i,label:"Fair",color:"warning"}:{score:i,label:"Weak",color:"error"}},A=async()=>{if(m(""),w(!0),!o.currentPassword||!o.newPassword||!o.confirmPassword){m("All fields are required"),w(!1);return}if(o.newPassword!==o.confirmPassword){m("New password and confirmation do not match"),w(!1);return}const s=v(o.newPassword);if(s.length>0){m(`Password must have: ${s.join(", ")}`),w(!1);return}try{const a=await fetch("/auth/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:o.currentPassword,newPassword:o.newPassword,confirmPassword:o.confirmPassword})}),i=await a.json();a.ok&&i.success?(y(!0),setTimeout(()=>{t(),n()},1500)):m(i.message||"Failed to change password")}catch{m("Network error. Please try again.")}finally{w(!1)}},S=W(o.newPassword);return e.jsxs(q,{open:r,onClose:d?void 0:n,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(H,{sx:{pb:1},children:[e.jsxs(x,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(J,{color:"primary"}),e.jsx(p,{variant:"h6",children:d?"Set Your Password":"Change Password"})]}),d&&e.jsxs(p,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Welcome ",c,"! Please set a secure password to continue."]})]}),e.jsxs(U,{sx:{pt:2},children:[C&&e.jsx(D,{severity:"error",sx:{mb:2},icon:e.jsx(ce,{}),children:C}),f&&e.jsx(D,{severity:"success",sx:{mb:2},icon:e.jsx(de,{}),children:"Password changed successfully! Redirecting..."}),e.jsxs(x,{component:"form",sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(L,{label:d?"Current Temporary Password":"Current Password",type:h.current?"text":"password",value:o.currentPassword,onChange:P("currentPassword"),required:!0,fullWidth:!0,disabled:u,InputProps:{endAdornment:e.jsx(z,{position:"end",children:e.jsx(F,{onClick:()=>b("current"),edge:"end",children:h.current?e.jsx(R,{}):e.jsx(T,{})})})}}),e.jsx(L,{label:"New Password",type:h.new?"text":"password",value:o.newPassword,onChange:P("newPassword"),required:!0,fullWidth:!0,disabled:u,InputProps:{endAdornment:e.jsx(z,{position:"end",children:e.jsx(F,{onClick:()=>b("new"),edge:"end",children:h.new?e.jsx(R,{}):e.jsx(T,{})})})}}),o.newPassword&&e.jsxs(x,{children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(p,{variant:"body2",children:"Password Strength"}),e.jsx(p,{variant:"body2",color:`${S.color}.main`,children:S.label})]}),e.jsx(ue,{variant:"determinate",value:S.score,color:S.color,sx:{height:8,borderRadius:4}})]}),e.jsx(L,{label:"Confirm New Password",type:h.confirm?"text":"password",value:o.confirmPassword,onChange:P("confirmPassword"),required:!0,fullWidth:!0,disabled:u,error:o.confirmPassword!==""&&o.newPassword!==o.confirmPassword,helperText:o.confirmPassword!==""&&o.newPassword!==o.confirmPassword?"Passwords do not match":"",InputProps:{endAdornment:e.jsx(z,{position:"end",children:e.jsx(F,{onClick:()=>b("confirm"),edge:"end",children:h.confirm?e.jsx(R,{}):e.jsx(T,{})})})}})]})]}),e.jsxs(_,{sx:{px:3,pb:3},children:[!d&&e.jsx(k,{onClick:n,disabled:u,children:"Cancel"}),e.jsx(k,{onClick:A,variant:"contained",disabled:u||f,sx:{minWidth:120},children:u?"Changing...":d?"Set Password":"Change Password"})]})]})},be=({open:r,onClose:n})=>{const[t,d]=l.useState(""),[c,o]=l.useState(!1),[g,h]=l.useState(null),[j,u]=l.useState(null),[w,C]=l.useState(!1),m=async P=>{if(P.preventDefault(),!t.trim()){u("Email address is required");return}if(!t.includes("@")||!t.includes(".")){u("Please enter a valid email address");return}o(!0),u(null),h(null);try{const v=await(await fetch("/auth/api/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:t})})).json();v.success?(h(v.message),C(!0)):u(v.message||"Failed to send reset email")}catch(b){console.error("Forgot password error:",b),u("An error occurred while sending the reset email")}finally{o(!1)}},f=()=>{c||(d(""),h(null),u(null),C(!1),n())},y=()=>{f()};return e.jsxs(q,{open:r,onClose:f,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,p:1}},children:[e.jsxs(H,{sx:{display:"flex",alignItems:"center",gap:1,pb:1},children:[e.jsx(N,{color:"primary"}),e.jsx(p,{variant:"h6",component:"span",sx:{flexGrow:1},children:"Reset Password"}),e.jsx(F,{onClick:f,disabled:c,size:"small",children:e.jsx(pe,{})})]}),e.jsx(U,{sx:{pt:1},children:w?e.jsxs(x,{sx:{textAlign:"center",py:2},children:[e.jsx(N,{sx:{fontSize:64,color:"primary.main",mb:2}}),e.jsx(p,{variant:"h6",gutterBottom:!0,children:"Check Your Email"}),e.jsxs(p,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["We've sent password reset instructions to ",e.jsx("strong",{children:t})]}),e.jsx(p,{variant:"body2",color:"text.secondary",children:"Didn't receive the email? Check your spam folder or try again."})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Enter your email address and we'll send you a link to reset your password."}),e.jsxs(x,{component:"form",onSubmit:m,sx:{width:"100%"},children:[e.jsx(L,{fullWidth:!0,label:"Email Address",type:"email",value:t,onChange:P=>d(P.target.value),disabled:c,autoFocus:!0,sx:{mb:2},helperText:"Enter the email address associated with your account"}),j&&e.jsx(D,{severity:"error",sx:{mb:2},children:j}),g&&e.jsx(D,{severity:"success",sx:{mb:2},children:g})]})]})}),e.jsx(_,{sx:{px:3,pb:3},children:w?e.jsx(e.Fragment,{children:e.jsx(k,{onClick:y,variant:"contained",fullWidth:!0,children:"Return to Login"})}):e.jsxs(e.Fragment,{children:[e.jsx(k,{onClick:f,disabled:c,children:"Cancel"}),e.jsx(k,{type:"submit",variant:"contained",onClick:m,disabled:c||!t.trim(),startIcon:c?e.jsx(re,{size:20}):e.jsx(N,{}),children:c?"Sending...":"Send Reset Link"})]})})]})},Re=()=>{const r=te(),n=oe(),[t,d]=l.useState({email:"",password:""}),[c,o]=l.useState([]),[g,h]=l.useState(!1),[j,u]=l.useState(!1),[w,C]=l.useState(!1),[m,f]=l.useState(!1),[y,P]=l.useState(null);l.useEffect(()=>{new URLSearchParams(n.search).get("signup")==="success"&&h(!0)},[n]);const b=(s,a)=>{d(i=>({...i,[s]:a}))},v=()=>{const s=[];return t.email.trim()?t.email.includes("@")||s.push("Valid email is required"):s.push("Email is required"),t.password||s.push("Password is required"),o(s),s.length===0},W=async s=>{if(s.preventDefault(),!!v())try{const i=await(await fetch("/auth/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,password:t.password,remember:!1})})).json();if(i.success){if(console.log("Login successful:",i.user),i.user.has_temp_password){P(i.user),C(!0);return}i.user.role==="super_admin"||i.user.role==="admin"?r("/admin"):r("/")}else o([i.message||"Login failed"])}catch(a){console.error("Login error:",a),o(["An error occurred during login. Please try again."])}},A=()=>{f(!0)},S=()=>{y.role==="super_admin"||y.role==="admin"?r("/admin"):r("/")};return e.jsxs(x,{sx:{minHeight:"100vh",bgcolor:"#f5f5f5"},children:[e.jsx(x,{sx:{background:"linear-gradient(135deg, #1565c0 0%, #1976d2 50%, #1e88e5 100%)",minHeight:"40vh",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:e.jsx(V,{maxWidth:"lg",children:e.jsxs(x,{sx:{textAlign:"center",color:"white"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:[e.jsx(xe,{sx:{fontSize:60,mr:2}}),e.jsx(p,{variant:"h3",sx:{fontWeight:"bold"},children:"FireEMS.AI"})]}),e.jsx(p,{variant:"h5",sx:{opacity:.9},children:"Welcome back to your fire department analytics suite"})]})})}),e.jsx(V,{maxWidth:"sm",sx:{mt:-8,position:"relative",zIndex:1},children:e.jsxs(le,{sx:{p:4,boxShadow:"0 8px 32px rgba(0,0,0,0.1)"},children:[e.jsxs(x,{sx:{textAlign:"center",mb:4},children:[e.jsx(p,{variant:"h4",gutterBottom:!0,sx:{fontWeight:"bold",color:"#1565c0"},children:"Sign In"}),e.jsx(p,{variant:"body1",color:"text.secondary",children:"Access your department's analytics and reporting tools"})]}),g&&e.jsx(D,{severity:"success",sx:{mb:3},children:"Account created successfully! Please sign in with your credentials."}),c.length>0&&e.jsx(D,{severity:"error",sx:{mb:3},children:e.jsx(x,{children:c.map((s,a)=>e.jsxs(p,{variant:"body2",children:["• ",s]},a))})}),e.jsxs("form",{onSubmit:W,children:[e.jsxs(x,{sx:{mb:3},children:[e.jsx(L,{fullWidth:!0,label:"Email Address",type:"email",value:t.email,onChange:s=>b("email",s.target.value),placeholder:"chief@department.gov",required:!0,InputProps:{startAdornment:e.jsx(N,{sx:{color:"#757575",mr:1}})},sx:{mb:2}}),e.jsx(L,{fullWidth:!0,label:"Password",type:j?"text":"password",value:t.password,onChange:s=>b("password",s.target.value),required:!0,InputProps:{startAdornment:e.jsx(J,{sx:{color:"#757575",mr:1}}),endAdornment:e.jsx(z,{position:"end",children:e.jsx(F,{"aria-label":"toggle password visibility",onClick:()=>u(!j),edge:"end",size:"small",children:j?e.jsx(R,{}):e.jsx(T,{})})})}})]}),e.jsx(k,{type:"submit",fullWidth:!0,variant:"contained",size:"large",sx:{py:1.5,fontSize:"1.1rem",fontWeight:"bold",mb:2,bgcolor:"#1565c0","&:hover":{bgcolor:"#1976d2"}},children:"Sign In"}),e.jsx(x,{sx:{textAlign:"center",mb:3},children:e.jsx(B,{component:"button",type:"button",onClick:A,sx:{color:"#1565c0",textDecoration:"none",fontSize:"0.95rem"},children:"Forgot your password?"})}),e.jsx(ne,{sx:{mb:3},children:e.jsx(p,{variant:"body2",color:"text.secondary",children:"New to FireEMS.AI?"})}),e.jsx(k,{fullWidth:!0,variant:"outlined",size:"large",onClick:()=>r("/signup"),sx:{py:1.5,fontSize:"1.1rem",fontWeight:"bold",borderColor:"#1565c0",color:"#1565c0","&:hover":{borderColor:"#1976d2",bgcolor:"rgba(21, 101, 192, 0.04)"}},children:"Create New Account"})]}),e.jsxs(x,{sx:{mt:4,p:3,bgcolor:"#f5f5f5",borderRadius:2},children:[e.jsxs(p,{variant:"body2",color:"text.secondary",align:"center",gutterBottom:!0,children:[e.jsx("strong",{children:"Demo Access:"})," While in development, you can access tools directly from the homepage."]}),e.jsx(k,{variant:"text",size:"small",onClick:()=>r("/"),sx:{display:"block",mx:"auto",color:"#1565c0"},children:"Return to Homepage"})]})]})}),e.jsx(x,{sx:{py:6,textAlign:"center"},children:e.jsxs(p,{variant:"body2",color:"text.secondary",children:["Need help? Contact our support team at"," ",e.jsx(B,{href:"mailto:support@fireems.ai",sx:{color:"#1565c0"},children:"support@fireems.ai"})]})}),e.jsx(ye,{open:w,onClose:()=>{},onSuccess:S,isTemporary:!0,userName:(y==null?void 0:y.name)||""}),e.jsx(be,{open:m,onClose:()=>f(!1)})]})};export{Re as default};
