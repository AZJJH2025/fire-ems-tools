import{d7 as Z,dj as $,r as o,j as e,d9 as j,H as k,I as C,ch as D,v as r,a9 as m,dk as I,Z as H,b7 as A,P as J,t as x,W,X as B,a1 as L,bt as R,bs as T,K,aa as X}from"./index-B6XOhqXj.js";import{L as N}from"./Lock-DQL_Gz3g.js";const U=()=>{const u=Z(),[f]=$(),c=f.get("token"),l=f.get("email"),[t,O]=o.useState(""),[a,z]=o.useState(""),[w,E]=o.useState(!1),[p,q]=o.useState(!1),[d,b]=o.useState(!1),[P,i]=o.useState(null),[F,V]=o.useState(!1),g=[{test:s=>s.length>=8,label:"At least 8 characters"},{test:s=>/[A-Z]/.test(s),label:"One uppercase letter"},{test:s=>/[a-z]/.test(s),label:"One lowercase letter"},{test:s=>/\d/.test(s),label:"One number"},{test:s=>/[!@#$%^&*(),.?\":{}|<>]/.test(s),label:"One special character"}],n=g.filter(s=>s.test(t)).length,y=n>=3;o.useEffect(()=>{(!c||!l)&&i("Invalid reset link. Please request a new password reset.")},[c,l]);const Y=async s=>{if(s.preventDefault(),!c||!l){i("Invalid reset link. Please request a new password reset.");return}if(!y){i("Password does not meet security requirements");return}if(t!==a){i("Passwords do not match");return}b(!0),i(null);try{const S=await(await fetch("/auth/api/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:l,token:c,newPassword:t,confirmPassword:a})})).json();S.success?(V(!0),setTimeout(()=>{u("/login",{state:{message:"Password reset successfully. You can now log in."}})},3e3)):i(S.message||"Failed to reset password")}catch(h){console.error("Password reset error:",h),i("An error occurred while resetting your password")}finally{b(!1)}},v=()=>n<=1?"error":n<=2?"warning":n<=3?"info":"success",G=()=>n<=1?"Weak":n<=2?"Fair":n<=3?"Good":"Strong";return!c||!l?e.jsx(j,{maxWidth:"sm",sx:{mt:8},children:e.jsx(k,{children:e.jsxs(C,{sx:{textAlign:"center",py:4},children:[e.jsx(D,{sx:{fontSize:64,color:"error.main",mb:2}}),e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Invalid Reset Link"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"This password reset link is invalid or has expired. Please request a new password reset."}),e.jsx(m,{variant:"contained",onClick:()=>u("/login"),startIcon:e.jsx(I,{}),children:"Back to Login"})]})})}):F?e.jsx(j,{maxWidth:"sm",sx:{mt:8},children:e.jsx(k,{children:e.jsxs(C,{sx:{textAlign:"center",py:4},children:[e.jsx(H,{sx:{fontSize:64,color:"success.main",mb:2}}),e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Password Reset Successfully"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Your password has been updated. You will be redirected to the login page shortly."}),e.jsx(A,{sx:{mb:2}}),e.jsx(m,{variant:"contained",onClick:()=>u("/login"),children:"Go to Login"})]})})}):e.jsx(j,{maxWidth:"sm",sx:{mt:8},children:e.jsxs(J,{elevation:3,sx:{p:4},children:[e.jsxs(x,{sx:{textAlign:"center",mb:4},children:[e.jsx(N,{sx:{fontSize:48,color:"primary.main",mb:2}}),e.jsx(r,{variant:"h4",gutterBottom:!0,children:"Reset Password"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Enter your new password for ",l]})]}),e.jsxs(x,{component:"form",onSubmit:Y,children:[e.jsx(W,{fullWidth:!0,label:"New Password",type:w?"text":"password",value:t,onChange:s=>O(s.target.value),disabled:d,sx:{mb:2},InputProps:{endAdornment:e.jsx(B,{position:"end",children:e.jsx(L,{onClick:()=>E(!w),edge:"end",children:w?e.jsx(R,{}):e.jsx(T,{})})})}}),t&&e.jsxs(x,{sx:{mb:2},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"body2",sx:{mr:1},children:"Password Strength:"}),e.jsx(r,{variant:"body2",color:`${v()}.main`,sx:{fontWeight:"bold"},children:G()})]}),e.jsx(A,{variant:"determinate",value:n/g.length*100,color:v(),sx:{mb:1}}),e.jsx(x,{children:g.map((s,h)=>e.jsxs(r,{variant:"caption",sx:{display:"block",color:s.test(t)?"success.main":"text.secondary"},children:[s.test(t)?"✓":"○"," ",s.label]},h))})]}),e.jsx(W,{fullWidth:!0,label:"Confirm New Password",type:p?"text":"password",value:a,onChange:s=>z(s.target.value),disabled:d,sx:{mb:3},error:a!==""&&t!==a,helperText:a!==""&&t!==a?"Passwords do not match":"",InputProps:{endAdornment:e.jsx(B,{position:"end",children:e.jsx(L,{onClick:()=>q(!p),edge:"end",children:p?e.jsx(R,{}):e.jsx(T,{})})})}}),P&&e.jsx(K,{severity:"error",sx:{mb:2},children:P}),e.jsx(m,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:d||!y||t!==a,startIcon:d?e.jsx(X,{size:20}):e.jsx(N,{}),sx:{mb:2},children:d?"Resetting Password...":"Reset Password"}),e.jsx(m,{fullWidth:!0,variant:"text",onClick:()=>u("/login"),disabled:d,startIcon:e.jsx(I,{}),children:"Back to Login"})]})]})})};export{U as default};
