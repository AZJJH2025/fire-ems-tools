import{h as K,i as Q,dh as I,aB as z,r as l,k as X,Q as ee,j as e,s as se,m as re,n as U,o as te,v as h,p as ne,cM as oe,cS as O,e as ae,aC as _,aT as J,t as x,aE as G,K as D,ch as ie,Z as le,W,X as R,a1 as E,bt as T,bs as N,b7 as ce,as as Y,a9 as k,bW as de,aa as ue,d7 as he,di as xe,d9 as q,bE as pe,P as me,D as ge}from"./index-5HY2vqT-.js";import{L as Z}from"./Lock-DzGGfzfD.js";function fe(r){return Q("MuiLink",r)}const we=K("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]),ye=({theme:r,ownerState:o})=>{const t=o.color,d=I(r,`palette.${t}.main`,!1)||I(r,`palette.${t}`,!1)||o.color,c=I(r,`palette.${t}.mainChannel`)||I(r,`palette.${t}Channel`);return"vars"in r&&c?`rgba(${c} / 0.4)`:z(d,.4)},B={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},be=r=>{const{classes:o,component:t,focusVisible:d,underline:c}=r,n={root:["root",`underline${U(c)}`,t==="button"&&"button",d&&"focusVisible"]};return te(n,fe,o)},je=se(h,{name:"MuiLink",slot:"Root",overridesResolver:(r,o)=>{const{ownerState:t}=r;return[o.root,o[`underline${U(t.underline)}`],t.component==="button"&&o.button]}})(ne(({theme:r})=>({variants:[{props:{underline:"none"},style:{textDecoration:"none"}},{props:{underline:"hover"},style:{textDecoration:"none","&:hover":{textDecoration:"underline"}}},{props:{underline:"always"},style:{textDecoration:"underline","&:hover":{textDecorationColor:"inherit"}}},{props:({underline:o,ownerState:t})=>o==="always"&&t.color!=="inherit",style:{textDecorationColor:"var(--Link-underlineColor)"}},...Object.entries(r.palette).filter(oe()).map(([o])=>({props:{underline:"always",color:o},style:{"--Link-underlineColor":r.vars?`rgba(${r.vars.palette[o].mainChannel} / 0.4)`:z(r.palette[o].main,.4)}})),{props:{underline:"always",color:"textPrimary"},style:{"--Link-underlineColor":r.vars?`rgba(${r.vars.palette.text.primaryChannel} / 0.4)`:z(r.palette.text.primary,.4)}},{props:{underline:"always",color:"textSecondary"},style:{"--Link-underlineColor":r.vars?`rgba(${r.vars.palette.text.secondaryChannel} / 0.4)`:z(r.palette.text.secondary,.4)}},{props:{underline:"always",color:"textDisabled"},style:{"--Link-underlineColor":(r.vars||r).palette.text.disabled}},{props:{component:"button"},style:{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${we.focusVisible}`]:{outline:"auto"}}}]}))),H=l.forwardRef(function(o,t){const d=X({props:o,name:"MuiLink"}),c=ee(),{className:n,color:f="primary",component:p="a",onBlur:j,onFocus:u,TypographyClasses:w,underline:v="always",variant:m="inherit",sx:g,...y}=d,[P,b]=l.useState(!1),C=s=>{O(s.target)||b(!1),j&&j(s)},F=s=>{O(s.target)&&b(!0),u&&u(s)},A={...d,color:f,component:p,focusVisible:P,underline:v,variant:m},S=be(A);return e.jsx(je,{color:f,className:re(S.root,n),classes:w,component:p,onBlur:C,onFocus:F,ref:t,ownerState:A,variant:m,...y,sx:[...B[f]===void 0?[{color:f}]:[],...Array.isArray(g)?g:[g]],style:{...y.style,...v==="always"&&f!=="inherit"&&!B[f]&&{"--Link-underlineColor":ye({theme:c,ownerState:A})}}})}),M=ae(e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"})),Pe=({open:r,onClose:o,onSuccess:t,isTemporary:d=!1,userName:c=""})=>{const[n,f]=l.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[p,j]=l.useState({current:!1,new:!1,confirm:!1}),[u,w]=l.useState(!1),[v,m]=l.useState(""),[g,y]=l.useState(!1),P=s=>a=>{f(i=>({...i,[s]:a.target.value})),m("")},b=s=>{j(a=>({...a,[s]:!a[s]}))},C=s=>{const a=[];return s.length<8&&a.push("At least 8 characters long"),/[A-Z]/.test(s)||a.push("One uppercase letter"),/[a-z]/.test(s)||a.push("One lowercase letter"),/[0-9]/.test(s)||a.push("One number"),a},F=s=>{const i=(4-C(s).length)/4*100;return i===100?{score:i,label:"Strong",color:"success"}:i>=75?{score:i,label:"Good",color:"info"}:i>=50?{score:i,label:"Fair",color:"warning"}:{score:i,label:"Weak",color:"error"}},A=async()=>{if(m(""),w(!0),!n.currentPassword||!n.newPassword||!n.confirmPassword){m("All fields are required"),w(!1);return}if(n.newPassword!==n.confirmPassword){m("New password and confirmation do not match"),w(!1);return}const s=C(n.newPassword);if(s.length>0){m(`Password must have: ${s.join(", ")}`),w(!1);return}try{const a=await fetch("/auth/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:n.currentPassword,newPassword:n.newPassword,confirmPassword:n.confirmPassword})}),i=await a.json();a.ok&&i.success?(y(!0),setTimeout(()=>{t(),o()},1500)):m(i.message||"Failed to change password")}catch{m("Network error. Please try again.")}finally{w(!1)}},S=F(n.newPassword);return e.jsxs(_,{open:r,onClose:d?void 0:o,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(J,{sx:{pb:1},children:[e.jsxs(x,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Z,{color:"primary"}),e.jsx(h,{variant:"h6",children:d?"Set Your Password":"Change Password"})]}),d&&e.jsxs(h,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Welcome ",c,"! Please set a secure password to continue."]})]}),e.jsxs(G,{sx:{pt:2},children:[v&&e.jsx(D,{severity:"error",sx:{mb:2},icon:e.jsx(ie,{}),children:v}),g&&e.jsx(D,{severity:"success",sx:{mb:2},icon:e.jsx(le,{}),children:"Password changed successfully! Redirecting..."}),e.jsxs(x,{component:"form",sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(W,{label:d?"Current Temporary Password":"Current Password",type:p.current?"text":"password",value:n.currentPassword,onChange:P("currentPassword"),required:!0,fullWidth:!0,disabled:u,InputProps:{endAdornment:e.jsx(R,{position:"end",children:e.jsx(E,{onClick:()=>b("current"),edge:"end",children:p.current?e.jsx(T,{}):e.jsx(N,{})})})}}),e.jsx(W,{label:"New Password",type:p.new?"text":"password",value:n.newPassword,onChange:P("newPassword"),required:!0,fullWidth:!0,disabled:u,InputProps:{endAdornment:e.jsx(R,{position:"end",children:e.jsx(E,{onClick:()=>b("new"),edge:"end",children:p.new?e.jsx(T,{}):e.jsx(N,{})})})}}),n.newPassword&&e.jsxs(x,{children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(h,{variant:"body2",children:"Password Strength"}),e.jsx(h,{variant:"body2",color:`${S.color}.main`,children:S.label})]}),e.jsx(ce,{variant:"determinate",value:S.score,color:S.color,sx:{height:8,borderRadius:4}})]}),e.jsx(W,{label:"Confirm New Password",type:p.confirm?"text":"password",value:n.confirmPassword,onChange:P("confirmPassword"),required:!0,fullWidth:!0,disabled:u,error:n.confirmPassword!==""&&n.newPassword!==n.confirmPassword,helperText:n.confirmPassword!==""&&n.newPassword!==n.confirmPassword?"Passwords do not match":"",InputProps:{endAdornment:e.jsx(R,{position:"end",children:e.jsx(E,{onClick:()=>b("confirm"),edge:"end",children:p.confirm?e.jsx(T,{}):e.jsx(N,{})})})}})]})]}),e.jsxs(Y,{sx:{px:3,pb:3},children:[!d&&e.jsx(k,{onClick:o,disabled:u,children:"Cancel"}),e.jsx(k,{onClick:A,variant:"contained",disabled:u||g,sx:{minWidth:120},children:u?"Changing...":d?"Set Password":"Change Password"})]})]})},ve=({open:r,onClose:o})=>{const[t,d]=l.useState(""),[c,n]=l.useState(!1),[f,p]=l.useState(null),[j,u]=l.useState(null),[w,v]=l.useState(!1),m=async P=>{if(P.preventDefault(),!t.trim()){u("Email address is required");return}if(!t.includes("@")||!t.includes(".")){u("Please enter a valid email address");return}n(!0),u(null),p(null);try{const C=await(await fetch("/auth/api/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:t})})).json();C.success?(p(C.message),v(!0)):u(C.message||"Failed to send reset email")}catch(b){console.error("Forgot password error:",b),u("An error occurred while sending the reset email")}finally{n(!1)}},g=()=>{c||(d(""),p(null),u(null),v(!1),o())},y=()=>{g()};return e.jsxs(_,{open:r,onClose:g,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,p:1}},children:[e.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:1,pb:1},children:[e.jsx(M,{color:"primary"}),e.jsx(h,{variant:"h6",component:"span",sx:{flexGrow:1},children:"Reset Password"}),e.jsx(E,{onClick:g,disabled:c,size:"small",children:e.jsx(de,{})})]}),e.jsx(G,{sx:{pt:1},children:w?e.jsxs(x,{sx:{textAlign:"center",py:2},children:[e.jsx(M,{sx:{fontSize:64,color:"primary.main",mb:2}}),e.jsx(h,{variant:"h6",gutterBottom:!0,children:"Check Your Email"}),e.jsxs(h,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["We've sent password reset instructions to ",e.jsx("strong",{children:t})]}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"Didn't receive the email? Check your spam folder or try again."})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Enter your email address and we'll send you a link to reset your password."}),e.jsxs(x,{component:"form",onSubmit:m,sx:{width:"100%"},children:[e.jsx(W,{fullWidth:!0,label:"Email Address",type:"email",value:t,onChange:P=>d(P.target.value),disabled:c,autoFocus:!0,sx:{mb:2},helperText:"Enter the email address associated with your account"}),j&&e.jsx(D,{severity:"error",sx:{mb:2},children:j}),f&&e.jsx(D,{severity:"success",sx:{mb:2},children:f})]})]})}),e.jsx(Y,{sx:{px:3,pb:3},children:w?e.jsx(e.Fragment,{children:e.jsx(k,{onClick:y,variant:"contained",fullWidth:!0,children:"Return to Login"})}):e.jsxs(e.Fragment,{children:[e.jsx(k,{onClick:g,disabled:c,children:"Cancel"}),e.jsx(k,{type:"submit",variant:"contained",onClick:m,disabled:c||!t.trim(),startIcon:c?e.jsx(ue,{size:20}):e.jsx(M,{}),children:c?"Sending...":"Send Reset Link"})]})})]})},ke=()=>{const r=he(),o=xe(),[t,d]=l.useState({email:"",password:""}),[c,n]=l.useState([]),[f,p]=l.useState(!1),[j,u]=l.useState(!1),[w,v]=l.useState(!1),[m,g]=l.useState(!1),[y,P]=l.useState(null);l.useEffect(()=>{new URLSearchParams(o.search).get("signup")==="success"&&p(!0)},[o]);const b=(s,a)=>{d(i=>({...i,[s]:a}))},C=()=>{const s=[];return t.email.trim()?t.email.includes("@")||s.push("Valid email is required"):s.push("Email is required"),t.password||s.push("Password is required"),n(s),s.length===0},F=async s=>{var a,i;if(s.preventDefault(),!!C())try{const L=await(await fetch("/auth/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,password:t.password,remember:!1})})).json();if(L.success){if(console.log("Login successful:",L.user),L.user.has_temp_password){P(L.user),v(!0);return}const V=((i=(a=o.state)==null?void 0:a.from)==null?void 0:i.pathname)||"/";L.user.role==="super_admin"||L.user.role==="admin"?r(V==="/"?"/admin":V):r(V)}else n([L.message||"Login failed"])}catch($){console.error("Login error:",$),n(["An error occurred during login. Please try again."])}},A=()=>{g(!0)},S=()=>{var a,i;const s=((i=(a=o.state)==null?void 0:a.from)==null?void 0:i.pathname)||"/";y.role==="super_admin"||y.role==="admin"?r(s==="/"?"/admin":s):r(s)};return e.jsxs(x,{sx:{minHeight:"100vh",bgcolor:"#f5f5f5"},children:[e.jsx(x,{sx:{background:"linear-gradient(135deg, #1565c0 0%, #1976d2 50%, #1e88e5 100%)",minHeight:"40vh",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:e.jsx(q,{maxWidth:"lg",children:e.jsxs(x,{sx:{textAlign:"center",color:"white"},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:[e.jsx(pe,{sx:{fontSize:60,mr:2}}),e.jsx(h,{variant:"h3",sx:{fontWeight:"bold"},children:"FireEMS.AI"})]}),e.jsx(h,{variant:"h5",sx:{opacity:.9},children:"Welcome back to your fire department analytics suite"})]})})}),e.jsx(q,{maxWidth:"sm",sx:{mt:-8,position:"relative",zIndex:1},children:e.jsxs(me,{sx:{p:4,boxShadow:"0 8px 32px rgba(0,0,0,0.1)"},children:[e.jsxs(x,{sx:{textAlign:"center",mb:4},children:[e.jsx(h,{variant:"h4",gutterBottom:!0,sx:{fontWeight:"bold",color:"#1565c0"},children:"Sign In"}),e.jsx(h,{variant:"body1",color:"text.secondary",children:"Access your department's analytics and reporting tools"})]}),f&&e.jsx(D,{severity:"success",sx:{mb:3},children:"Account created successfully! Please sign in with your credentials."}),c.length>0&&e.jsx(D,{severity:"error",sx:{mb:3},children:e.jsx(x,{children:c.map((s,a)=>e.jsxs(h,{variant:"body2",children:["• ",s]},a))})}),e.jsxs("form",{onSubmit:F,children:[e.jsxs(x,{sx:{mb:3},children:[e.jsx(W,{fullWidth:!0,label:"Email Address",type:"email",value:t.email,onChange:s=>b("email",s.target.value),placeholder:"chief@department.gov",required:!0,InputProps:{startAdornment:e.jsx(M,{sx:{color:"#757575",mr:1}})},sx:{mb:2}}),e.jsx(W,{fullWidth:!0,label:"Password",type:j?"text":"password",value:t.password,onChange:s=>b("password",s.target.value),required:!0,InputProps:{startAdornment:e.jsx(Z,{sx:{color:"#757575",mr:1}}),endAdornment:e.jsx(R,{position:"end",children:e.jsx(E,{"aria-label":"toggle password visibility",onClick:()=>u(!j),edge:"end",size:"small",children:j?e.jsx(T,{}):e.jsx(N,{})})})}})]}),e.jsx(k,{type:"submit",fullWidth:!0,variant:"contained",size:"large",sx:{py:1.5,fontSize:"1.1rem",fontWeight:"bold",mb:2,bgcolor:"#1565c0","&:hover":{bgcolor:"#1976d2"}},children:"Sign In"}),e.jsx(x,{sx:{textAlign:"center",mb:3},children:e.jsx(H,{component:"button",type:"button",onClick:A,sx:{color:"#1565c0",textDecoration:"none",fontSize:"0.95rem"},children:"Forgot your password?"})}),e.jsx(ge,{sx:{mb:3},children:e.jsx(h,{variant:"body2",color:"text.secondary",children:"New to FireEMS.AI?"})}),e.jsx(k,{fullWidth:!0,variant:"outlined",size:"large",onClick:()=>r("/signup"),sx:{py:1.5,fontSize:"1.1rem",fontWeight:"bold",borderColor:"#1565c0",color:"#1565c0","&:hover":{borderColor:"#1976d2",bgcolor:"rgba(21, 101, 192, 0.04)"}},children:"Create New Account"})]}),e.jsxs(x,{sx:{mt:4,p:3,bgcolor:"#f5f5f5",borderRadius:2},children:[e.jsxs(h,{variant:"body2",color:"text.secondary",align:"center",gutterBottom:!0,children:[e.jsx("strong",{children:"Demo Access:"})," While in development, you can access tools directly from the homepage."]}),e.jsx(k,{variant:"text",size:"small",onClick:()=>r("/"),sx:{display:"block",mx:"auto",color:"#1565c0"},children:"Return to Homepage"})]})]})}),e.jsx(x,{sx:{py:6,textAlign:"center"},children:e.jsxs(h,{variant:"body2",color:"text.secondary",children:["Need help? Contact our support team at"," ",e.jsx(H,{href:"mailto:support@fireems.ai",sx:{color:"#1565c0"},children:"support@fireems.ai"})]})}),e.jsx(Pe,{open:w,onClose:()=>{},onSuccess:S,isTemporary:!0,userName:(y==null?void 0:y.name)||""}),e.jsx(ve,{open:m,onClose:()=>g(!1)})]})};export{ke as default};
